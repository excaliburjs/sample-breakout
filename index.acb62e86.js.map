{"mappings":"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","sources":["node_modules/excalibur/build/node_modules/core-js/es/array/sort.js","node_modules/excalibur/build/node_modules/core-js/es/object/keys.js","node_modules/excalibur/build/node_modules/core-js/internals/a-callable.js","node_modules/excalibur/build/node_modules/core-js/internals/an-object.js","node_modules/excalibur/build/node_modules/core-js/internals/array-includes.js","node_modules/excalibur/build/node_modules/core-js/internals/array-method-is-strict.js","node_modules/excalibur/build/node_modules/core-js/internals/array-slice-simple.js","node_modules/excalibur/build/node_modules/core-js/internals/array-sort.js","node_modules/excalibur/build/node_modules/core-js/internals/classof-raw.js","node_modules/excalibur/build/node_modules/core-js/internals/classof.js","node_modules/excalibur/build/node_modules/core-js/internals/copy-constructor-properties.js","node_modules/excalibur/build/node_modules/core-js/internals/create-non-enumerable-property.js","node_modules/excalibur/build/node_modules/core-js/internals/create-property-descriptor.js","node_modules/excalibur/build/node_modules/core-js/internals/create-property.js","node_modules/excalibur/build/node_modules/core-js/internals/descriptors.js","node_modules/excalibur/build/node_modules/core-js/internals/document-create-element.js","node_modules/excalibur/build/node_modules/core-js/internals/engine-ff-version.js","node_modules/excalibur/build/node_modules/core-js/internals/engine-is-ie-or-edge.js","node_modules/excalibur/build/node_modules/core-js/internals/engine-user-agent.js","node_modules/excalibur/build/node_modules/core-js/internals/engine-v8-version.js","node_modules/excalibur/build/node_modules/core-js/internals/engine-webkit-version.js","node_modules/excalibur/build/node_modules/core-js/internals/entry-unbind.js","node_modules/excalibur/build/node_modules/core-js/internals/enum-bug-keys.js","node_modules/excalibur/build/node_modules/core-js/internals/export.js","node_modules/excalibur/build/node_modules/core-js/internals/fails.js","node_modules/excalibur/build/node_modules/core-js/internals/function-bind-native.js","node_modules/excalibur/build/node_modules/core-js/internals/function-call.js","node_modules/excalibur/build/node_modules/core-js/internals/function-name.js","node_modules/excalibur/build/node_modules/core-js/internals/function-uncurry-this.js","node_modules/excalibur/build/node_modules/core-js/internals/get-built-in.js","node_modules/excalibur/build/node_modules/core-js/internals/get-method.js","node_modules/excalibur/build/node_modules/core-js/internals/global.js","node_modules/excalibur/build/node_modules/core-js/internals/has-own-property.js","node_modules/excalibur/build/node_modules/core-js/internals/hidden-keys.js","node_modules/excalibur/build/node_modules/core-js/internals/ie8-dom-define.js","node_modules/excalibur/build/node_modules/core-js/internals/indexed-object.js","node_modules/excalibur/build/node_modules/core-js/internals/inspect-source.js","node_modules/excalibur/build/node_modules/core-js/internals/internal-state.js","node_modules/excalibur/build/node_modules/core-js/internals/is-callable.js","node_modules/excalibur/build/node_modules/core-js/internals/is-forced.js","node_modules/excalibur/build/node_modules/core-js/internals/is-object.js","node_modules/excalibur/build/node_modules/core-js/internals/is-pure.js","node_modules/excalibur/build/node_modules/core-js/internals/is-symbol.js","node_modules/excalibur/build/node_modules/core-js/internals/length-of-array-like.js","node_modules/excalibur/build/node_modules/core-js/internals/native-symbol.js","node_modules/excalibur/build/node_modules/core-js/internals/native-weak-map.js","node_modules/excalibur/build/node_modules/core-js/internals/object-define-property.js","node_modules/excalibur/build/node_modules/core-js/internals/object-get-own-property-descriptor.js","node_modules/excalibur/build/node_modules/core-js/internals/object-get-own-property-names.js","node_modules/excalibur/build/node_modules/core-js/internals/object-get-own-property-symbols.js","node_modules/excalibur/build/node_modules/core-js/internals/object-is-prototype-of.js","node_modules/excalibur/build/node_modules/core-js/internals/object-keys-internal.js","node_modules/excalibur/build/node_modules/core-js/internals/object-keys.js","node_modules/excalibur/build/node_modules/core-js/internals/object-property-is-enumerable.js","node_modules/excalibur/build/node_modules/core-js/internals/ordinary-to-primitive.js","node_modules/excalibur/build/node_modules/core-js/internals/own-keys.js","node_modules/excalibur/build/node_modules/core-js/internals/path.js","node_modules/excalibur/build/node_modules/core-js/internals/redefine.js","node_modules/excalibur/build/node_modules/core-js/internals/require-object-coercible.js","node_modules/excalibur/build/node_modules/core-js/internals/set-global.js","node_modules/excalibur/build/node_modules/core-js/internals/shared-key.js","node_modules/excalibur/build/node_modules/core-js/internals/shared-store.js","node_modules/excalibur/build/node_modules/core-js/internals/shared.js","node_modules/excalibur/build/node_modules/core-js/internals/to-absolute-index.js","node_modules/excalibur/build/node_modules/core-js/internals/to-indexed-object.js","node_modules/excalibur/build/node_modules/core-js/internals/to-integer-or-infinity.js","node_modules/excalibur/build/node_modules/core-js/internals/to-length.js","node_modules/excalibur/build/node_modules/core-js/internals/to-object.js","node_modules/excalibur/build/node_modules/core-js/internals/to-primitive.js","node_modules/excalibur/build/node_modules/core-js/internals/to-property-key.js","node_modules/excalibur/build/node_modules/core-js/internals/to-string-tag-support.js","node_modules/excalibur/build/node_modules/core-js/internals/to-string.js","node_modules/excalibur/build/node_modules/core-js/internals/try-to-string.js","node_modules/excalibur/build/node_modules/core-js/internals/uid.js","node_modules/excalibur/build/node_modules/core-js/internals/use-symbol-as-uid.js","node_modules/excalibur/build/node_modules/core-js/internals/v8-prototype-define-bug.js","node_modules/excalibur/build/node_modules/core-js/internals/well-known-symbol.js","node_modules/excalibur/build/node_modules/core-js/modules/es.array.sort.js","node_modules/excalibur/build/node_modules/core-js/modules/es.object.keys.js","node_modules/excalibur/build/esm/webpack:/Loader.css","node_modules/excalibur/build/node_modules/css-loader/dist/runtime/api.js","node_modules/excalibur/build/node_modules/css-loader/dist/runtime/sourceMaps.js","node_modules/excalibur/build/esm/webpack:/webpack/bootstrap","node_modules/excalibur/build/esm/webpack:/webpack/runtime/compat get default export","node_modules/excalibur/build/esm/webpack:/webpack/runtime/define property getters","node_modules/excalibur/build/esm/webpack:/webpack/runtime/global","node_modules/excalibur/build/esm/webpack:/webpack/runtime/hasOwnProperty shorthand","node_modules/excalibur/build/esm/webpack:/webpack/runtime/make namespace object","node_modules/excalibur/build/esm/webpack:/Flags.ts","node_modules/excalibur/build/esm/webpack:/Util/Log.ts","node_modules/excalibur/build/esm/webpack:/Polyfill.ts","node_modules/excalibur/build/esm/webpack:/Id.ts","node_modules/excalibur/build/esm/webpack:/Util/Decorators.ts","node_modules/excalibur/build/esm/webpack:/Math/vector.ts","node_modules/excalibur/build/esm/webpack:/Color.ts","node_modules/excalibur/build/esm/webpack:/Math/Random.ts","node_modules/excalibur/build/esm/webpack:/Collision/Side.ts","node_modules/excalibur/build/esm/webpack:/Collision/BoundingBox.ts","node_modules/excalibur/build/esm/webpack:/Math/util.ts","node_modules/excalibur/build/esm/webpack:/Util/Util.ts","node_modules/excalibur/build/esm/webpack:/Math/matrix.ts","node_modules/excalibur/build/esm/webpack:/Graphics/Context/transform-stack.ts","node_modules/excalibur/build/esm/webpack:/Graphics/Context/state-stack.ts","node_modules/excalibur/build/esm/webpack:/Util/Watch.ts","node_modules/excalibur/build/esm/webpack:/Graphics/Graphic.ts","node_modules/excalibur/build/esm/webpack:/Drawing/Sprite.ts","node_modules/excalibur/build/esm/webpack:/Graphics/Context/webgl-util.ts","node_modules/excalibur/build/esm/webpack:/Graphics/Filtering.ts","node_modules/excalibur/build/esm/webpack:/Graphics/Context/texture-loader.ts","node_modules/excalibur/build/esm/webpack:/Graphics/Raster.ts","node_modules/excalibur/build/esm/webpack:/Graphics/Canvas.ts","node_modules/excalibur/build/esm/webpack:/Events.ts","node_modules/excalibur/build/esm/webpack:/EventDispatcher.ts","node_modules/excalibur/build/esm/webpack:/Resources/Resource.ts","node_modules/excalibur/build/esm/webpack:/Drawing/SpriteEffects.ts","node_modules/excalibur/build/esm/webpack:/Drawing/Texture.ts","node_modules/excalibur/build/esm/webpack:/Configurable.ts","node_modules/excalibur/build/esm/webpack:/Graphics/Sprite.ts","node_modules/excalibur/build/esm/webpack:/Graphics/ImageSource.ts","node_modules/excalibur/build/esm/webpack:/Drawing/Animation.ts","node_modules/excalibur/build/esm/webpack:/Graphics/FontCommon.ts","node_modules/excalibur/build/esm/webpack:/Drawing/SpriteSheet.ts","node_modules/excalibur/build/esm/webpack:/Graphics/SpriteSheet.ts","node_modules/excalibur/build/esm/webpack:/Graphics/SpriteFont.ts","node_modules/excalibur/build/esm/webpack:/Graphics/Context/debug-font.png","node_modules/excalibur/build/esm/webpack:/Graphics/Context/debug-text.ts","node_modules/excalibur/build/esm/webpack:/Graphics/Context/render-source.ts","node_modules/excalibur/build/esm/webpack:/Graphics/Context/render-target.ts","node_modules/excalibur/build/esm/webpack:/Graphics/Context/webgl-adapter.ts","node_modules/excalibur/build/esm/webpack:/Graphics/Context/line-renderer/line-vertex.glsl","node_modules/excalibur/build/esm/webpack:/Graphics/Context/line-renderer/line-fragment.glsl","node_modules/excalibur/build/esm/webpack:/Graphics/Context/shader.ts","node_modules/excalibur/build/esm/webpack:/Graphics/Context/vertex-buffer.ts","node_modules/excalibur/build/esm/webpack:/Graphics/Context/vertex-layout.ts","node_modules/excalibur/build/esm/webpack:/Graphics/GraphicsDiagnostics.ts","node_modules/excalibur/build/esm/webpack:/Graphics/Context/line-renderer/line-renderer.ts","node_modules/excalibur/build/esm/webpack:/Graphics/Context/point-renderer/point-vertex.glsl","node_modules/excalibur/build/esm/webpack:/Graphics/Context/point-renderer/point-renderer.ts","node_modules/excalibur/build/esm/webpack:/Graphics/Context/screen-pass-painter/screen-vertex.glsl","node_modules/excalibur/build/esm/webpack:/Graphics/Context/screen-pass-painter/screen-pass-painter.ts","node_modules/excalibur/build/esm/webpack:/Graphics/Context/quad-index-buffer.ts","node_modules/excalibur/build/esm/webpack:/Graphics/Context/image-renderer/image-renderer.frag.glsl","node_modules/excalibur/build/esm/webpack:/Graphics/Context/image-renderer/image-renderer.vert.glsl","node_modules/excalibur/build/esm/webpack:/Graphics/Context/image-renderer/image-renderer.ts","node_modules/excalibur/build/esm/webpack:/Graphics/Context/rectangle-renderer/rectangle-renderer.frag.glsl","node_modules/excalibur/build/esm/webpack:/Graphics/Context/rectangle-renderer/rectangle-renderer.ts","node_modules/excalibur/build/esm/webpack:/Graphics/Context/circle-renderer/circle-renderer.vert.glsl","node_modules/excalibur/build/esm/webpack:/Graphics/Context/circle-renderer/circle-renderer.ts","node_modules/excalibur/build/esm/webpack:/Graphics/Context/ExcaliburGraphicsContextWebGL.ts","node_modules/excalibur/build/esm/webpack:/Screen.ts","node_modules/excalibur/build/esm/webpack:/Resources/Sound/AudioContext.ts","node_modules/excalibur/build/esm/webpack:/Util/WebAudio.ts","node_modules/excalibur/build/esm/webpack:/Class.ts","node_modules/excalibur/build/esm/webpack:/Util/DrawUtil.ts","node_modules/excalibur/build/esm/webpack:/Loader.logo.png","node_modules/excalibur/build/esm/webpack:/Loader.ts","node_modules/excalibur/build/esm/webpack:/Util/Detector.ts","node_modules/excalibur/build/esm/webpack:/Collision/CollisionType.ts","node_modules/excalibur/build/esm/webpack:/Collision/Physics.ts","node_modules/excalibur/build/esm/webpack:/Math/vector-view.ts","node_modules/excalibur/build/esm/webpack:/EntityComponentSystem/Component.ts","node_modules/excalibur/build/esm/webpack:/EntityComponentSystem/Components/TransformComponent.ts","node_modules/excalibur/build/esm/webpack:/EntityComponentSystem/Components/MotionComponent.ts","node_modules/excalibur/build/esm/webpack:/Collision/Group/CollisionGroup.ts","node_modules/excalibur/build/esm/webpack:/Util/Observable.ts","node_modules/excalibur/build/esm/webpack:/Collision/Detection/Pair.ts","node_modules/excalibur/build/esm/webpack:/Math/projection.ts","node_modules/excalibur/build/esm/webpack:/Collision/Detection/DynamicTree.ts","node_modules/excalibur/build/esm/webpack:/Math/ray.ts","node_modules/excalibur/build/esm/webpack:/Collision/Detection/DynamicTreeCollisionProcessor.ts","node_modules/excalibur/build/esm/webpack:/Collision/Colliders/Collider.ts","node_modules/excalibur/build/esm/webpack:/Collision/Colliders/CompositeCollider.ts","node_modules/excalibur/build/esm/webpack:/Math/line.ts","node_modules/excalibur/build/esm/webpack:/Collision/Colliders/ClosestLineJumpTable.ts","node_modules/excalibur/build/esm/webpack:/Collision/Colliders/CircleCollider.ts","node_modules/excalibur/build/esm/webpack:/Collision/Detection/CollisionContact.ts","node_modules/excalibur/build/esm/webpack:/Collision/Colliders/SeparatingAxis.ts","node_modules/excalibur/build/esm/webpack:/Collision/Colliders/CollisionJumpTable.ts","node_modules/excalibur/build/esm/webpack:/Collision/Colliders/EdgeCollider.ts","node_modules/excalibur/build/esm/webpack:/Collision/Colliders/PolygonCollider.ts","node_modules/excalibur/build/esm/webpack:/Collision/Colliders/Shape.ts","node_modules/excalibur/build/esm/webpack:/Collision/ColliderComponent.ts","node_modules/excalibur/build/esm/webpack:/Collision/BodyComponent.ts","node_modules/excalibur/build/esm/webpack:/Util/CullingBox.ts","node_modules/excalibur/build/esm/webpack:/Traits/OffscreenCulling.ts","node_modules/excalibur/build/esm/webpack:/EntityComponentSystem/Entity.ts","node_modules/excalibur/build/esm/webpack:/Drawing/CanvasDrawComponent.ts","node_modules/excalibur/build/esm/webpack:/Graphics/GraphicsComponent.ts","node_modules/excalibur/build/esm/webpack:/Graphics/Rectangle.ts","node_modules/excalibur/build/esm/webpack:/Graphics/Circle.ts","node_modules/excalibur/build/esm/webpack:/Input/PointerComponent.ts","node_modules/excalibur/build/esm/webpack:/Util/EasingFunctions.ts","node_modules/excalibur/build/esm/webpack:/Actions/ActionQueue.ts","node_modules/excalibur/build/esm/webpack:/Actions/Action/Repeat.ts","node_modules/excalibur/build/esm/webpack:/Actions/Action/RepeatForever.ts","node_modules/excalibur/build/esm/webpack:/Actions/Action/MoveBy.ts","node_modules/excalibur/build/esm/webpack:/Actions/Action/MoveTo.ts","node_modules/excalibur/build/esm/webpack:/Actions/RotationType.ts","node_modules/excalibur/build/esm/webpack:/Actions/Action/RotateTo.ts","node_modules/excalibur/build/esm/webpack:/Actions/Action/RotateBy.ts","node_modules/excalibur/build/esm/webpack:/Actions/Action/ScaleTo.ts","node_modules/excalibur/build/esm/webpack:/Actions/Action/ScaleBy.ts","node_modules/excalibur/build/esm/webpack:/Actions/Action/CallMethod.ts","node_modules/excalibur/build/esm/webpack:/Actions/Action/EaseTo.ts","node_modules/excalibur/build/esm/webpack:/Actions/Action/Blink.ts","node_modules/excalibur/build/esm/webpack:/Actions/Action/Fade.ts","node_modules/excalibur/build/esm/webpack:/Actions/Action/Delay.ts","node_modules/excalibur/build/esm/webpack:/Actions/Action/Die.ts","node_modules/excalibur/build/esm/webpack:/Actions/Action/Follow.ts","node_modules/excalibur/build/esm/webpack:/Actions/Action/Meet.ts","node_modules/excalibur/build/esm/webpack:/Actions/ActionContext.ts","node_modules/excalibur/build/esm/webpack:/Actions/ActionsComponent.ts","node_modules/excalibur/build/esm/webpack:/Graphics/Font.ts","node_modules/excalibur/build/esm/webpack:/Graphics/Text.ts","node_modules/excalibur/build/esm/webpack:/Actor.ts","node_modules/excalibur/build/esm/webpack:/ScreenElement.ts","node_modules/excalibur/build/esm/webpack:/Timer.ts","node_modules/excalibur/build/esm/webpack:/Graphics/DebugGraphicsComponent.ts","node_modules/excalibur/build/esm/webpack:/TileMap.ts","node_modules/excalibur/build/esm/webpack:/Camera.ts","node_modules/excalibur/build/esm/webpack:/EntityComponentSystem/QueryManager.ts","node_modules/excalibur/build/esm/webpack:/Trigger.ts","node_modules/excalibur/build/esm/webpack:/EntityComponentSystem/System.ts","node_modules/excalibur/build/esm/webpack:/EntityComponentSystem/EntityManager.ts","node_modules/excalibur/build/esm/webpack:/EntityComponentSystem/Query.ts","node_modules/excalibur/build/esm/webpack:/EntityComponentSystem/Util.ts","node_modules/excalibur/build/esm/webpack:/EntityComponentSystem/SystemManager.ts","node_modules/excalibur/build/esm/webpack:/EntityComponentSystem/World.ts","node_modules/excalibur/build/esm/webpack:/Collision/Integrator.ts","node_modules/excalibur/build/esm/webpack:/Collision/MotionSystem.ts","node_modules/excalibur/build/esm/webpack:/Collision/Solver/Solver.ts","node_modules/excalibur/build/esm/webpack:/Collision/Solver/ArcadeSolver.ts","node_modules/excalibur/build/esm/webpack:/Collision/Solver/ContactConstraintPoint.ts","node_modules/excalibur/build/esm/webpack:/Collision/Solver/RealisticSolver.ts","node_modules/excalibur/build/esm/webpack:/Collision/CollisionSystem.ts","node_modules/excalibur/build/esm/webpack:/Graphics/Animation.ts","node_modules/excalibur/build/esm/webpack:/Graphics/GraphicsGroup.ts","node_modules/excalibur/build/esm/webpack:/Particles.ts","node_modules/excalibur/build/esm/webpack:/Graphics/GraphicsSystem.ts","node_modules/excalibur/build/esm/webpack:/Drawing/CanvasDrawingSystem.ts","node_modules/excalibur/build/esm/webpack:/Debug/DebugSystem.ts","node_modules/excalibur/build/esm/webpack:/Input/PointerSystem.ts","node_modules/excalibur/build/esm/webpack:/Actions/ActionsSystem.ts","node_modules/excalibur/build/esm/webpack:/Scene.ts","node_modules/excalibur/build/esm/webpack:/Graphics/PostProcessor/color-blind-fragment.glsl","node_modules/excalibur/build/esm/webpack:/Graphics/PostProcessor/ScreenShader.ts","node_modules/excalibur/build/esm/webpack:/Graphics/PostProcessor/ColorBlindnessPostProcessor.ts","node_modules/excalibur/build/esm/webpack:/Debug/DebugFlags.ts","node_modules/excalibur/build/esm/webpack:/Debug/Debug.ts","node_modules/excalibur/build/esm/webpack:/Input/PointerScope.ts","node_modules/excalibur/build/esm/webpack:/Input/Keyboard.ts","node_modules/excalibur/build/esm/webpack:/Input/Gamepad.ts","node_modules/excalibur/build/esm/webpack:/Util/Browser.ts","node_modules/excalibur/build/esm/webpack:/Graphics/Context/ExcaliburGraphicsContext2DCanvas.ts","node_modules/excalibur/build/esm/webpack:/Math/global-coordinates.ts","node_modules/excalibur/build/esm/webpack:/Input/PointerEvent.ts","node_modules/excalibur/build/esm/webpack:/Input/WheelEvent.ts","node_modules/excalibur/build/esm/webpack:/Input/PointerAbstraction.ts","node_modules/excalibur/build/esm/webpack:/Input/WheelDeltaMode.ts","node_modules/excalibur/build/esm/webpack:/Input/NativePointerButton.ts","node_modules/excalibur/build/esm/webpack:/Input/PointerButton.ts","node_modules/excalibur/build/esm/webpack:/Input/PointerType.ts","node_modules/excalibur/build/esm/webpack:/Input/PointerEventReceiver.ts","node_modules/excalibur/build/esm/webpack:/Util/Fps.ts","node_modules/excalibur/build/esm/webpack:/Util/Clock.ts","node_modules/excalibur/build/esm/webpack:/Engine.ts","node_modules/excalibur/build/esm/webpack:/Drawing/Polygon.ts","node_modules/excalibur/build/esm/webpack:/Events/MediaEvents.ts","node_modules/excalibur/build/esm/webpack:/Label.ts","node_modules/excalibur/build/esm/webpack:/Collision/Group/CollisionGroupManager.ts","node_modules/excalibur/build/esm/webpack:/Interfaces/AudioImplementation.ts","node_modules/excalibur/build/esm/webpack:/Interfaces/LifecycleEvents.ts","node_modules/excalibur/build/esm/webpack:/Resources/Sound/WebAudioInstance.ts","node_modules/excalibur/build/esm/webpack:/Util/Sound.ts","node_modules/excalibur/build/esm/webpack:/Resources/Sound/Sound.ts","node_modules/excalibur/build/esm/webpack:/Resources/Gif.ts","node_modules/excalibur/build/esm/webpack:/Graphics/Polygon.ts","node_modules/excalibur/build/esm/webpack:/Util/SortedList.ts","node_modules/excalibur/build/esm/webpack:/Util/Pool.ts","node_modules/excalibur/build/esm/webpack:/Promises.ts","node_modules/excalibur/build/esm/webpack:/index.ts","src/main.ts"],"sourcesContent":["require('../../modules/es.array.sort');\nvar entryUnbind = require('../../internals/entry-unbind');\n\nmodule.exports = entryUnbind('Array', 'sort');\n","require('../../modules/es.object.keys');\nvar path = require('../../internals/path');\n\nmodule.exports = path.Object.keys;\n","var global = require('../internals/global');\nvar isCallable = require('../internals/is-callable');\nvar tryToString = require('../internals/try-to-string');\n\nvar TypeError = global.TypeError;\n\n// `Assert: IsCallable(argument) is true`\nmodule.exports = function (argument) {\n  if (isCallable(argument)) return argument;\n  throw TypeError(tryToString(argument) + ' is not a function');\n};\n","var global = require('../internals/global');\nvar isObject = require('../internals/is-object');\n\nvar String = global.String;\nvar TypeError = global.TypeError;\n\n// `Assert: Type(argument) is Object`\nmodule.exports = function (argument) {\n  if (isObject(argument)) return argument;\n  throw TypeError(String(argument) + ' is not an object');\n};\n","var toIndexedObject = require('../internals/to-indexed-object');\nvar toAbsoluteIndex = require('../internals/to-absolute-index');\nvar lengthOfArrayLike = require('../internals/length-of-array-like');\n\n// `Array.prototype.{ indexOf, includes }` methods implementation\nvar createMethod = function (IS_INCLUDES) {\n  return function ($this, el, fromIndex) {\n    var O = toIndexedObject($this);\n    var length = lengthOfArrayLike(O);\n    var index = toAbsoluteIndex(fromIndex, length);\n    var value;\n    // Array#includes uses SameValueZero equality algorithm\n    // eslint-disable-next-line no-self-compare -- NaN check\n    if (IS_INCLUDES && el != el) while (length > index) {\n      value = O[index++];\n      // eslint-disable-next-line no-self-compare -- NaN check\n      if (value != value) return true;\n    // Array#indexOf ignores holes, Array#includes - not\n    } else for (;length > index; index++) {\n      if ((IS_INCLUDES || index in O) && O[index] === el) return IS_INCLUDES || index || 0;\n    } return !IS_INCLUDES && -1;\n  };\n};\n\nmodule.exports = {\n  // `Array.prototype.includes` method\n  // https://tc39.es/ecma262/#sec-array.prototype.includes\n  includes: createMethod(true),\n  // `Array.prototype.indexOf` method\n  // https://tc39.es/ecma262/#sec-array.prototype.indexof\n  indexOf: createMethod(false)\n};\n","'use strict';\nvar fails = require('../internals/fails');\n\nmodule.exports = function (METHOD_NAME, argument) {\n  var method = [][METHOD_NAME];\n  return !!method && fails(function () {\n    // eslint-disable-next-line no-useless-call,no-throw-literal -- required for testing\n    method.call(null, argument || function () { throw 1; }, 1);\n  });\n};\n","var global = require('../internals/global');\nvar toAbsoluteIndex = require('../internals/to-absolute-index');\nvar lengthOfArrayLike = require('../internals/length-of-array-like');\nvar createProperty = require('../internals/create-property');\n\nvar Array = global.Array;\nvar max = Math.max;\n\nmodule.exports = function (O, start, end) {\n  var length = lengthOfArrayLike(O);\n  var k = toAbsoluteIndex(start, length);\n  var fin = toAbsoluteIndex(end === undefined ? length : end, length);\n  var result = Array(max(fin - k, 0));\n  for (var n = 0; k < fin; k++, n++) createProperty(result, n, O[k]);\n  result.length = n;\n  return result;\n};\n","var arraySlice = require('../internals/array-slice-simple');\n\nvar floor = Math.floor;\n\nvar mergeSort = function (array, comparefn) {\n  var length = array.length;\n  var middle = floor(length / 2);\n  return length < 8 ? insertionSort(array, comparefn) : merge(\n    array,\n    mergeSort(arraySlice(array, 0, middle), comparefn),\n    mergeSort(arraySlice(array, middle), comparefn),\n    comparefn\n  );\n};\n\nvar insertionSort = function (array, comparefn) {\n  var length = array.length;\n  var i = 1;\n  var element, j;\n\n  while (i < length) {\n    j = i;\n    element = array[i];\n    while (j && comparefn(array[j - 1], element) > 0) {\n      array[j] = array[--j];\n    }\n    if (j !== i++) array[j] = element;\n  } return array;\n};\n\nvar merge = function (array, left, right, comparefn) {\n  var llength = left.length;\n  var rlength = right.length;\n  var lindex = 0;\n  var rindex = 0;\n\n  while (lindex < llength || rindex < rlength) {\n    array[lindex + rindex] = (lindex < llength && rindex < rlength)\n      ? comparefn(left[lindex], right[rindex]) <= 0 ? left[lindex++] : right[rindex++]\n      : lindex < llength ? left[lindex++] : right[rindex++];\n  } return array;\n};\n\nmodule.exports = mergeSort;\n","var uncurryThis = require('../internals/function-uncurry-this');\n\nvar toString = uncurryThis({}.toString);\nvar stringSlice = uncurryThis(''.slice);\n\nmodule.exports = function (it) {\n  return stringSlice(toString(it), 8, -1);\n};\n","var global = require('../internals/global');\nvar TO_STRING_TAG_SUPPORT = require('../internals/to-string-tag-support');\nvar isCallable = require('../internals/is-callable');\nvar classofRaw = require('../internals/classof-raw');\nvar wellKnownSymbol = require('../internals/well-known-symbol');\n\nvar TO_STRING_TAG = wellKnownSymbol('toStringTag');\nvar Object = global.Object;\n\n// ES3 wrong here\nvar CORRECT_ARGUMENTS = classofRaw(function () { return arguments; }()) == 'Arguments';\n\n// fallback for IE11 Script Access Denied error\nvar tryGet = function (it, key) {\n  try {\n    return it[key];\n  } catch (error) { /* empty */ }\n};\n\n// getting tag from ES6+ `Object.prototype.toString`\nmodule.exports = TO_STRING_TAG_SUPPORT ? classofRaw : function (it) {\n  var O, tag, result;\n  return it === undefined ? 'Undefined' : it === null ? 'Null'\n    // @@toStringTag case\n    : typeof (tag = tryGet(O = Object(it), TO_STRING_TAG)) == 'string' ? tag\n    // builtinTag case\n    : CORRECT_ARGUMENTS ? classofRaw(O)\n    // ES3 arguments fallback\n    : (result = classofRaw(O)) == 'Object' && isCallable(O.callee) ? 'Arguments' : result;\n};\n","var hasOwn = require('../internals/has-own-property');\nvar ownKeys = require('../internals/own-keys');\nvar getOwnPropertyDescriptorModule = require('../internals/object-get-own-property-descriptor');\nvar definePropertyModule = require('../internals/object-define-property');\n\nmodule.exports = function (target, source, exceptions) {\n  var keys = ownKeys(source);\n  var defineProperty = definePropertyModule.f;\n  var getOwnPropertyDescriptor = getOwnPropertyDescriptorModule.f;\n  for (var i = 0; i < keys.length; i++) {\n    var key = keys[i];\n    if (!hasOwn(target, key) && !(exceptions && hasOwn(exceptions, key))) {\n      defineProperty(target, key, getOwnPropertyDescriptor(source, key));\n    }\n  }\n};\n","var DESCRIPTORS = require('../internals/descriptors');\nvar definePropertyModule = require('../internals/object-define-property');\nvar createPropertyDescriptor = require('../internals/create-property-descriptor');\n\nmodule.exports = DESCRIPTORS ? function (object, key, value) {\n  return definePropertyModule.f(object, key, createPropertyDescriptor(1, value));\n} : function (object, key, value) {\n  object[key] = value;\n  return object;\n};\n","module.exports = function (bitmap, value) {\n  return {\n    enumerable: !(bitmap & 1),\n    configurable: !(bitmap & 2),\n    writable: !(bitmap & 4),\n    value: value\n  };\n};\n","'use strict';\nvar toPropertyKey = require('../internals/to-property-key');\nvar definePropertyModule = require('../internals/object-define-property');\nvar createPropertyDescriptor = require('../internals/create-property-descriptor');\n\nmodule.exports = function (object, key, value) {\n  var propertyKey = toPropertyKey(key);\n  if (propertyKey in object) definePropertyModule.f(object, propertyKey, createPropertyDescriptor(0, value));\n  else object[propertyKey] = value;\n};\n","var fails = require('../internals/fails');\n\n// Detect IE8's incomplete defineProperty implementation\nmodule.exports = !fails(function () {\n  // eslint-disable-next-line es/no-object-defineproperty -- required for testing\n  return Object.defineProperty({}, 1, { get: function () { return 7; } })[1] != 7;\n});\n","var global = require('../internals/global');\nvar isObject = require('../internals/is-object');\n\nvar document = global.document;\n// typeof document.createElement is 'object' in old IE\nvar EXISTS = isObject(document) && isObject(document.createElement);\n\nmodule.exports = function (it) {\n  return EXISTS ? document.createElement(it) : {};\n};\n","var userAgent = require('../internals/engine-user-agent');\n\nvar firefox = userAgent.match(/firefox\\/(\\d+)/i);\n\nmodule.exports = !!firefox && +firefox[1];\n","var UA = require('../internals/engine-user-agent');\n\nmodule.exports = /MSIE|Trident/.test(UA);\n","var getBuiltIn = require('../internals/get-built-in');\n\nmodule.exports = getBuiltIn('navigator', 'userAgent') || '';\n","var global = require('../internals/global');\nvar userAgent = require('../internals/engine-user-agent');\n\nvar process = global.process;\nvar Deno = global.Deno;\nvar versions = process && process.versions || Deno && Deno.version;\nvar v8 = versions && versions.v8;\nvar match, version;\n\nif (v8) {\n  match = v8.split('.');\n  // in old Chrome, versions of V8 isn't V8 = Chrome / 10\n  // but their correct versions are not interesting for us\n  version = match[0] > 0 && match[0] < 4 ? 1 : +(match[0] + match[1]);\n}\n\n// BrowserFS NodeJS `process` polyfill incorrectly set `.v8` to `0.0`\n// so check `userAgent` even if `.v8` exists, but 0\nif (!version && userAgent) {\n  match = userAgent.match(/Edge\\/(\\d+)/);\n  if (!match || match[1] >= 74) {\n    match = userAgent.match(/Chrome\\/(\\d+)/);\n    if (match) version = +match[1];\n  }\n}\n\nmodule.exports = version;\n","var userAgent = require('../internals/engine-user-agent');\n\nvar webkit = userAgent.match(/AppleWebKit\\/(\\d+)\\./);\n\nmodule.exports = !!webkit && +webkit[1];\n","var global = require('../internals/global');\nvar uncurryThis = require('../internals/function-uncurry-this');\n\nmodule.exports = function (CONSTRUCTOR, METHOD) {\n  return uncurryThis(global[CONSTRUCTOR].prototype[METHOD]);\n};\n","// IE8- don't enum bug keys\nmodule.exports = [\n  'constructor',\n  'hasOwnProperty',\n  'isPrototypeOf',\n  'propertyIsEnumerable',\n  'toLocaleString',\n  'toString',\n  'valueOf'\n];\n","var global = require('../internals/global');\nvar getOwnPropertyDescriptor = require('../internals/object-get-own-property-descriptor').f;\nvar createNonEnumerableProperty = require('../internals/create-non-enumerable-property');\nvar redefine = require('../internals/redefine');\nvar setGlobal = require('../internals/set-global');\nvar copyConstructorProperties = require('../internals/copy-constructor-properties');\nvar isForced = require('../internals/is-forced');\n\n/*\n  options.target      - name of the target object\n  options.global      - target is the global object\n  options.stat        - export as static methods of target\n  options.proto       - export as prototype methods of target\n  options.real        - real prototype method for the `pure` version\n  options.forced      - export even if the native feature is available\n  options.bind        - bind methods to the target, required for the `pure` version\n  options.wrap        - wrap constructors to preventing global pollution, required for the `pure` version\n  options.unsafe      - use the simple assignment of property instead of delete + defineProperty\n  options.sham        - add a flag to not completely full polyfills\n  options.enumerable  - export as enumerable property\n  options.noTargetGet - prevent calling a getter on target\n  options.name        - the .name of the function if it does not match the key\n*/\nmodule.exports = function (options, source) {\n  var TARGET = options.target;\n  var GLOBAL = options.global;\n  var STATIC = options.stat;\n  var FORCED, target, key, targetProperty, sourceProperty, descriptor;\n  if (GLOBAL) {\n    target = global;\n  } else if (STATIC) {\n    target = global[TARGET] || setGlobal(TARGET, {});\n  } else {\n    target = (global[TARGET] || {}).prototype;\n  }\n  if (target) for (key in source) {\n    sourceProperty = source[key];\n    if (options.noTargetGet) {\n      descriptor = getOwnPropertyDescriptor(target, key);\n      targetProperty = descriptor && descriptor.value;\n    } else targetProperty = target[key];\n    FORCED = isForced(GLOBAL ? key : TARGET + (STATIC ? '.' : '#') + key, options.forced);\n    // contained in target\n    if (!FORCED && targetProperty !== undefined) {\n      if (typeof sourceProperty == typeof targetProperty) continue;\n      copyConstructorProperties(sourceProperty, targetProperty);\n    }\n    // add a flag to not completely full polyfills\n    if (options.sham || (targetProperty && targetProperty.sham)) {\n      createNonEnumerableProperty(sourceProperty, 'sham', true);\n    }\n    // extend global\n    redefine(target, key, sourceProperty, options);\n  }\n};\n","module.exports = function (exec) {\n  try {\n    return !!exec();\n  } catch (error) {\n    return true;\n  }\n};\n","var fails = require('../internals/fails');\n\nmodule.exports = !fails(function () {\n  var test = (function () { /* empty */ }).bind();\n  // eslint-disable-next-line no-prototype-builtins -- safe\n  return typeof test != 'function' || test.hasOwnProperty('prototype');\n});\n","var NATIVE_BIND = require('../internals/function-bind-native');\n\nvar call = Function.prototype.call;\n\nmodule.exports = NATIVE_BIND ? call.bind(call) : function () {\n  return call.apply(call, arguments);\n};\n","var DESCRIPTORS = require('../internals/descriptors');\nvar hasOwn = require('../internals/has-own-property');\n\nvar FunctionPrototype = Function.prototype;\n// eslint-disable-next-line es/no-object-getownpropertydescriptor -- safe\nvar getDescriptor = DESCRIPTORS && Object.getOwnPropertyDescriptor;\n\nvar EXISTS = hasOwn(FunctionPrototype, 'name');\n// additional protection from minified / mangled / dropped function names\nvar PROPER = EXISTS && (function something() { /* empty */ }).name === 'something';\nvar CONFIGURABLE = EXISTS && (!DESCRIPTORS || (DESCRIPTORS && getDescriptor(FunctionPrototype, 'name').configurable));\n\nmodule.exports = {\n  EXISTS: EXISTS,\n  PROPER: PROPER,\n  CONFIGURABLE: CONFIGURABLE\n};\n","var NATIVE_BIND = require('../internals/function-bind-native');\n\nvar FunctionPrototype = Function.prototype;\nvar bind = FunctionPrototype.bind;\nvar call = FunctionPrototype.call;\nvar uncurryThis = NATIVE_BIND && bind.bind(call, call);\n\nmodule.exports = NATIVE_BIND ? function (fn) {\n  return fn && uncurryThis(fn);\n} : function (fn) {\n  return fn && function () {\n    return call.apply(fn, arguments);\n  };\n};\n","var global = require('../internals/global');\nvar isCallable = require('../internals/is-callable');\n\nvar aFunction = function (argument) {\n  return isCallable(argument) ? argument : undefined;\n};\n\nmodule.exports = function (namespace, method) {\n  return arguments.length < 2 ? aFunction(global[namespace]) : global[namespace] && global[namespace][method];\n};\n","var aCallable = require('../internals/a-callable');\n\n// `GetMethod` abstract operation\n// https://tc39.es/ecma262/#sec-getmethod\nmodule.exports = function (V, P) {\n  var func = V[P];\n  return func == null ? undefined : aCallable(func);\n};\n","var check = function (it) {\n  return it && it.Math == Math && it;\n};\n\n// https://github.com/zloirock/core-js/issues/86#issuecomment-115759028\nmodule.exports =\n  // eslint-disable-next-line es/no-global-this -- safe\n  check(typeof globalThis == 'object' && globalThis) ||\n  check(typeof window == 'object' && window) ||\n  // eslint-disable-next-line no-restricted-globals -- safe\n  check(typeof self == 'object' && self) ||\n  check(typeof global == 'object' && global) ||\n  // eslint-disable-next-line no-new-func -- fallback\n  (function () { return this; })() || Function('return this')();\n","var uncurryThis = require('../internals/function-uncurry-this');\nvar toObject = require('../internals/to-object');\n\nvar hasOwnProperty = uncurryThis({}.hasOwnProperty);\n\n// `HasOwnProperty` abstract operation\n// https://tc39.es/ecma262/#sec-hasownproperty\nmodule.exports = Object.hasOwn || function hasOwn(it, key) {\n  return hasOwnProperty(toObject(it), key);\n};\n","module.exports = {};\n","var DESCRIPTORS = require('../internals/descriptors');\nvar fails = require('../internals/fails');\nvar createElement = require('../internals/document-create-element');\n\n// Thanks to IE8 for its funny defineProperty\nmodule.exports = !DESCRIPTORS && !fails(function () {\n  // eslint-disable-next-line es/no-object-defineproperty -- required for testing\n  return Object.defineProperty(createElement('div'), 'a', {\n    get: function () { return 7; }\n  }).a != 7;\n});\n","var global = require('../internals/global');\nvar uncurryThis = require('../internals/function-uncurry-this');\nvar fails = require('../internals/fails');\nvar classof = require('../internals/classof-raw');\n\nvar Object = global.Object;\nvar split = uncurryThis(''.split);\n\n// fallback for non-array-like ES3 and non-enumerable old V8 strings\nmodule.exports = fails(function () {\n  // throws an error in rhino, see https://github.com/mozilla/rhino/issues/346\n  // eslint-disable-next-line no-prototype-builtins -- safe\n  return !Object('z').propertyIsEnumerable(0);\n}) ? function (it) {\n  return classof(it) == 'String' ? split(it, '') : Object(it);\n} : Object;\n","var uncurryThis = require('../internals/function-uncurry-this');\nvar isCallable = require('../internals/is-callable');\nvar store = require('../internals/shared-store');\n\nvar functionToString = uncurryThis(Function.toString);\n\n// this helper broken in `core-js@3.4.1-3.4.4`, so we can't use `shared` helper\nif (!isCallable(store.inspectSource)) {\n  store.inspectSource = function (it) {\n    return functionToString(it);\n  };\n}\n\nmodule.exports = store.inspectSource;\n","var NATIVE_WEAK_MAP = require('../internals/native-weak-map');\nvar global = require('../internals/global');\nvar uncurryThis = require('../internals/function-uncurry-this');\nvar isObject = require('../internals/is-object');\nvar createNonEnumerableProperty = require('../internals/create-non-enumerable-property');\nvar hasOwn = require('../internals/has-own-property');\nvar shared = require('../internals/shared-store');\nvar sharedKey = require('../internals/shared-key');\nvar hiddenKeys = require('../internals/hidden-keys');\n\nvar OBJECT_ALREADY_INITIALIZED = 'Object already initialized';\nvar TypeError = global.TypeError;\nvar WeakMap = global.WeakMap;\nvar set, get, has;\n\nvar enforce = function (it) {\n  return has(it) ? get(it) : set(it, {});\n};\n\nvar getterFor = function (TYPE) {\n  return function (it) {\n    var state;\n    if (!isObject(it) || (state = get(it)).type !== TYPE) {\n      throw TypeError('Incompatible receiver, ' + TYPE + ' required');\n    } return state;\n  };\n};\n\nif (NATIVE_WEAK_MAP || shared.state) {\n  var store = shared.state || (shared.state = new WeakMap());\n  var wmget = uncurryThis(store.get);\n  var wmhas = uncurryThis(store.has);\n  var wmset = uncurryThis(store.set);\n  set = function (it, metadata) {\n    if (wmhas(store, it)) throw new TypeError(OBJECT_ALREADY_INITIALIZED);\n    metadata.facade = it;\n    wmset(store, it, metadata);\n    return metadata;\n  };\n  get = function (it) {\n    return wmget(store, it) || {};\n  };\n  has = function (it) {\n    return wmhas(store, it);\n  };\n} else {\n  var STATE = sharedKey('state');\n  hiddenKeys[STATE] = true;\n  set = function (it, metadata) {\n    if (hasOwn(it, STATE)) throw new TypeError(OBJECT_ALREADY_INITIALIZED);\n    metadata.facade = it;\n    createNonEnumerableProperty(it, STATE, metadata);\n    return metadata;\n  };\n  get = function (it) {\n    return hasOwn(it, STATE) ? it[STATE] : {};\n  };\n  has = function (it) {\n    return hasOwn(it, STATE);\n  };\n}\n\nmodule.exports = {\n  set: set,\n  get: get,\n  has: has,\n  enforce: enforce,\n  getterFor: getterFor\n};\n","// `IsCallable` abstract operation\n// https://tc39.es/ecma262/#sec-iscallable\nmodule.exports = function (argument) {\n  return typeof argument == 'function';\n};\n","var fails = require('../internals/fails');\nvar isCallable = require('../internals/is-callable');\n\nvar replacement = /#|\\.prototype\\./;\n\nvar isForced = function (feature, detection) {\n  var value = data[normalize(feature)];\n  return value == POLYFILL ? true\n    : value == NATIVE ? false\n    : isCallable(detection) ? fails(detection)\n    : !!detection;\n};\n\nvar normalize = isForced.normalize = function (string) {\n  return String(string).replace(replacement, '.').toLowerCase();\n};\n\nvar data = isForced.data = {};\nvar NATIVE = isForced.NATIVE = 'N';\nvar POLYFILL = isForced.POLYFILL = 'P';\n\nmodule.exports = isForced;\n","var isCallable = require('../internals/is-callable');\n\nmodule.exports = function (it) {\n  return typeof it == 'object' ? it !== null : isCallable(it);\n};\n","module.exports = false;\n","var global = require('../internals/global');\nvar getBuiltIn = require('../internals/get-built-in');\nvar isCallable = require('../internals/is-callable');\nvar isPrototypeOf = require('../internals/object-is-prototype-of');\nvar USE_SYMBOL_AS_UID = require('../internals/use-symbol-as-uid');\n\nvar Object = global.Object;\n\nmodule.exports = USE_SYMBOL_AS_UID ? function (it) {\n  return typeof it == 'symbol';\n} : function (it) {\n  var $Symbol = getBuiltIn('Symbol');\n  return isCallable($Symbol) && isPrototypeOf($Symbol.prototype, Object(it));\n};\n","var toLength = require('../internals/to-length');\n\n// `LengthOfArrayLike` abstract operation\n// https://tc39.es/ecma262/#sec-lengthofarraylike\nmodule.exports = function (obj) {\n  return toLength(obj.length);\n};\n","/* eslint-disable es/no-symbol -- required for testing */\nvar V8_VERSION = require('../internals/engine-v8-version');\nvar fails = require('../internals/fails');\n\n// eslint-disable-next-line es/no-object-getownpropertysymbols -- required for testing\nmodule.exports = !!Object.getOwnPropertySymbols && !fails(function () {\n  var symbol = Symbol();\n  // Chrome 38 Symbol has incorrect toString conversion\n  // `get-own-property-symbols` polyfill symbols converted to object are not Symbol instances\n  return !String(symbol) || !(Object(symbol) instanceof Symbol) ||\n    // Chrome 38-40 symbols are not inherited from DOM collections prototypes to instances\n    !Symbol.sham && V8_VERSION && V8_VERSION < 41;\n});\n","var global = require('../internals/global');\nvar isCallable = require('../internals/is-callable');\nvar inspectSource = require('../internals/inspect-source');\n\nvar WeakMap = global.WeakMap;\n\nmodule.exports = isCallable(WeakMap) && /native code/.test(inspectSource(WeakMap));\n","var global = require('../internals/global');\nvar DESCRIPTORS = require('../internals/descriptors');\nvar IE8_DOM_DEFINE = require('../internals/ie8-dom-define');\nvar V8_PROTOTYPE_DEFINE_BUG = require('../internals/v8-prototype-define-bug');\nvar anObject = require('../internals/an-object');\nvar toPropertyKey = require('../internals/to-property-key');\n\nvar TypeError = global.TypeError;\n// eslint-disable-next-line es/no-object-defineproperty -- safe\nvar $defineProperty = Object.defineProperty;\n// eslint-disable-next-line es/no-object-getownpropertydescriptor -- safe\nvar $getOwnPropertyDescriptor = Object.getOwnPropertyDescriptor;\nvar ENUMERABLE = 'enumerable';\nvar CONFIGURABLE = 'configurable';\nvar WRITABLE = 'writable';\n\n// `Object.defineProperty` method\n// https://tc39.es/ecma262/#sec-object.defineproperty\nexports.f = DESCRIPTORS ? V8_PROTOTYPE_DEFINE_BUG ? function defineProperty(O, P, Attributes) {\n  anObject(O);\n  P = toPropertyKey(P);\n  anObject(Attributes);\n  if (typeof O === 'function' && P === 'prototype' && 'value' in Attributes && WRITABLE in Attributes && !Attributes[WRITABLE]) {\n    var current = $getOwnPropertyDescriptor(O, P);\n    if (current && current[WRITABLE]) {\n      O[P] = Attributes.value;\n      Attributes = {\n        configurable: CONFIGURABLE in Attributes ? Attributes[CONFIGURABLE] : current[CONFIGURABLE],\n        enumerable: ENUMERABLE in Attributes ? Attributes[ENUMERABLE] : current[ENUMERABLE],\n        writable: false\n      };\n    }\n  } return $defineProperty(O, P, Attributes);\n} : $defineProperty : function defineProperty(O, P, Attributes) {\n  anObject(O);\n  P = toPropertyKey(P);\n  anObject(Attributes);\n  if (IE8_DOM_DEFINE) try {\n    return $defineProperty(O, P, Attributes);\n  } catch (error) { /* empty */ }\n  if ('get' in Attributes || 'set' in Attributes) throw TypeError('Accessors not supported');\n  if ('value' in Attributes) O[P] = Attributes.value;\n  return O;\n};\n","var DESCRIPTORS = require('../internals/descriptors');\nvar call = require('../internals/function-call');\nvar propertyIsEnumerableModule = require('../internals/object-property-is-enumerable');\nvar createPropertyDescriptor = require('../internals/create-property-descriptor');\nvar toIndexedObject = require('../internals/to-indexed-object');\nvar toPropertyKey = require('../internals/to-property-key');\nvar hasOwn = require('../internals/has-own-property');\nvar IE8_DOM_DEFINE = require('../internals/ie8-dom-define');\n\n// eslint-disable-next-line es/no-object-getownpropertydescriptor -- safe\nvar $getOwnPropertyDescriptor = Object.getOwnPropertyDescriptor;\n\n// `Object.getOwnPropertyDescriptor` method\n// https://tc39.es/ecma262/#sec-object.getownpropertydescriptor\nexports.f = DESCRIPTORS ? $getOwnPropertyDescriptor : function getOwnPropertyDescriptor(O, P) {\n  O = toIndexedObject(O);\n  P = toPropertyKey(P);\n  if (IE8_DOM_DEFINE) try {\n    return $getOwnPropertyDescriptor(O, P);\n  } catch (error) { /* empty */ }\n  if (hasOwn(O, P)) return createPropertyDescriptor(!call(propertyIsEnumerableModule.f, O, P), O[P]);\n};\n","var internalObjectKeys = require('../internals/object-keys-internal');\nvar enumBugKeys = require('../internals/enum-bug-keys');\n\nvar hiddenKeys = enumBugKeys.concat('length', 'prototype');\n\n// `Object.getOwnPropertyNames` method\n// https://tc39.es/ecma262/#sec-object.getownpropertynames\n// eslint-disable-next-line es/no-object-getownpropertynames -- safe\nexports.f = Object.getOwnPropertyNames || function getOwnPropertyNames(O) {\n  return internalObjectKeys(O, hiddenKeys);\n};\n","// eslint-disable-next-line es/no-object-getownpropertysymbols -- safe\nexports.f = Object.getOwnPropertySymbols;\n","var uncurryThis = require('../internals/function-uncurry-this');\n\nmodule.exports = uncurryThis({}.isPrototypeOf);\n","var uncurryThis = require('../internals/function-uncurry-this');\nvar hasOwn = require('../internals/has-own-property');\nvar toIndexedObject = require('../internals/to-indexed-object');\nvar indexOf = require('../internals/array-includes').indexOf;\nvar hiddenKeys = require('../internals/hidden-keys');\n\nvar push = uncurryThis([].push);\n\nmodule.exports = function (object, names) {\n  var O = toIndexedObject(object);\n  var i = 0;\n  var result = [];\n  var key;\n  for (key in O) !hasOwn(hiddenKeys, key) && hasOwn(O, key) && push(result, key);\n  // Don't enum bug & hidden keys\n  while (names.length > i) if (hasOwn(O, key = names[i++])) {\n    ~indexOf(result, key) || push(result, key);\n  }\n  return result;\n};\n","var internalObjectKeys = require('../internals/object-keys-internal');\nvar enumBugKeys = require('../internals/enum-bug-keys');\n\n// `Object.keys` method\n// https://tc39.es/ecma262/#sec-object.keys\n// eslint-disable-next-line es/no-object-keys -- safe\nmodule.exports = Object.keys || function keys(O) {\n  return internalObjectKeys(O, enumBugKeys);\n};\n","'use strict';\nvar $propertyIsEnumerable = {}.propertyIsEnumerable;\n// eslint-disable-next-line es/no-object-getownpropertydescriptor -- safe\nvar getOwnPropertyDescriptor = Object.getOwnPropertyDescriptor;\n\n// Nashorn ~ JDK8 bug\nvar NASHORN_BUG = getOwnPropertyDescriptor && !$propertyIsEnumerable.call({ 1: 2 }, 1);\n\n// `Object.prototype.propertyIsEnumerable` method implementation\n// https://tc39.es/ecma262/#sec-object.prototype.propertyisenumerable\nexports.f = NASHORN_BUG ? function propertyIsEnumerable(V) {\n  var descriptor = getOwnPropertyDescriptor(this, V);\n  return !!descriptor && descriptor.enumerable;\n} : $propertyIsEnumerable;\n","var global = require('../internals/global');\nvar call = require('../internals/function-call');\nvar isCallable = require('../internals/is-callable');\nvar isObject = require('../internals/is-object');\n\nvar TypeError = global.TypeError;\n\n// `OrdinaryToPrimitive` abstract operation\n// https://tc39.es/ecma262/#sec-ordinarytoprimitive\nmodule.exports = function (input, pref) {\n  var fn, val;\n  if (pref === 'string' && isCallable(fn = input.toString) && !isObject(val = call(fn, input))) return val;\n  if (isCallable(fn = input.valueOf) && !isObject(val = call(fn, input))) return val;\n  if (pref !== 'string' && isCallable(fn = input.toString) && !isObject(val = call(fn, input))) return val;\n  throw TypeError(\"Can't convert object to primitive value\");\n};\n","var getBuiltIn = require('../internals/get-built-in');\nvar uncurryThis = require('../internals/function-uncurry-this');\nvar getOwnPropertyNamesModule = require('../internals/object-get-own-property-names');\nvar getOwnPropertySymbolsModule = require('../internals/object-get-own-property-symbols');\nvar anObject = require('../internals/an-object');\n\nvar concat = uncurryThis([].concat);\n\n// all object keys, includes non-enumerable and symbols\nmodule.exports = getBuiltIn('Reflect', 'ownKeys') || function ownKeys(it) {\n  var keys = getOwnPropertyNamesModule.f(anObject(it));\n  var getOwnPropertySymbols = getOwnPropertySymbolsModule.f;\n  return getOwnPropertySymbols ? concat(keys, getOwnPropertySymbols(it)) : keys;\n};\n","var global = require('../internals/global');\n\nmodule.exports = global;\n","var global = require('../internals/global');\nvar isCallable = require('../internals/is-callable');\nvar hasOwn = require('../internals/has-own-property');\nvar createNonEnumerableProperty = require('../internals/create-non-enumerable-property');\nvar setGlobal = require('../internals/set-global');\nvar inspectSource = require('../internals/inspect-source');\nvar InternalStateModule = require('../internals/internal-state');\nvar CONFIGURABLE_FUNCTION_NAME = require('../internals/function-name').CONFIGURABLE;\n\nvar getInternalState = InternalStateModule.get;\nvar enforceInternalState = InternalStateModule.enforce;\nvar TEMPLATE = String(String).split('String');\n\n(module.exports = function (O, key, value, options) {\n  var unsafe = options ? !!options.unsafe : false;\n  var simple = options ? !!options.enumerable : false;\n  var noTargetGet = options ? !!options.noTargetGet : false;\n  var name = options && options.name !== undefined ? options.name : key;\n  var state;\n  if (isCallable(value)) {\n    if (String(name).slice(0, 7) === 'Symbol(') {\n      name = '[' + String(name).replace(/^Symbol\\(([^)]*)\\)/, '$1') + ']';\n    }\n    if (!hasOwn(value, 'name') || (CONFIGURABLE_FUNCTION_NAME && value.name !== name)) {\n      createNonEnumerableProperty(value, 'name', name);\n    }\n    state = enforceInternalState(value);\n    if (!state.source) {\n      state.source = TEMPLATE.join(typeof name == 'string' ? name : '');\n    }\n  }\n  if (O === global) {\n    if (simple) O[key] = value;\n    else setGlobal(key, value);\n    return;\n  } else if (!unsafe) {\n    delete O[key];\n  } else if (!noTargetGet && O[key]) {\n    simple = true;\n  }\n  if (simple) O[key] = value;\n  else createNonEnumerableProperty(O, key, value);\n// add fake Function#toString for correct work wrapped methods / constructors with methods like LoDash isNative\n})(Function.prototype, 'toString', function toString() {\n  return isCallable(this) && getInternalState(this).source || inspectSource(this);\n});\n","var global = require('../internals/global');\n\nvar TypeError = global.TypeError;\n\n// `RequireObjectCoercible` abstract operation\n// https://tc39.es/ecma262/#sec-requireobjectcoercible\nmodule.exports = function (it) {\n  if (it == undefined) throw TypeError(\"Can't call method on \" + it);\n  return it;\n};\n","var global = require('../internals/global');\n\n// eslint-disable-next-line es/no-object-defineproperty -- safe\nvar defineProperty = Object.defineProperty;\n\nmodule.exports = function (key, value) {\n  try {\n    defineProperty(global, key, { value: value, configurable: true, writable: true });\n  } catch (error) {\n    global[key] = value;\n  } return value;\n};\n","var shared = require('../internals/shared');\nvar uid = require('../internals/uid');\n\nvar keys = shared('keys');\n\nmodule.exports = function (key) {\n  return keys[key] || (keys[key] = uid(key));\n};\n","var global = require('../internals/global');\nvar setGlobal = require('../internals/set-global');\n\nvar SHARED = '__core-js_shared__';\nvar store = global[SHARED] || setGlobal(SHARED, {});\n\nmodule.exports = store;\n","var IS_PURE = require('../internals/is-pure');\nvar store = require('../internals/shared-store');\n\n(module.exports = function (key, value) {\n  return store[key] || (store[key] = value !== undefined ? value : {});\n})('versions', []).push({\n  version: '3.21.0',\n  mode: IS_PURE ? 'pure' : 'global',\n  copyright: ' 2014-2022 Denis Pushkarev (zloirock.ru)',\n  license: 'https://github.com/zloirock/core-js/blob/v3.21.0/LICENSE',\n  source: 'https://github.com/zloirock/core-js'\n});\n","var toIntegerOrInfinity = require('../internals/to-integer-or-infinity');\n\nvar max = Math.max;\nvar min = Math.min;\n\n// Helper for a popular repeating case of the spec:\n// Let integer be ? ToInteger(index).\n// If integer < 0, let result be max((length + integer), 0); else let result be min(integer, length).\nmodule.exports = function (index, length) {\n  var integer = toIntegerOrInfinity(index);\n  return integer < 0 ? max(integer + length, 0) : min(integer, length);\n};\n","// toObject with fallback for non-array-like ES3 strings\nvar IndexedObject = require('../internals/indexed-object');\nvar requireObjectCoercible = require('../internals/require-object-coercible');\n\nmodule.exports = function (it) {\n  return IndexedObject(requireObjectCoercible(it));\n};\n","var ceil = Math.ceil;\nvar floor = Math.floor;\n\n// `ToIntegerOrInfinity` abstract operation\n// https://tc39.es/ecma262/#sec-tointegerorinfinity\nmodule.exports = function (argument) {\n  var number = +argument;\n  // eslint-disable-next-line no-self-compare -- safe\n  return number !== number || number === 0 ? 0 : (number > 0 ? floor : ceil)(number);\n};\n","var toIntegerOrInfinity = require('../internals/to-integer-or-infinity');\n\nvar min = Math.min;\n\n// `ToLength` abstract operation\n// https://tc39.es/ecma262/#sec-tolength\nmodule.exports = function (argument) {\n  return argument > 0 ? min(toIntegerOrInfinity(argument), 0x1FFFFFFFFFFFFF) : 0; // 2 ** 53 - 1 == 9007199254740991\n};\n","var global = require('../internals/global');\nvar requireObjectCoercible = require('../internals/require-object-coercible');\n\nvar Object = global.Object;\n\n// `ToObject` abstract operation\n// https://tc39.es/ecma262/#sec-toobject\nmodule.exports = function (argument) {\n  return Object(requireObjectCoercible(argument));\n};\n","var global = require('../internals/global');\nvar call = require('../internals/function-call');\nvar isObject = require('../internals/is-object');\nvar isSymbol = require('../internals/is-symbol');\nvar getMethod = require('../internals/get-method');\nvar ordinaryToPrimitive = require('../internals/ordinary-to-primitive');\nvar wellKnownSymbol = require('../internals/well-known-symbol');\n\nvar TypeError = global.TypeError;\nvar TO_PRIMITIVE = wellKnownSymbol('toPrimitive');\n\n// `ToPrimitive` abstract operation\n// https://tc39.es/ecma262/#sec-toprimitive\nmodule.exports = function (input, pref) {\n  if (!isObject(input) || isSymbol(input)) return input;\n  var exoticToPrim = getMethod(input, TO_PRIMITIVE);\n  var result;\n  if (exoticToPrim) {\n    if (pref === undefined) pref = 'default';\n    result = call(exoticToPrim, input, pref);\n    if (!isObject(result) || isSymbol(result)) return result;\n    throw TypeError(\"Can't convert object to primitive value\");\n  }\n  if (pref === undefined) pref = 'number';\n  return ordinaryToPrimitive(input, pref);\n};\n","var toPrimitive = require('../internals/to-primitive');\nvar isSymbol = require('../internals/is-symbol');\n\n// `ToPropertyKey` abstract operation\n// https://tc39.es/ecma262/#sec-topropertykey\nmodule.exports = function (argument) {\n  var key = toPrimitive(argument, 'string');\n  return isSymbol(key) ? key : key + '';\n};\n","var wellKnownSymbol = require('../internals/well-known-symbol');\n\nvar TO_STRING_TAG = wellKnownSymbol('toStringTag');\nvar test = {};\n\ntest[TO_STRING_TAG] = 'z';\n\nmodule.exports = String(test) === '[object z]';\n","var global = require('../internals/global');\nvar classof = require('../internals/classof');\n\nvar String = global.String;\n\nmodule.exports = function (argument) {\n  if (classof(argument) === 'Symbol') throw TypeError('Cannot convert a Symbol value to a string');\n  return String(argument);\n};\n","var global = require('../internals/global');\n\nvar String = global.String;\n\nmodule.exports = function (argument) {\n  try {\n    return String(argument);\n  } catch (error) {\n    return 'Object';\n  }\n};\n","var uncurryThis = require('../internals/function-uncurry-this');\n\nvar id = 0;\nvar postfix = Math.random();\nvar toString = uncurryThis(1.0.toString);\n\nmodule.exports = function (key) {\n  return 'Symbol(' + (key === undefined ? '' : key) + ')_' + toString(++id + postfix, 36);\n};\n","/* eslint-disable es/no-symbol -- required for testing */\nvar NATIVE_SYMBOL = require('../internals/native-symbol');\n\nmodule.exports = NATIVE_SYMBOL\n  && !Symbol.sham\n  && typeof Symbol.iterator == 'symbol';\n","var DESCRIPTORS = require('../internals/descriptors');\nvar fails = require('../internals/fails');\n\n// V8 ~ Chrome 36-\n// https://bugs.chromium.org/p/v8/issues/detail?id=3334\nmodule.exports = DESCRIPTORS && fails(function () {\n  // eslint-disable-next-line es/no-object-defineproperty -- required for testing\n  return Object.defineProperty(function () { /* empty */ }, 'prototype', {\n    value: 42,\n    writable: false\n  }).prototype != 42;\n});\n","var global = require('../internals/global');\nvar shared = require('../internals/shared');\nvar hasOwn = require('../internals/has-own-property');\nvar uid = require('../internals/uid');\nvar NATIVE_SYMBOL = require('../internals/native-symbol');\nvar USE_SYMBOL_AS_UID = require('../internals/use-symbol-as-uid');\n\nvar WellKnownSymbolsStore = shared('wks');\nvar Symbol = global.Symbol;\nvar symbolFor = Symbol && Symbol['for'];\nvar createWellKnownSymbol = USE_SYMBOL_AS_UID ? Symbol : Symbol && Symbol.withoutSetter || uid;\n\nmodule.exports = function (name) {\n  if (!hasOwn(WellKnownSymbolsStore, name) || !(NATIVE_SYMBOL || typeof WellKnownSymbolsStore[name] == 'string')) {\n    var description = 'Symbol.' + name;\n    if (NATIVE_SYMBOL && hasOwn(Symbol, name)) {\n      WellKnownSymbolsStore[name] = Symbol[name];\n    } else if (USE_SYMBOL_AS_UID && symbolFor) {\n      WellKnownSymbolsStore[name] = symbolFor(description);\n    } else {\n      WellKnownSymbolsStore[name] = createWellKnownSymbol(description);\n    }\n  } return WellKnownSymbolsStore[name];\n};\n","'use strict';\nvar $ = require('../internals/export');\nvar uncurryThis = require('../internals/function-uncurry-this');\nvar aCallable = require('../internals/a-callable');\nvar toObject = require('../internals/to-object');\nvar lengthOfArrayLike = require('../internals/length-of-array-like');\nvar toString = require('../internals/to-string');\nvar fails = require('../internals/fails');\nvar internalSort = require('../internals/array-sort');\nvar arrayMethodIsStrict = require('../internals/array-method-is-strict');\nvar FF = require('../internals/engine-ff-version');\nvar IE_OR_EDGE = require('../internals/engine-is-ie-or-edge');\nvar V8 = require('../internals/engine-v8-version');\nvar WEBKIT = require('../internals/engine-webkit-version');\n\nvar test = [];\nvar un$Sort = uncurryThis(test.sort);\nvar push = uncurryThis(test.push);\n\n// IE8-\nvar FAILS_ON_UNDEFINED = fails(function () {\n  test.sort(undefined);\n});\n// V8 bug\nvar FAILS_ON_NULL = fails(function () {\n  test.sort(null);\n});\n// Old WebKit\nvar STRICT_METHOD = arrayMethodIsStrict('sort');\n\nvar STABLE_SORT = !fails(function () {\n  // feature detection can be too slow, so check engines versions\n  if (V8) return V8 < 70;\n  if (FF && FF > 3) return;\n  if (IE_OR_EDGE) return true;\n  if (WEBKIT) return WEBKIT < 603;\n\n  var result = '';\n  var code, chr, value, index;\n\n  // generate an array with more 512 elements (Chakra and old V8 fails only in this case)\n  for (code = 65; code < 76; code++) {\n    chr = String.fromCharCode(code);\n\n    switch (code) {\n      case 66: case 69: case 70: case 72: value = 3; break;\n      case 68: case 71: value = 4; break;\n      default: value = 2;\n    }\n\n    for (index = 0; index < 47; index++) {\n      test.push({ k: chr + index, v: value });\n    }\n  }\n\n  test.sort(function (a, b) { return b.v - a.v; });\n\n  for (index = 0; index < test.length; index++) {\n    chr = test[index].k.charAt(0);\n    if (result.charAt(result.length - 1) !== chr) result += chr;\n  }\n\n  return result !== 'DGBEFHACIJK';\n});\n\nvar FORCED = FAILS_ON_UNDEFINED || !FAILS_ON_NULL || !STRICT_METHOD || !STABLE_SORT;\n\nvar getSortCompare = function (comparefn) {\n  return function (x, y) {\n    if (y === undefined) return -1;\n    if (x === undefined) return 1;\n    if (comparefn !== undefined) return +comparefn(x, y) || 0;\n    return toString(x) > toString(y) ? 1 : -1;\n  };\n};\n\n// `Array.prototype.sort` method\n// https://tc39.es/ecma262/#sec-array.prototype.sort\n$({ target: 'Array', proto: true, forced: FORCED }, {\n  sort: function sort(comparefn) {\n    if (comparefn !== undefined) aCallable(comparefn);\n\n    var array = toObject(this);\n\n    if (STABLE_SORT) return comparefn === undefined ? un$Sort(array) : un$Sort(array, comparefn);\n\n    var items = [];\n    var arrayLength = lengthOfArrayLike(array);\n    var itemsLength, index;\n\n    for (index = 0; index < arrayLength; index++) {\n      if (index in array) push(items, array[index]);\n    }\n\n    internalSort(items, getSortCompare(comparefn));\n\n    itemsLength = items.length;\n    index = 0;\n\n    while (index < itemsLength) array[index] = items[index++];\n    while (index < arrayLength) delete array[index++];\n\n    return array;\n  }\n});\n","var $ = require('../internals/export');\nvar toObject = require('../internals/to-object');\nvar nativeKeys = require('../internals/object-keys');\nvar fails = require('../internals/fails');\n\nvar FAILS_ON_PRIMITIVES = fails(function () { nativeKeys(1); });\n\n// `Object.keys` method\n// https://tc39.es/ecma262/#sec-object.keys\n$({ target: 'Object', stat: true, forced: FAILS_ON_PRIMITIVES }, {\n  keys: function keys(it) {\n    return nativeKeys(toObject(it));\n  }\n});\n","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \"/* Buttons styles start */\\r\\n\\r\\nbutton#excalibur-play {\\r\\n  display: inline-block;\\r\\n  position: relative;\\r\\n  z-index: 999;\\r\\n  border-radius: 6px;\\r\\n  border: none;\\r\\n  /*border: 3px solid;\\r\\n    border-color: white;\\r\\n    box-shadow: 0 0 10px #ccc;*/\\r\\n  padding: 1rem 1.5rem 1rem 4rem;\\r\\n  margin: 0;\\r\\n  text-decoration: none;\\r\\n  background: #00b233;\\r\\n  color: #ffffff;\\r\\n  font-family: sans-serif;\\r\\n  font-size: 2rem;\\r\\n  white-space: nowrap;\\r\\n  line-height: 1;\\r\\n  cursor: pointer;\\r\\n  text-align: center;\\r\\n  transition: background 250ms ease-in-out, transform 150ms ease;\\r\\n  -webkit-appearance: none;\\r\\n  -moz-appearance: none;\\r\\n\\r\\n  -webkit-animation: excalibur-button-fadein 200ms; /* Safari, Chrome and Opera > 12.1 */\\r\\n  -moz-animation: excalibur-button-fadein 200ms; /* Firefox < 16 */\\r\\n  -ms-animation: excalibur-button-fadein 200ms; /* Internet Explorer */\\r\\n  -o-animation: excalibur-button-fadein 200ms; /* Opera < 12.1 */\\r\\n  animation: excalibur-button-fadein 200ms;\\r\\n}\\r\\n\\r\\n/*\\r\\nbutton#excalibur-play {\\r\\n  display: none;\\r\\n}*/\\r\\n\\r\\nbutton#excalibur-play:after {\\r\\n  position: absolute;\\r\\n  content: '';\\r\\n  border: 8px solid;\\r\\n  border-color: transparent transparent transparent white;\\r\\n  left: 35px;\\r\\n  top: 24px;\\r\\n  width: 0;\\r\\n  height: 0;\\r\\n}\\r\\n\\r\\nbutton#excalibur-play:before {\\r\\n  position: absolute;\\r\\n  content: '';\\r\\n  border: 3px solid;\\r\\n  left: 19px;\\r\\n  top: 14px;\\r\\n  border-radius: 20px;\\r\\n  width: 30px;\\r\\n  height: 30px;\\r\\n}\\r\\n\\r\\nbutton#excalibur-play:hover,\\r\\nbutton#excalibur-play:focus {\\r\\n  background: #00982c;\\r\\n}\\r\\n\\r\\nbutton#excalibur-play:focus {\\r\\n  outline: 1px solid #fff;\\r\\n  outline-offset: -4px;\\r\\n}\\r\\n\\r\\nbutton#excalibur-play:active {\\r\\n  transform: scale(0.99);\\r\\n}\\r\\n\\r\\n@keyframes excalibur-button-fadein {\\r\\n  from {\\r\\n    opacity: 0;\\r\\n  }\\r\\n  to {\\r\\n    opacity: 1;\\r\\n  }\\r\\n}\\r\\n\\r\\n/* Firefox < 16 */\\r\\n@-moz-keyframes excalibur-button-fadein {\\r\\n  from {\\r\\n    opacity: 0;\\r\\n  }\\r\\n  to {\\r\\n    opacity: 1;\\r\\n  }\\r\\n}\\r\\n\\r\\n/* Safari, Chrome and Opera > 12.1 */\\r\\n@-webkit-keyframes excalibur-button-fadein {\\r\\n  from {\\r\\n    opacity: 0;\\r\\n  }\\r\\n  to {\\r\\n    opacity: 1;\\r\\n  }\\r\\n}\\r\\n\\r\\n/* Internet Explorer */\\r\\n@-ms-keyframes excalibur-button-fadein {\\r\\n  from {\\r\\n    opacity: 0;\\r\\n  }\\r\\n  to {\\r\\n    opacity: 1;\\r\\n  }\\r\\n}\\r\\n\\r\\n/* Opera < 12.1 */\\r\\n@-o-keyframes excalibur-button-fadein {\\r\\n  from {\\r\\n    opacity: 0;\\r\\n  }\\r\\n  to {\\r\\n    opacity: 1;\\r\\n  }\\r\\n}\\r\\n\", \"\",{\"version\":3,\"sources\":[\"webpack://./Loader.css\"],\"names\":[],\"mappings\":\"AAAA,yBAAyB;;AAEzB;EACE,qBAAqB;EACrB,kBAAkB;EAClB,YAAY;EACZ,kBAAkB;EAClB,YAAY;EACZ;;+BAE6B;EAC7B,8BAA8B;EAC9B,SAAS;EACT,qBAAqB;EACrB,mBAAmB;EACnB,cAAc;EACd,uBAAuB;EACvB,eAAe;EACf,mBAAmB;EACnB,cAAc;EACd,eAAe;EACf,kBAAkB;EAClB,8DAA8D;EAC9D,wBAAwB;EACxB,qBAAqB;;EAErB,gDAAgD,EAAE,oCAAoC;EACtF,6CAA6C,EAAE,iBAAiB;EAChE,4CAA4C,EAAE,sBAAsB;EACpE,2CAA2C,EAAE,iBAAiB;EAC9D,wCAAwC;AAC1C;;AAEA;;;EAGE;;AAEF;EACE,kBAAkB;EAClB,WAAW;EACX,iBAAiB;EACjB,uDAAuD;EACvD,UAAU;EACV,SAAS;EACT,QAAQ;EACR,SAAS;AACX;;AAEA;EACE,kBAAkB;EAClB,WAAW;EACX,iBAAiB;EACjB,UAAU;EACV,SAAS;EACT,mBAAmB;EACnB,WAAW;EACX,YAAY;AACd;;AAEA;;EAEE,mBAAmB;AACrB;;AAEA;EACE,uBAAuB;EACvB,oBAAoB;AACtB;;AAEA;EACE,sBAAsB;AACxB;;AAEA;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,iBAAiB;AACjB;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,oCAAoC;AACpC;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,sBAAsB;AACtB;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,iBAAiB;AACjB;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF\",\"sourcesContent\":[\"/* Buttons styles start */\\r\\n\\r\\nbutton#excalibur-play {\\r\\n  display: inline-block;\\r\\n  position: relative;\\r\\n  z-index: 999;\\r\\n  border-radius: 6px;\\r\\n  border: none;\\r\\n  /*border: 3px solid;\\r\\n    border-color: white;\\r\\n    box-shadow: 0 0 10px #ccc;*/\\r\\n  padding: 1rem 1.5rem 1rem 4rem;\\r\\n  margin: 0;\\r\\n  text-decoration: none;\\r\\n  background: #00b233;\\r\\n  color: #ffffff;\\r\\n  font-family: sans-serif;\\r\\n  font-size: 2rem;\\r\\n  white-space: nowrap;\\r\\n  line-height: 1;\\r\\n  cursor: pointer;\\r\\n  text-align: center;\\r\\n  transition: background 250ms ease-in-out, transform 150ms ease;\\r\\n  -webkit-appearance: none;\\r\\n  -moz-appearance: none;\\r\\n\\r\\n  -webkit-animation: excalibur-button-fadein 200ms; /* Safari, Chrome and Opera > 12.1 */\\r\\n  -moz-animation: excalibur-button-fadein 200ms; /* Firefox < 16 */\\r\\n  -ms-animation: excalibur-button-fadein 200ms; /* Internet Explorer */\\r\\n  -o-animation: excalibur-button-fadein 200ms; /* Opera < 12.1 */\\r\\n  animation: excalibur-button-fadein 200ms;\\r\\n}\\r\\n\\r\\n/*\\r\\nbutton#excalibur-play {\\r\\n  display: none;\\r\\n}*/\\r\\n\\r\\nbutton#excalibur-play:after {\\r\\n  position: absolute;\\r\\n  content: '';\\r\\n  border: 8px solid;\\r\\n  border-color: transparent transparent transparent white;\\r\\n  left: 35px;\\r\\n  top: 24px;\\r\\n  width: 0;\\r\\n  height: 0;\\r\\n}\\r\\n\\r\\nbutton#excalibur-play:before {\\r\\n  position: absolute;\\r\\n  content: '';\\r\\n  border: 3px solid;\\r\\n  left: 19px;\\r\\n  top: 14px;\\r\\n  border-radius: 20px;\\r\\n  width: 30px;\\r\\n  height: 30px;\\r\\n}\\r\\n\\r\\nbutton#excalibur-play:hover,\\r\\nbutton#excalibur-play:focus {\\r\\n  background: #00982c;\\r\\n}\\r\\n\\r\\nbutton#excalibur-play:focus {\\r\\n  outline: 1px solid #fff;\\r\\n  outline-offset: -4px;\\r\\n}\\r\\n\\r\\nbutton#excalibur-play:active {\\r\\n  transform: scale(0.99);\\r\\n}\\r\\n\\r\\n@keyframes excalibur-button-fadein {\\r\\n  from {\\r\\n    opacity: 0;\\r\\n  }\\r\\n  to {\\r\\n    opacity: 1;\\r\\n  }\\r\\n}\\r\\n\\r\\n/* Firefox < 16 */\\r\\n@-moz-keyframes excalibur-button-fadein {\\r\\n  from {\\r\\n    opacity: 0;\\r\\n  }\\r\\n  to {\\r\\n    opacity: 1;\\r\\n  }\\r\\n}\\r\\n\\r\\n/* Safari, Chrome and Opera > 12.1 */\\r\\n@-webkit-keyframes excalibur-button-fadein {\\r\\n  from {\\r\\n    opacity: 0;\\r\\n  }\\r\\n  to {\\r\\n    opacity: 1;\\r\\n  }\\r\\n}\\r\\n\\r\\n/* Internet Explorer */\\r\\n@-ms-keyframes excalibur-button-fadein {\\r\\n  from {\\r\\n    opacity: 0;\\r\\n  }\\r\\n  to {\\r\\n    opacity: 1;\\r\\n  }\\r\\n}\\r\\n\\r\\n/* Opera < 12.1 */\\r\\n@-o-keyframes excalibur-button-fadein {\\r\\n  from {\\r\\n    opacity: 0;\\r\\n  }\\r\\n  to {\\r\\n    opacity: 1;\\r\\n  }\\r\\n}\\r\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","\"use strict\";\n\n/*\n  MIT License http://www.opensource.org/licenses/mit-license.php\n  Author Tobias Koppers @sokra\n*/\nmodule.exports = function (cssWithMappingToString) {\n  var list = []; // return the list of modules as css string\n\n  list.toString = function toString() {\n    return this.map(function (item) {\n      var content = \"\";\n      var needLayer = typeof item[5] !== \"undefined\";\n\n      if (item[4]) {\n        content += \"@supports (\".concat(item[4], \") {\");\n      }\n\n      if (item[2]) {\n        content += \"@media \".concat(item[2], \" {\");\n      }\n\n      if (needLayer) {\n        content += \"@layer\".concat(item[5].length > 0 ? \" \".concat(item[5]) : \"\", \" {\");\n      }\n\n      content += cssWithMappingToString(item);\n\n      if (needLayer) {\n        content += \"}\";\n      }\n\n      if (item[2]) {\n        content += \"}\";\n      }\n\n      if (item[4]) {\n        content += \"}\";\n      }\n\n      return content;\n    }).join(\"\");\n  }; // import a list of modules into the list\n\n\n  list.i = function i(modules, media, dedupe, supports, layer) {\n    if (typeof modules === \"string\") {\n      modules = [[null, modules, undefined]];\n    }\n\n    var alreadyImportedModules = {};\n\n    if (dedupe) {\n      for (var k = 0; k < this.length; k++) {\n        var id = this[k][0];\n\n        if (id != null) {\n          alreadyImportedModules[id] = true;\n        }\n      }\n    }\n\n    for (var _k = 0; _k < modules.length; _k++) {\n      var item = [].concat(modules[_k]);\n\n      if (dedupe && alreadyImportedModules[item[0]]) {\n        continue;\n      }\n\n      if (typeof layer !== \"undefined\") {\n        if (typeof item[5] === \"undefined\") {\n          item[5] = layer;\n        } else {\n          item[1] = \"@layer\".concat(item[5].length > 0 ? \" \".concat(item[5]) : \"\", \" {\").concat(item[1], \"}\");\n          item[5] = layer;\n        }\n      }\n\n      if (media) {\n        if (!item[2]) {\n          item[2] = media;\n        } else {\n          item[1] = \"@media \".concat(item[2], \" {\").concat(item[1], \"}\");\n          item[2] = media;\n        }\n      }\n\n      if (supports) {\n        if (!item[4]) {\n          item[4] = \"\".concat(supports);\n        } else {\n          item[1] = \"@supports (\".concat(item[4], \") {\").concat(item[1], \"}\");\n          item[4] = supports;\n        }\n      }\n\n      list.push(item);\n    }\n  };\n\n  return list;\n};","\"use strict\";\n\nmodule.exports = function (item) {\n  var content = item[1];\n  var cssMapping = item[3];\n\n  if (!cssMapping) {\n    return content;\n  }\n\n  if (typeof btoa === \"function\") {\n    var base64 = btoa(unescape(encodeURIComponent(JSON.stringify(cssMapping))));\n    var data = \"sourceMappingURL=data:application/json;charset=utf-8;base64,\".concat(base64);\n    var sourceMapping = \"/*# \".concat(data, \" */\");\n    var sourceURLs = cssMapping.sources.map(function (source) {\n      return \"/*# sourceURL=\".concat(cssMapping.sourceRoot || \"\").concat(source, \" */\");\n    });\n    return [content].concat(sourceURLs).concat([sourceMapping]).join(\"\\n\");\n  }\n\n  return [content].join(\"\\n\");\n};","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\tid: moduleId,\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","\r\n/**\r\n * Features in preview\r\n */\r\nexport enum Experiments {\r\n  WebGL = 'use-webgl'\r\n}\r\n\r\n/**\r\n * Legacy features that will go away\r\n */\r\nexport enum Legacy {\r\n  Canvas = 'use-canvas-context',\r\n  LegacyDrawing = 'use-legacy-drawing'\r\n}\r\n\r\n/**\r\n * Flags is a feature flag implementation for Excalibur. They can only be operated **before [[Engine]] construction**\r\n * after which they are frozen and are read-only.\r\n *\r\n * Flags are used to enable experimental or preview features in Excalibur.\r\n */\r\nexport class Flags {\r\n  private static _FROZEN = false;\r\n  private static _FLAGS: Record<string, boolean> = {};\r\n\r\n  /**\r\n   * Freeze all flag modifications making them readonly\r\n   */\r\n  public static freeze() {\r\n    Flags._FROZEN = true;\r\n  }\r\n\r\n  /**\r\n   * Resets internal flag state, not meant to be called by users. Only used for testing.\r\n   *\r\n   * Calling this in your game is UNSUPPORTED\r\n   * @internal\r\n   */\r\n  public static _reset() {\r\n    Flags._FROZEN = false;\r\n    Flags._FLAGS = {};\r\n  }\r\n\r\n  /**\r\n   * Turn on webgl support\r\n   */\r\n  public static useWebGL() {\r\n    Flags.enable(Experiments.WebGL);\r\n  }\r\n\r\n  public static useCanvasGraphicsContext() {\r\n    Flags.enable(Legacy.Canvas);\r\n  }\r\n\r\n  /**\r\n   * @deprecated Recommended not to use legacy drawing, going away in v0.26.0\r\n   */\r\n  public static useLegacyDrawing() {\r\n    Flags.enable(Legacy.LegacyDrawing);\r\n  }\r\n\r\n  /**\r\n   * Enable a specific feature flag by name. **Note: can only be set before [[Engine]] constructor time**\r\n   * @param flagName\r\n   */\r\n  public static enable(flagName: string): void {\r\n    if (this._FROZEN) {\r\n      throw Error('Feature flags can only be enabled before Engine constructor time');\r\n    }\r\n    Flags._FLAGS[flagName] = true;\r\n  }\r\n\r\n  /**\r\n   * Disable a specific feature flag by name. **Note: can only be set before [[Engine]] constructor time**\r\n   * @param flagName\r\n   */\r\n  public static disable(flagName: string): void {\r\n    if (this._FROZEN) {\r\n      throw Error('Feature flags can only be disabled before Engine constructor time');\r\n    }\r\n    Flags._FLAGS[flagName] = false;\r\n  }\r\n\r\n  /**\r\n   * Check if a flag is enabled. If the flag is disabled or does not exist `false` is returned\r\n   * @param flagName\r\n   */\r\n  public static isEnabled(flagName: string): boolean {\r\n    return !!Flags._FLAGS[flagName];\r\n  }\r\n\r\n  /**\r\n   * Show a list of currently known flags\r\n   */\r\n  public static show(): string[] {\r\n    return Object.keys(Flags._FLAGS);\r\n  }\r\n}\r\n","/* eslint-disable no-console */\r\n/**\r\n * Logging level that Excalibur will tag\r\n */\r\nexport enum LogLevel {\r\n  Debug,\r\n  Info,\r\n  Warn,\r\n  Error,\r\n  Fatal\r\n}\r\n\r\n/**\r\n * Static singleton that represents the logging facility for Excalibur.\r\n * Excalibur comes built-in with a [[ConsoleAppender]] and [[ScreenAppender]].\r\n * Derive from [[Appender]] to create your own logging appenders.\r\n */\r\nexport class Logger {\r\n  private static _INSTANCE: Logger = null;\r\n  private _appenders: Appender[] = [];\r\n\r\n  constructor() {\r\n    if (Logger._INSTANCE) {\r\n      throw new Error('Logger is a singleton');\r\n    }\r\n    Logger._INSTANCE = this;\r\n    // Default console appender\r\n    Logger._INSTANCE.addAppender(new ConsoleAppender());\r\n    return Logger._INSTANCE;\r\n  }\r\n\r\n  /**\r\n   * Gets or sets the default logging level. Excalibur will only log\r\n   * messages if equal to or above this level. Default: [[LogLevel.Info]]\r\n   */\r\n  public defaultLevel: LogLevel = LogLevel.Info;\r\n\r\n  /**\r\n   * Gets the current static instance of Logger\r\n   */\r\n  public static getInstance(): Logger {\r\n    if (Logger._INSTANCE == null) {\r\n      Logger._INSTANCE = new Logger();\r\n    }\r\n    return Logger._INSTANCE;\r\n  }\r\n\r\n  /**\r\n   * Adds a new [[Appender]] to the list of appenders to write to\r\n   */\r\n  public addAppender(appender: Appender): void {\r\n    this._appenders.push(appender);\r\n  }\r\n\r\n  /**\r\n   * Clears all appenders from the logger\r\n   */\r\n  public clearAppenders(): void {\r\n    this._appenders.length = 0;\r\n  }\r\n\r\n  /**\r\n   * Logs a message at a given LogLevel\r\n   * @param level  The LogLevel`to log the message at\r\n   * @param args   An array of arguments to write to an appender\r\n   */\r\n  private _log(level: LogLevel, args: any[]): void {\r\n    if (level == null) {\r\n      level = this.defaultLevel;\r\n    }\r\n\r\n    const len = this._appenders.length;\r\n\r\n    for (let i = 0; i < len; i++) {\r\n      if (level >= this.defaultLevel) {\r\n        this._appenders[i].log(level, args);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Writes a log message at the [[LogLevel.Debug]] level\r\n   * @param args  Accepts any number of arguments\r\n   */\r\n  public debug(...args: any[]): void {\r\n    this._log(LogLevel.Debug, args);\r\n  }\r\n\r\n  /**\r\n   * Writes a log message at the [[LogLevel.Info]] level\r\n   * @param args  Accepts any number of arguments\r\n   */\r\n  public info(...args: any[]): void {\r\n    this._log(LogLevel.Info, args);\r\n  }\r\n\r\n  /**\r\n   * Writes a log message at the [[LogLevel.Warn]] level\r\n   * @param args  Accepts any number of arguments\r\n   */\r\n  public warn(...args: any[]): void {\r\n    this._log(LogLevel.Warn, args);\r\n  }\r\n\r\n  /**\r\n   * Writes a log message at the [[LogLevel.Error]] level\r\n   * @param args  Accepts any number of arguments\r\n   */\r\n  public error(...args: any[]): void {\r\n    this._log(LogLevel.Error, args);\r\n  }\r\n\r\n  /**\r\n   * Writes a log message at the [[LogLevel.Fatal]] level\r\n   * @param args  Accepts any number of arguments\r\n   */\r\n  public fatal(...args: any[]): void {\r\n    this._log(LogLevel.Fatal, args);\r\n  }\r\n}\r\n\r\n/**\r\n * Contract for any log appender (such as console/screen)\r\n */\r\nexport interface Appender {\r\n  /**\r\n   * Logs a message at the given [[LogLevel]]\r\n   * @param level  Level to log at\r\n   * @param args   Arguments to log\r\n   */\r\n  log(level: LogLevel, args: any[]): void;\r\n}\r\n\r\n/**\r\n * Console appender for browsers (i.e. `console.log`)\r\n */\r\nexport class ConsoleAppender implements Appender {\r\n  /**\r\n   * Logs a message at the given [[LogLevel]]\r\n   * @param level  Level to log at\r\n   * @param args   Arguments to log\r\n   */\r\n  public log(level: LogLevel, args: any[]): void {\r\n    // Check for console support\r\n    if (!console && !console.log && console.warn && console.error) {\r\n      // todo maybe do something better than nothing\r\n      return;\r\n    }\r\n\r\n    // Create a new console args array\r\n    const consoleArgs: any[] = [];\r\n    consoleArgs.unshift.apply(consoleArgs, args);\r\n    consoleArgs.unshift('[' + LogLevel[level] + '] : ');\r\n\r\n    if (level < LogLevel.Warn) {\r\n      // Call .log for Debug/Info\r\n      if (console.log.apply) {\r\n        // this is required on some older browsers that don't support apply on console.log :(\r\n        console.log.apply(console, consoleArgs);\r\n      } else {\r\n        console.log(consoleArgs.join(' '));\r\n      }\r\n    } else if (level < LogLevel.Error) {\r\n      // Call .warn for Warn\r\n      if (console.warn.apply) {\r\n        console.warn.apply(console, consoleArgs);\r\n      } else {\r\n        console.warn(consoleArgs.join(' '));\r\n      }\r\n    } else {\r\n      // Call .error for Error/Fatal\r\n      if (console.error.apply) {\r\n        console.error.apply(console, consoleArgs);\r\n      } else {\r\n        console.error(consoleArgs.join(' '));\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * On-screen (canvas) appender\r\n */\r\nexport class ScreenAppender implements Appender {\r\n  // @todo Clean this up\r\n\r\n  private _messages: string[] = [];\r\n  private _canvas: HTMLCanvasElement;\r\n  private _ctx: CanvasRenderingContext2D;\r\n\r\n  /**\r\n   * @param width   Width of the screen appender in pixels\r\n   * @param height  Height of the screen appender in pixels\r\n   */\r\n  constructor(width?: number, height?: number) {\r\n    this._canvas = <HTMLCanvasElement>document.createElement('canvas');\r\n    this._canvas.width = width || window.innerWidth;\r\n    this._canvas.height = height || window.innerHeight;\r\n    this._canvas.style.position = 'absolute';\r\n    // eslint-disable-next-line\r\n    this._ctx = <CanvasRenderingContext2D>this._canvas.getContext('2d'); // eslint-disable-line\r\n    document.body.appendChild(this._canvas);\r\n  }\r\n\r\n  /**\r\n   * Logs a message at the given [[LogLevel]]\r\n   * @param level  Level to log at\r\n   * @param args   Arguments to log\r\n   */\r\n  public log(level: LogLevel, args: any[]): void {\r\n    const message = args.join(',');\r\n\r\n    this._ctx.clearRect(0, 0, this._canvas.width, this._canvas.height);\r\n\r\n    this._messages.unshift('[' + LogLevel[level] + '] : ' + message);\r\n\r\n    let pos = 10;\r\n    let opacity = 1.0;\r\n    for (let i = 0; i < this._messages.length; i++) {\r\n      this._ctx.fillStyle = 'rgba(255,255,255,' + opacity.toFixed(2) + ')';\r\n      this._ctx.fillText(this._messages[i], 200, pos);\r\n      pos += 10;\r\n      opacity = opacity > 0 ? opacity - 0.05 : 0;\r\n    }\r\n  }\r\n}\r\n","import 'core-js/es/array/sort';\r\nimport 'core-js/es/object/keys';\r\n\r\n/**\r\n * Polyfill adding function\r\n */\r\nexport function polyfill() {\r\n  /* istanbul ignore next */\r\n  if (typeof window === 'undefined') {\r\n    window = <any>{\r\n      audioContext: function () {\r\n        return;\r\n      }\r\n    };\r\n  }\r\n  /* istanbul ignore next */\r\n  if (typeof window !== 'undefined' && !window.requestAnimationFrame) {\r\n    (<any>window).requestAnimationFrame =\r\n      (<any>window).webkitRequestAnimationFrame ||\r\n      (<any>window).mozRequestAnimationFrame ||\r\n      function (callback: Function) {\r\n        window.setInterval(callback, 1000 / 60);\r\n      };\r\n  }\r\n  /* istanbul ignore next */\r\n  if (typeof window !== 'undefined' && !window.cancelAnimationFrame) {\r\n    (<any>window).cancelAnimationFrame =\r\n      (<any>window).webkitCancelAnimationFrame ||\r\n      (<any>window).mozCancelAnimationFrame ||\r\n      function () {\r\n        return;\r\n      };\r\n  }\r\n  /* istanbul ignore next */\r\n  if (typeof window !== 'undefined' && !(<any>window).AudioContext) {\r\n    if ((<any>window).webkitAudioContext) {\r\n      const ctx = (<any>window).webkitAudioContext;\r\n      const replaceMe = ctx.prototype.decodeAudioData;\r\n      (<any>window).webkitAudioContext.prototype.decodeAudioData = function (arrayBuffer: ArrayBuffer) {\r\n        return new Promise((resolve, reject) => {\r\n          replaceMe.call(this, arrayBuffer, resolve, reject);\r\n        });\r\n      };\r\n    }\r\n\r\n    (<any>window).AudioContext =\r\n      (<any>window).AudioContext ||\r\n      (<any>window).webkitAudioContext ||\r\n      (<any>window).mozAudioContext ||\r\n      (<any>window).msAudioContext ||\r\n      (<any>window).oAudioContext;\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  if (typeof window !== 'undefined' && !(<any>window).devicePixelRatio) {\r\n    (<any>window).devicePixelRatio = window.devicePixelRatio || 1;\r\n  }\r\n}\r\n","export type Id<T extends string> = {\r\n  type: T,\r\n  value: number\r\n};\r\n\r\n/**\r\n * Create a branded ID type from a number\r\n */\r\nexport function createId<T extends string>(type: T, value: number): Id<T> {\r\n  return { type, value };\r\n};\r\n","import { Flags } from '../Flags';\r\nimport { Logger } from './Log';\r\n\r\n/**\r\n * Obsolete decorator options\r\n */\r\nexport interface ObsoleteOptions {\r\n  // Optionally specify a custom message\r\n  message?: string;\r\n  // Optionally indicate that an alternate method to the obsolete one exists\r\n  alternateMethod?: string;\r\n  // Optional show stack trace, by default off\r\n  showStackTrace?: boolean;\r\n}\r\n\r\nexport const maxMessages = 5;\r\nconst obsoleteMessage: { [messageCount: string]: number } = {};\r\nexport const resetObsoleteCounter = () => {\r\n  for (const message in obsoleteMessage) {\r\n    obsoleteMessage[message] = 0;\r\n  }\r\n};\r\n\r\nconst logMessage = (message: string, options: ObsoleteOptions) => {\r\n  const suppressObsoleteMessages = Flags.isEnabled('suppress-obsolete-message');\r\n  if (obsoleteMessage[message] < maxMessages && !suppressObsoleteMessages) {\r\n    Logger.getInstance().warn(message);\r\n\r\n    // tslint:disable-next-line: no-console\r\n    if (console.trace && options.showStackTrace) {\r\n      // tslint:disable-next-line: no-console\r\n      console.trace();\r\n    }\r\n  }\r\n  obsoleteMessage[message]++;\r\n};\r\n\r\n/**\r\n * Obsolete decorator for marking Excalibur methods obsolete, you can optionally specify a custom message and/or alternate replacement\r\n * method do the deprecated one. Inspired by https://github.com/jayphelps/core-decorators.js\r\n */\r\nexport function obsolete(options?: ObsoleteOptions): any {\r\n  options = {\r\n    message: 'This feature will be removed in future versions of Excalibur.',\r\n    alternateMethod: null,\r\n    showStackTrace: false,\r\n    ...options\r\n  };\r\n\r\n  return function (target: any, property: string, descriptor: PropertyDescriptor): any {\r\n    if (\r\n      descriptor &&\r\n      !(typeof descriptor.value === 'function' || typeof descriptor.get === 'function' || typeof descriptor.set === 'function')\r\n    ) {\r\n      throw new SyntaxError('Only classes/functions/getters/setters can be marked as obsolete');\r\n    }\r\n    const methodSignature = `${target.name || ''}${target.name && property ? '.' : ''}${property ? property : ''}`;\r\n\r\n    const message =\r\n      `${methodSignature} is marked obsolete: ${options.message}` +\r\n      (options.alternateMethod ? ` Use ${options.alternateMethod} instead` : '');\r\n\r\n    if (!obsoleteMessage[message]) {\r\n      obsoleteMessage[message] = 0;\r\n    }\r\n\r\n    // If descriptor is null it is a class\r\n    const method = descriptor ? { ...descriptor } : target;\r\n    if (!descriptor) {\r\n      // with es2015 classes we need to change our decoration tactic\r\n      class DecoratedClass extends method {\r\n        constructor(...args: any) {\r\n          logMessage(message, options);\r\n          super(...args);\r\n        }\r\n      }\r\n      return DecoratedClass;\r\n    }\r\n\r\n    if (descriptor && descriptor.value) {\r\n      method.value = function (this: any) {\r\n        logMessage(message, options);\r\n        return descriptor.value.apply(this, arguments);\r\n      };\r\n      return method;\r\n    }\r\n\r\n    if (descriptor && descriptor.get) {\r\n      method.get = function (this: any) {\r\n        logMessage(message, options);\r\n        return descriptor.get.apply(this, arguments);\r\n      };\r\n    }\r\n\r\n    if (descriptor && descriptor.set) {\r\n      method.set = function (this: any) {\r\n        logMessage(message, options);\r\n        return descriptor.set.apply(this, arguments);\r\n      };\r\n    }\r\n    return method;\r\n  };\r\n}\r\n","import { Clonable } from '../Interfaces/Clonable';\r\nimport { obsolete } from '../Util/Decorators';\r\n\r\n/**\r\n * A 2D vector on a plane.\r\n */\r\n\r\nexport class Vector implements Clonable<Vector> {\r\n  /**\r\n   * A (0, 0) vector\r\n   */\r\n  public static get Zero() {\r\n    return new Vector(0, 0);\r\n  }\r\n\r\n  /**\r\n   * A (1, 1) vector\r\n   */\r\n  public static get One() {\r\n    return new Vector(1, 1);\r\n  }\r\n\r\n  /**\r\n   * A (0.5, 0.5) vector\r\n   */\r\n  public static get Half() {\r\n    return new Vector(0.5, 0.5);\r\n  }\r\n\r\n  /**\r\n   * A unit vector pointing up (0, -1)\r\n   */\r\n  public static get Up() {\r\n    return new Vector(0, -1);\r\n  }\r\n\r\n  /**\r\n   * A unit vector pointing down (0, 1)\r\n   */\r\n  public static get Down() {\r\n    return new Vector(0, 1);\r\n  }\r\n\r\n  /**\r\n   * A unit vector pointing left (-1, 0)\r\n   */\r\n  public static get Left() {\r\n    return new Vector(-1, 0);\r\n  }\r\n  /**\r\n   * A unit vector pointing right (1, 0)\r\n   */\r\n  public static get Right() {\r\n    return new Vector(1, 0);\r\n  }\r\n\r\n  /**\r\n   * Returns a vector of unit length in the direction of the specified angle in Radians.\r\n   * @param angle The angle to generate the vector\r\n   */\r\n  public static fromAngle(angle: number) {\r\n    return new Vector(Math.cos(angle), Math.sin(angle));\r\n  }\r\n\r\n  /**\r\n   * Checks if vector is not null, undefined, or if any of its components are NaN or Infinity.\r\n   */\r\n  public static isValid(vec: Vector) {\r\n    if (vec === null || vec === undefined) {\r\n      return false;\r\n    }\r\n    if (isNaN(vec.x) || isNaN(vec.y)) {\r\n      return false;\r\n    }\r\n\r\n    if (vec.x === Infinity || vec.y === Infinity || vec.x === -Infinity || vec.y === -Infinity) {\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Calculates distance between two Vectors\r\n   * @param vec1\r\n   * @param vec2\r\n   */\r\n  public static distance(vec1: Vector, vec2: Vector) {\r\n    return Math.sqrt(Math.pow(vec1.x - vec2.x, 2) + Math.pow(vec1.y - vec2.y, 2));\r\n  }\r\n\r\n  /**\r\n   * @param x  X component of the Vector\r\n   * @param y  Y component of the Vector\r\n   */\r\n  constructor(x: number, y: number) {\r\n    this._x = x;\r\n    this._y = y;\r\n  }\r\n\r\n  protected _x = 0;\r\n  /**\r\n   * Get the x component of the vector\r\n   */\r\n  public get x(): number {\r\n    return this._x;\r\n  }\r\n\r\n  /**\r\n   * Set the x component, THIS MUTATES the current vector. It is usually better to create a new vector.\r\n   * @warning **Be very careful setting components on shared vectors, mutating shared vectors can cause hard to find bugs**\r\n   */\r\n  public set x(val: number) {\r\n    this._x = val;\r\n  }\r\n\r\n  protected _y = 0;\r\n  /**\r\n   * Get the y component of the vector\r\n   */\r\n  public get y(): number {\r\n    return this._y;\r\n  }\r\n\r\n  /**\r\n   * Set the y component, THIS MUTATES the current vector. It is usually better to create a new vector.\r\n   * @warning **Be very careful setting components on shared vectors, mutating shared vectors can cause hard to find bugs**\r\n   */\r\n  public set y(val: number) {\r\n    this._y = val;\r\n  }\r\n\r\n  /**\r\n   * Sets the x and y components at once, THIS MUTATES the current vector. It is usually better to create a new vector.\r\n   *\r\n   * @warning **Be very careful using this, mutating vectors can cause hard to find bugs**\r\n   */\r\n  setTo(x: number, y: number) {\r\n    (this.x as number) = x;\r\n    (this.y as number) = y;\r\n  }\r\n\r\n  /**\r\n   * Compares this point against another and tests for equality\r\n   * @param vector The other point to compare to\r\n   * @param tolerance Amount of euclidean distance off we are willing to tolerate\r\n   */\r\n  public equals(vector: Vector, tolerance: number = 0.001): boolean {\r\n    return Math.abs(this.x - vector.x) <= tolerance && Math.abs(this.y - vector.y) <= tolerance;\r\n  }\r\n\r\n  /**\r\n   * The distance to another vector. If no other Vector is specified, this will return the [[magnitude]].\r\n   * @param v  The other vector. Leave blank to use origin vector.\r\n   */\r\n  public distance(v?: Vector): number {\r\n    if (!v) {\r\n      v = Vector.Zero;\r\n    }\r\n    return Math.sqrt(Math.pow(this.x - v.x, 2) + Math.pow(this.y - v.y, 2));\r\n  }\r\n\r\n  public squareDistance(v?: Vector): number {\r\n    if (!v) {\r\n      v = Vector.Zero;\r\n    }\r\n    return Math.pow(this.x - v.x, 2) + Math.pow(this.y - v.y, 2);\r\n  }\r\n\r\n  /**\r\n   * The magnitude (size) of the Vector\r\n   * @deprecated magnitude will be removed in favour of '.size' in version 0.25.0\r\n   */\r\n  @obsolete({ message: 'will be removed in favour of `.size` in version 0.25.0' })\r\n  public magnitude(): number {\r\n    return this.distance();\r\n  }\r\n\r\n  /**\r\n   * The size (magnitude) of the Vector\r\n   */\r\n  public get size(): number {\r\n    return this.distance();\r\n  }\r\n\r\n  /**\r\n   * Setting the size mutates the current vector\r\n   *\r\n   * @warning Can be used to set the size of the vector, **be very careful using this, mutating vectors can cause hard to find bugs**\r\n   */\r\n  public set size(newLength: number) {\r\n    const v = this.normalize().scale(newLength);\r\n    this.setTo(v.x, v.y);\r\n  }\r\n\r\n  /**\r\n   * Normalizes a vector to have a magnitude of 1.\r\n   */\r\n  public normalize(): Vector {\r\n    const d = this.distance();\r\n    if (d > 0) {\r\n      return new Vector(this.x / d, this.y / d);\r\n    } else {\r\n      return new Vector(0, 1);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns the average (midpoint) between the current point and the specified\r\n   */\r\n  public average(vec: Vector): Vector {\r\n    return this.add(vec).scale(0.5);\r\n  }\r\n\r\n  /**\r\n   * Scales a vector's by a factor of size\r\n   * @param size  The factor to scale the magnitude by\r\n   */\r\n  public scale(scale: Vector): Vector;\r\n  public scale(size: number): Vector;\r\n  public scale(sizeOrScale: number | Vector): Vector {\r\n    if (sizeOrScale instanceof Vector) {\r\n      return new Vector(this.x * sizeOrScale.x, this.y * sizeOrScale.y);\r\n    } else {\r\n      return new Vector(this.x * sizeOrScale, this.y * sizeOrScale);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Adds one vector to another\r\n   * @param v The vector to add\r\n   */\r\n  public add(v: Vector): Vector {\r\n    return new Vector(this.x + v.x, this.y + v.y);\r\n  }\r\n\r\n  /**\r\n   * Subtracts a vector from another, if you subtract vector `B.sub(A)` the resulting vector points from A -> B\r\n   * @param v The vector to subtract\r\n   */\r\n  public sub(v: Vector): Vector {\r\n    return new Vector(this.x - v.x, this.y - v.y);\r\n  }\r\n\r\n  /**\r\n   * Adds one vector to this one modifying the original\r\n   * @param v The vector to add\r\n   * @warning Be very careful using this, mutating vectors can cause hard to find bugs\r\n   */\r\n  public addEqual(v: Vector): Vector {\r\n    this.setTo(this.x + v.x, this.y + v.y);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Subtracts a vector from this one modifying the original\r\n   * @param v The vector to subtract\r\n   * @warning Be very careful using this, mutating vectors can cause hard to find bugs\r\n   */\r\n  public subEqual(v: Vector): Vector {\r\n    this.setTo(this.x - v.x, this.y - v.y);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Scales this vector by a factor of size and modifies the original\r\n   * @warning Be very careful using this, mutating vectors can cause hard to find bugs\r\n   */\r\n  public scaleEqual(size: number): Vector {\r\n    this.setTo(this.x * size, this.y * size);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Performs a dot product with another vector\r\n   * @param v  The vector to dot\r\n   */\r\n  public dot(v: Vector): number {\r\n    return this.x * v.x + this.y * v.y;\r\n  }\r\n\r\n  /**\r\n   * Performs a 2D cross product with scalar. 2D cross products with a scalar return a vector.\r\n   * @param v  The scalar to cross\r\n   */\r\n  public cross(v: number): Vector;\r\n  /**\r\n   * Performs a 2D cross product with another vector. 2D cross products return a scalar value not a vector.\r\n   * @param v  The vector to cross\r\n   */\r\n  public cross(v: Vector): number;\r\n  public cross(v: any): any {\r\n    if (v instanceof Vector) {\r\n      return this.x * v.y - this.y * v.x;\r\n    } else if (typeof v === 'number') {\r\n      return new Vector(v * this.y, -v * this.x);\r\n    }\r\n  }\r\n\r\n  static cross(num: number, vec: Vector): Vector {\r\n    return new Vector(-num * vec.y, num * vec.x);\r\n  }\r\n\r\n  /**\r\n   * Returns the perpendicular vector to this one\r\n   */\r\n  public perpendicular(): Vector {\r\n    return new Vector(this.y, -this.x);\r\n  }\r\n\r\n  /**\r\n   * Returns the normal vector to this one, same as the perpendicular of length 1\r\n   */\r\n  public normal(): Vector {\r\n    return this.perpendicular().normalize();\r\n  }\r\n\r\n  /**\r\n   * Negate the current vector\r\n   */\r\n  public negate(): Vector {\r\n    return this.scale(-1);\r\n  }\r\n\r\n  /**\r\n   * Returns the angle of this vector.\r\n   */\r\n  public toAngle(): number {\r\n    return Math.atan2(this.y, this.x);\r\n  }\r\n\r\n  /**\r\n   * Rotates the current vector around a point by a certain number of\r\n   * degrees in radians\r\n   */\r\n  public rotate(angle: number, anchor?: Vector): Vector {\r\n    if (!anchor) {\r\n      anchor = new Vector(0, 0);\r\n    }\r\n    const sinAngle = Math.sin(angle);\r\n    const cosAngle = Math.cos(angle);\r\n    const x = cosAngle * (this.x - anchor.x) - sinAngle * (this.y - anchor.y) + anchor.x;\r\n    const y = sinAngle * (this.x - anchor.x) + cosAngle * (this.y - anchor.y) + anchor.y;\r\n    return new Vector(x, y);\r\n  }\r\n\r\n  /**\r\n   * Creates new vector that has the same values as the previous.\r\n   */\r\n  public clone(): Vector {\r\n    return new Vector(this.x, this.y);\r\n  }\r\n\r\n  /**\r\n   * Returns a string representation of the vector.\r\n   */\r\n  public toString(fixed?: number): string {\r\n    if (fixed) {\r\n      return `(${this.x.toFixed(fixed)}, ${this.y.toFixed(fixed)})`;\r\n    }\r\n    return `(${this.x}, ${this.y})`;\r\n  }\r\n}\r\n\r\n/**\r\n * Shorthand for creating new Vectors - returns a new Vector instance with the\r\n * provided X and Y components.\r\n *\r\n * @param x  X component of the Vector\r\n * @param y  Y component of the Vector\r\n */\r\nexport function vec(x: number, y: number): Vector {\r\n  return new Vector(x, y);\r\n}\r\n","import { obsolete } from './Util/Decorators';\r\n\r\n/**\r\n * Provides standard colors (e.g. [[Color.Black]])\r\n * but you can also create custom colors using RGB, HSL, or Hex. Also provides\r\n * useful color operations like [[Color.lighten]], [[Color.darken]], and more.\r\n */\r\nexport class Color {\r\n  /**\r\n   * Red channel\r\n   */\r\n  public r: number;\r\n  /**\r\n   * Green channel\r\n   */\r\n  public g: number;\r\n  /**\r\n   * Blue channel\r\n   */\r\n  public b: number;\r\n  /**\r\n   * Alpha channel (between 0 and 1)\r\n   */\r\n  public a: number;\r\n\r\n  /**\r\n   * Hue\r\n   */\r\n  public h: number;\r\n  /**\r\n   * Saturation\r\n   */\r\n  public s: number;\r\n  /**\r\n   * Lightness\r\n   */\r\n  public l: number;\r\n\r\n  /**\r\n   * Creates a new instance of Color from an r, g, b, a\r\n   *\r\n   * @param r  The red component of color (0-255)\r\n   * @param g  The green component of color (0-255)\r\n   * @param b  The blue component of color (0-255)\r\n   * @param a  The alpha component of color (0-1.0)\r\n   */\r\n  constructor(r: number, g: number, b: number, a?: number) {\r\n    this.r = r;\r\n    this.g = g;\r\n    this.b = b;\r\n    this.a = a != null ? a : 1;\r\n  }\r\n\r\n  /**\r\n   * Creates a new instance of Color from an r, g, b, a\r\n   *\r\n   * @param r  The red component of color (0-255)\r\n   * @param g  The green component of color (0-255)\r\n   * @param b  The blue component of color (0-255)\r\n   * @param a  The alpha component of color (0-1.0)\r\n   */\r\n  public static fromRGB(r: number, g: number, b: number, a?: number): Color {\r\n    return new Color(r, g, b, a);\r\n  }\r\n\r\n  /**\r\n   * Creates a new instance of Color from a rgb string\r\n   *\r\n   * @param string  CSS color string of the form rgba(255, 255, 255, 1) or rgb(255, 255, 255)\r\n   */\r\n  public static fromRGBString(string: string): Color {\r\n    const rgbaRegEx: RegExp = /^rgba?\\((\\d+),\\s*(\\d+),\\s*(\\d+)(?:,\\s*(\\d+(?:\\.\\d+)?))?\\)/i;\r\n    let match = null;\r\n    if ((match = string.match(rgbaRegEx))) {\r\n      const r = parseInt(match[1], 10);\r\n      const g = parseInt(match[2], 10);\r\n      const b = parseInt(match[3], 10);\r\n      let a = 1;\r\n      if (match[4]) {\r\n        a = parseFloat(match[4]);\r\n      }\r\n      return new Color(r, g, b, a);\r\n    } else {\r\n      throw new Error('Invalid rgb/a string: ' + string);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Creates a new instance of Color from a hex string\r\n   *\r\n   * @param hex  CSS color string of the form #ffffff, the alpha component is optional\r\n   */\r\n  public static fromHex(hex: string): Color {\r\n    const hexRegEx: RegExp = /^#?([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})?$/i;\r\n    let match = null;\r\n    if ((match = hex.match(hexRegEx))) {\r\n      const r = parseInt(match[1], 16);\r\n      const g = parseInt(match[2], 16);\r\n      const b = parseInt(match[3], 16);\r\n      let a = 1;\r\n      if (match[4]) {\r\n        a = parseInt(match[4], 16) / 255;\r\n      }\r\n      return new Color(r, g, b, a);\r\n    } else {\r\n      throw new Error('Invalid hex string: ' + hex);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Creates a new instance of Color from hsla values\r\n   *\r\n   * @param h  Hue is represented [0-1]\r\n   * @param s  Saturation is represented [0-1]\r\n   * @param l  Luminance is represented [0-1]\r\n   * @param a  Alpha is represented [0-1]\r\n   */\r\n  public static fromHSL(h: number, s: number, l: number, a: number = 1.0): Color {\r\n    const temp = new HSLColor(h, s, l, a);\r\n    return temp.toRGBA();\r\n  }\r\n\r\n  /**\r\n   * Lightens the current color by a specified amount\r\n   *\r\n   * @param factor  The amount to lighten by [0-1]\r\n   */\r\n  public lighten(factor: number = 0.1): Color {\r\n    const temp = HSLColor.fromRGBA(this.r, this.g, this.b, this.a);\r\n    temp.l += (1 - temp.l) * factor;\r\n    return temp.toRGBA();\r\n  }\r\n\r\n  /**\r\n   * Darkens the current color by a specified amount\r\n   *\r\n   * @param factor  The amount to darken by [0-1]\r\n   */\r\n  public darken(factor: number = 0.1): Color {\r\n    const temp = HSLColor.fromRGBA(this.r, this.g, this.b, this.a);\r\n    temp.l -= temp.l * factor;\r\n    return temp.toRGBA();\r\n  }\r\n\r\n  /**\r\n   * Saturates the current color by a specified amount\r\n   *\r\n   * @param factor  The amount to saturate by [0-1]\r\n   */\r\n  public saturate(factor: number = 0.1): Color {\r\n    const temp = HSLColor.fromRGBA(this.r, this.g, this.b, this.a);\r\n    temp.s += temp.s * factor;\r\n    return temp.toRGBA();\r\n  }\r\n\r\n  /**\r\n   * Desaturates the current color by a specified amount\r\n   *\r\n   * @param factor  The amount to desaturate by [0-1]\r\n   */\r\n  public desaturate(factor: number = 0.1): Color {\r\n    const temp = HSLColor.fromRGBA(this.r, this.g, this.b, this.a);\r\n    temp.s -= temp.s * factor;\r\n    return temp.toRGBA();\r\n  }\r\n\r\n  /**\r\n   * Multiplies a color by another, results in a darker color\r\n   *\r\n   * @param color  The other color\r\n   */\r\n  public multiply(color: Color): Color {\r\n    const newR = (((color.r / 255) * this.r) / 255) * 255;\r\n    const newG = (((color.g / 255) * this.g) / 255) * 255;\r\n    const newB = (((color.b / 255) * this.b) / 255) * 255;\r\n    const newA = color.a * this.a;\r\n    return new Color(newR, newG, newB, newA);\r\n  }\r\n\r\n  /**\r\n   * Multiplies a color by another, results in a darker color\r\n   * @param color\r\n   * @deprecated Alias for incorrect spelling used in older versions, use multiply instead, will be removed in v0.25.0\r\n   */\r\n  @obsolete({ message: 'Alias for incorrect spelling used in older versions, use multiply instead, will be removed in v0.25.0' })\r\n  public mulitiply(color: Color): Color {\r\n    return this.multiply(color);\r\n  }\r\n\r\n  /**\r\n   * Screens a color by another, results in a lighter color\r\n   *\r\n   * @param color  The other color\r\n   */\r\n  public screen(color: Color): Color {\r\n    const color1 = color.invert();\r\n    const color2 = color.invert();\r\n    return color1.multiply(color2).invert();\r\n  }\r\n\r\n  /**\r\n   * Inverts the current color\r\n   */\r\n  public invert(): Color {\r\n    return new Color(255 - this.r, 255 - this.g, 255 - this.b, 1.0 - this.a);\r\n  }\r\n\r\n  /**\r\n   * Averages the current color with another\r\n   *\r\n   * @param color  The other color\r\n   */\r\n  public average(color: Color): Color {\r\n    const newR = (color.r + this.r) / 2;\r\n    const newG = (color.g + this.g) / 2;\r\n    const newB = (color.b + this.b) / 2;\r\n    const newA = (color.a + this.a) / 2;\r\n    return new Color(newR, newG, newB, newA);\r\n  }\r\n\r\n  public equal(color: Color): boolean {\r\n    return this.toString() === color.toString();\r\n  }\r\n\r\n  /**\r\n   * Returns a CSS string representation of a color.\r\n   *\r\n   * @param format Color representation, accepts: rgb, hsl, or hex\r\n   */\r\n  public toString(format: 'rgb' | 'hsl' | 'hex' = 'rgb') {\r\n    switch (format) {\r\n      case 'rgb':\r\n        return this.toRGBA();\r\n      case 'hsl':\r\n        return this.toHSLA();\r\n      case 'hex':\r\n        return this.toHex();\r\n      default:\r\n        throw new Error('Invalid Color format');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns Hex Value of a color component\r\n   * @param c color component\r\n   * @see https://stackoverflow.com/questions/5623838/rgb-to-hex-and-hex-to-rgb\r\n   */\r\n  private _componentToHex(c: number) {\r\n    const hex = c.toString(16);\r\n    return hex.length === 1 ? '0' + hex : hex;\r\n  }\r\n\r\n  /**\r\n   * Return Hex representation of a color.\r\n   */\r\n  public toHex() {\r\n    return '#' + this._componentToHex(this.r) + this._componentToHex(this.g) + this._componentToHex(this.b);\r\n  }\r\n\r\n  /**\r\n   * Return RGBA representation of a color.\r\n   */\r\n  public toRGBA() {\r\n    const result = String(this.r.toFixed(0)) + ', ' + String(this.g.toFixed(0)) + ', ' + String(this.b.toFixed(0));\r\n    if (this.a !== undefined || this.a !== null) {\r\n      return 'rgba(' + result + ', ' + String(this.a) + ')';\r\n    }\r\n    return 'rgb(' + result + ')';\r\n  }\r\n\r\n  /**\r\n   * Return HSLA representation of a color.\r\n   */\r\n  public toHSLA() {\r\n    return HSLColor.fromRGBA(this.r, this.g, this.b, this.a).toString();\r\n  }\r\n\r\n  /**\r\n   * Returns a CSS string representation of a color.\r\n   */\r\n  public fillStyle() {\r\n    return this.toString();\r\n  }\r\n\r\n  /**\r\n   * Returns a clone of the current color.\r\n   */\r\n  public clone(): Color {\r\n    return new Color(this.r, this.g, this.b, this.a);\r\n  }\r\n\r\n  /**\r\n   * Black (#000000)\r\n   */\r\n  public static get Black(): Color {\r\n    return Color.fromHex('#000000');\r\n  }\r\n\r\n  /**\r\n   * White (#FFFFFF)\r\n   */\r\n  public static get White(): Color {\r\n    return Color.fromHex('#FFFFFF');\r\n  }\r\n\r\n  /**\r\n   * Gray (#808080)\r\n   */\r\n  public static get Gray(): Color {\r\n    return Color.fromHex('#808080');\r\n  }\r\n\r\n  /**\r\n   * Light gray (#D3D3D3)\r\n   */\r\n  public static get LightGray(): Color {\r\n    return Color.fromHex('#D3D3D3');\r\n  }\r\n\r\n  /**\r\n   * Dark gray (#A9A9A9)\r\n   */\r\n  public static get DarkGray(): Color {\r\n    return Color.fromHex('#A9A9A9');\r\n  }\r\n\r\n  /**\r\n   * Yellow (#FFFF00)\r\n   */\r\n  public static get Yellow(): Color {\r\n    return Color.fromHex('#FFFF00');\r\n  }\r\n\r\n  /**\r\n   * Orange (#FFA500)\r\n   */\r\n  public static get Orange(): Color {\r\n    return Color.fromHex('#FFA500');\r\n  }\r\n\r\n  /**\r\n   * Red (#FF0000)\r\n   */\r\n  public static get Red(): Color {\r\n    return Color.fromHex('#FF0000');\r\n  }\r\n\r\n  /**\r\n   * Vermilion (#FF5B31)\r\n   */\r\n  public static get Vermilion(): Color {\r\n    return Color.fromHex('#FF5B31');\r\n  }\r\n\r\n  /**\r\n   * Vermilion (#FF5B31)\r\n   * @deprecated Alias for incorrect spelling used in older versions, use multiply instead, will be removed in v0.25.0\r\n   */\r\n  @obsolete({\r\n    message: 'Alias for incorrect spelling used in older versions',\r\n    alternateMethod: 'Vermilion'\r\n  })\r\n  public static get Vermillion(): Color {\r\n    return Color.Vermilion;\r\n  }\r\n\r\n  /**\r\n   * Rose (#FF007F)\r\n   */\r\n  public static get Rose(): Color {\r\n    return Color.fromHex('#FF007F');\r\n  }\r\n\r\n  /**\r\n   * Magenta (#FF00FF)\r\n   */\r\n  public static get Magenta(): Color {\r\n    return Color.fromHex('#FF00FF');\r\n  }\r\n\r\n  /**\r\n   * Violet (#7F00FF)\r\n   */\r\n  public static get Violet(): Color {\r\n    return Color.fromHex('#7F00FF');\r\n  }\r\n\r\n  /**\r\n   * Blue (#0000FF)\r\n   */\r\n  public static get Blue(): Color {\r\n    return Color.fromHex('#0000FF');\r\n  }\r\n\r\n  /**\r\n   * Azure (#007FFF)\r\n   */\r\n  public static get Azure(): Color {\r\n    return Color.fromHex('#007FFF');\r\n  }\r\n\r\n  /**\r\n   * Cyan (#00FFFF)\r\n   */\r\n  public static get Cyan(): Color {\r\n    return Color.fromHex('#00FFFF');\r\n  }\r\n\r\n  /**\r\n   * Viridian (#59978F)\r\n   */\r\n  public static get Viridian(): Color {\r\n    return Color.fromHex('#59978F');\r\n  }\r\n\r\n  /**\r\n   * Green (#00FF00)\r\n   */\r\n  public static get Green(): Color {\r\n    return Color.fromHex('#00FF00');\r\n  }\r\n\r\n  /**\r\n   * Chartreuse (#7FFF00)\r\n   */\r\n  public static get Chartreuse(): Color {\r\n    return Color.fromHex('#7FFF00');\r\n  }\r\n\r\n  /**\r\n   * Transparent (#FFFFFF00)\r\n   */\r\n  public static get Transparent(): Color {\r\n    return Color.fromHex('#FFFFFF00');\r\n  }\r\n\r\n  /**\r\n   * ExcaliburBlue (#176BAA)\r\n   */\r\n  public static get ExcaliburBlue(): Color {\r\n    return Color.fromHex('#176BAA');\r\n  }\r\n}\r\n\r\n/**\r\n * Internal HSL Color representation\r\n *\r\n * http://en.wikipedia.org/wiki/HSL_and_HSV\r\n * http://axonflux.com/handy-rgb-to-hsl-and-rgb-to-hsv-color-model-c\r\n */\r\nclass HSLColor {\r\n  constructor(public h: number, public s: number, public l: number, public a: number) {}\r\n\r\n  public static hue2rgb(p: number, q: number, t: number): number {\r\n    if (t < 0) {\r\n      t += 1;\r\n    }\r\n    if (t > 1) {\r\n      t -= 1;\r\n    }\r\n    if (t < 1 / 6) {\r\n      return p + (q - p) * 6 * t;\r\n    }\r\n    if (t < 1 / 2) {\r\n      return q;\r\n    }\r\n    if (t < 2 / 3) {\r\n      return p + (q - p) * (2 / 3 - t) * 6;\r\n    }\r\n    return p;\r\n  }\r\n\r\n  public static fromRGBA(r: number, g: number, b: number, a: number): HSLColor {\r\n    r /= 255;\r\n    g /= 255;\r\n    b /= 255;\r\n    const max = Math.max(r, g, b),\r\n      min = Math.min(r, g, b);\r\n    let h, s;\r\n    const l = (max + min) / 2;\r\n\r\n    if (max === min) {\r\n      h = s = 0; // achromatic\r\n    } else {\r\n      const d = max - min;\r\n      s = l > 0.5 ? d / (2 - max - min) : d / (max + min);\r\n      switch (max) {\r\n        case r:\r\n          h = (g - b) / d + (g < b ? 6 : 0);\r\n          break;\r\n        case g:\r\n          h = (b - r) / d + 2;\r\n          break;\r\n        case b:\r\n          h = (r - g) / d + 4;\r\n          break;\r\n      }\r\n      h /= 6;\r\n    }\r\n\r\n    return new HSLColor(h, s, l, a);\r\n  }\r\n\r\n  public toRGBA(): Color {\r\n    let r: number, g: number, b: number;\r\n\r\n    if (this.s === 0) {\r\n      r = g = b = this.l; // achromatic\r\n    } else {\r\n      const q = this.l < 0.5 ? this.l * (1 + this.s) : this.l + this.s - this.l * this.s;\r\n      const p = 2 * this.l - q;\r\n      r = HSLColor.hue2rgb(p, q, this.h + 1 / 3);\r\n      g = HSLColor.hue2rgb(p, q, this.h);\r\n      b = HSLColor.hue2rgb(p, q, this.h - 1 / 3);\r\n    }\r\n\r\n    return new Color(r * 255, g * 255, b * 255, this.a);\r\n  }\r\n\r\n  public toString(): string {\r\n    const h = this.h.toFixed(0),\r\n      s = this.s.toFixed(0),\r\n      l = this.l.toFixed(0),\r\n      a = this.a.toFixed(0);\r\n    return `hsla(${h}, ${s}, ${l}, ${a})`;\r\n  }\r\n}\r\n","/**\r\n * @module\r\n * Pseudo-Random Utility\r\n *\r\n * A pseudo-random utility to add seeded random support for help in\r\n * generating things like terrain or reproducible randomness. Uses the\r\n * [Mersenne Twister](https://en.wikipedia.org/wiki/Mersenne_Twister) algorithm.\r\n */\r\n\r\n/**\r\n * 32-bit mask\r\n */\r\nconst BITMASK32: number = 0xffffffff;\r\n\r\n/**\r\n * Pseudo-random number generator following the Mersenne_Twister algorithm. Given a seed this generator will produce the same sequence\r\n * of numbers each time it is called.\r\n * See https://en.wikipedia.org/wiki/Mersenne_Twister for more details.\r\n * Uses the MT19937-32 (2002) implementation documented here http://www.math.sci.hiroshima-u.ac.jp/~m-mat/MT/MT2002/emt19937ar.html\r\n *\r\n * Api inspired by http://chancejs.com/# https://github.com/chancejs/chancejs\r\n */\r\nexport class Random {\r\n  // Separation point of one one word, the number of bits in the lower bitmask 0 <= r <= w-1\r\n  private _lowerMask: number = 0x7fffffff; // 31 bits same as _r\r\n  private _upperMask: number = 0x80000000; // 34 high bits\r\n\r\n  // Word size, 64 bits\r\n  private _w: number = 32;\r\n\r\n  // Degree of recurrence\r\n  private _n: number = 624;\r\n\r\n  // Middle word, an offset used in the recurrence defining the series x, 1<=m<n\r\n  private _m: number = 397;\r\n  // coefficients of teh rational normal form twist matrix\r\n  private _a: number = 0x9908b0df;\r\n\r\n  // tempering bit shifts and masks\r\n  private _u: number = 11;\r\n  private _s: number = 7;\r\n  private _b: number = 0x9d2c5680;\r\n  private _t: number = 15;\r\n  private _c: number = 0xefc60000;\r\n  private _l: number = 18;\r\n  private _f: number = 1812433253;\r\n\r\n  private _mt: number[];\r\n\r\n  private _index: number;\r\n\r\n  /**\r\n   * If no seed is specified, the Date.now() is used\r\n   */\r\n  constructor(public seed?: number) {\r\n    this._mt = new Array<number>(this._n);\r\n    // need to mask to support higher bit machines\r\n    this._mt[0] = (seed || Date.now()) >>> 0;\r\n\r\n    for (let i = 1; i < this._n; i++) {\r\n      const s = this._mt[i - 1] ^ (this._mt[i - 1] >>> (this._w - 2));\r\n      // numbers are bigger than the JS max safe int, add in 16-bit chunks to prevent IEEE rounding errors on high bits\r\n      this._mt[i] = (((this._f * ((s & 0xffff0000) >>> 16)) << 16) + this._f * (s & 0xffff) + i) >>> 0;\r\n    }\r\n    this._index = this._n;\r\n  }\r\n\r\n  /**\r\n   * Apply the twist\r\n   */\r\n  private _twist(): void {\r\n    const mag01 = [0x0, this._a];\r\n    let y = 0,\r\n      i = 0;\r\n    for (; i < this._n - this._m; i++) {\r\n      y = (this._mt[i] & this._upperMask) | (this._mt[i + 1] & this._lowerMask);\r\n      this._mt[i] = this._mt[i + this._m] ^ (y >>> 1) ^ (mag01[y & 0x1] & BITMASK32);\r\n    }\r\n    for (; i < this._n - 1; i++) {\r\n      y = (this._mt[i] & this._upperMask) | (this._mt[i + 1] & this._lowerMask);\r\n      this._mt[i] = this._mt[i + (this._m - this._n)] ^ (y >>> 1) ^ (mag01[y & 0x1] & BITMASK32);\r\n    }\r\n    y = (this._mt[this._n - 1] & this._upperMask) | (this._mt[0] & this._lowerMask);\r\n    this._mt[this._n - 1] = this._mt[this._m - 1] ^ (y >>> 1) ^ (mag01[y & 0x1] & BITMASK32);\r\n\r\n    this._index = 0;\r\n  }\r\n\r\n  /**\r\n   * Return next 32 bit integer number in sequence\r\n   */\r\n  public nextInt(): number {\r\n    if (this._index >= this._n) {\r\n      this._twist();\r\n    }\r\n\r\n    let y = this._mt[this._index++];\r\n\r\n    y ^= y >>> this._u;\r\n    y ^= (y << this._s) & this._b;\r\n    y ^= (y << this._t) & this._c;\r\n    y ^= y >>> this._l;\r\n\r\n    return y >>> 0;\r\n  }\r\n\r\n  /**\r\n   * Return a random floating point number between [0, 1)\r\n   */\r\n  public next(): number {\r\n    return this.nextInt() * (1.0 / 4294967296.0); // divided by 2^32\r\n  }\r\n\r\n  /**\r\n   * Return a random floating point in range [min, max) min is included, max is not included\r\n   */\r\n  public floating(min: number, max: number): number {\r\n    return (max - min) * this.next() + min;\r\n  }\r\n\r\n  /**\r\n   * Return a random integer in range [min, max] min is included, max is included.\r\n   * Implemented with rejection sampling, see https://medium.com/@betable/tifu-by-using-math-random-f1c308c4fd9d#.i13tdiu5a\r\n   */\r\n  public integer(min: number, max: number): number {\r\n    return Math.floor((max - min + 1) * this.next() + min);\r\n  }\r\n\r\n  /**\r\n   * Returns true or false randomly with 50/50 odds by default.\r\n   * By default the likelihood of returning a true is .5 (50%).\r\n   * @param likelihood takes values between [0, 1]\r\n   */\r\n  public bool(likelihood: number = 0.5): boolean {\r\n    return this.next() <= likelihood;\r\n  }\r\n\r\n  /**\r\n   * Returns one element from an array at random\r\n   */\r\n  public pickOne<T>(array: Array<T>): T {\r\n    return array[this.integer(0, array.length - 1)];\r\n  }\r\n\r\n  /**\r\n   * Returns a new array random picking elements from the original\r\n   * @param array Original array to pick from\r\n   * @param numPicks can be any positive number\r\n   * @param allowDuplicates indicates whether the returned set is allowed duplicates (it does not mean there will always be duplicates\r\n   * just that it is possible)\r\n   */\r\n  public pickSet<T>(array: Array<T>, numPicks: number, allowDuplicates: boolean = false): Array<T> {\r\n    if (allowDuplicates) {\r\n      return this._pickSetWithDuplicates(array, numPicks);\r\n    } else {\r\n      return this._pickSetWithoutDuplicates(array, numPicks);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns a new array randomly picking elements in the original (not reused)\r\n   * @param array Array to pick elements out of\r\n   * @param numPicks must be less than or equal to the number of elements in the array.\r\n   */\r\n  private _pickSetWithoutDuplicates<T>(array: Array<T>, numPicks: number): Array<T> {\r\n    if (numPicks > array.length || numPicks < 0) {\r\n      throw new Error('Invalid number of elements to pick, must pick a value 0 < n <= length');\r\n    }\r\n    if (numPicks === array.length) {\r\n      return array;\r\n    }\r\n\r\n    const result: Array<T> = new Array<T>(numPicks);\r\n    let currentPick = 0;\r\n    const tempArray = array.slice(0);\r\n    while (currentPick < numPicks) {\r\n      const index = this.integer(0, tempArray.length - 1);\r\n      result[currentPick++] = tempArray[index];\r\n      tempArray.splice(index, 1);\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Returns a new array random picking elements from the original allowing duplicates\r\n   * @param array Array to pick elements out of\r\n   * @param numPicks can be any positive number\r\n   */\r\n  private _pickSetWithDuplicates<T>(array: Array<T>, numPicks: number): Array<T> {\r\n    // Typescript numbers are all floating point, so do we add check for int? (or floor the input?)\r\n    if (numPicks < 0) {\r\n      throw new Error('Invalid number of elements to pick, must pick a value 0 <= n < MAX_INT');\r\n    }\r\n    const result = new Array<T>(numPicks);\r\n    for (let i = 0; i < numPicks; i++) {\r\n      result[i] = this.pickOne(array);\r\n    }\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Returns a new array that has its elements shuffled. Using the Fisher/Yates method\r\n   * https://en.wikipedia.org/wiki/Fisher%E2%80%93Yates_shuffle\r\n   */\r\n  public shuffle<T>(array: Array<T>): Array<T> {\r\n    const tempArray = array.slice(0);\r\n    let swap: T = null;\r\n    for (let i = 0; i < tempArray.length - 2; i++) {\r\n      const randomIndex = this.integer(i, tempArray.length - 1);\r\n      swap = tempArray[i];\r\n      tempArray[i] = tempArray[randomIndex];\r\n      tempArray[randomIndex] = swap;\r\n    }\r\n\r\n    return tempArray;\r\n  }\r\n\r\n  /**\r\n   * Generate a list of random integer numbers\r\n   * @param length the length of the final array\r\n   * @param min the minimum integer number to generate inclusive\r\n   * @param max the maximum integer number to generate inclusive\r\n   */\r\n  public range(length: number, min: number, max: number): Array<number> {\r\n    const result: Array<number> = new Array(length);\r\n    for (let i = 0; i < length; i++) {\r\n      result[i] = this.integer(min, max);\r\n    }\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Returns the result of a d4 dice roll\r\n   */\r\n  public d4() {\r\n    return this.integer(1, 4);\r\n  }\r\n\r\n  /**\r\n   * Returns the result of a d6 dice roll\r\n   */\r\n  public d6() {\r\n    return this.integer(1, 6);\r\n  }\r\n\r\n  /**\r\n   * Returns the result of a d8 dice roll\r\n   */\r\n  public d8() {\r\n    return this.integer(1, 8);\r\n  }\r\n\r\n  /**\r\n   * Returns the result of a d10 dice roll\r\n   */\r\n  public d10() {\r\n    return this.integer(1, 10);\r\n  }\r\n\r\n  /**\r\n   * Returns the result of a d12 dice roll\r\n   */\r\n  public d12() {\r\n    return this.integer(1, 12);\r\n  }\r\n\r\n  /**\r\n   * Returns the result of a d20 dice roll\r\n   */\r\n  public d20() {\r\n    return this.integer(1, 20);\r\n  }\r\n}\r\n","import { Vector } from '../Math/vector';\r\n\r\n/**\r\n * An enum that describes the sides of an axis aligned box for collision\r\n */\r\nexport enum Side {\r\n  None = 'None',\r\n  Top = 'Top',\r\n  Bottom = 'Bottom',\r\n  Left = 'Left',\r\n  Right = 'Right'\r\n}\r\n\r\nexport module Side {\r\n  /**\r\n   * Returns the opposite side from the current\r\n   */\r\n  export function getOpposite(side: Side): Side {\r\n    if (side === Side.Top) {\r\n      return Side.Bottom;\r\n    }\r\n    if (side === Side.Bottom) {\r\n      return Side.Top;\r\n    }\r\n    if (side === Side.Left) {\r\n      return Side.Right;\r\n    }\r\n    if (side === Side.Right) {\r\n      return Side.Left;\r\n    }\r\n\r\n    return Side.None;\r\n  }\r\n\r\n  /**\r\n   * Given a vector, return the Side most in that direction (via dot product)\r\n   */\r\n  export function fromDirection(direction: Vector): Side {\r\n    const directions = [Vector.Left, Vector.Right, Vector.Up, Vector.Down];\r\n    const directionEnum = [Side.Left, Side.Right, Side.Top, Side.Bottom];\r\n\r\n    let max = -Number.MAX_VALUE;\r\n    let maxIndex = -1;\r\n    for (let i = 0; i < directions.length; i++) {\r\n      if (directions[i].dot(direction) > max) {\r\n        max = directions[i].dot(direction);\r\n        maxIndex = i;\r\n      }\r\n    }\r\n    return directionEnum[maxIndex];\r\n  }\r\n}\r\n","import { Vector } from '../Math/vector';\r\nimport { Ray } from '../Math/ray';\r\nimport { Color } from '../Color';\r\nimport { Side } from './Side';\r\nimport { ExcaliburGraphicsContext } from '../Graphics/Context/ExcaliburGraphicsContext';\r\nimport { Matrix } from '../Math/matrix';\r\n\r\nexport interface BoundingBoxOptions {\r\n  left: number;\r\n  right: number;\r\n  top: number;\r\n  bottom: number;\r\n}\r\n\r\n/**\r\n * Axis Aligned collision primitive for Excalibur.\r\n */\r\nexport class BoundingBox {\r\n  public top: number;\r\n  public right: number;\r\n  public bottom: number;\r\n  public left: number;\r\n\r\n  /**\r\n   * Constructor allows passing of either an object with all coordinate components,\r\n   * or the coordinate components passed separately.\r\n   * @param leftOrOptions    Either x coordinate of the left edge or an options object\r\n   * containing the four coordinate components.\r\n   * @param top     y coordinate of the top edge\r\n   * @param right   x coordinate of the right edge\r\n   * @param bottom  y coordinate of the bottom edge\r\n   */\r\n  constructor(leftOrOptions: number | BoundingBoxOptions = 0, top: number = 0, right: number = 0, bottom: number = 0) {\r\n    if (typeof leftOrOptions === 'object') {\r\n      this.left = leftOrOptions.left;\r\n      this.top = leftOrOptions.top;\r\n      this.right = leftOrOptions.right;\r\n      this.bottom = leftOrOptions.bottom;\r\n    } else if (typeof leftOrOptions === 'number') {\r\n      this.left = leftOrOptions;\r\n      this.top = top;\r\n      this.right = right;\r\n      this.bottom = bottom;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Given bounding box A & B, returns the side relative to A when intersection is performed.\r\n   * @param intersection Intersection vector between 2 bounding boxes\r\n   */\r\n  public static getSideFromIntersection(intersection: Vector): Side {\r\n    if (!intersection) {\r\n      return Side.None;\r\n    }\r\n    if (intersection) {\r\n      if (Math.abs(intersection.x) > Math.abs(intersection.y)) {\r\n        if (intersection.x < 0) {\r\n          return Side.Right;\r\n        }\r\n        return Side.Left;\r\n      } else {\r\n        if (intersection.y < 0) {\r\n          return Side.Bottom;\r\n        }\r\n        return Side.Top;\r\n      }\r\n    }\r\n    return Side.None;\r\n  }\r\n\r\n  public static fromPoints(points: Vector[]): BoundingBox {\r\n    let minX = Infinity;\r\n    let minY = Infinity;\r\n    let maxX = -Infinity;\r\n    let maxY = -Infinity;\r\n    for (let i = 0; i < points.length; i++) {\r\n      if (points[i].x < minX) {\r\n        minX = points[i].x;\r\n      }\r\n      if (points[i].x > maxX) {\r\n        maxX = points[i].x;\r\n      }\r\n      if (points[i].y < minY) {\r\n        minY = points[i].y;\r\n      }\r\n      if (points[i].y > maxY) {\r\n        maxY = points[i].y;\r\n      }\r\n    }\r\n    return new BoundingBox(minX, minY, maxX, maxY);\r\n  }\r\n\r\n  public static fromDimension(width: number, height: number, anchor: Vector = Vector.Half, pos: Vector = Vector.Zero) {\r\n    return new BoundingBox(\r\n      -width * anchor.x + pos.x,\r\n      -height * anchor.y + pos.y,\r\n      width - width * anchor.x + pos.x,\r\n      height - height * anchor.y + pos.y\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Returns the calculated width of the bounding box\r\n   */\r\n  public get width() {\r\n    return this.right - this.left;\r\n  }\r\n\r\n  /**\r\n   * Returns the calculated height of the bounding box\r\n   */\r\n  public get height() {\r\n    return this.bottom - this.top;\r\n  }\r\n\r\n  /**\r\n   * Return whether the bounding box has zero dimensions in height,width or both\r\n   */\r\n  public hasZeroDimensions() {\r\n    return this.width === 0 || this.height === 0;\r\n  }\r\n\r\n  /**\r\n   * Returns the center of the bounding box\r\n   */\r\n  public get center(): Vector {\r\n    return new Vector((this.left + this.right) / 2, (this.top + this.bottom) / 2);\r\n  }\r\n\r\n  public translate(pos: Vector): BoundingBox {\r\n    return new BoundingBox(this.left + pos.x, this.top + pos.y, this.right + pos.x, this.bottom + pos.y);\r\n  }\r\n\r\n  /**\r\n   * Rotates a bounding box by and angle and around a point, if no point is specified (0, 0) is used by default. The resulting bounding\r\n   * box is also axis-align. This is useful when a new axis-aligned bounding box is needed for rotated geometry.\r\n   */\r\n  public rotate(angle: number, point: Vector = Vector.Zero): BoundingBox {\r\n    const points = this.getPoints().map((p) => p.rotate(angle, point));\r\n    return BoundingBox.fromPoints(points);\r\n  }\r\n\r\n  public scale(scale: Vector, point: Vector = Vector.Zero): BoundingBox {\r\n    const shifted = this.translate(point);\r\n    return new BoundingBox(shifted.left * scale.x, shifted.top * scale.y, shifted.right * scale.x, shifted.bottom * scale.y);\r\n  }\r\n\r\n  public transform(matrix: Matrix) {\r\n    const points = this.getPoints().map((p) => matrix.multv(p));\r\n    return BoundingBox.fromPoints(points);\r\n  }\r\n\r\n  /**\r\n   * Returns the perimeter of the bounding box\r\n   */\r\n  public getPerimeter(): number {\r\n    const wx = this.width;\r\n    const wy = this.height;\r\n    return 2 * (wx + wy);\r\n  }\r\n\r\n  public getPoints(): Vector[] {\r\n    const results = [];\r\n    results.push(new Vector(this.left, this.top));\r\n    results.push(new Vector(this.right, this.top));\r\n    results.push(new Vector(this.right, this.bottom));\r\n    results.push(new Vector(this.left, this.bottom));\r\n    return results;\r\n  }\r\n\r\n  /**\r\n   * Determines whether a ray intersects with a bounding box\r\n   */\r\n  public rayCast(ray: Ray, farClipDistance = Infinity): boolean {\r\n    // algorithm from https://tavianator.com/fast-branchless-raybounding-box-intersections/\r\n    let tmin = -Infinity;\r\n    let tmax = +Infinity;\r\n\r\n    const xinv = ray.dir.x === 0 ? Number.MAX_VALUE : 1 / ray.dir.x;\r\n    const yinv = ray.dir.y === 0 ? Number.MAX_VALUE : 1 / ray.dir.y;\r\n\r\n    const tx1 = (this.left - ray.pos.x) * xinv;\r\n    const tx2 = (this.right - ray.pos.x) * xinv;\r\n    tmin = Math.min(tx1, tx2);\r\n    tmax = Math.max(tx1, tx2);\r\n\r\n    const ty1 = (this.top - ray.pos.y) * yinv;\r\n    const ty2 = (this.bottom - ray.pos.y) * yinv;\r\n    tmin = Math.max(tmin, Math.min(ty1, ty2));\r\n    tmax = Math.min(tmax, Math.max(ty1, ty2));\r\n\r\n    return tmax >= Math.max(0, tmin) && tmin < farClipDistance;\r\n  }\r\n\r\n  public rayCastTime(ray: Ray, farClipDistance = Infinity): number {\r\n    // algorithm from https://tavianator.com/fast-branchless-raybounding-box-intersections/\r\n    let tmin = -Infinity;\r\n    let tmax = +Infinity;\r\n\r\n    const xinv = ray.dir.x === 0 ? Number.MAX_VALUE : 1 / ray.dir.x;\r\n    const yinv = ray.dir.y === 0 ? Number.MAX_VALUE : 1 / ray.dir.y;\r\n\r\n    const tx1 = (this.left - ray.pos.x) * xinv;\r\n    const tx2 = (this.right - ray.pos.x) * xinv;\r\n    tmin = Math.min(tx1, tx2);\r\n    tmax = Math.max(tx1, tx2);\r\n\r\n    const ty1 = (this.top - ray.pos.y) * yinv;\r\n    const ty2 = (this.bottom - ray.pos.y) * yinv;\r\n    tmin = Math.max(tmin, Math.min(ty1, ty2));\r\n    tmax = Math.min(tmax, Math.max(ty1, ty2));\r\n\r\n    if (tmax >= Math.max(0, tmin) && tmin < farClipDistance) {\r\n      return tmin;\r\n    }\r\n    return -1;\r\n  }\r\n\r\n  /**\r\n   * Tests whether a point is contained within the bounding box\r\n   * @param p  The point to test\r\n   */\r\n  public contains(p: Vector): boolean;\r\n\r\n  /**\r\n   * Tests whether another bounding box is totally contained in this one\r\n   * @param bb  The bounding box to test\r\n   */\r\n  public contains(bb: BoundingBox): boolean;\r\n  public contains(val: any): boolean {\r\n    if (val instanceof Vector) {\r\n      return this.left <= val.x && this.top <= val.y && this.bottom >= val.y && this.right >= val.x;\r\n    } else if (val instanceof BoundingBox) {\r\n      if (this.left < val.left && this.top < val.top && val.bottom < this.bottom && val.right < this.right) {\r\n        return true;\r\n      }\r\n      return false;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Combines this bounding box and another together returning a new bounding box\r\n   * @param other  The bounding box to combine\r\n   */\r\n  public combine(other: BoundingBox): BoundingBox {\r\n    const compositeBB = new BoundingBox(\r\n      Math.min(this.left, other.left),\r\n      Math.min(this.top, other.top),\r\n      Math.max(this.right, other.right),\r\n      Math.max(this.bottom, other.bottom)\r\n    );\r\n    return compositeBB;\r\n  }\r\n\r\n  public get dimensions(): Vector {\r\n    return new Vector(this.width, this.height);\r\n  }\r\n\r\n  /**\r\n   * Test wether this bounding box intersects with another returning\r\n   * the intersection vector that can be used to resolve the collision. If there\r\n   * is no intersection null is returned.\r\n   *\r\n   * @param other  Other [[BoundingBox]] to test intersection with\r\n   * @returns A Vector in the direction of the current BoundingBox, this <- other\r\n   */\r\n  public intersect(other: BoundingBox): Vector {\r\n    const totalBoundingBox = this.combine(other);\r\n\r\n    // If the total bounding box is less than or equal the sum of the 2 bounds then there is collision\r\n    if (\r\n      totalBoundingBox.width < other.width + this.width &&\r\n      totalBoundingBox.height < other.height + this.height &&\r\n      !totalBoundingBox.dimensions.equals(other.dimensions) &&\r\n      !totalBoundingBox.dimensions.equals(this.dimensions)\r\n    ) {\r\n      // collision\r\n      let overlapX = 0;\r\n      // right edge is between the other's left and right edge\r\n      /**\r\n       *     +-this-+\r\n       *     |      |\r\n       *     |    +-other-+\r\n       *     +----|-+     |\r\n       *          |       |\r\n       *          +-------+\r\n       *         <---\r\n       *          ^ overlap\r\n       */\r\n      if (this.right >= other.left && this.right <= other.right) {\r\n        overlapX = other.left - this.right;\r\n        // right edge is past the other's right edge\r\n        /**\r\n         *     +-other-+\r\n         *     |       |\r\n         *     |    +-this-+\r\n         *     +----|--+   |\r\n         *          |      |\r\n         *          +------+\r\n         *          --->\r\n         *          ^ overlap\r\n         */\r\n      } else {\r\n        overlapX = other.right - this.left;\r\n      }\r\n\r\n      let overlapY = 0;\r\n      // top edge is between the other's top and bottom edge\r\n      /**\r\n       *     +-other-+\r\n       *     |       |\r\n       *     |    +-this-+   | <- overlap\r\n       *     +----|--+   |   |\r\n       *          |      |  \\ /\r\n       *          +------+   '\r\n       */\r\n      if (this.top <= other.bottom && this.top >= other.top) {\r\n        overlapY = other.bottom - this.top;\r\n        // top edge is above the other top edge\r\n        /**\r\n         *     +-this-+         .\r\n         *     |      |        / \\\r\n         *     |    +-other-+   | <- overlap\r\n         *     +----|-+     |   |\r\n         *          |       |\r\n         *          +-------+\r\n         */\r\n      } else {\r\n        overlapY = other.top - this.bottom;\r\n      }\r\n\r\n      if (Math.abs(overlapX) < Math.abs(overlapY)) {\r\n        return new Vector(overlapX, 0);\r\n      } else {\r\n        return new Vector(0, overlapY);\r\n      }\r\n      // Case of total containment of one bounding box by another\r\n    } else if (totalBoundingBox.dimensions.equals(other.dimensions) || totalBoundingBox.dimensions.equals(this.dimensions)) {\r\n      let overlapX = 0;\r\n      // this is wider than the other\r\n      if (this.width - other.width >= 0) {\r\n        // This right edge is closest to the others right edge\r\n        if (this.right - other.right <= other.left - this.left) {\r\n          overlapX = other.left - this.right;\r\n          // This left edge is closest to the others left edge\r\n        } else {\r\n          overlapX = other.right - this.left;\r\n        }\r\n        // other is wider than this\r\n      } else {\r\n        // This right edge is closest to the others right edge\r\n        if (other.right - this.right <= this.left - other.left) {\r\n          overlapX = this.left - other.right;\r\n          // This left edge is closest to the others left edge\r\n        } else {\r\n          overlapX = this.right - other.left;\r\n        }\r\n      }\r\n\r\n      let overlapY = 0;\r\n      // this is taller than other\r\n      if (this.height - other.height >= 0) {\r\n        // The bottom edge is closest to the others bottom edge\r\n        if (this.bottom - other.bottom <= other.top - this.top) {\r\n          overlapY = other.top - this.bottom;\r\n        } else {\r\n          overlapY = other.bottom - this.top;\r\n        }\r\n        // other is taller than this\r\n      } else {\r\n        // The bottom edge is closest to the others bottom edge\r\n        if (other.bottom - this.bottom <= this.top - other.top) {\r\n          overlapY = this.top - other.bottom;\r\n        } else {\r\n          overlapY = this.bottom - other.top;\r\n        }\r\n      }\r\n\r\n      if (Math.abs(overlapX) < Math.abs(overlapY)) {\r\n        return new Vector(overlapX, 0);\r\n      } else {\r\n        return new Vector(0, overlapY);\r\n      }\r\n    } else {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Test whether the bounding box has intersected with another bounding box, returns the side of the current bb that intersected.\r\n   * @param bb The other actor to test\r\n   */\r\n  public intersectWithSide(bb: BoundingBox): Side {\r\n    const intersect = this.intersect(bb);\r\n    return BoundingBox.getSideFromIntersection(intersect);\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @deprecated signature will change in v0.26.0\r\n   * @param ctx\r\n   * @param color\r\n   */\r\n  /* istanbul ignore next */\r\n  public debugDraw(ctx: CanvasRenderingContext2D, color: Color = Color.Yellow) {\r\n    ctx.strokeStyle = color.toString();\r\n    ctx.strokeRect(this.left, this.top, this.width, this.height);\r\n  }\r\n\r\n  /**\r\n   * Draw a debug bounding box\r\n   * @param ex\r\n   * @param color\r\n   */\r\n  public draw(ex: ExcaliburGraphicsContext, color: Color = Color.Yellow) {\r\n    ex.debug.drawRect(this.left, this.top, this.width, this.height, { color });\r\n  }\r\n}\r\n","import { Random } from './Random';\r\n\r\n/**\r\n * Two PI constant\r\n */\r\nexport const TwoPI: number = Math.PI * 2;\r\n\r\n/**\r\n * Returns the fractional part of a number\r\n * @param x\r\n */\r\nexport function frac(x: number): number {\r\n  if (x >= 0) {\r\n    return x - Math.floor(x);\r\n  } else {\r\n    return x - Math.ceil(x);\r\n  }\r\n}\r\n\r\n/**\r\n * Returns the sign of a number, if 0 returns 0\r\n */\r\nexport function sign(val: number): number {\r\n  if (val === 0) {\r\n    return 0;\r\n  }\r\n  return val < 0 ? -1 : 1;\r\n};\r\n\r\n/**\r\n * Clamps a value between a min and max inclusive\r\n */\r\nexport function clamp(val: number, min: number, max: number) {\r\n  return Math.min(Math.max(min, val), max);\r\n}\r\n\r\n\r\n/**\r\n * Convert an angle to be the equivalent in the range [0, 2PI]\r\n */\r\nexport function canonicalizeAngle(angle: number): number {\r\n  let tmpAngle = angle;\r\n  if (angle > TwoPI) {\r\n    while (tmpAngle > TwoPI) {\r\n      tmpAngle -= TwoPI;\r\n    }\r\n  }\r\n\r\n  if (angle < 0) {\r\n    while (tmpAngle < 0) {\r\n      tmpAngle += TwoPI;\r\n    }\r\n  }\r\n  return tmpAngle;\r\n}\r\n\r\n/**\r\n * Convert radians to degrees\r\n */\r\nexport function toDegrees(radians: number): number {\r\n  return (180 / Math.PI) * radians;\r\n}\r\n\r\n/**\r\n * Convert degrees to radians\r\n */\r\nexport function toRadians(degrees: number): number {\r\n  return (degrees / 180) * Math.PI;\r\n}\r\n\r\n/**\r\n * Generate a range of numbers\r\n * For example: range(0, 5) -> [0, 1, 2, 3, 4, 5]\r\n * @param from inclusive\r\n * @param to inclusive\r\n */\r\nexport const range = (from: number, to: number) => Array.from(new Array(to - from + 1), (_x, i) => i + from);\r\n\r\n/**\r\n * Find a random floating point number in range\r\n */\r\nexport function randomInRange(min: number, max: number, random: Random = new Random()): number {\r\n  return random ? random.floating(min, max) : min + Math.random() * (max - min);\r\n}\r\n\r\n/**\r\n * Find a random integer in a range\r\n */\r\nexport function randomIntInRange(min: number, max: number, random: Random = new Random()): number {\r\n  return random ? random.integer(min, max) : Math.round(randomInRange(min, max));\r\n}","import { Vector } from '../Math/vector';\r\nimport { Side } from '../Collision/Side';\r\nimport { Clock } from './Clock';\r\n\r\n// TODO remove in v0.26.0\r\n// Re-export hack to deprecate import site gently\r\nimport {\r\n  TwoPI as lTwoPI,\r\n  clamp as lclamp,\r\n  randomInRange as lrandomInRange,\r\n  randomIntInRange as lrandomIntInRange,\r\n  canonicalizeAngle as lcanonicalizeAngle,\r\n  toDegrees as ltoDegrees,\r\n  toRadians as ltoRadians,\r\n  range as lrange\r\n} from '../Math/util';\r\n\r\n/**\r\n * @deprecated ex.Util.TwoPI import site will be removed in v0.26.0, use ex.TwoPI\r\n */\r\nexport const TwoPI = lTwoPI;\r\n\r\n/**\r\n * @deprecated ex.Util.clamp import site will be removed in v0.26.0, use ex.clamp\r\n */\r\nexport const clamp = lclamp;\r\n\r\n/**\r\n * @deprecated ex.Util.randomInRange import site will be removed in v0.26.0, use ex.randomInRange\r\n */\r\nexport const randomInRange = lrandomInRange;\r\n\r\n/**\r\n * @deprecated ex.Util.randomIntInRange import site will be removed in v0.26.0, use ex.randomIntInRange\r\n */\r\nexport const randomIntInRange = lrandomIntInRange;\r\n\r\n/**\r\n * @deprecated ex.Util.canonicalizeAngle import site will be removed in v0.26.0, use ex.canonicalizeAngle\r\n */\r\nexport const canonicalizeAngle = lcanonicalizeAngle;\r\n\r\n/**\r\n * @deprecated ex.Util.toDegrees import site will be removed in v0.26.0, use ex.toDegrees\r\n */\r\nexport const toDegrees = ltoDegrees;\r\n\r\n/**\r\n * @deprecated ex.Util.toRadians import site will be removed in v0.26.0, use ex.toRadians\r\n */\r\nexport const toRadians = ltoRadians;\r\n\r\n/**\r\n * @deprecated ex.Util.range import site will be removed in v0.26.0, use ex.range\r\n */\r\nexport const range = lrange;\r\n\r\n// TODO END REMOVE in v0.26.0\r\n\r\n/**\r\n * Find the screen position of an HTML element\r\n */\r\nexport function getPosition(el: HTMLElement): Vector {\r\n  let oLeft: number = 0,\r\n    oTop: number = 0;\r\n\r\n  const calcOffsetLeft = (parent: HTMLElement) => {\r\n    oLeft += parent.offsetLeft;\r\n\r\n    if (parent.offsetParent) {\r\n      calcOffsetLeft(<HTMLElement>parent.offsetParent);\r\n    }\r\n  };\r\n  const calcOffsetTop = (parent: HTMLElement) => {\r\n    oTop += parent.offsetTop;\r\n    if (parent.offsetParent) {\r\n      calcOffsetTop(<HTMLElement>parent.offsetParent);\r\n    }\r\n  };\r\n\r\n  calcOffsetLeft(el);\r\n  calcOffsetTop(el);\r\n\r\n  return new Vector(oLeft, oTop);\r\n}\r\n\r\n/**\r\n * Add an item to an array list if it doesn't already exist. Returns true if added, false if not and already exists in the array.\r\n * @deprecated Will be removed in v0.26.0\r\n */\r\nexport function addItemToArray<T>(item: T, array: T[]): boolean {\r\n  if (array.indexOf(item) === -1) {\r\n    array.push(item);\r\n    return true;\r\n  }\r\n  return false;\r\n}\r\n\r\n/**\r\n * Remove an item from an list\r\n * @deprecated Will be removed in v0.26.0\r\n */\r\nexport function removeItemFromArray<T>(item: T, array: T[]): boolean {\r\n  let index = -1;\r\n  if ((index = array.indexOf(item)) > -1) {\r\n    array.splice(index, 1);\r\n    return true;\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\n/**\r\n * See if an array contains something\r\n */\r\nexport function contains(array: Array<any>, obj: any): boolean {\r\n  for (let i = 0; i < array.length; i++) {\r\n    if (array[i] === obj) {\r\n      return true;\r\n    }\r\n  }\r\n  return false;\r\n}\r\n\r\n/**\r\n * Get the opposite side\r\n * TODO: Move to Side type\r\n * @deprecated Will be removed in v0.26.0\r\n */\r\nexport function getOppositeSide(side: Side) {\r\n  if (side === Side.Top) {\r\n    return Side.Bottom;\r\n  }\r\n  if (side === Side.Bottom) {\r\n    return Side.Top;\r\n  }\r\n  if (side === Side.Left) {\r\n    return Side.Right;\r\n  }\r\n  if (side === Side.Right) {\r\n    return Side.Left;\r\n  }\r\n\r\n  return Side.None;\r\n}\r\n\r\n/**\r\n * Returns the side in the direction of the vector supplied\r\n * @param direction Vector to check\r\n * @deprecated\r\n * TODO: Move to Side type\r\n */\r\nexport function getSideFromDirection(direction: Vector) {\r\n  const directions = [Vector.Left, Vector.Right, Vector.Up, Vector.Down];\r\n  const directionEnum = [Side.Left, Side.Right, Side.Top, Side.Bottom];\r\n\r\n  let max = -Number.MAX_VALUE;\r\n  let maxIndex = -1;\r\n  for (let i = 0; i < directions.length; i++) {\r\n    if (directions[i].dot(direction) > max) {\r\n      max = directions[i].dot(direction);\r\n      maxIndex = i;\r\n    }\r\n  }\r\n  return directionEnum[maxIndex];\r\n}\r\n\r\n/**\r\n * Excalibur's dynamically resizing collection\r\n * @deprecated Will be removed v0.26.0\r\n */\r\nexport class Collection<T> {\r\n  /**\r\n   * Default collection size\r\n   */\r\n  public static DefaultSize = 200;\r\n  private _internalArray: T[] = null;\r\n  private _endPointer: number = 0;\r\n\r\n  /**\r\n   * @param initialSize  Initial size of the internal backing array\r\n   */\r\n  constructor(initialSize: number = Collection.DefaultSize) {\r\n    this._internalArray = new Array<T>(initialSize);\r\n  }\r\n\r\n  private _resize() {\r\n    const newSize = this._internalArray.length * 2;\r\n    const newArray = new Array<T>(newSize);\r\n    const count = this.count();\r\n    for (let i = 0; i < count; i++) {\r\n      newArray[i] = this._internalArray[i];\r\n    }\r\n\r\n    delete this._internalArray;\r\n    this._internalArray = newArray;\r\n  }\r\n\r\n  /**\r\n   * Push elements to the end of the collection\r\n   */\r\n  public push(element: T): T {\r\n    if (this._endPointer === this._internalArray.length) {\r\n      this._resize();\r\n    }\r\n    return (this._internalArray[this._endPointer++] = element);\r\n  }\r\n\r\n  /**\r\n   * Removes elements from the end of the collection\r\n   */\r\n  public pop(): T {\r\n    this._endPointer = this._endPointer - 1 < 0 ? 0 : this._endPointer - 1;\r\n    return this._internalArray[this._endPointer];\r\n  }\r\n\r\n  /**\r\n   * Returns the count of the collection\r\n   */\r\n  public count(): number {\r\n    return this._endPointer;\r\n  }\r\n\r\n  /**\r\n   * Empties the collection\r\n   */\r\n  public clear() {\r\n    this._endPointer = 0;\r\n  }\r\n\r\n  /**\r\n   * Returns the size of the internal backing array\r\n   */\r\n  public internalSize(): number {\r\n    return this._internalArray.length;\r\n  }\r\n\r\n  /**\r\n   * Returns an element at a specific index\r\n   * @param index  Index of element to retrieve\r\n   */\r\n  public elementAt(index: number): T {\r\n    if (index >= this.count()) {\r\n      //Logger.getInstance().error('Invalid parameter: ' + index);\r\n      throw new Error('Invalid index ' + index);\r\n    }\r\n    return this._internalArray[index];\r\n  }\r\n\r\n  /**\r\n   * Inserts an element at a specific index\r\n   * @param index  Index to insert the element\r\n   * @param value  Element to insert\r\n   */\r\n  public insert(index: number, value: T): T {\r\n    if (index >= this.count()) {\r\n      this._resize();\r\n    }\r\n    return (this._internalArray[index] = value);\r\n  }\r\n\r\n  /**\r\n   * Removes an element at a specific index\r\n   * @param index  Index of element to remove\r\n   */\r\n  public remove(index: number): T {\r\n    const count = this.count();\r\n    if (count === 0) {\r\n      //Logger.getInstance().error('Invalid parameter: ' + index);\r\n      throw new Error('Invalid parameter ' + index);\r\n    }\r\n    // O(n) Shift\r\n    const removed = this._internalArray[index];\r\n    for (let i = index; i < count; i++) {\r\n      this._internalArray[i] = this._internalArray[i + 1];\r\n    }\r\n    this._endPointer--;\r\n    return removed;\r\n  }\r\n\r\n  /**\r\n   * Removes an element by reference\r\n   * @param element  Element to retrieve\r\n   */\r\n  public removeElement(element: T) {\r\n    const index = this._internalArray.indexOf(element);\r\n    this.remove(index);\r\n  }\r\n\r\n  /**\r\n   * Returns a array representing the collection\r\n   */\r\n  public toArray(): T[] {\r\n    return this._internalArray.slice(0, this._endPointer);\r\n  }\r\n\r\n  /**\r\n   * Iterate over every element in the collection\r\n   * @param func  Callback to call for each element passing a reference to the element and its index, returned values are ignored\r\n   */\r\n  public forEach(func: (element: T, index: number) => any) {\r\n    let i = 0;\r\n    const count = this.count();\r\n    for (i; i < count; i++) {\r\n      func.call(this, this._internalArray[i], i);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Mutate every element in the collection\r\n   * @param func  Callback to call for each element passing a reference to the element and its index, any values returned mutate\r\n   * the collection\r\n   */\r\n  public map(func: (element: T, index: number) => any) {\r\n    const count = this.count();\r\n    for (let i = 0; i < count; i++) {\r\n      this._internalArray[i] = func.call(this, this._internalArray[i], i);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Used for exhaustive checks at compile time\r\n */\r\nexport function fail(message: never): never {\r\n  throw new Error(message);\r\n}\r\n\r\n/**\r\n * Create a promise that resolves after a certain number of milliseconds\r\n *\r\n * It is strongly recommended you pass the excalibur clock so delays are bound to the\r\n * excalibur clock which would be unaffected by stop/pause.\r\n * @param milliseconds\r\n * @param clock\r\n */\r\nexport function delay(milliseconds: number, clock?: Clock): Promise<void> {\r\n  const schedule = clock?.schedule.bind(clock) ?? setTimeout;\r\n  return new Promise<void>(resolve => {\r\n    schedule(() => {\r\n      resolve();\r\n    }, milliseconds);\r\n  });\r\n}\r\n","import { sign } from './util';\r\nimport { Vector, vec } from './vector';\r\nimport { canonicalizeAngle } from './util';\r\n\r\nexport enum MatrixLocations {\r\n  X = 12,\r\n  Y = 13\r\n}\r\n\r\n/**\r\n * Excalibur Matrix helper for 4x4 matrices\r\n *\r\n * Useful for webgl 4x4 matrices\r\n */\r\nexport class Matrix {\r\n  /**\r\n   *  4x4 matrix in column major order\r\n   *\r\n   * |         |         |          |          |\r\n   * | ------- | ------- | -------- |          |\r\n   * | data[0] | data[4] | data[8]  | data[12] |\r\n   * | data[1] | data[5] | data[9]  | data[13] |\r\n   * | data[2] | data[6] | data[10] | data[14] |\r\n   * | data[3] | data[7] | data[11] | data[15] |\r\n   *\r\n   */\r\n  public data: Float32Array = new Float32Array(16);\r\n\r\n  /**\r\n   * Creates an orthographic (flat non-perspective) projection\r\n   * https://en.wikipedia.org/wiki/Orthographic_projection\r\n   * @param left\r\n   * @param right\r\n   * @param bottom\r\n   * @param top\r\n   * @param near\r\n   * @param far\r\n   */\r\n  public static ortho(left: number, right: number, bottom: number, top: number, near: number, far: number): Matrix {\r\n    const mat = new Matrix();\r\n    mat.data[0] = 2 / (right - left);\r\n    mat.data[1] = 0;\r\n    mat.data[2] = 0;\r\n    mat.data[3] = 0;\r\n\r\n    mat.data[4] = 0;\r\n    mat.data[5] = 2 / (top - bottom);\r\n    mat.data[6] = 0;\r\n    mat.data[7] = 0;\r\n\r\n    mat.data[8] = 0;\r\n    mat.data[9] = 0;\r\n    mat.data[10] = -2 / (far - near);\r\n    mat.data[11] = 0;\r\n\r\n    mat.data[12] = -(right + left) / (right - left);\r\n    mat.data[13] = -(top + bottom) / (top - bottom);\r\n    mat.data[14] = -(far + near) / (far - near);\r\n    mat.data[15] = 1;\r\n    return mat;\r\n  }\r\n\r\n  /**\r\n   * Creates a new Matrix with the same data as the current 4x4\r\n   */\r\n  public clone(): Matrix {\r\n    const mat = new Matrix();\r\n    mat.data[0] = this.data[0];\r\n    mat.data[1] = this.data[1];\r\n    mat.data[2] = this.data[2];\r\n    mat.data[3] = this.data[3];\r\n\r\n    mat.data[4] = this.data[4];\r\n    mat.data[5] = this.data[5];\r\n    mat.data[6] = this.data[6];\r\n    mat.data[7] = this.data[7];\r\n\r\n    mat.data[8] = this.data[8];\r\n    mat.data[9] = this.data[9];\r\n    mat.data[10] = this.data[10];\r\n    mat.data[11] = this.data[11];\r\n\r\n    mat.data[12] = this.data[12];\r\n    mat.data[13] = this.data[13];\r\n    mat.data[14] = this.data[14];\r\n    mat.data[15] = this.data[15];\r\n    return mat;\r\n  }\r\n\r\n  /**\r\n   * Converts the current matrix into a DOMMatrix\r\n   *\r\n   * This is useful when working with the browser Canvas context\r\n   * @returns {DOMMatrix} DOMMatrix\r\n   */\r\n  public toDOMMatrix(): DOMMatrix {\r\n    return new DOMMatrix([...this.data]);\r\n  }\r\n\r\n  /**\r\n   * Creates a new identity matrix (a matrix that when applied does nothing)\r\n   */\r\n  public static identity(): Matrix {\r\n    const mat = new Matrix();\r\n    mat.data[0] = 1;\r\n    mat.data[1] = 0;\r\n    mat.data[2] = 0;\r\n    mat.data[3] = 0;\r\n\r\n    mat.data[4] = 0;\r\n    mat.data[5] = 1;\r\n    mat.data[6] = 0;\r\n    mat.data[7] = 0;\r\n\r\n    mat.data[8] = 0;\r\n    mat.data[9] = 0;\r\n    mat.data[10] = 1;\r\n    mat.data[11] = 0;\r\n\r\n    mat.data[12] = 0;\r\n    mat.data[13] = 0;\r\n    mat.data[14] = 0;\r\n    mat.data[15] = 1;\r\n    return mat;\r\n  }\r\n\r\n  /**\r\n   * Resets the current matrix to the identity matrix, mutating it\r\n   * @returns {Matrix} Current matrix as identity\r\n   */\r\n  public reset(): Matrix {\r\n    const mat = this;\r\n    mat.data[0] = 1;\r\n    mat.data[1] = 0;\r\n    mat.data[2] = 0;\r\n    mat.data[3] = 0;\r\n\r\n    mat.data[4] = 0;\r\n    mat.data[5] = 1;\r\n    mat.data[6] = 0;\r\n    mat.data[7] = 0;\r\n\r\n    mat.data[8] = 0;\r\n    mat.data[9] = 0;\r\n    mat.data[10] = 1;\r\n    mat.data[11] = 0;\r\n\r\n    mat.data[12] = 0;\r\n    mat.data[13] = 0;\r\n    mat.data[14] = 0;\r\n    mat.data[15] = 1;\r\n    return mat;\r\n  }\r\n\r\n  /**\r\n   * Creates a brand new translation matrix at the specified 3d point\r\n   * @param x\r\n   * @param y\r\n   */\r\n  public static translation(x: number, y: number): Matrix {\r\n    const mat = Matrix.identity();\r\n    mat.data[12] = x;\r\n    mat.data[13] = y;\r\n    return mat;\r\n  }\r\n\r\n  /**\r\n   * Creates a brand new scaling matrix with the specified scaling factor\r\n   * @param sx\r\n   * @param sy\r\n   */\r\n  public static scale(sx: number, sy: number): Matrix {\r\n    const mat = Matrix.identity();\r\n    mat.data[0] = sx;\r\n    mat.data[5] = sy;\r\n    mat.data[10] = 1;\r\n    mat.data[15] = 1;\r\n    return mat;\r\n  }\r\n\r\n  /**\r\n   * Creates a brand new rotation matrix with the specified angle\r\n   * @param angleRadians\r\n   */\r\n  public static rotation(angleRadians: number): Matrix {\r\n    const mat = Matrix.identity();\r\n    mat.data[0] = Math.cos(angleRadians);\r\n    mat.data[4] = -Math.sin(angleRadians);\r\n    mat.data[1] = Math.sin(angleRadians);\r\n    mat.data[5] = Math.cos(angleRadians);\r\n    return mat;\r\n  }\r\n\r\n  /**\r\n   * Multiplies the current matrix by a vector and returns the resulting vector\r\n   * @param other\r\n   */\r\n  multv(other: [number, number]): [number, number];\r\n  multv(other: Vector): Vector;\r\n  multv(other: [number, number] | Vector): [number, number] | Vector {\r\n    const z = 0;\r\n    if (other instanceof Vector) {\r\n      return new Vector(\r\n        other.x * this.data[0] + other.y * this.data[4] + z * this.data[6] + 1 * this.data[12],\r\n        other.x * this.data[1] + other.y * this.data[5] + z * this.data[9] + 1 * this.data[13]\r\n      );\r\n    } else {\r\n      const dest: [number, number] = [\r\n        other[0] * this.data[0] + other[1] * this.data[4] + z * this.data[6] + 1 * this.data[12],\r\n\r\n        other[0] * this.data[1] + other[1] * this.data[5] + z * this.data[9] + 1 * this.data[13]\r\n      ];\r\n      return dest;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Multiplies the current matrix by another and returns the resulting matrix\r\n   * @param other\r\n   */\r\n  multm(other: Matrix): Matrix {\r\n    const dest = new Matrix();\r\n    const a11 = this.data[0];\r\n    const a21 = this.data[1];\r\n    const a31 = this.data[2];\r\n    const a41 = this.data[3];\r\n\r\n    const a12 = this.data[4];\r\n    const a22 = this.data[5];\r\n    const a32 = this.data[6];\r\n    const a42 = this.data[7];\r\n\r\n    const a13 = this.data[8];\r\n    const a23 = this.data[9];\r\n    const a33 = this.data[10];\r\n    const a43 = this.data[11];\r\n\r\n    const a14 = this.data[12];\r\n    const a24 = this.data[13];\r\n    const a34 = this.data[14];\r\n    const a44 = this.data[15];\r\n\r\n    const b11 = other.data[0];\r\n    const b21 = other.data[1];\r\n    const b31 = other.data[2];\r\n    const b41 = other.data[3];\r\n\r\n    const b12 = other.data[4];\r\n    const b22 = other.data[5];\r\n    const b32 = other.data[6];\r\n    const b42 = other.data[7];\r\n\r\n    const b13 = other.data[8];\r\n    const b23 = other.data[9];\r\n    const b33 = other.data[10];\r\n    const b43 = other.data[11];\r\n\r\n    const b14 = other.data[12];\r\n    const b24 = other.data[13];\r\n    const b34 = other.data[14];\r\n    const b44 = other.data[15];\r\n\r\n    dest.data[0] = a11 * b11 + a12 * b21 + a13 * b31 + a14 * b41;\r\n    dest.data[1] = a21 * b11 + a22 * b21 + a23 * b31 + a24 * b41;\r\n    dest.data[2] = a31 * b11 + a32 * b21 + a33 * b31 + a34 * b41;\r\n    dest.data[3] = a41 * b11 + a42 * b21 + a43 * b31 + a44 * b41;\r\n\r\n    dest.data[4] = a11 * b12 + a12 * b22 + a13 * b32 + a14 * b42;\r\n    dest.data[5] = a21 * b12 + a22 * b22 + a23 * b32 + a24 * b42;\r\n    dest.data[6] = a31 * b12 + a32 * b22 + a33 * b32 + a34 * b42;\r\n    dest.data[7] = a41 * b12 + a42 * b22 + a43 * b32 + a44 * b42;\r\n\r\n    dest.data[8] = a11 * b13 + a12 * b23 + a13 * b33 + a14 * b43;\r\n    dest.data[9] = a21 * b13 + a22 * b23 + a23 * b33 + a24 * b43;\r\n    dest.data[10] = a31 * b13 + a32 * b23 + a33 * b33 + a34 * b43;\r\n    dest.data[11] = a41 * b13 + a42 * b23 + a43 * b33 + a44 * b43;\r\n\r\n    dest.data[12] = a11 * b14 + a12 * b24 + a13 * b34 + a14 * b44;\r\n    dest.data[13] = a21 * b14 + a22 * b24 + a23 * b34 + a24 * b44;\r\n    dest.data[14] = a31 * b14 + a32 * b24 + a33 * b34 + a34 * b44;\r\n    dest.data[15] = a41 * b14 + a42 * b24 + a43 * b34 + a44 * b44;\r\n\r\n    const s = this.getScale();\r\n    dest._scaleSignX = sign(s.x) * sign(dest._scaleSignX);\r\n    dest._scaleSignY = sign(s.y) * sign(dest._scaleSignY);\r\n\r\n    return dest;\r\n  }\r\n\r\n  /**\r\n   * Applies translation to the current matrix mutating it\r\n   * @param x\r\n   * @param y\r\n   */\r\n  translate(x: number, y: number) {\r\n    const a11 = this.data[0];\r\n    const a21 = this.data[1];\r\n    const a31 = this.data[2];\r\n    const a41 = this.data[3];\r\n\r\n    const a12 = this.data[4];\r\n    const a22 = this.data[5];\r\n    const a32 = this.data[6];\r\n    const a42 = this.data[7];\r\n\r\n    const a13 = this.data[8];\r\n    const a23 = this.data[9];\r\n    const a33 = this.data[10];\r\n    const a43 = this.data[11];\r\n\r\n    const a14 = this.data[12];\r\n    const a24 = this.data[13];\r\n    const a34 = this.data[14];\r\n    const a44 = this.data[15];\r\n\r\n    // Doesn't change z\r\n    const z = 0;\r\n    const w = 1;\r\n    this.data[12] = a11 * x + a12 * y + a13 * z + a14 * w;\r\n    this.data[13] = a21 * x + a22 * y + a23 * z + a24 * w;\r\n    this.data[14] = a31 * x + a32 * y + a33 * z + a34 * w;\r\n    this.data[15] = a41 * x + a42 * y + a43 * z + a44 * w;\r\n\r\n    return this;\r\n  }\r\n\r\n  public setPosition(x: number, y: number) {\r\n    this.data[12] = x;\r\n    this.data[13] = y;\r\n  }\r\n\r\n  public getPosition(): Vector {\r\n    return vec(this.data[12], this.data[13]);\r\n  }\r\n\r\n  /**\r\n   * Applies rotation to the current matrix mutating it\r\n   * @param angle in Radians\r\n   */\r\n  rotate(angle: number) {\r\n    const a11 = this.data[0];\r\n    const a21 = this.data[1];\r\n    const a31 = this.data[2];\r\n    const a41 = this.data[3];\r\n\r\n    const a12 = this.data[4];\r\n    const a22 = this.data[5];\r\n    const a32 = this.data[6];\r\n    const a42 = this.data[7];\r\n\r\n    const sine = Math.sin(angle);\r\n    const cosine = Math.cos(angle);\r\n\r\n    this.data[0] = cosine * a11 + sine * a12;\r\n    this.data[1] = cosine * a21 + sine * a22;\r\n    this.data[2] = cosine * a31 + sine * a32;\r\n    this.data[3] = cosine * a41 + sine * a42;\r\n\r\n    this.data[4] = cosine * a12 - sine * a11;\r\n    this.data[5] = cosine * a22 - sine * a21;\r\n    this.data[6] = cosine * a32 - sine * a31;\r\n    this.data[7] = cosine * a42 - sine * a41;\r\n\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Applies scaling to the current matrix mutating it\r\n   * @param x\r\n   * @param y\r\n   */\r\n  scale(x: number, y: number) {\r\n    const a11 = this.data[0];\r\n    const a21 = this.data[1];\r\n    const a31 = this.data[2];\r\n    const a41 = this.data[3];\r\n\r\n    const a12 = this.data[4];\r\n    const a22 = this.data[5];\r\n    const a32 = this.data[6];\r\n    const a42 = this.data[7];\r\n\r\n    this.data[0] = a11 * x;\r\n    this.data[1] = a21 * x;\r\n    this.data[2] = a31 * x;\r\n    this.data[3] = a41 * x;\r\n\r\n    this.data[4] = a12 * y;\r\n    this.data[5] = a22 * y;\r\n    this.data[6] = a32 * y;\r\n    this.data[7] = a42 * y;\r\n\r\n    return this;\r\n  }\r\n\r\n  public setRotation(angle: number) {\r\n    const currentScale = this.getScale();\r\n    const sine = Math.sin(angle);\r\n    const cosine = Math.cos(angle);\r\n\r\n    this.data[0] = cosine * currentScale.x;\r\n    this.data[1] = sine * currentScale.y;\r\n    this.data[4] = -sine * currentScale.x;\r\n    this.data[5] = cosine * currentScale.y;\r\n  }\r\n\r\n  public getRotation(): number {\r\n    const angle = Math.atan2(this.data[1] / this.getScaleY(), this.data[0] / this.getScaleX());\r\n    return canonicalizeAngle(angle);\r\n  }\r\n\r\n  public getScaleX(): number {\r\n    // absolute scale of the matrix (we lose sign so need to add it back)\r\n    const xscale = vec(this.data[0], this.data[4]).size;\r\n    return this._scaleSignX * xscale;\r\n  }\r\n\r\n  public getScaleY(): number {\r\n    // absolute scale of the matrix (we lose sign so need to add it back)\r\n    const yscale = vec(this.data[1], this.data[5]).size;\r\n    return this._scaleSignY * yscale;\r\n  }\r\n\r\n  /**\r\n   * Get the scale of the matrix\r\n   */\r\n  public getScale(): Vector {\r\n    return vec(this.getScaleX(), this.getScaleY());\r\n  }\r\n\r\n  private _scaleSignX = 1;\r\n  public setScaleX(val: number) {\r\n    this._scaleSignX = sign(val);\r\n    // negative scale acts like a 180 rotation, so flip\r\n    const xscale = vec(this.data[0] * this._scaleSignX, this.data[4] * this._scaleSignX).normalize();\r\n    this.data[0] = xscale.x * val;\r\n    this.data[4] = xscale.y * val;\r\n  }\r\n\r\n  private _scaleSignY = 1;\r\n  public setScaleY(val: number) {\r\n    this._scaleSignY = sign(val);\r\n    // negative scale acts like a 180 rotation, so flip\r\n    const yscale = vec(this.data[1] * this._scaleSignY, this.data[5] * this._scaleSignY).normalize();\r\n    this.data[1] = yscale.x * val;\r\n    this.data[5] = yscale.y * val;\r\n  }\r\n\r\n  public setScale(scale: Vector) {\r\n    this.setScaleX(scale.x);\r\n    this.setScaleY(scale.y);\r\n  }\r\n\r\n  /**\r\n   * Determinant of the upper left 2x2 matrix\r\n   */\r\n  public getBasisDeterminant() {\r\n    return this.data[0] * this.data[5] - this.data[1] * this.data[4];\r\n  }\r\n\r\n  /**\r\n   * Return the affine inverse, optionally store it in a target matrix.\r\n   *\r\n   * It's recommended you call .reset() the target unless you know what you're doing\r\n   * @param target\r\n   */\r\n  public getAffineInverse(target?: Matrix): Matrix {\r\n    // See http://negativeprobability.blogspot.com/2011/11/affine-transformations-and-their.html\r\n    // See https://www.mathsisfun.com/algebra/matrix-inverse.html\r\n    // Since we are actually only doing 2D transformations we can use this hack\r\n    // We don't actually use the 3rd or 4th dimension\r\n\r\n    const det = this.getBasisDeterminant();\r\n    const inverseDet = 1 / det; // todo zero check\r\n    const a = this.data[0];\r\n    const b = this.data[4];\r\n    const c = this.data[1];\r\n    const d = this.data[5];\r\n\r\n    const m = target || Matrix.identity();\r\n    // inverts rotation and scale\r\n    m.data[0] = d * inverseDet;\r\n    m.data[1] = -c * inverseDet;\r\n    m.data[4] = -b * inverseDet;\r\n    m.data[5] = a * inverseDet;\r\n\r\n    const tx = this.data[12];\r\n    const ty = this.data[13];\r\n    // invert translation\r\n    // transform translation into the matrix basis created by rot/scale\r\n    m.data[12] = -(tx * m.data[0] + ty * m.data[4]);\r\n    m.data[13] = -(tx * m.data[1] + ty * m.data[5]);\r\n\r\n    return m;\r\n  }\r\n\r\n  public isIdentity(): boolean {\r\n    return (\r\n      this.data[0] === 1 &&\r\n      this.data[1] === 0 &&\r\n      this.data[2] === 0 &&\r\n      this.data[3] === 0 &&\r\n      this.data[4] === 0 &&\r\n      this.data[5] === 1 &&\r\n      this.data[6] === 0 &&\r\n      this.data[7] === 0 &&\r\n      this.data[8] === 0 &&\r\n      this.data[9] === 0 &&\r\n      this.data[10] === 1 &&\r\n      this.data[11] === 0 &&\r\n      this.data[12] === 0 &&\r\n      this.data[13] === 0 &&\r\n      this.data[14] === 0 &&\r\n      this.data[15] === 1\r\n    );\r\n  }\r\n\r\n  public toString() {\r\n    return `\r\n[${this.data[0]} ${this.data[4]} ${this.data[8]} ${this.data[12]}]\r\n[${this.data[1]} ${this.data[5]} ${this.data[9]} ${this.data[13]}]\r\n[${this.data[2]} ${this.data[6]} ${this.data[10]} ${this.data[14]}]\r\n[${this.data[3]} ${this.data[7]} ${this.data[11]} ${this.data[15]}]\r\n`;\r\n  }\r\n}\r\n","import { Matrix } from '../../Math/matrix';\r\n\r\nexport class TransformStack {\r\n  private _transforms: Matrix[] = [];\r\n  private _currentTransform: Matrix = Matrix.identity();\r\n\r\n  public save(): void {\r\n    this._transforms.push(this._currentTransform);\r\n    this._currentTransform = this._currentTransform.clone();\r\n  }\r\n\r\n  public restore(): void {\r\n    this._currentTransform = this._transforms.pop();\r\n  }\r\n\r\n  public translate(x: number, y: number): Matrix {\r\n    return this._currentTransform.translate(x, y);\r\n  }\r\n\r\n  public rotate(angle: number): Matrix {\r\n    return this._currentTransform.rotate(angle);\r\n  }\r\n\r\n  public scale(x: number, y: number): Matrix {\r\n    return this._currentTransform.scale(x, y);\r\n  }\r\n\r\n  public set current(matrix: Matrix) {\r\n    this._currentTransform = matrix;\r\n  }\r\n\r\n  public get current(): Matrix {\r\n    return this._currentTransform;\r\n  }\r\n}\r\n","import { ExcaliburGraphicsContextState } from './ExcaliburGraphicsContext';\r\n\r\nexport class StateStack {\r\n  private _states: ExcaliburGraphicsContextState[] = [];\r\n  private _currentState: ExcaliburGraphicsContextState = this._getDefaultState();\r\n\r\n  private _getDefaultState() {\r\n    return {\r\n      opacity: 1\r\n    };\r\n  }\r\n\r\n  private _cloneState() {\r\n    return {\r\n      opacity: this._currentState.opacity\r\n    };\r\n  }\r\n\r\n  public save(): void {\r\n    this._states.push(this._currentState);\r\n    this._currentState = this._cloneState();\r\n  }\r\n\r\n  public restore(): void {\r\n    this._currentState = this._states.pop();\r\n  }\r\n\r\n  public get current(): ExcaliburGraphicsContextState {\r\n    return this._currentState;\r\n  }\r\n}\r\n","/**\r\n * Watch an object with a proxy, only fires if property value is different\r\n */\r\nexport function watch<T extends object>(type: T, change: (type: T) => any): T {\r\n  if (!type) {\r\n    return type;\r\n  }\r\n  if ((type as any).__isProxy === undefined) {\r\n    // expando hack to mark a proxy\r\n    return new Proxy(type, {\r\n      set: (obj, prop, value) => {\r\n        // The default behavior to store the value\r\n        if ((obj as any)[prop] !== value) {\r\n          (obj as any)[prop] = value;\r\n          // Avoid watching private junk\r\n          if (typeof prop === 'string') {\r\n            if (prop[0] !== '_') {\r\n              change(obj);\r\n            }\r\n          }\r\n        }\r\n        // Indicate success\r\n        return true;\r\n      },\r\n      get: (obj, prop) => {\r\n        if (prop !== '__isProxy') {\r\n          return (obj as any)[prop];\r\n        }\r\n        return true;\r\n      }\r\n    });\r\n  }\r\n  return type;\r\n}\r\n\r\n/**\r\n * Watch an object with a proxy, fires change on any property value change\r\n */\r\nexport function watchAny<T extends object>(type: T, change: (type: T) => any): T {\r\n  if (!type) {\r\n    return type;\r\n  }\r\n  if ((type as any).__isProxy === undefined) {\r\n    // expando hack to mark a proxy\r\n    return new Proxy(type, {\r\n      set: (obj, prop, value) => {\r\n        // The default behavior to store the value\r\n        (obj as any)[prop] = value;\r\n        // Avoid watching private junk\r\n        if (typeof prop === 'string') {\r\n          if (prop[0] !== '_') {\r\n            change(obj);\r\n          }\r\n        }\r\n\r\n        // Indicate success\r\n        return true;\r\n      },\r\n      get: (obj, prop) => {\r\n        if (prop !== '__isProxy') {\r\n          return (obj as any)[prop];\r\n        }\r\n        return true;\r\n      }\r\n    });\r\n  }\r\n  return type;\r\n}\r\n","import { Vector, vec } from '../Math/vector';\r\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\r\nimport { BoundingBox } from '../Collision/BoundingBox';\r\nimport { Matrix } from '..';\r\nimport { watch } from '../Util/Watch';\r\n\r\nexport interface GraphicOptions {\r\n  /**\r\n   * The width of the graphic\r\n   */\r\n  width?: number;\r\n  /**\r\n   * The height of the graphic\r\n   */\r\n  height?: number;\r\n  /**\r\n   * SHould the graphic be flipped horizontally\r\n   */\r\n  flipHorizontal?: boolean;\r\n  /**\r\n   * Should the graphic be flipped vertically\r\n   */\r\n  flipVertical?: boolean;\r\n  /**\r\n   * The rotation of the graphic\r\n   */\r\n  rotation?: number;\r\n  /**\r\n   * The scale of the graphic\r\n   */\r\n  scale?: Vector;\r\n  /**\r\n   * The opacity of the graphic\r\n   */\r\n  opacity?: number;\r\n  /**\r\n   * The origin of the drawing in pixels to use when applying transforms, by default it will be the center of the image\r\n   */\r\n  origin?: Vector;\r\n}\r\n\r\n/**\r\n * A Graphic is the base Excalibur primitive for something that can be drawn to the [[ExcaliburGraphicsContext]].\r\n * [[Sprite]], [[Animation]], [[GraphicsGroup]], [[Canvas]], [[Rectangle]], [[Circle]], and [[Polygon]] all derive from the\r\n * [[Graphic]] abstract class.\r\n *\r\n * Implementors of a Graphic must override the abstract [[Graphic._drawImage]] method to render an image to the graphics context. Graphic\r\n * handles all the position, rotation, and scale transformations in [[Graphic._preDraw]] and [[Graphic._postDraw]]\r\n */\r\nexport abstract class Graphic {\r\n  private static _ID: number = 0;\r\n  readonly id = Graphic._ID++;\r\n\r\n  public transform: Matrix = Matrix.identity();\r\n  private _transformStale = true;\r\n  public isStale() {\r\n    return this._transformStale;\r\n  }\r\n\r\n  /**\r\n   * Gets or sets wether to show debug information about the graphic\r\n   */\r\n  public showDebug: boolean = false;\r\n\r\n\r\n  private _flipHorizontal = false;\r\n  /**\r\n   * Gets or sets the flipHorizontal, which will flip the graphic horizontally (across the y axis)\r\n   */\r\n  public get flipHorizontal(): boolean {\r\n    return this._flipHorizontal;\r\n  }\r\n\r\n  public set flipHorizontal(value: boolean) {\r\n    this._flipHorizontal = value;\r\n    this._transformStale = true;\r\n  }\r\n\r\n  private _flipVertical = false;\r\n  /**\r\n   * Gets or sets the flipVertical, which will flip the graphic vertically (across the x axis)\r\n   */\r\n  public get flipVertical(): boolean {\r\n    return this._flipVertical;\r\n  }\r\n\r\n  public set flipVertical(value: boolean) {\r\n    this._flipVertical = value;\r\n    this._transformStale = true;\r\n  }\r\n\r\n  private _rotation = 0;\r\n  /**\r\n   * Gets or sets the rotation of the graphic\r\n   */\r\n  public get rotation(): number {\r\n    return this._rotation;\r\n  }\r\n\r\n  public set rotation(value: number) {\r\n    this._rotation = value;\r\n    this._transformStale = true;\r\n  }\r\n\r\n  /**\r\n   * Gets or sets the opacity of the graphic, 0 is transparent, 1 is solid (opaque).\r\n   */\r\n  public opacity: number = 1;\r\n\r\n  private _scale = Vector.One;\r\n  /**\r\n   * Gets or sets the scale of the graphic, this affects the width and\r\n   */\r\n  public get scale() {\r\n    return this._scale;\r\n  }\r\n\r\n  public set scale(value: Vector) {\r\n    this._scale = watch(value, () => {\r\n      this._transformStale = true;\r\n    });\r\n    this._transformStale = true;\r\n  }\r\n\r\n  private _origin: Vector | null = null;\r\n  /**\r\n   * Gets or sets the origin of the graphic, if not set the center of the graphic is the origin\r\n   */\r\n  public get origin(): Vector | null {\r\n    return this._origin;\r\n  }\r\n\r\n  public set origin(value: Vector | null) {\r\n    this._origin = watch(value, () => {\r\n      this._transformStale = true;\r\n    });\r\n    this._transformStale = true;\r\n  }\r\n\r\n  constructor(options?: GraphicOptions) {\r\n    if (options) {\r\n      this.origin = options.origin ?? this.origin;\r\n      this.flipHorizontal = options.flipHorizontal ?? this.flipHorizontal;\r\n      this.flipVertical = options.flipVertical ?? this.flipVertical;\r\n      this.rotation = options.rotation ?? this.rotation;\r\n      this.opacity = options.opacity ?? this.opacity;\r\n      this.scale = options.scale ?? this.scale;\r\n    }\r\n  }\r\n\r\n  public cloneGraphicOptions(): GraphicOptions {\r\n    return {\r\n      origin: this.origin ? this.origin.clone() : null,\r\n      flipHorizontal: this.flipHorizontal,\r\n      flipVertical: this.flipVertical,\r\n      rotation: this.rotation,\r\n      opacity: this.opacity,\r\n      scale: this.scale ? this.scale.clone() : null\r\n    };\r\n  }\r\n\r\n  private _width: number = 0;\r\n\r\n  /**\r\n   * Gets or sets the width of the graphic (always positive)\r\n   */\r\n  public get width() {\r\n    return Math.abs(this._width * this.scale.x);\r\n  }\r\n\r\n  private _height: number = 0;\r\n\r\n  /**\r\n   * Gets or sets the height of the graphic (always positive)\r\n   */\r\n  public get height() {\r\n    return Math.abs(this._height * this.scale.y);\r\n  }\r\n\r\n  public set width(value: number) {\r\n    this._width = value;\r\n    this._transformStale = true;\r\n  }\r\n\r\n  public set height(value: number) {\r\n    this._height = value;\r\n    this._transformStale = true;\r\n  }\r\n\r\n  /**\r\n   * Gets a copy of the bounds in pixels occupied by the graphic on the the screen. This includes scale.\r\n   */\r\n  public get localBounds(): BoundingBox {\r\n    return BoundingBox.fromDimension(this.width, this.height, Vector.Zero);\r\n  }\r\n\r\n  /**\r\n   * Draw the whole graphic to the context including transform\r\n   * @param ex The excalibur graphics context\r\n   * @param x\r\n   * @param y\r\n   */\r\n  public draw(ex: ExcaliburGraphicsContext, x: number, y: number): void {\r\n    this._preDraw(ex, x, y);\r\n    this._drawImage(ex, 0, 0);\r\n    this._postDraw(ex);\r\n  }\r\n\r\n  /**\r\n   * Meant to be overridden by the graphic implementation to draw the underlying image (HTMLCanvasElement or HTMLImageElement)\r\n   * to the graphics context without transform. Transformations like position, rotation, and scale are handled by [[Graphic._preDraw]]\r\n   * and [[Graphic._postDraw]]\r\n   * @param ex The excalibur graphics context\r\n   * @param x\r\n   * @param y\r\n   */\r\n  protected abstract _drawImage(ex: ExcaliburGraphicsContext, x: number, y: number): void;\r\n\r\n  /**\r\n   * Apply affine transformations to the graphics context to manipulate the graphic before [[Graphic._drawImage]]\r\n   * @param ex\r\n   * @param x\r\n   * @param y\r\n   */\r\n  protected _preDraw(ex: ExcaliburGraphicsContext, x: number, y: number): void {\r\n    ex.save();\r\n    ex.translate(x, y);\r\n    if (this._transformStale) {\r\n      this.transform.reset();\r\n      this.transform.scale(Math.abs(this.scale.x), Math.abs(this.scale.y));\r\n      this._rotate(this.transform);\r\n      this._flip(this.transform);\r\n      this._transformStale = false;\r\n    }\r\n    ex.multiply(this.transform);\r\n    // it is important to multiply alphas so graphics respect the current context\r\n    ex.opacity = ex.opacity * this.opacity;\r\n  }\r\n\r\n  protected _rotate(ex: ExcaliburGraphicsContext | Matrix) {\r\n    const scaleDirX = this.scale.x > 0 ? 1 : -1;\r\n    const scaleDirY = this.scale.y > 0 ? 1 : -1;\r\n    const origin = this.origin ?? vec(this.width / 2, this.height / 2);\r\n    ex.translate(origin.x, origin.y);\r\n    ex.rotate(this.rotation);\r\n    // This is for handling direction changes 1 or -1, that way we don't have mismatched translates()\r\n    ex.scale(scaleDirX, scaleDirY);\r\n    ex.translate(-origin.x, -origin.y);\r\n  }\r\n\r\n  protected _flip(ex: ExcaliburGraphicsContext | Matrix) {\r\n    if (this.flipHorizontal) {\r\n      ex.translate(this.width / this.scale.x, 0);\r\n      ex.scale(-1, 1);\r\n    }\r\n\r\n    if (this.flipVertical) {\r\n      ex.translate(0, this.height / this.scale.y);\r\n      ex.scale(1, -1);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Apply any additional work after [[Graphic._drawImage]] and restore the context state.\r\n   * @param ex\r\n   */\r\n  protected _postDraw(ex: ExcaliburGraphicsContext): void {\r\n    if (this.showDebug) {\r\n      ex.debug.drawRect(0, 0, this.width, this.height);\r\n    }\r\n    ex.restore();\r\n  }\r\n\r\n  /**\r\n   * Returns a new instance of the graphic that has the same properties\r\n   */\r\n  abstract clone(): Graphic;\r\n}\r\n","import * as Effects from './SpriteEffects';\r\nimport { Color } from '../Color';\r\n\r\nimport { Drawable, DrawOptions } from '../Interfaces/Drawable';\r\nimport { Texture } from './Texture';\r\nimport { Vector } from '../Math/vector';\r\nimport { Logger } from '../Util/Log';\r\nimport { Configurable } from '../Configurable';\r\nimport { obsolete } from '../Util/Decorators';\r\nimport { clamp } from '../Math/util';\r\n\r\n/**\r\n * @hidden\r\n * @deprecated Use [[Sprite]]\r\n */\r\nexport class SpriteImpl implements Drawable {\r\n  public texture: Texture;\r\n\r\n  public x: number = 0;\r\n  public y: number = 0;\r\n\r\n  public get drawWidth(): number {\r\n    return Math.abs(this.width * this.scale.x);\r\n  }\r\n\r\n  public get drawHeight(): number {\r\n    return Math.abs(this.height * this.scale.y);\r\n  }\r\n\r\n  public rotation: number = 0.0;\r\n  public anchor: Vector = Vector.Half;\r\n  public offset: Vector = Vector.Zero;\r\n  public scale: Vector = Vector.One;\r\n  /**\r\n   * Default: false, should the sprite be drawn around the anchor or from the top left.\r\n   * Sprite rotations/scaling still happen around the anchor regardless of this setting.\r\n   */\r\n  public drawAroundAnchor = false;\r\n\r\n  public logger: Logger = Logger.getInstance();\r\n\r\n  /**\r\n   * Draws the sprite flipped vertically\r\n   */\r\n  public flipVertical: boolean = false;\r\n\r\n  /**\r\n   * Draws the sprite flipped horizontally\r\n   */\r\n  public flipHorizontal: boolean = false;\r\n\r\n  public effects: Effects.SpriteEffect[] = [];\r\n\r\n  public width: number = 0;\r\n  public height: number = 0;\r\n\r\n  private _spriteCanvas: HTMLCanvasElement = null;\r\n  private _spriteCtx: CanvasRenderingContext2D = null;\r\n  private _pixelData: ImageData = null;\r\n  private _pixelsLoaded: boolean = false;\r\n  private _dirtyEffect: boolean = true;\r\n\r\n  /**\r\n   * @param imageOrConfig  The backing image texture to build the Sprite, or Sprite option bag\r\n   * @param x      The x position of the sprite\r\n   * @param y      The y position of the sprite\r\n   * @param width  The width of the sprite in pixels\r\n   * @param height The height of the sprite in pixels\r\n   */\r\n  constructor(imageOrConfig: Texture | SpriteArgs, x: number, y: number, width: number, height: number) {\r\n    let image = imageOrConfig;\r\n    if (imageOrConfig && !(imageOrConfig instanceof Texture)) {\r\n      x = imageOrConfig.x | 0;\r\n      y = imageOrConfig.y | 0;\r\n      width = imageOrConfig.width | 0;\r\n      height = imageOrConfig.height | 0;\r\n      image = imageOrConfig.image;\r\n      if (!image) {\r\n        const message = 'An image texture is required to construct a sprite';\r\n        throw new Error(message);\r\n      }\r\n    }\r\n\r\n    this.x = x || 0;\r\n    this.y = y || 0;\r\n\r\n    this.texture = image as Texture;\r\n    this._spriteCanvas = document.createElement('canvas');\r\n    this._spriteCanvas.width = width;\r\n    this._spriteCanvas.height = height;\r\n    this._spriteCtx = this._spriteCanvas.getContext('2d');\r\n    this._initPixelsFromTexture();\r\n\r\n    this.width = width;\r\n    this.height = height;\r\n  }\r\n\r\n  private async _initPixelsFromTexture() {\r\n    try {\r\n      const image = await this.texture.loaded;\r\n      this.width = this.width || image.naturalWidth;\r\n      this.height = this.height || image.naturalHeight;\r\n      this._spriteCanvas.width = this._spriteCanvas.width || image.naturalWidth;\r\n      this._spriteCanvas.height = this._spriteCanvas.height || image.naturalHeight;\r\n      this._loadPixels();\r\n      this._dirtyEffect = true;\r\n    } catch (e) {\r\n      this.logger.error('Error loading texture ', this.texture.path, e);\r\n    }\r\n  }\r\n\r\n  private _loadPixels() {\r\n    if (this.texture.isLoaded() && !this._pixelsLoaded) {\r\n      const naturalWidth = this.texture.image.naturalWidth || 0;\r\n      const naturalHeight = this.texture.image.naturalHeight || 0;\r\n\r\n      if (this.width > naturalWidth) {\r\n        this.logger.warn(`The sprite width ${this.width} exceeds the width \r\n                              ${naturalWidth} of the backing texture ${this.texture.path}`);\r\n      }\r\n\r\n      if (this.width <= 0 || naturalWidth <= 0) {\r\n        throw new Error(`The width of a sprite cannot be 0 or negative, sprite width: ${this.width}, original width: ${naturalWidth}`);\r\n      }\r\n\r\n      if (this.height > naturalHeight) {\r\n        this.logger.warn(`The sprite height ${this.height} exceeds the height \r\n                              ${naturalHeight} of the backing texture ${this.texture.path}`);\r\n      }\r\n\r\n      if (this.height <= 0 || naturalHeight <= 0) {\r\n        throw new Error(`The height of a sprite cannot be 0 or negative, sprite height: ${this.height}, original height: ${naturalHeight}`);\r\n      }\r\n\r\n      this._flushTexture();\r\n\r\n      this._pixelsLoaded = true;\r\n    }\r\n  }\r\n\r\n  private _flushTexture() {\r\n    const naturalWidth = this.texture.image.naturalWidth || 0;\r\n    const naturalHeight = this.texture.image.naturalHeight || 0;\r\n\r\n    this._spriteCtx.clearRect(0, 0, this.width, this.height);\r\n    this._spriteCtx.drawImage(\r\n      this.texture.image,\r\n      clamp(this.x, 0, naturalWidth),\r\n      clamp(this.y, 0, naturalHeight),\r\n      clamp(this.width, 0, naturalWidth),\r\n      clamp(this.height, 0, naturalHeight),\r\n      0,\r\n      0,\r\n      this.width,\r\n      this.height\r\n    );\r\n  }\r\n\r\n  private _opacity: number = 1;\r\n  /**\r\n   * Applies the [[Opacity]] effect to a sprite, setting the alpha of all pixels to a given value\r\n   */\r\n  public opacity(value: number) {\r\n    this._opacity = value;\r\n  }\r\n\r\n  /**\r\n   * Applies the [[Grayscale]] effect to a sprite, removing color information.\r\n   */\r\n  public grayscale() {\r\n    this.addEffect(new Effects.Grayscale());\r\n  }\r\n\r\n  /**\r\n   * Applies the [[Invert]] effect to a sprite, inverting the pixel colors.\r\n   */\r\n  public invert() {\r\n    this.addEffect(new Effects.Invert());\r\n  }\r\n\r\n  /**\r\n   * Applies the [[Fill]] effect to a sprite, changing the color channels of all non-transparent pixels to match a given color\r\n   */\r\n  public fill(color: Color) {\r\n    this.addEffect(new Effects.Fill(color));\r\n  }\r\n\r\n  /**\r\n   * Applies the [[Colorize]] effect to a sprite, changing the color channels of all pixels to be the average of the original color\r\n   * and the provided color.\r\n   */\r\n  public colorize(color: Color) {\r\n    this.addEffect(new Effects.Colorize(color));\r\n  }\r\n\r\n  /**\r\n   * Applies the [[Lighten]] effect to a sprite, changes the lightness of the color according to HSL\r\n   */\r\n  public lighten(factor: number = 0.1) {\r\n    this.addEffect(new Effects.Lighten(factor));\r\n  }\r\n\r\n  /**\r\n   * Applies the [[Darken]] effect to a sprite, changes the darkness of the color according to HSL\r\n   */\r\n  public darken(factor: number = 0.1) {\r\n    this.addEffect(new Effects.Darken(factor));\r\n  }\r\n\r\n  /**\r\n   * Applies the [[Saturate]] effect to a sprite, saturates the color according to HSL\r\n   */\r\n  public saturate(factor: number = 0.1) {\r\n    this.addEffect(new Effects.Saturate(factor));\r\n  }\r\n\r\n  /**\r\n   * Applies the [[Desaturate]] effect to a sprite, desaturates the color according to HSL\r\n   */\r\n  public desaturate(factor: number = 0.1) {\r\n    this.addEffect(new Effects.Desaturate(factor));\r\n  }\r\n\r\n  /**\r\n   * Adds a new [[SpriteEffect]] to this drawing.\r\n   * @param effect  Effect to add to the this drawing\r\n   */\r\n  public addEffect(effect: Effects.SpriteEffect) {\r\n    this.effects.push(effect);\r\n    // We must check if the texture and the backing sprite pixels are loaded as well before\r\n    // an effect can be applied\r\n    if (!this.texture.isLoaded() || !this._pixelsLoaded) {\r\n      this._dirtyEffect = true;\r\n    } else {\r\n      this._applyEffects();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Removes a [[SpriteEffect]] from this sprite.\r\n   * @param effect  Effect to remove from this sprite\r\n   */\r\n  public removeEffect(effect: Effects.SpriteEffect): void;\r\n\r\n  /**\r\n   * Removes an effect given the index from this sprite.\r\n   * @param index  Index of the effect to remove from this sprite\r\n   */\r\n  public removeEffect(index: number): void;\r\n  public removeEffect(param: any) {\r\n    let indexToRemove = -1;\r\n    if (typeof param === 'number') {\r\n      indexToRemove = param;\r\n    } else {\r\n      indexToRemove = this.effects.indexOf(param);\r\n    }\r\n\r\n    // bounds check\r\n    if (indexToRemove < 0 || indexToRemove >= this.effects.length) {\r\n      return;\r\n    }\r\n\r\n    this.effects.splice(indexToRemove, 1);\r\n\r\n    // We must check if the texture and the backing sprite pixels are loaded as well before\r\n    // an effect can be applied\r\n    if (!this.texture.isLoaded() || !this._pixelsLoaded) {\r\n      this._dirtyEffect = true;\r\n    } else {\r\n      this._applyEffects();\r\n    }\r\n  }\r\n\r\n  private _applyEffects() {\r\n    this._flushTexture();\r\n\r\n    if (this.effects.length > 0) {\r\n      this._pixelData = this._spriteCtx.getImageData(0, 0, this.width, this.height);\r\n\r\n      const len = this.effects.length;\r\n      for (let i = 0; i < len; i++) {\r\n        for (let y = 0; y < this.height; y++) {\r\n          for (let x = 0; x < this.width; x++) {\r\n            this.effects[i].updatePixel(x, y, this._pixelData);\r\n          }\r\n        }\r\n      }\r\n      this._spriteCtx.clearRect(0, 0, this.width, this.height);\r\n      this._spriteCtx.putImageData(this._pixelData, 0, 0);\r\n    }\r\n\r\n    this._dirtyEffect = false;\r\n  }\r\n\r\n  /**\r\n   * Clears all effects from the drawing and return it to its original state.\r\n   */\r\n  public clearEffects() {\r\n    this.effects.length = 0;\r\n    this._applyEffects();\r\n  }\r\n\r\n  /**\r\n   * Resets the internal state of the drawing (if any)\r\n   */\r\n  public reset() {\r\n    // do nothing\r\n  }\r\n\r\n  public debugDraw(ctx: CanvasRenderingContext2D, x: number, y: number) {\r\n    ctx.save();\r\n    ctx.translate(x, y);\r\n    ctx.rotate(this.rotation);\r\n    const xpoint = this.drawWidth * this.anchor.x;\r\n    const ypoint = this.drawHeight * this.anchor.y;\r\n\r\n    ctx.strokeStyle = Color.Black.toString();\r\n    ctx.strokeRect(-xpoint, -ypoint, this.drawWidth, this.drawHeight);\r\n    ctx.restore();\r\n  }\r\n\r\n  /**\r\n   * Draws the sprite appropriately to the 2D rendering context, at an x and y coordinate.\r\n   * @param ctx  The 2D rendering context\r\n   * @param x    The x coordinate of where to draw\r\n   * @param y    The y coordinate of where to draw\r\n   */\r\n  public draw(ctx: CanvasRenderingContext2D, x: number, y: number): void;\r\n  /**\r\n   * Draws the sprite with custom options to override internals without mutating them.\r\n   * @param options\r\n   */\r\n  public draw(options: DrawOptions): void;\r\n  public draw(ctxOrOptions: CanvasRenderingContext2D | DrawOptions, x?: number, y?: number): void {\r\n    if (ctxOrOptions instanceof CanvasRenderingContext2D) {\r\n      this._drawWithOptions({ ctx: ctxOrOptions, x, y });\r\n    } else {\r\n      this._drawWithOptions(ctxOrOptions);\r\n    }\r\n  }\r\n\r\n  private _drawWithOptions(options: DrawOptions) {\r\n    const { ctx, x, y, rotation, drawWidth, drawHeight, anchor, offset, opacity, flipHorizontal, flipVertical } = {\r\n      ...options,\r\n      rotation: options.rotation ?? this.rotation,\r\n      drawWidth: options.drawWidth ?? this.width,\r\n      drawHeight: options.drawHeight ?? this.height,\r\n      flipHorizontal: options.flipHorizontal ?? this.flipHorizontal,\r\n      flipVertical: options.flipVertical ?? this.flipVertical,\r\n      anchor: options.anchor ?? this.anchor,\r\n      offset: options.offset ?? this.offset,\r\n      opacity: (options.opacity ?? 1) * (this._opacity ?? 1)\r\n    };\r\n\r\n    if (this._dirtyEffect) {\r\n      this._applyEffects();\r\n    }\r\n    // calculating current dimensions\r\n    const anchorX = drawWidth * anchor.x + offset.x;\r\n    const anchorY = drawHeight * anchor.y + offset.y;\r\n    const scaleDirX = this.scale.x > 0 ? 1 : -1;\r\n    const scaleDirY = this.scale.y > 0 ? 1 : -1;\r\n\r\n    ctx.save();\r\n    // Move the draw point of origin\r\n    ctx.translate(x, y);\r\n\r\n    // Rotate and scale around anchor point\r\n    // This requires a bit of explaination, scale coordinates first positive flipping or rotating\r\n    ctx.scale(Math.abs(this.scale.x), Math.abs(this.scale.y));\r\n\r\n    if (this.drawAroundAnchor) {\r\n      // In the case where you want the anchor to match with the point of draw\r\n      // Otherwise sprites are always drawn from top-left\r\n      ctx.translate(-anchorX, -anchorY);\r\n    }\r\n\r\n    ctx.translate(anchorX, anchorY);\r\n    ctx.rotate(rotation);\r\n    // This is for handling direction changes 1 or -1, that way we don't have mismatched translates()\r\n    ctx.scale(scaleDirX, scaleDirY);\r\n    ctx.translate(-anchorX, -anchorY);\r\n\r\n    if (flipHorizontal) {\r\n      ctx.translate(drawWidth, 0);\r\n      ctx.scale(-1, 1);\r\n    }\r\n\r\n    if (flipVertical) {\r\n      ctx.translate(0, drawHeight);\r\n      ctx.scale(1, -1);\r\n    }\r\n    const oldAlpha = ctx.globalAlpha;\r\n    ctx.globalAlpha = opacity;\r\n    // Context is already rotated and scaled\r\n    ctx.drawImage(\r\n      this._spriteCanvas,\r\n      0,\r\n      0,\r\n      this.width,\r\n      this.height, // source\r\n      0,\r\n      0,\r\n      this.width,\r\n      this.height\r\n    ); // dest\r\n    ctx.globalAlpha = oldAlpha;\r\n    ctx.restore();\r\n  }\r\n\r\n  /**\r\n   * Produces a copy of the current sprite\r\n   */\r\n  public clone(): SpriteImpl {\r\n    const result = new Sprite(this.texture, this.x, this.y, this.width, this.height);\r\n    result.anchor = this.anchor.clone();\r\n    result.scale = this.scale.clone();\r\n    result.rotation = this.rotation;\r\n    result.flipHorizontal = this.flipHorizontal;\r\n    result.flipVertical = this.flipVertical;\r\n\r\n    const len = this.effects.length;\r\n    for (let i = 0; i < len; i++) {\r\n      result.addEffect(this.effects[i]);\r\n    }\r\n    return result;\r\n  }\r\n}\r\n\r\n/**\r\n * @deprecated Use [[Sprite]]\r\n */\r\nexport interface SpriteArgs extends Partial<SpriteImpl> {\r\n  image?: Texture;\r\n  x?: number;\r\n  width?: number;\r\n  height?: number;\r\n  rotation?: number;\r\n  anchor?: Vector;\r\n  scale?: Vector;\r\n  flipVertical?: boolean;\r\n  flipHorizontal?: boolean;\r\n}\r\n\r\n/**\r\n * A [[LegacyDrawing.Sprite]] is one of the main drawing primitives. It is responsible for drawing\r\n * images or parts of images from a [[LegacyDrawing.Texture]] resource to the screen.\r\n * @deprecated Use [[Sprite]]\r\n */\r\n@obsolete({\r\n  message: 'Label.clearTextShadow will be removed in v0.26.0',\r\n  alternateMethod: 'Use Label.font.shadow'\r\n})\r\nexport class Sprite extends Configurable(SpriteImpl) {\r\n  constructor(config: SpriteArgs);\r\n  constructor(image: Texture, x: number, y: number, width: number, height: number);\r\n  constructor(imageOrConfig: Texture | SpriteArgs, x?: number, y?: number, width?: number, height?: number) {\r\n    super(imageOrConfig, x, y, width, height);\r\n  }\r\n}\r\n","/**\r\n * Checks if the current number is a power of two\r\n */\r\nexport function isPowerOfTwo(x: number): boolean {\r\n  return (x & (x - 1)) === 0;\r\n}\r\n\r\n/**\r\n * Returns the next highest power of two\r\n */\r\nexport function nextHighestPowerOfTwo(x: number): number {\r\n  --x;\r\n  for (let i = 1; i < 32; i <<= 1) {\r\n    x = x | (x >> i);\r\n  }\r\n  return x + 1;\r\n}\r\n\r\n/**\r\n * Returns the input number if a power of two, otherwise the next highest power of two\r\n */\r\nexport function ensurePowerOfTwo(x: number): number {\r\n  if (!isPowerOfTwo(x)) {\r\n    return nextHighestPowerOfTwo(x);\r\n  }\r\n  return x;\r\n}\r\n\r\n/**\r\n * Return the size of the GlType in bytes\r\n * @param gl\r\n * @param type\r\n */\r\nexport function getGlTypeSizeBytes(gl: WebGLRenderingContext, type: number): number {\r\n  switch (type) {\r\n    case gl.FLOAT:\r\n      return 4;\r\n    case gl.SHORT:\r\n      return 2;\r\n    case gl.UNSIGNED_SHORT:\r\n      return 2;\r\n    case gl.BYTE:\r\n      return 1;\r\n    case gl.UNSIGNED_BYTE:\r\n      return 1;\r\n    default:\r\n      return 1;\r\n  }\r\n}\r\n\r\n\r\n/**\r\n * Based on the type return the number of attribute components\r\n *\r\n * https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/vertexAttribPointer\r\n * @param gl\r\n * @param type\r\n */\r\nexport function getAttributeComponentSize(gl: WebGLRenderingContext, type: number): number {\r\n  switch (type) {\r\n    case gl.LOW_FLOAT:\r\n    case gl.HIGH_FLOAT:\r\n    case gl.FLOAT:\r\n      return 1;\r\n    case gl.FLOAT_VEC2:\r\n      return 2;\r\n    case gl.FLOAT_VEC3:\r\n      return 3;\r\n    case gl.FLOAT_VEC4:\r\n      return 4;\r\n    case gl.BYTE:\r\n      return 1;\r\n    case gl.UNSIGNED_BYTE:\r\n      return 1;\r\n    case gl.UNSIGNED_SHORT:\r\n    case gl.SHORT:\r\n      return 1;\r\n    default:\r\n      return 1;\r\n  }\r\n}\r\n\r\n/**\r\n * Based on the attribute return the corresponding supported attrib pointer type\r\n * https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/vertexAttribPointer\r\n *\r\n * @param gl\r\n * @param type\r\n */\r\nexport function getAttributePointerType(gl: WebGLRenderingContext, type: number) {\r\n  switch (type) {\r\n    case gl.LOW_FLOAT:\r\n    case gl.HIGH_FLOAT:\r\n    case gl.FLOAT:\r\n    case gl.FLOAT_VEC2:\r\n    case gl.FLOAT_VEC3:\r\n    case gl.FLOAT_VEC4:\r\n      return gl.FLOAT;\r\n    case gl.BYTE:\r\n      return gl.BYTE;\r\n    case gl.UNSIGNED_BYTE:\r\n      return gl.UNSIGNED_BYTE;\r\n    case gl.SHORT:\r\n      return gl.SHORT;\r\n    case gl.UNSIGNED_SHORT:\r\n      return gl.UNSIGNED_SHORT;\r\n    default:\r\n      return gl.FLOAT;\r\n  }\r\n}","\r\n/**\r\n * Describes the different image filtering modes\r\n */\r\nexport enum ImageFiltering {\r\n\r\n  /**\r\n   * Pixel is useful when you do not want smoothing aka antialiasing applied to your graphics.\r\n   *\r\n   * Useful for Pixel art aesthetics.\r\n   */\r\n  Pixel = 'Pixel',\r\n\r\n  /**\r\n   * Blended is useful when you have high resolution artwork and would like it blended and smoothed\r\n   */\r\n  Blended = 'Blended'\r\n}","import { Logger } from '../../Util/Log';\r\nimport { ImageFiltering } from '../Filtering';\r\nimport { HTMLImageSource } from './ExcaliburGraphicsContext';\r\nimport { ensurePowerOfTwo, isPowerOfTwo } from './webgl-util';\r\n\r\n/**\r\n * Manages loading image sources into webgl textures, a unique id is associated with all sources\r\n */\r\nexport class TextureLoader {\r\n  private static _LOGGER = Logger.getInstance();\r\n  /**\r\n   * Sets the default filtering for the Excalibur texture loader, default [[ImageFiltering.Blended]]\r\n   */\r\n  public static filtering: ImageFiltering = ImageFiltering.Blended;\r\n  private static _POT_CANVAS = document.createElement('canvas');\r\n  private static _POT_CTX = TextureLoader._POT_CANVAS.getContext('2d');\r\n\r\n  private static _GL: WebGLRenderingContext;\r\n\r\n  private static _TEXTURE_MAP = new Map<HTMLImageSource, WebGLTexture>();\r\n\r\n  private static _MAX_TEXTURE_SIZE: number  = 0;\r\n\r\n  public static register(context: WebGLRenderingContext): void {\r\n    TextureLoader._GL = context;\r\n    TextureLoader._MAX_TEXTURE_SIZE = context.getParameter(context.MAX_TEXTURE_SIZE);\r\n  }\r\n\r\n  /**\r\n   * Get the WebGL Texture from a source image\r\n   * @param image\r\n   */\r\n  public static get(image: HTMLImageSource): WebGLTexture {\r\n    return TextureLoader._TEXTURE_MAP.get(image);\r\n  }\r\n\r\n  /**\r\n   * Returns whether a source image has been loaded as a texture\r\n   * @param image\r\n   */\r\n  public static has(image: HTMLImageSource): boolean {\r\n    return TextureLoader._TEXTURE_MAP.has(image);\r\n  }\r\n\r\n  /**\r\n   * Loads a graphic into webgl and returns it's texture info, a webgl context must be previously registered\r\n   * @param image Source graphic\r\n   * @param filtering {ImageFiltering} The ImageFiltering mode to apply to the loaded texture\r\n   * @param forceUpdate Optionally force a texture to be reloaded, useful if the source graphic has changed\r\n   */\r\n  public static load(image: HTMLImageSource, filtering?: ImageFiltering, forceUpdate = false): WebGLTexture {\r\n    // Ignore loading if webgl is not registered\r\n    const gl = TextureLoader._GL;\r\n    if (!gl) {\r\n      return null;\r\n    }\r\n\r\n    let tex: WebGLTexture = null;\r\n    // If reuse the texture if it's from the same source\r\n    if (TextureLoader.has(image)) {\r\n      tex = TextureLoader.get(image);\r\n    }\r\n\r\n    // Update existing webgl texture and return early\r\n    if (tex) {\r\n      if (forceUpdate) {\r\n        gl.bindTexture(gl.TEXTURE_2D, tex);\r\n        const source = TextureLoader.toPowerOfTwoImage(image);\r\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, source);\r\n      }\r\n      return tex;\r\n    }\r\n\r\n    // No texture exists create a new one\r\n    tex = gl.createTexture();\r\n    const source = TextureLoader.toPowerOfTwoImage(image);\r\n\r\n    TextureLoader.checkImageSizeSupportedAndLog(image);\r\n\r\n    gl.bindTexture(gl.TEXTURE_2D, tex);\r\n\r\n    gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, true);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n\r\n    // NEAREST for pixel art, LINEAR for hi-res\r\n    const filterMode = filtering ?? TextureLoader.filtering;\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, filterMode === ImageFiltering.Pixel ? gl.NEAREST : gl.LINEAR);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, filterMode === ImageFiltering.Pixel ? gl.NEAREST : gl.LINEAR);\r\n\r\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, source);\r\n\r\n    TextureLoader._TEXTURE_MAP.set(image, tex);\r\n    return tex;\r\n  }\r\n\r\n  /**\r\n   * Converts source images into power of two images, WebGL only supports POT images\r\n   * https://www.khronos.org/webgl/wiki/WebGL_and_OpenGL_Differences#Non-Power_of_Two_Texture_Support\r\n   * @param image\r\n   */\r\n  public static toPowerOfTwoImage(image: HTMLImageSource): HTMLImageSource {\r\n    const potCanvas = TextureLoader._POT_CANVAS;\r\n    const potCtx = TextureLoader._POT_CTX;\r\n    if (!isPowerOfTwo(image.width) || !isPowerOfTwo(image.height)) {\r\n      // Scale up the texture to the next highest power of two dimensions.\r\n\r\n      potCanvas.width = ensurePowerOfTwo(image.width);\r\n      potCanvas.height = ensurePowerOfTwo(image.height);\r\n      potCtx.imageSmoothingEnabled = false;\r\n      potCtx.clearRect(0, 0, potCanvas.width, potCanvas.height);\r\n      potCtx.drawImage(image, 0, 0, image.width, image.height);\r\n      image = potCanvas;\r\n    }\r\n    return image;\r\n  }\r\n\r\n  /**\r\n   * Takes an image and returns if it meets size criteria for hardware\r\n   * @param image\r\n   * @returns if the image will be supported at runtime\r\n   */\r\n  public static checkImageSizeSupportedAndLog(image: HTMLImageSource) {\r\n    const originalSrc = image.dataset.originalSrc ?? 'internal canvas bitmap';\r\n    if (image.width > TextureLoader._MAX_TEXTURE_SIZE || image.height > TextureLoader._MAX_TEXTURE_SIZE) {\r\n      TextureLoader._LOGGER.error(\r\n        `The image [${originalSrc}] provided to Excalibur is too large for the device's maximum texture size of `+\r\n        `(${TextureLoader._MAX_TEXTURE_SIZE}x${TextureLoader._MAX_TEXTURE_SIZE}) please resize to an image `\r\n        +`for excalibur to render properly.\\n\\nImages will likely render as black rectangles.\\n\\n`+\r\n        `Read more here: https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/WebGL_best_practices#understand_system_limits`);\r\n      return false;\r\n    } else if (image.width > 4096 || image.height > 4096) {\r\n      // https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/WebGL_best_practices#understand_system_limits\r\n      TextureLoader._LOGGER.warn(\r\n        `The image [${originalSrc}] provided to excalibur is too large may not work on all mobile devices, `+\r\n        `it is recommended you resize images to a maximum (4096x4096).\\n\\n` +\r\n        `Images will likely render as black rectangles on some mobile platforms.\\n\\n` +\r\n        `Read more here: https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/WebGL_best_practices#understand_system_limits`);\r\n    }\r\n    return true;\r\n  }\r\n}\r\n","import { Graphic, GraphicOptions } from './Graphic';\r\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\r\nimport { Color } from '../Color';\r\nimport { ensurePowerOfTwo } from './Context/webgl-util';\r\nimport { Vector } from '../Math/vector';\r\nimport { BoundingBox } from '../Collision/BoundingBox';\r\nimport { watch } from '../Util/Watch';\r\nimport { TextureLoader } from './Context/texture-loader';\r\nimport { ImageFiltering } from './Filtering';\r\n\r\n\r\nexport interface RasterOptions {\r\n  /**\r\n   * Optionally specify \"smoothing\" if you want antialiasing to apply to the raster's bitmap context, by default `false`\r\n   */\r\n  smoothing?: boolean;\r\n\r\n  /**\r\n   * Optionally specify the color of the raster's bitmap context, by default [[Color.Black]]\r\n   */\r\n  color?: Color;\r\n\r\n  /**\r\n   * Optionally specify the stroke color of the raster's bitmap context, by default undefined\r\n   */\r\n  strokeColor?: Color;\r\n\r\n  /**\r\n   * Optionally specify the line width of the raster's bitmap, by default 1 pixel\r\n   */\r\n  lineWidth?: number;\r\n\r\n  /**\r\n   * Optionally specify the line dash of the raster's bitmap, by default `[]` which means none\r\n   */\r\n  lineDash?: number[];\r\n\r\n  /**\r\n   * Optionally specify the padding to apply to the bitmap\r\n   */\r\n  padding?: number;\r\n\r\n  /**\r\n   * Optionally specify what image filtering mode should be used, [[ImageFiltering.Pixel]] for pixel art,\r\n   * [[ImageFiltering.Blended]] for hi-res art\r\n   *\r\n   * By default unset, rasters defer to the engine antialiasing setting\r\n   */\r\n  filtering?: ImageFiltering;\r\n}\r\n\r\n/**\r\n * A Raster is a Graphic that needs to be first painted to a HTMLCanvasElement before it can be drawn to the\r\n * [[ExcaliburGraphicsContext]]. This is useful for generating custom images using the 2D canvas api.\r\n *\r\n * Implementors must implement the [[Raster.execute]] method to rasterize their drawing.\r\n */\r\nexport abstract class Raster extends Graphic {\r\n  public filtering: ImageFiltering = null;\r\n  public _bitmap: HTMLCanvasElement;\r\n  protected _ctx: CanvasRenderingContext2D;\r\n  private _dirty: boolean = true;\r\n\r\n  constructor(options?: GraphicOptions & RasterOptions) {\r\n    super(options);\r\n    if (options) {\r\n      this.color = options.color ?? Color.Black;\r\n      this.strokeColor = options?.strokeColor;\r\n      this.smoothing = options.smoothing ?? this.smoothing;\r\n      this.lineWidth = options.lineWidth ?? this.lineWidth;\r\n      this.lineDash = options.lineDash ?? this.lineDash;\r\n      this.padding = options.padding ?? this.padding;\r\n      this.filtering = options.filtering ?? this.filtering;\r\n    }\r\n    this._bitmap = document.createElement('canvas');\r\n    // get the default canvas width/height as a fallback\r\n    const bitmapWidth = options?.width ?? this._bitmap.width;\r\n    const bitmapHeight = options?.height ?? this._bitmap.height;\r\n    // Rasters use power of two images as an optimization for webgl\r\n    this.width = ensurePowerOfTwo(bitmapWidth);\r\n    this.height = ensurePowerOfTwo(bitmapHeight);\r\n    const maybeCtx = this._bitmap.getContext('2d');\r\n    if (!maybeCtx) {\r\n      /* istanbul ignore next */\r\n      throw new Error('Browser does not support 2d canvas drawing, cannot create Raster graphic');\r\n    } else {\r\n      this._ctx = maybeCtx;\r\n    }\r\n  }\r\n\r\n  public cloneRasterOptions(): RasterOptions {\r\n    return {\r\n      color: this.color ? this.color.clone() : null,\r\n      strokeColor: this.strokeColor ? this.strokeColor.clone() : null,\r\n      smoothing: this.smoothing,\r\n      lineWidth: this.lineWidth,\r\n      lineDash: this.lineDash,\r\n      padding: this.padding\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Gets whether the graphic is dirty, this means there are changes that haven't been re-rasterized\r\n   */\r\n  public get dirty() {\r\n    return this._dirty;\r\n  }\r\n\r\n  /**\r\n   * Flags the graphic as dirty, meaning it must be re-rasterized before draw.\r\n   * This should be called any time the graphics state changes such that it affects the outputted drawing\r\n   */\r\n  public flagDirty() {\r\n    this._dirty = true;\r\n  }\r\n\r\n  private _originalWidth: number;\r\n  /**\r\n   * Gets or sets the current width of the Raster graphic. Setting the width will cause the raster\r\n   * to be flagged dirty causing a re-raster on the next draw.\r\n   *\r\n   * Any `padding`s set will be factored into the width\r\n   */\r\n  public get width() {\r\n    return Math.abs(this._getTotalWidth() * this.scale.x);\r\n  }\r\n  public set width(value: number) {\r\n    value /= Math.abs(this.scale.x);\r\n    this._bitmap.width = value;\r\n    this._originalWidth = value;\r\n    this.flagDirty();\r\n  }\r\n\r\n  private _originalHeight: number;\r\n  /**\r\n   * Gets or sets the current height of the Raster graphic. Setting the height will cause the raster\r\n   * to be flagged dirty causing a re-raster on the next draw.\r\n   *\r\n   * Any `padding` set will be factored into the height\r\n   */\r\n  public get height() {\r\n    return Math.abs(this._getTotalHeight() * this.scale.y);\r\n  }\r\n\r\n  public set height(value: number) {\r\n    value /= Math.abs(this.scale.y);\r\n    this._bitmap.height = value;\r\n    this._originalHeight = value;\r\n    this.flagDirty();\r\n  }\r\n\r\n  private _getTotalWidth() {\r\n    return (this._originalWidth ?? this._bitmap.width) + this.padding * 2;\r\n  }\r\n\r\n  private _getTotalHeight() {\r\n    return (this._originalHeight ?? this._bitmap.height) + this.padding * 2;\r\n  }\r\n\r\n  /**\r\n   * Returns the local bounds of the Raster including the padding\r\n   */\r\n  public get localBounds() {\r\n    return BoundingBox.fromDimension(this._getTotalWidth() * this.scale.x, this._getTotalHeight() * this.scale.y, Vector.Zero);\r\n  }\r\n\r\n  private _smoothing: boolean = false;\r\n  /**\r\n   * Gets or sets the smoothing (anti-aliasing of the graphic). Setting the height will cause the raster\r\n   * to be flagged dirty causing a re-raster on the next draw.\r\n   */\r\n  public get smoothing() {\r\n    return this._smoothing;\r\n  }\r\n  public set smoothing(value: boolean) {\r\n    this._smoothing = value;\r\n    this.flagDirty();\r\n  }\r\n\r\n  private _color: Color = watch(Color.Black, () => this.flagDirty());\r\n  /**\r\n   * Gets or sets the fillStyle of the Raster graphic. Setting the fillStyle will cause the raster to be\r\n   * flagged dirty causing a re-raster on the next draw.\r\n   */\r\n  public get color() {\r\n    return this._color;\r\n  }\r\n  public set color(value) {\r\n    this.flagDirty();\r\n    this._color = watch(value, () => this.flagDirty());\r\n  }\r\n\r\n  private _strokeColor: Color;\r\n  /**\r\n   * Gets or sets the strokeStyle of the Raster graphic. Setting the strokeStyle will cause the raster to be\r\n   * flagged dirty causing a re-raster on the next draw.\r\n   */\r\n  public get strokeColor() {\r\n    return this._strokeColor;\r\n  }\r\n  public set strokeColor(value) {\r\n    this.flagDirty();\r\n    this._strokeColor = watch(value, () => this.flagDirty());\r\n  }\r\n\r\n  private _lineWidth: number = 1;\r\n  /**\r\n   * Gets or sets the line width of the Raster graphic. Setting the lineWidth will cause the raster to be\r\n   * flagged dirty causing a re-raster on the next draw.\r\n   */\r\n  public get lineWidth() {\r\n    return this._lineWidth;\r\n  }\r\n  public set lineWidth(value) {\r\n    this._lineWidth = value;\r\n    this.flagDirty();\r\n  }\r\n\r\n  private _lineDash: number[] = [];\r\n  public get lineDash() {\r\n    return this._lineDash;\r\n  }\r\n\r\n  public set lineDash(value) {\r\n    this._lineDash = value;\r\n    this.flagDirty();\r\n  }\r\n\r\n  private _padding: number = 0;\r\n  public get padding() {\r\n    return this._padding;\r\n  }\r\n\r\n  public set padding(value: number) {\r\n    this._padding = value;\r\n    this.flagDirty();\r\n  }\r\n\r\n  /**\r\n   * Rasterize the graphic to a bitmap making it usable as in excalibur. Rasterize is called automatically if\r\n   * the graphic is [[Raster.dirty]] on the next [[Graphic.draw]] call\r\n   */\r\n  public rasterize(): void {\r\n    this._dirty = false;\r\n    this._ctx.clearRect(0, 0, this._getTotalWidth(), this._getTotalHeight());\r\n    this._ctx.save();\r\n    this._applyRasterProperties(this._ctx);\r\n    this.execute(this._ctx);\r\n    this._ctx.restore();\r\n    // The webgl texture needs to be updated if it exists after a raster cycle\r\n    TextureLoader.load(this._bitmap, this.filtering, true);\r\n  }\r\n\r\n  protected _applyRasterProperties(ctx: CanvasRenderingContext2D) {\r\n    this._bitmap.width = this._getTotalWidth();\r\n    this._bitmap.height = this._getTotalHeight();\r\n    ctx.translate(this.padding, this.padding);\r\n    ctx.imageSmoothingEnabled = this.smoothing;\r\n    ctx.lineWidth = this.lineWidth;\r\n    ctx.setLineDash(this.lineDash ?? ctx.getLineDash());\r\n    ctx.strokeStyle = this.strokeColor?.toString();\r\n    ctx.fillStyle = this.color?.toString();\r\n  }\r\n\r\n  protected _drawImage(ex: ExcaliburGraphicsContext, x: number, y: number) {\r\n    if (this._dirty) {\r\n      this.rasterize();\r\n    }\r\n\r\n    ex.drawImage(this._bitmap, x, y);\r\n  }\r\n\r\n  /**\r\n   * Executes drawing implementation of the graphic, this is where the specific drawing code for the graphic\r\n   * should be implemented. Once `rasterize()` the graphic can be drawn to the [[ExcaliburGraphicsContext]] via `draw(...)`\r\n   * @param ctx Canvas to draw the graphic to\r\n   */\r\n  abstract execute(ctx: CanvasRenderingContext2D): void;\r\n}\r\n","import { GraphicOptions } from './Graphic';\r\nimport { Raster, RasterOptions } from './Raster';\r\n\r\nexport interface CanvasOptions {\r\n  draw?: (ctx: CanvasRenderingContext2D) => void;\r\n  cache?: boolean;\r\n}\r\n\r\n/**\r\n * A canvas [[Graphic]] to provide an adapter between the 2D Canvas API and the [[ExcaliburGraphicsContext]].\r\n *\r\n * The [[Canvas]] works by re-rastering a draw handler to a HTMLCanvasElement for every draw which is then passed\r\n * to the [[ExcaliburGraphicsContext]] implementation as a rendered image.\r\n *\r\n * **Low performance API**\r\n */\r\nexport class Canvas extends Raster {\r\n  /**\r\n   * Return the 2D graphics context of this canvas\r\n   */\r\n  public get ctx() {\r\n    return this._ctx;\r\n  }\r\n\r\n  constructor(private _options: GraphicOptions & RasterOptions & CanvasOptions) {\r\n    super(_options);\r\n  }\r\n\r\n  public clone(): Canvas {\r\n    return new Canvas({\r\n      ...this._options,\r\n      ...this.cloneGraphicOptions(),\r\n      ...this.cloneRasterOptions()\r\n    });\r\n  }\r\n\r\n  execute(ctx: CanvasRenderingContext2D): void {\r\n    if (this._options?.draw) {\r\n      this._options?.draw(ctx);\r\n    }\r\n    if (!this._options.cache) {\r\n      this.flagDirty();\r\n    }\r\n  }\r\n}\r\n","import { Scene } from './Scene';\r\nimport { Vector } from './Math/vector';\r\nimport { Actor } from './Actor';\r\nimport { Trigger } from './Trigger';\r\nimport { FrameStats } from './Debug';\r\nimport { Engine } from './Engine';\r\nimport { TileMap } from './TileMap';\r\nimport { Side } from './Collision/Side';\r\nimport * as Input from './Input/Index';\r\nimport { CollisionContact } from './Collision/Detection/CollisionContact';\r\nimport { Collider } from './Collision/Colliders/Collider';\r\nimport { Entity } from './EntityComponentSystem/Entity';\r\nimport { OnInitialize, OnPreUpdate, OnPostUpdate } from './Interfaces/LifecycleEvents';\r\nimport { BodyComponent } from './Collision/BodyComponent';\r\n\r\nexport enum EventTypes {\r\n  Kill = 'kill',\r\n  PreKill = 'prekill',\r\n  PostKill = 'postkill',\r\n\r\n  PreDraw = 'predraw',\r\n  PostDraw = 'postdraw',\r\n\r\n  PreDebugDraw = 'predebugdraw',\r\n  PostDebugDraw = 'postdebugdraw',\r\n\r\n  PreUpdate = 'preupdate',\r\n  PostUpdate = 'postupdate',\r\n\r\n  PreFrame = 'preframe',\r\n  PostFrame = 'postframe',\r\n\r\n  PreCollision = 'precollision',\r\n  CollisionStart = 'collisionstart',\r\n  CollisionEnd = 'collisionend',\r\n  PostCollision = 'postcollision',\r\n\r\n  Initialize = 'initialize',\r\n  Activate = 'activate',\r\n  Deactivate = 'deactivate',\r\n\r\n  ExitViewport = 'exitviewport',\r\n  EnterViewport = 'enterviewport',\r\n\r\n  ExitTrigger = 'exit',\r\n  EnterTrigger = 'enter',\r\n\r\n  Connect = 'connect',\r\n  Disconnect = 'disconnect',\r\n  Button = 'button',\r\n  Axis = 'axis',\r\n\r\n  Subscribe = 'subscribe',\r\n  Unsubscribe = 'unsubscribe',\r\n\r\n  Visible = 'visible',\r\n  Hidden = 'hidden',\r\n  Start = 'start',\r\n  Stop = 'stop',\r\n\r\n  PointerUp = 'pointerup',\r\n  PointerDown = 'pointerdown',\r\n  PointerMove = 'pointermove',\r\n  PointerEnter = 'pointerenter',\r\n  PointerLeave = 'pointerleave',\r\n  PointerCancel = 'pointercancel',\r\n  PointerWheel = 'pointerwheel',\r\n\r\n  Up = 'up',\r\n  Down = 'down',\r\n  Move = 'move',\r\n  Enter = 'enter',\r\n  Leave = 'leave',\r\n  Cancel = 'cancel',\r\n  Wheel = 'wheel',\r\n\r\n  Press = 'press',\r\n  Release = 'release',\r\n  Hold = 'hold',\r\n\r\n  PointerDragStart = 'pointerdragstart',\r\n  PointerDragEnd = 'pointerdragend',\r\n  PointerDragEnter = 'pointerdragenter',\r\n  PointerDragLeave = 'pointerdragleave',\r\n  PointerDragMove = 'pointerdragmove'\r\n}\r\n\r\n/* istanbul ignore next */\r\n/* compiler only: these are internal to lib */\r\nexport type kill = 'kill';\r\nexport type prekill = 'prekill';\r\nexport type postkill = 'postkill';\r\n\r\nexport type predraw = 'predraw';\r\nexport type postdraw = 'postdraw';\r\n\r\nexport type predebugdraw = 'predebugdraw';\r\nexport type postdebugdraw = 'postdebugdraw';\r\n\r\nexport type preupdate = 'preupdate';\r\nexport type postupdate = 'postupdate';\r\n\r\nexport type preframe = 'preframe';\r\nexport type postframe = 'postframe';\r\n\r\nexport type precollision = 'precollision';\r\nexport type collisionstart = 'collisionstart';\r\nexport type collisionend = 'collisionend';\r\nexport type postcollision = 'postcollision';\r\n\r\nexport type initialize = 'initialize';\r\nexport type activate = 'activate';\r\nexport type deactivate = 'deactivate';\r\n\r\nexport type exitviewport = 'exitviewport';\r\nexport type enterviewport = 'enterviewport';\r\n\r\nexport type exittrigger = 'exit';\r\nexport type entertrigger = 'enter';\r\n\r\nexport type connect = 'connect';\r\nexport type disconnect = 'disconnect';\r\nexport type button = 'button';\r\nexport type axis = 'axis';\r\n\r\nexport type subscribe = 'subscribe';\r\nexport type unsubscribe = 'unsubscribe';\r\n\r\nexport type visible = 'visible';\r\nexport type hidden = 'hidden';\r\nexport type start = 'start';\r\nexport type stop = 'stop';\r\n\r\nexport type pointerup = 'pointerup';\r\nexport type pointerdown = 'pointerdown';\r\nexport type pointermove = 'pointermove';\r\nexport type pointerenter = 'pointerenter';\r\nexport type pointerleave = 'pointerleave';\r\nexport type pointercancel = 'pointercancel';\r\nexport type pointerwheel = 'pointerwheel';\r\n\r\nexport type up = 'up';\r\nexport type down = 'down';\r\nexport type move = 'move';\r\nexport type enter = 'enter';\r\nexport type leave = 'leave';\r\nexport type cancel = 'cancel';\r\nexport type wheel = 'wheel';\r\n\r\nexport type press = 'press';\r\nexport type release = 'release';\r\nexport type hold = 'hold';\r\n\r\nexport type pointerdragstart = 'pointerdragstart';\r\nexport type pointerdragend = 'pointerdragend';\r\nexport type pointerdragenter = 'pointerdragenter';\r\nexport type pointerdragleave = 'pointerdragleave';\r\nexport type pointerdragmove = 'pointerdragmove';\r\n\r\n/**\r\n * Base event type in Excalibur that all other event types derive from. Not all event types are thrown on all Excalibur game objects,\r\n * some events are unique to a type, others are not.\r\n *\r\n */\r\nexport class GameEvent<T, U = T> {\r\n  /**\r\n   * Target object for this event.\r\n   */\r\n  public target: T;\r\n\r\n  /**\r\n   * Other target object for this event\r\n   */\r\n  public other: U | null;\r\n\r\n  /**\r\n   * If set to false, prevents event from propagating to other actors. If true it will be propagated\r\n   * to all actors that apply.\r\n   */\r\n  public get bubbles(): boolean {\r\n    return this._bubbles;\r\n  }\r\n\r\n  public set bubbles(value: boolean) {\r\n    this._bubbles = value;\r\n  }\r\n\r\n  private _bubbles: boolean = true;\r\n  /**\r\n   * Prevents event from bubbling\r\n   */\r\n  public stopPropagation() {\r\n    this.bubbles = false;\r\n  }\r\n}\r\n\r\n/**\r\n * The 'kill' event is emitted on actors when it is killed. The target is the actor that was killed.\r\n */\r\nexport class KillEvent extends GameEvent<Actor> {\r\n  constructor(public target: Actor) {\r\n    super();\r\n  }\r\n}\r\n\r\n/**\r\n * The 'prekill' event is emitted directly before an actor is killed.\r\n */\r\nexport class PreKillEvent extends GameEvent<Actor> {\r\n  constructor(public target: Actor) {\r\n    super();\r\n  }\r\n}\r\n\r\n/**\r\n * The 'postkill' event is emitted directly after the actor is killed.\r\n */\r\nexport class PostKillEvent extends GameEvent<Actor> {\r\n  constructor(public target: Actor) {\r\n    super();\r\n  }\r\n}\r\n\r\n/**\r\n * The 'start' event is emitted on engine when has started and is ready for interaction.\r\n */\r\nexport class GameStartEvent extends GameEvent<Engine> {\r\n  constructor(public target: Engine) {\r\n    super();\r\n  }\r\n}\r\n\r\n/**\r\n * The 'stop' event is emitted on engine when has been stopped and will no longer take input, update or draw.\r\n */\r\nexport class GameStopEvent extends GameEvent<Engine> {\r\n  constructor(public target: Engine) {\r\n    super();\r\n  }\r\n}\r\n\r\n/**\r\n * The 'predraw' event is emitted on actors, scenes, and engine before drawing starts. Actors' predraw happens inside their graphics\r\n * transform so that all drawing takes place with the actor as the origin.\r\n *\r\n */\r\nexport class PreDrawEvent extends GameEvent<Entity | Scene | Engine | TileMap> {\r\n  constructor(public ctx: CanvasRenderingContext2D, public delta: number, public target: Entity | Scene | Engine | TileMap) {\r\n    super();\r\n  }\r\n}\r\n\r\n/**\r\n * The 'postdraw' event is emitted on actors, scenes, and engine after drawing finishes. Actors' postdraw happens inside their graphics\r\n * transform so that all drawing takes place with the actor as the origin.\r\n *\r\n */\r\nexport class PostDrawEvent extends GameEvent<Entity | Scene | Engine | TileMap> {\r\n  constructor(public ctx: CanvasRenderingContext2D, public delta: number, public target: Entity | Scene | Engine | TileMap) {\r\n    super();\r\n  }\r\n}\r\n\r\n/**\r\n * The 'predebugdraw' event is emitted on actors, scenes, and engine before debug drawing starts.\r\n */\r\nexport class PreDebugDrawEvent extends GameEvent<Entity | Actor | Scene | Engine> {\r\n  constructor(public ctx: CanvasRenderingContext2D, public target: Entity | Actor | Scene | Engine) {\r\n    super();\r\n  }\r\n}\r\n\r\n/**\r\n * The 'postdebugdraw' event is emitted on actors, scenes, and engine after debug drawing starts.\r\n */\r\nexport class PostDebugDrawEvent extends GameEvent<Entity | Actor | Scene | Engine> {\r\n  constructor(public ctx: CanvasRenderingContext2D, public target: Entity | Actor | Scene | Engine) {\r\n    super();\r\n  }\r\n}\r\n\r\n/**\r\n * The 'preupdate' event is emitted on actors, scenes, camera, and engine before the update starts.\r\n */\r\nexport class PreUpdateEvent<T extends OnPreUpdate = Entity> extends GameEvent<T> {\r\n  constructor(public engine: Engine, public delta: number, public target: T) {\r\n    super();\r\n  }\r\n}\r\n\r\n/**\r\n * The 'postupdate' event is emitted on actors, scenes, camera, and engine after the update ends.\r\n */\r\nexport class PostUpdateEvent<T extends OnPostUpdate = Entity> extends GameEvent<T> {\r\n  constructor(public engine: Engine, public delta: number, public target: T) {\r\n    super();\r\n  }\r\n}\r\n\r\n/**\r\n * The 'preframe' event is emitted on the engine, before the frame begins.\r\n */\r\nexport class PreFrameEvent extends GameEvent<Engine> {\r\n  constructor(public engine: Engine, public prevStats: FrameStats) {\r\n    super();\r\n    this.target = engine;\r\n  }\r\n}\r\n\r\n/**\r\n * The 'postframe' event is emitted on the engine, after a frame ends.\r\n */\r\nexport class PostFrameEvent extends GameEvent<Engine> {\r\n  constructor(public engine: Engine, public stats: FrameStats) {\r\n    super();\r\n    this.target = engine;\r\n  }\r\n}\r\n\r\n/**\r\n * Event received when a gamepad is connected to Excalibur. [[Gamepads]] receives this event.\r\n */\r\nexport class GamepadConnectEvent extends GameEvent<Input.Gamepad> {\r\n  constructor(public index: number, public gamepad: Input.Gamepad) {\r\n    super();\r\n    this.target = gamepad;\r\n  }\r\n}\r\n\r\n/**\r\n * Event received when a gamepad is disconnected from Excalibur. [[Gamepads]] receives this event.\r\n */\r\nexport class GamepadDisconnectEvent extends GameEvent<Input.Gamepad> {\r\n  constructor(public index: number, public gamepad: Input.Gamepad) {\r\n    super();\r\n    this.target = gamepad;\r\n  }\r\n}\r\n\r\n/**\r\n * Gamepad button event. See [[Gamepads]] for information on responding to controller input. [[Gamepad]] instances receive this event;\r\n */\r\nexport class GamepadButtonEvent extends GameEvent<Input.Gamepad> {\r\n  /**\r\n   * @param button  The Gamepad button\r\n   * @param value   A numeric value between 0 and 1\r\n   */\r\n  constructor(public button: Input.Buttons, public value: number, public target: Input.Gamepad) {\r\n    super();\r\n  }\r\n}\r\n\r\n/**\r\n * Gamepad axis event. See [[Gamepads]] for information on responding to controller input. [[Gamepad]] instances receive this event;\r\n */\r\nexport class GamepadAxisEvent extends GameEvent<Input.Gamepad> {\r\n  /**\r\n   * @param axis  The Gamepad axis\r\n   * @param value A numeric value between -1 and 1\r\n   */\r\n  constructor(public axis: Input.Axes, public value: number, public target: Input.Gamepad) {\r\n    super();\r\n  }\r\n}\r\n\r\n/**\r\n * Subscribe event thrown when handlers for events other than subscribe are added. Meta event that is received by\r\n * [[EventDispatcher|event dispatchers]].\r\n */\r\nexport class SubscribeEvent<T> extends GameEvent<T> {\r\n  constructor(public topic: string, public handler: (event: GameEvent<T>) => void) {\r\n    super();\r\n  }\r\n}\r\n\r\n/**\r\n * Unsubscribe event thrown when handlers for events other than unsubscribe are removed. Meta event that is received by\r\n * [[EventDispatcher|event dispatchers]].\r\n */\r\nexport class UnsubscribeEvent<T> extends GameEvent<T> {\r\n  constructor(public topic: string, public handler: (event: GameEvent<T>) => void) {\r\n    super();\r\n  }\r\n}\r\n\r\n/**\r\n * Event received by the [[Engine]] when the browser window is visible on a screen.\r\n */\r\nexport class VisibleEvent extends GameEvent<Engine> {\r\n  constructor(public target: Engine) {\r\n    super();\r\n  }\r\n}\r\n\r\n/**\r\n * Event received by the [[Engine]] when the browser window is hidden from all screens.\r\n */\r\nexport class HiddenEvent extends GameEvent<Engine> {\r\n  constructor(public target: Engine) {\r\n    super();\r\n  }\r\n}\r\n\r\n/**\r\n * Event thrown on an [[Actor|actor]] when a collision will occur this frame if it resolves\r\n */\r\nexport class PreCollisionEvent<T extends BodyComponent | Collider | Entity = Actor> extends GameEvent<T> {\r\n  /**\r\n   * @param actor         The actor the event was thrown on\r\n   * @param other         The actor that will collided with the current actor\r\n   * @param side          The side that will be collided with the current actor\r\n   * @param intersection  Intersection vector\r\n   */\r\n  constructor(actor: T, public other: T, public side: Side, public intersection: Vector) {\r\n    super();\r\n    this.target = actor;\r\n  }\r\n}\r\n\r\n/**\r\n * Event thrown on an [[Actor|actor]] when a collision has been resolved (body reacted) this frame\r\n */\r\nexport class PostCollisionEvent<T extends Collider | Entity = Actor> extends GameEvent<T> {\r\n  /**\r\n   * @param actor         The actor the event was thrown on\r\n   * @param other         The actor that did collide with the current actor\r\n   * @param side          The side that did collide with the current actor\r\n   * @param intersection  Intersection vector\r\n   */\r\n  constructor(actor: T, public other: T, public side: Side, public intersection: Vector) {\r\n    super();\r\n    this.target = actor;\r\n  }\r\n\r\n  public get actor() {\r\n    return this.target;\r\n  }\r\n\r\n  public set actor(actor: T) {\r\n    this.target = actor;\r\n  }\r\n}\r\n\r\nexport class ContactStartEvent<T> {\r\n  constructor(public target: T, public other: T, public contact: CollisionContact) {}\r\n}\r\n\r\nexport class ContactEndEvent<T> {\r\n  constructor(public target: T, public other: T) {}\r\n}\r\n\r\nexport class CollisionPreSolveEvent<T> {\r\n  constructor(public target: T, public other: T, public side: Side, public intersection: Vector, public contact: CollisionContact) {}\r\n}\r\n\r\nexport class CollisionPostSolveEvent<T> {\r\n  constructor(public target: T, public other: T, public side: Side, public intersection: Vector, public contact: CollisionContact) {}\r\n}\r\n\r\n/**\r\n * Event thrown the first time an [[Actor|actor]] collides with another, after an actor is in contact normal collision events are fired.\r\n */\r\nexport class CollisionStartEvent<T extends BodyComponent | Collider | Entity = Actor> extends GameEvent<T> {\r\n  /**\r\n   *\r\n   * @param actor\r\n   * @param other\r\n   * @param contact\r\n   */\r\n  constructor(actor: T, public other: T, public contact: CollisionContact) {\r\n    super();\r\n    this.target = actor;\r\n  }\r\n\r\n  public get actor() {\r\n    return this.target;\r\n  }\r\n\r\n  public set actor(actor: T) {\r\n    this.target = actor;\r\n  }\r\n}\r\n\r\n/**\r\n * Event thrown when the [[Actor|actor]] is no longer colliding with another\r\n */\r\nexport class CollisionEndEvent<T extends BodyComponent | Collider | Entity = Actor> extends GameEvent<T> {\r\n  /**\r\n   *\r\n   */\r\n  constructor(actor: T, public other: T) {\r\n    super();\r\n    this.target = actor;\r\n  }\r\n\r\n  public get actor() {\r\n    return this.target;\r\n  }\r\n\r\n  public set actor(actor: T) {\r\n    this.target = actor;\r\n  }\r\n}\r\n\r\n/**\r\n * Event thrown on an [[Actor]] and a [[Scene]] only once before the first update call\r\n */\r\nexport class InitializeEvent<T extends OnInitialize = Entity> extends GameEvent<T> {\r\n  /**\r\n   * @param engine  The reference to the current engine\r\n   */\r\n  constructor(public engine: Engine, public target: T) {\r\n    super();\r\n  }\r\n}\r\n\r\n/**\r\n * Event thrown on a [[Scene]] on activation\r\n */\r\nexport class ActivateEvent extends GameEvent<Scene> {\r\n  /**\r\n   * @param oldScene  The reference to the old scene\r\n   */\r\n  constructor(public oldScene: Scene, public target: Scene) {\r\n    super();\r\n  }\r\n}\r\n\r\n/**\r\n * Event thrown on a [[Scene]] on deactivation\r\n */\r\nexport class DeactivateEvent extends GameEvent<Scene> {\r\n  /**\r\n   * @param newScene  The reference to the new scene\r\n   */\r\n  constructor(public newScene: Scene, public target: Scene) {\r\n    super();\r\n  }\r\n}\r\n\r\n/**\r\n * Event thrown on an [[Actor]] when it completely leaves the screen.\r\n */\r\nexport class ExitViewPortEvent extends GameEvent<Entity> {\r\n  constructor(public target: Entity) {\r\n    super();\r\n  }\r\n}\r\n\r\n/**\r\n * Event thrown on an [[Actor]] when it completely leaves the screen.\r\n */\r\nexport class EnterViewPortEvent extends GameEvent<Entity> {\r\n  constructor(public target: Entity) {\r\n    super();\r\n  }\r\n}\r\n\r\nexport class EnterTriggerEvent extends GameEvent<Actor> {\r\n  constructor(public target: Trigger, public actor: Actor) {\r\n    super();\r\n  }\r\n}\r\n\r\nexport class ExitTriggerEvent extends GameEvent<Actor> {\r\n  constructor(public target: Trigger, public actor: Actor) {\r\n    super();\r\n  }\r\n}\r\n","import { GameEvent, SubscribeEvent, UnsubscribeEvent } from './Events';\r\nimport { Eventable } from './Interfaces/Evented';\r\n\r\nexport class EventDispatcher<T = any> implements Eventable {\r\n  private _handlers: { [key: string]: { (event: GameEvent<T>): void }[] } = {};\r\n  private _wiredEventDispatchers: Eventable[] = [];\r\n\r\n  /**\r\n   * Clears any existing handlers or wired event dispatchers on this event dispatcher\r\n   */\r\n  public clear() {\r\n    this._handlers = {};\r\n    this._wiredEventDispatchers = [];\r\n  }\r\n\r\n  /**\r\n   * Emits an event for target\r\n   * @param eventName  The name of the event to publish\r\n   * @param event      Optionally pass an event data object to the handler\r\n   */\r\n  public emit(eventName: string, event: GameEvent<T>) {\r\n    if (!eventName) {\r\n      // key not mapped\r\n      return;\r\n    }\r\n    eventName = eventName.toLowerCase();\r\n    if (!event) {\r\n      event = new GameEvent();\r\n    }\r\n    let i: number, len: number;\r\n\r\n    if (this._handlers[eventName]) {\r\n      i = 0;\r\n      len = this._handlers[eventName].length;\r\n\r\n      for (i; i < len; i++) {\r\n        this._handlers[eventName][i](event);\r\n      }\r\n    }\r\n\r\n    i = 0;\r\n    len = this._wiredEventDispatchers.length;\r\n\r\n    for (i; i < len; i++) {\r\n      this._wiredEventDispatchers[i].emit(eventName, event);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Subscribe an event handler to a particular event name, multiple handlers per event name are allowed.\r\n   * @param eventName  The name of the event to subscribe to\r\n   * @param handler    The handler callback to fire on this event\r\n   */\r\n  public on(eventName: string, handler: (event: GameEvent<T>) => void) {\r\n    eventName = eventName.toLowerCase();\r\n    if (!this._handlers[eventName]) {\r\n      this._handlers[eventName] = [];\r\n    }\r\n    this._handlers[eventName].push(handler);\r\n\r\n    // meta event handlers\r\n    if (eventName !== 'unsubscribe' && eventName !== 'subscribe') {\r\n      this.emit('subscribe', new SubscribeEvent(eventName, handler));\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Unsubscribe an event handler(s) from an event. If a specific handler\r\n   * is specified for an event, only that handler will be unsubscribed.\r\n   * Otherwise all handlers will be unsubscribed for that event.\r\n   *\r\n   * @param eventName  The name of the event to unsubscribe\r\n   * @param handler    Optionally the specific handler to unsubscribe\r\n   */\r\n  public off(eventName: string, handler?: (event: GameEvent<T>) => void) {\r\n    eventName = eventName.toLowerCase();\r\n    const eventHandlers = this._handlers[eventName];\r\n\r\n    if (eventHandlers) {\r\n      // if no explicit handler is give with the event name clear all handlers\r\n      if (!handler) {\r\n        this._handlers[eventName].length = 0;\r\n      } else {\r\n        const index = eventHandlers.indexOf(handler);\r\n        this._handlers[eventName].splice(index, 1);\r\n      }\r\n    }\r\n    // meta event handlers\r\n    if (eventName !== 'unsubscribe' && eventName !== 'subscribe') {\r\n      this.emit('unsubscribe', new UnsubscribeEvent(eventName, handler));\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Once listens to an event one time, then unsubscribes from that event\r\n   *\r\n   * @param eventName The name of the event to subscribe to once\r\n   * @param handler   The handler of the event that will be auto unsubscribed\r\n   */\r\n  public once(eventName: string, handler: (event: GameEvent<T>) => void) {\r\n    const metaHandler = (event: GameEvent<T>) => {\r\n      const ev = event || new GameEvent();\r\n      this.off(eventName, handler);\r\n      handler(ev);\r\n    };\r\n\r\n    this.on(eventName, metaHandler);\r\n  }\r\n\r\n  /**\r\n   * Wires this event dispatcher to also receive events from another\r\n   */\r\n  public wire(eventDispatcher: EventDispatcher): void {\r\n    eventDispatcher._wiredEventDispatchers.push(this);\r\n  }\r\n\r\n  /**\r\n   * Unwires this event dispatcher from another\r\n   */\r\n  public unwire(eventDispatcher: EventDispatcher): void {\r\n    const index = eventDispatcher._wiredEventDispatchers.indexOf(this);\r\n    if (index > -1) {\r\n      eventDispatcher._wiredEventDispatchers.splice(index, 1);\r\n    }\r\n  }\r\n}\r\n","import { Loadable } from '../Interfaces/Loadable';\r\nimport { Logger } from '../Util/Log';\r\nimport { EventDispatcher } from '../EventDispatcher';\r\n\r\n/**\r\n * The [[Resource]] type allows games built in Excalibur to load generic resources.\r\n * For any type of remote resource it is recommended to use [[Resource]] for preloading.\r\n */\r\nexport class Resource<T> implements Loadable<T> {\r\n  public data: T = null;\r\n  public logger: Logger = Logger.getInstance();\r\n  public events: EventDispatcher = new EventDispatcher();\r\n\r\n  /**\r\n   * @param path          Path to the remote resource\r\n   * @param responseType  The type to expect as a response: \"\" | \"arraybuffer\" | \"blob\" | \"document\" | \"json\" | \"text\";\r\n   * @param bustCache     Whether or not to cache-bust requests\r\n   */\r\n  constructor(\r\n    public path: string,\r\n    public responseType: '' | 'arraybuffer' | 'blob' | 'document' | 'json' | 'text',\r\n    public bustCache: boolean = true\r\n  ) {}\r\n\r\n  /**\r\n   * Returns true if the Resource is completely loaded and is ready\r\n   * to be drawn.\r\n   */\r\n  public isLoaded(): boolean {\r\n    return this.data !== null;\r\n  }\r\n\r\n\r\n  private _cacheBust(uri: string): string {\r\n    const query: RegExp = /\\?\\w*=\\w*/;\r\n    if (query.test(uri)) {\r\n      uri += '&__=' + Date.now();\r\n    } else {\r\n      uri += '?__=' + Date.now();\r\n    }\r\n    return uri;\r\n  }\r\n  /**\r\n   * Begin loading the resource and returns a promise to be resolved on completion\r\n   */\r\n  public load(): Promise<T> {\r\n    return new Promise((resolve, reject) => {\r\n      // Exit early if we already have data\r\n      if (this.data !== null) {\r\n        this.logger.debug('Already have data for resource', this.path);\r\n        this.events.emit('complete', this.data as any);\r\n        resolve(this.data);\r\n        return;\r\n      }\r\n\r\n      const request = new XMLHttpRequest();\r\n      request.open('GET', this.bustCache ? this._cacheBust(this.path) : this.path, true);\r\n      request.responseType = this.responseType;\r\n      request.addEventListener('loadstart', (e) => this.events.emit('loadstart', e as any));\r\n      request.addEventListener('progress', (e) => this.events.emit('progress', e as any));\r\n      request.addEventListener('error', (e) => this.events.emit('error', e as any));\r\n      request.addEventListener('load', (e) => this.events.emit('load', e as any));\r\n      request.addEventListener('load', () => {\r\n        // XHR on file:// success status is 0, such as with PhantomJS\r\n        if (request.status !== 0 && request.status !== 200) {\r\n          this.logger.error('Failed to load resource ', this.path, ' server responded with error code', request.status);\r\n          this.events.emit('error', request.response);\r\n          reject(new Error(request.statusText));\r\n          return;\r\n        }\r\n\r\n        this.data = request.response;\r\n        this.events.emit('complete', this.data as any);\r\n        this.logger.debug('Completed loading resource', this.path);\r\n        resolve(this.data);\r\n      });\r\n      request.send();\r\n    });\r\n  }\r\n}\r\n","/**\r\n * @module\r\n * @deprecated\r\n * These effects can be applied to any bitmap image but are mainly used\r\n * for [[Sprite]] effects or [[Animation]] effects.\r\n */\r\n\r\n/**\r\n * @typedoc\r\n */\r\n\r\nimport { obsolete } from '../Util/Decorators';\r\nimport { Color } from '../Color';\r\n\r\n/**\r\n * The interface that all sprite effects must implement\r\n * @deprecated SpriteEffect will be removed in v0.26.0\r\n */\r\nexport interface SpriteEffect {\r\n  /**\r\n   * Should update individual pixels values\r\n   * @param x          The pixel's x coordinate\r\n   * @param y          The pixel's y coordinate\r\n   * @param imageData  The sprite's raw pixel data\r\n   */\r\n  updatePixel(x: number, y: number, imageData: ImageData): void;\r\n}\r\n\r\n/**\r\n * Applies the \"Grayscale\" effect to a sprite, removing color information.\r\n * @deprecated [[Grayscale]] will be removed in v0.26.0\r\n */\r\n@obsolete({\r\n  message: 'Grayscale will be removed in v0.26.0'\r\n})\r\nexport class Grayscale implements SpriteEffect {\r\n  updatePixel(x: number, y: number, imageData: ImageData): void {\r\n    const firstPixel = (x + y * imageData.width) * 4;\r\n    const pixel = imageData.data;\r\n    const avg = (pixel[firstPixel + 0] + pixel[firstPixel + 1] + pixel[firstPixel + 2]) / 3;\r\n    pixel[firstPixel + 0] = avg;\r\n    pixel[firstPixel + 1] = avg;\r\n    pixel[firstPixel + 2] = avg;\r\n  }\r\n}\r\n\r\n/**\r\n * Applies the \"Invert\" effect to a sprite, inverting the pixel colors.\r\n * @deprecated [[Invert]] will be removed in v0.26.0\r\n */\r\n@obsolete({\r\n  message: 'Invert will be removed in v0.26.0'\r\n})\r\nexport class Invert implements SpriteEffect {\r\n  updatePixel(x: number, y: number, imageData: ImageData): void {\r\n    const firstPixel = (x + y * imageData.width) * 4;\r\n    const pixel = imageData.data;\r\n    pixel[firstPixel + 0] = 255 - pixel[firstPixel + 0];\r\n    pixel[firstPixel + 1] = 255 - pixel[firstPixel + 1];\r\n    pixel[firstPixel + 2] = 255 - pixel[firstPixel + 2];\r\n  }\r\n}\r\n\r\n/**\r\n * Applies the \"Opacity\" effect to a sprite, setting the alpha of all pixels to a given value.\r\n * @deprecated [[Opacity]] will be removed in v0.26.0\r\n */\r\n@obsolete({\r\n  message: 'Opacity will be removed in v0.26.0'\r\n})\r\nexport class Opacity implements SpriteEffect {\r\n  /**\r\n   * @param opacity  The new opacity of the sprite from 0-1.0\r\n   */\r\n  constructor(public opacity: number) {}\r\n  updatePixel(x: number, y: number, imageData: ImageData): void {\r\n    const firstPixel = (x + y * imageData.width) * 4;\r\n    const pixel = imageData.data;\r\n    if (pixel[firstPixel + 3] !== 0) {\r\n      pixel[firstPixel + 3] = Math.round(this.opacity * pixel[firstPixel + 3]);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Applies the \"Colorize\" effect to a sprite, changing the color channels of all the pixels to an\r\n * average of the original color and the provided color\r\n * @deprecated [[Colorize]] will be removed in v0.26.0\r\n */\r\n@obsolete({\r\n  message: 'Colorize will be removed in v0.26.0'\r\n})\r\nexport class Colorize implements SpriteEffect {\r\n  /**\r\n   * @param color  The color to apply to the sprite\r\n   */\r\n  constructor(public color: Color) {}\r\n  updatePixel(x: number, y: number, imageData: ImageData): void {\r\n    const firstPixel = (x + y * imageData.width) * 4;\r\n    const pixel = imageData.data;\r\n    if (pixel[firstPixel + 3] !== 0) {\r\n      pixel[firstPixel + 0] = (pixel[firstPixel + 0] + this.color.r) / 2;\r\n      pixel[firstPixel + 1] = (pixel[firstPixel + 1] + this.color.g) / 2;\r\n      pixel[firstPixel + 2] = (pixel[firstPixel + 2] + this.color.b) / 2;\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Applies the \"Lighten\" effect to a sprite, changes the lightness of the color according to HSL\r\n * @deprecated [[Lighten]] will be removed in v0.26.0\r\n */\r\n@obsolete({\r\n  message: 'Lighten will be removed in v0.26.0'\r\n})\r\nexport class Lighten implements SpriteEffect {\r\n  /**\r\n   * @param factor  The factor of the effect between 0-1\r\n   */\r\n  constructor(public factor: number = 0.1) {}\r\n  updatePixel(x: number, y: number, imageData: ImageData): void {\r\n    const firstPixel = (x + y * imageData.width) * 4;\r\n    const pixel = imageData.data;\r\n    const color = Color.fromRGB(pixel[firstPixel + 0], pixel[firstPixel + 1], pixel[firstPixel + 2], pixel[firstPixel + 3]).lighten(\r\n      this.factor\r\n    );\r\n    pixel[firstPixel + 0] = color.r;\r\n    pixel[firstPixel + 1] = color.g;\r\n    pixel[firstPixel + 2] = color.b;\r\n    pixel[firstPixel + 3] = color.a;\r\n  }\r\n}\r\n\r\n/**\r\n * Applies the \"Darken\" effect to a sprite, changes the darkness of the color according to HSL\r\n * @deprecated [[Darken]] will be removed in v0.26.0\r\n */\r\n@obsolete({\r\n  message: 'Darken will be removed v0.26.0'\r\n})\r\nexport class Darken implements SpriteEffect {\r\n  /**\r\n   * @param factor  The factor of the effect between 0-1\r\n   */\r\n  constructor(public factor: number = 0.1) {}\r\n  updatePixel(x: number, y: number, imageData: ImageData): void {\r\n    const firstPixel = (x + y * imageData.width) * 4;\r\n    const pixel = imageData.data;\r\n    const color = Color.fromRGB(pixel[firstPixel + 0], pixel[firstPixel + 1], pixel[firstPixel + 2], pixel[firstPixel + 3]).darken(\r\n      this.factor\r\n    );\r\n    pixel[firstPixel + 0] = color.r;\r\n    pixel[firstPixel + 1] = color.g;\r\n    pixel[firstPixel + 2] = color.b;\r\n    pixel[firstPixel + 3] = color.a;\r\n  }\r\n}\r\n\r\n/**\r\n * Applies the \"Saturate\" effect to a sprite, saturates the color according to HSL\r\n * @deprecated [[Saturate]] will be removed in v0.26.0\r\n */\r\n@obsolete({\r\n  message: 'Saturate will be removed in v0.26.0'\r\n})\r\nexport class Saturate implements SpriteEffect {\r\n  /**\r\n   * @param factor  The factor of the effect between 0-1\r\n   */\r\n  constructor(public factor: number = 0.1) {}\r\n  updatePixel(x: number, y: number, imageData: ImageData): void {\r\n    const firstPixel = (x + y * imageData.width) * 4;\r\n    const pixel = imageData.data;\r\n    const color = Color.fromRGB(pixel[firstPixel + 0], pixel[firstPixel + 1], pixel[firstPixel + 2], pixel[firstPixel + 3]).saturate(\r\n      this.factor\r\n    );\r\n    pixel[firstPixel + 0] = color.r;\r\n    pixel[firstPixel + 1] = color.g;\r\n    pixel[firstPixel + 2] = color.b;\r\n    pixel[firstPixel + 3] = color.a;\r\n  }\r\n}\r\n\r\n/**\r\n * Applies the \"Desaturate\" effect to a sprite, desaturates the color according to HSL\r\n * @deprecated [[Desaturate]] will be removed in v0.26.0\r\n */\r\n@obsolete({\r\n  message: 'Desaturate will be removed in v0.26.0'\r\n})\r\nexport class Desaturate implements SpriteEffect {\r\n  /**\r\n   * @param factor  The factor of the effect between 0-1\r\n   */\r\n  constructor(public factor: number = 0.1) {}\r\n  updatePixel(x: number, y: number, imageData: ImageData): void {\r\n    const firstPixel = (x + y * imageData.width) * 4;\r\n    const pixel = imageData.data;\r\n    const color = Color.fromRGB(pixel[firstPixel + 0], pixel[firstPixel + 1], pixel[firstPixel + 2], pixel[firstPixel + 3]).desaturate(\r\n      this.factor\r\n    );\r\n    pixel[firstPixel + 0] = color.r;\r\n    pixel[firstPixel + 1] = color.g;\r\n    pixel[firstPixel + 2] = color.b;\r\n    pixel[firstPixel + 3] = color.a;\r\n  }\r\n}\r\n\r\n/**\r\n * Applies the \"Fill\" effect to a sprite, changing the color channels of all non-transparent pixels to match\r\n * a given color\r\n * @deprecated [[Fill]] will be removed in v0.26.0\r\n */\r\n@obsolete({\r\n  message: 'Fill will be removed in v0.26.0'\r\n})\r\nexport class Fill implements SpriteEffect {\r\n  /**\r\n   * @param color  The color to apply to the sprite\r\n   */\r\n  constructor(public color: Color) {}\r\n  updatePixel(x: number, y: number, imageData: ImageData): void {\r\n    const firstPixel = (x + y * imageData.width) * 4;\r\n    const pixel = imageData.data;\r\n    if (pixel[firstPixel + 3] !== 0) {\r\n      pixel[firstPixel + 0] = this.color.r;\r\n      pixel[firstPixel + 1] = this.color.g;\r\n      pixel[firstPixel + 2] = this.color.b;\r\n    }\r\n  }\r\n}\r\n","import { Resource } from '../Resources/Resource';\r\nimport { Sprite } from './Sprite';\r\nimport { Loadable } from '../Interfaces/Index';\r\n/**\r\n * The [[Texture]] object allows games built in Excalibur to load image resources.\r\n * [[Texture]] is an [[Loadable]] which means it can be passed to a [[Loader]]\r\n * to pre-load before starting a level or game.\r\n * @deprecated\r\n */\r\nexport class Texture implements Loadable<HTMLImageElement> {\r\n  private _resource: Resource<Blob>;\r\n  /**\r\n   * The width of the texture in pixels\r\n   */\r\n  public width: number;\r\n\r\n  /**\r\n   * The height of the texture in pixels\r\n   */\r\n  public height: number;\r\n\r\n  private _sprite: Sprite = null;\r\n\r\n  /**\r\n   * Populated once loading is complete\r\n   */\r\n  public data: HTMLImageElement;\r\n  public get image() {\r\n    return this.data;\r\n  }\r\n\r\n  private _loadedResolve: (image: HTMLImageElement) => any;\r\n  public loaded = new Promise<HTMLImageElement>(resolve => {\r\n    this._loadedResolve = resolve;\r\n  });\r\n\r\n  /**\r\n   * @param path       Path to the image resource or a base64 string representing an image \"data:image/png;base64,iVB...\"\r\n   * @param bustCache  Optionally load texture with cache busting\r\n   */\r\n  constructor(public path: string, public bustCache = true) {\r\n    this._resource = new Resource(path, 'blob', bustCache);\r\n    this._sprite = new Sprite(this, 0, 0, 0, 0);\r\n  }\r\n\r\n  /**\r\n   * Returns true if the Texture is completely loaded and is ready\r\n   * to be drawn.\r\n   */\r\n  public isLoaded(): boolean {\r\n    return !!this.data;\r\n  }\r\n\r\n  /**\r\n   * Begins loading the texture and returns a promise to be resolved on completion\r\n   */\r\n  public async load(): Promise<HTMLImageElement> {\r\n    try {\r\n      // Load base64 or blob if needed\r\n      let url: string;\r\n      if (!this.path.includes('data:image/')) {\r\n        const blob = await this._resource.load();\r\n        url = URL.createObjectURL(blob);\r\n      } else {\r\n        url = this.path;\r\n      }\r\n\r\n      // Decode the image\r\n      const image = new Image();\r\n      image.src = url;\r\n      await image.decode();\r\n\r\n      // Set results\r\n      this.data = image;\r\n      this.width = this._sprite.width = image.naturalWidth;\r\n      this.height = this._sprite.height = image.naturalHeight;\r\n      this._sprite = new Sprite(this, 0, 0, this.width, this.height);\r\n    } catch {\r\n      await Promise.reject('Error loading texture');\r\n    }\r\n    // todo emit complete\r\n    this._loadedResolve(this.data);\r\n    return this.data;\r\n  }\r\n\r\n  public asSprite(): Sprite {\r\n    return this._sprite;\r\n  }\r\n}\r\n","export type Constructor<T> = {\r\n  new (...args: any[]): T;\r\n};\r\n/**\r\n * Configurable helper extends base type and makes all properties available as option bag arguments\r\n * @internal\r\n * @param base\r\n */\r\nexport function Configurable<T extends Constructor<{}>>(base: T): T {\r\n  return class extends base {\r\n    public assign(props: Partial<T>) {\r\n      //set the value of every property that was passed in,\r\n      //if the constructor previously set this value, it will be overridden here\r\n      for (const k in props) {\r\n        // eslint-disable-next-line\r\n        if (typeof (<any>this)[k] !== 'function') {\r\n          // eslint-disable-next-line\r\n          (<any>this)[k] = (<any>props)[k];\r\n        }\r\n      }\r\n    }\r\n\r\n    constructor(...args: any[]) {\r\n      super(...args);\r\n      //get the number of arguments that aren't undefined. TS passes a value to all parameters\r\n      //of whatever ctor is the implementation, so args.length doesn't work here.\r\n      const size = args.filter(function(value) {\r\n        return value !== undefined;\r\n      }).length;\r\n      if (size === 1 && args[0] && typeof args[0] === 'object' && !(args[0] instanceof Array)) {\r\n        this.assign(args[0]);\r\n      }\r\n    }\r\n  };\r\n}\r\n","import { Graphic, GraphicOptions } from './Graphic';\r\nimport { ImageSource } from './ImageSource';\r\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\r\n\r\nimport { Sprite as LegacySprite } from '../Drawing/Sprite';\r\nimport { Texture } from '../Drawing/Texture';\r\n\r\nexport type SourceView = { x: number; y: number; width: number; height: number };\r\nexport type DestinationSize = { width: number; height: number };\r\n\r\nexport interface SpriteOptions {\r\n  /**\r\n   * Image to create a sprite from\r\n   */\r\n  image: ImageSource;\r\n  /**\r\n   * By default the source is the entire dimension of the [[ImageSource]]\r\n   */\r\n  sourceView?: { x: number; y: number; width: number; height: number };\r\n  /**\r\n   * By default the size of the final sprite is the size of the [[ImageSource]]\r\n   */\r\n  destSize?: { width: number; height: number };\r\n}\r\n\r\nexport class Sprite extends Graphic {\r\n  public image: ImageSource;\r\n  public sourceView: SourceView;\r\n  public destSize: DestinationSize;\r\n  private _dirty = true;\r\n\r\n  public static from(image: ImageSource): Sprite {\r\n    return new Sprite({\r\n      image: image\r\n    });\r\n  }\r\n\r\n  constructor(options: GraphicOptions & SpriteOptions) {\r\n    super(options);\r\n    this.image = options.image;\r\n    const { width, height } = options;\r\n    this.sourceView = options.sourceView ?? { x: 0, y: 0, width: width ?? 0, height: height ?? 0 };\r\n    this.destSize = options.destSize ?? { width: width ?? 0, height: height ?? 0 };\r\n    this._updateSpriteDimensions();\r\n    this.image.ready.then(() => {\r\n      this._updateSpriteDimensions();\r\n    });\r\n  }\r\n\r\n  public override get width(): number {\r\n    return Math.abs(this.destSize.width * this.scale.x);\r\n  }\r\n\r\n  public override get height(): number {\r\n    return Math.abs(this.destSize.height * this.scale.y);\r\n  }\r\n\r\n  public override set width(newWidth: number) {\r\n    newWidth /= Math.abs(this.scale.x);\r\n    this.destSize.width = newWidth;\r\n    super.width = Math.ceil(this.destSize.width);\r\n  }\r\n\r\n  public override set height(newHeight: number) {\r\n    newHeight /= Math.abs(this.scale.y);\r\n    this.destSize.height = newHeight;\r\n    super.height = Math.ceil(this.destSize.height);\r\n  }\r\n\r\n  private _updateSpriteDimensions() {\r\n    const { width: nativeWidth, height: nativeHeight } = this.image;\r\n    // This code uses || to avoid 0's\r\n    // If the source is not specified, use the native dimension\r\n    this.sourceView.width = this.sourceView?.width || nativeWidth;\r\n    this.sourceView.height = this.sourceView?.height || nativeHeight;\r\n\r\n    // If the destination is not specified, use the source if specified, then native\r\n    this.destSize.width = this.destSize?.width || this.sourceView?.width || nativeWidth;\r\n    this.destSize.height = this.destSize?.height || this.sourceView?.height || nativeHeight;\r\n\r\n    this.width = Math.ceil(this.destSize.width) * this.scale.x;\r\n    this.height = Math.ceil(this.destSize.height) * this.scale.y;\r\n  }\r\n\r\n  protected _preDraw(ex: ExcaliburGraphicsContext, x: number, y: number): void {\r\n    if (this.image.isLoaded() && this._dirty) {\r\n      this._dirty = false;\r\n      this._updateSpriteDimensions();\r\n    }\r\n    super._preDraw(ex, x, y);\r\n  }\r\n\r\n  public _drawImage(ex: ExcaliburGraphicsContext, x: number, y: number): void {\r\n    if (this.image.isLoaded()) {\r\n      ex.drawImage(\r\n        this.image.image,\r\n        this.sourceView.x,\r\n        this.sourceView.y,\r\n        this.sourceView.width,\r\n        this.sourceView.height,\r\n        x,\r\n        y,\r\n        this.destSize.width,\r\n        this.destSize.height\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Create a ImageSource from legacy texture\r\n   * @param sprite\r\n   */\r\n  public static fromLegacySprite(sprite: LegacySprite): Sprite {\r\n    const tex = sprite.texture;\r\n    const image = ImageSource.fromLegacyTexture(tex);\r\n    return new Sprite({\r\n      image,\r\n      sourceView: {\r\n        x: sprite.x,\r\n        y: sprite.y,\r\n        width: sprite.width,\r\n        height: sprite.height\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Converts a sprite to a Legacy sprite\r\n   * @deprecated\r\n   * @param sprite\r\n   * @returns LegacyDrawing.Sprite\r\n   */\r\n  public static toLegacySprite(sprite: Sprite): LegacySprite {\r\n    const image = sprite.image;\r\n    const tex = new Texture(image.path);\r\n    tex.data = image.image;\r\n\r\n    return new LegacySprite(tex, sprite.sourceView.x, sprite.sourceView.y, sprite.sourceView.width, sprite.sourceView.height);\r\n  }\r\n\r\n  public clone(): Sprite {\r\n    return new Sprite({\r\n      image: this.image,\r\n      sourceView: { ...this.sourceView },\r\n      destSize: { ...this.destSize },\r\n      ...this.cloneGraphicOptions()\r\n    });\r\n  }\r\n}\r\n","import { Resource } from '../Resources/Resource';\r\nimport { Texture } from '../Drawing/Texture';\r\nimport { Sprite } from './Sprite';\r\nimport { Loadable } from '../Interfaces/Index';\r\nimport { Logger } from '../Util/Log';\r\nimport { TextureLoader } from '.';\r\nimport { ImageFiltering } from './Filtering';\r\n\r\nexport class ImageSource implements Loadable<HTMLImageElement> {\r\n  private _logger = Logger.getInstance();\r\n  private _resource: Resource<Blob>;\r\n  private _filtering: ImageFiltering;\r\n\r\n  /**\r\n   * The original size of the source image in pixels\r\n   */\r\n  public get width() {\r\n    return this.image.naturalWidth;\r\n  }\r\n\r\n  /**\r\n   * The original height of the source image in pixels\r\n   */\r\n  public get height() {\r\n    return this.image.naturalHeight;\r\n  }\r\n\r\n  private _src: string;\r\n  /**\r\n   * Returns true if the Texture is completely loaded and is ready\r\n   * to be drawn.\r\n   */\r\n  public isLoaded(): boolean {\r\n    if (!this._src) {\r\n      // this boosts speed of access\r\n      this._src = this.data.src;\r\n    }\r\n    return !!this._src;\r\n  }\r\n\r\n  /**\r\n   * Access to the underlying html image element\r\n   */\r\n  public data: HTMLImageElement = new Image();\r\n  public get image(): HTMLImageElement {\r\n    return this.data;\r\n  }\r\n\r\n  /**\r\n   * Promise the resolves when the image is loaded and ready for use, does not initiate loading\r\n   */\r\n  public ready: Promise<HTMLImageElement>;\r\n  private _loadedResolve: (value?: HTMLImageElement | PromiseLike<HTMLImageElement>) => void;\r\n\r\n  /**\r\n   * The path to the image, can also be a data url like 'data:image/'\r\n   * @param path {string} Path to the image resource relative from the HTML document hosting the game, or absolute\r\n   * @param bustCache {boolean} Should excalibur add a cache busting querystring?\r\n   * @param filtering {ImageFiltering} Optionally override the image filtering set by [[EngineOptions.antialiasing]]\r\n   */\r\n  constructor(public readonly path: string, bustCache: boolean = false, filtering?: ImageFiltering) {\r\n    this._resource = new Resource(path, 'blob', bustCache);\r\n    this._filtering = filtering;\r\n    if (path.endsWith('.svg') || path.endsWith('.gif')) {\r\n      this._logger.warn(`Image type is not fully supported, you may have mixed results ${path}. Fully supported: jpg, bmp, and png`);\r\n    }\r\n    this.ready = new Promise<HTMLImageElement>((resolve) => {\r\n      this._loadedResolve = resolve;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Begins loading the image and returns a promise that resolves when the image is loaded\r\n   */\r\n  async load(): Promise<HTMLImageElement> {\r\n    if (this.isLoaded()) {\r\n      return this.data;\r\n    }\r\n    try {\r\n      // Load base64 or blob if needed\r\n      let url: string;\r\n      if (!this.path.includes('data:image/')) {\r\n        const blob = await this._resource.load();\r\n        url = URL.createObjectURL(blob);\r\n      } else {\r\n        url = this.path;\r\n      }\r\n\r\n      // Decode the image\r\n      const image = new Image();\r\n      image.src = url;\r\n      image.setAttribute('data-original-src', this.path);\r\n      await image.decode();\r\n\r\n      // Set results\r\n      this.data = image;\r\n    } catch (error) {\r\n      throw `Error loading ImageSource from path '${this.path}' with error [${error.message}]`;\r\n    }\r\n    TextureLoader.load(this.data, this._filtering);\r\n    // todo emit complete\r\n    this._loadedResolve(this.data);\r\n    return this.data;\r\n  }\r\n\r\n  /**\r\n   * Build a sprite from this ImageSource\r\n   */\r\n  public toSprite(): Sprite {\r\n    return Sprite.from(this);\r\n  }\r\n\r\n  /**\r\n   * Create a ImageSource from legacy texture\r\n   * @param tex\r\n   */\r\n  public static fromLegacyTexture(tex: Texture): ImageSource {\r\n    const image = new ImageSource(tex.path);\r\n    if (tex.isLoaded()) {\r\n      image.data = tex.data;\r\n    } else {\r\n      tex.loaded.then(() => {\r\n        image.data = tex.data;\r\n      });\r\n    }\r\n    return image;\r\n  }\r\n\r\n  /**\r\n   * Unload images from memory\r\n   */\r\n  unload(): void {\r\n    this.data = new Image();\r\n  }\r\n}\r\n","import { Sprite } from './Sprite';\r\nimport * as Effects from './SpriteEffects';\r\nimport { Color } from '../Color';\r\n\r\nimport { Drawable, DrawOptions } from '../Interfaces/Drawable';\r\nimport { Vector } from '../Math/vector';\r\nimport { Engine } from '../Engine';\r\nimport { Configurable } from '../Configurable';\r\nimport { obsolete } from '../Util/Decorators';\r\nimport { clamp } from '../Math/util';\r\n\r\n/**\r\n * @deprecated Use [[HasTick]]\r\n */\r\nexport interface HasTick {\r\n  /**\r\n   *\r\n   * @param elapsedMilliseconds The amount of real world time in milliseconds that has elapsed that must be updated in the animation\r\n   */\r\n  tick(elapsedMilliseconds: number, idempotencyToken?: number): void;\r\n}\r\n\r\n/**\r\n * @hidden\r\n * @deprecated Use [[Animation]]\r\n */\r\nexport class AnimationImpl implements Drawable, HasTick {\r\n  /**\r\n   * The sprite frames to play, in order. See [[SpriteSheet.getAnimationForAll]] to quickly\r\n   * generate an [[Animation]].\r\n   */\r\n  public sprites: Sprite[] = [];\r\n\r\n  /**\r\n   * Duration to show each frame (in milliseconds)\r\n   */\r\n  public speed: number;\r\n\r\n  /**\r\n   * Current frame index being shown\r\n   */\r\n  public currentFrame: number = 0;\r\n\r\n  private _timeLeftInFrame: number = 0;\r\n  private _idempotencyToken: number = -1;\r\n\r\n  public anchor: Vector = Vector.Zero;\r\n  public rotation: number = 0.0;\r\n  public scale: Vector = Vector.One;\r\n\r\n  /**\r\n   * Indicates whether the animation should loop after it is completed\r\n   */\r\n  public loop: boolean = true;\r\n\r\n  /**\r\n   * Indicates the frame index the animation should freeze on for a non-looping\r\n   * animation. By default it is the last frame.\r\n   */\r\n  public freezeFrame: number = -1;\r\n\r\n  private _engine: Engine;\r\n\r\n  /**\r\n   * Flip each frame vertically. Sets [[Sprite.flipVertical]].\r\n   */\r\n  public flipVertical: boolean = false;\r\n\r\n  /**\r\n   * Flip each frame horizontally. Sets [[Sprite.flipHorizontal]].\r\n   */\r\n  public flipHorizontal: boolean = false;\r\n\r\n  public drawWidth: number = 0;\r\n  public drawHeight: number = 0;\r\n  public width: number = 0;\r\n  public height: number = 0;\r\n\r\n  private _opacity = 1;\r\n\r\n  /**\r\n   * Typically you will use a [[SpriteSheet]] to generate an [[Animation]].\r\n   *\r\n   * @param engineOrConfig  Reference to the current game engine\r\n   * @param sprites  An array of sprites to create the frames for the animation\r\n   * @param speed   The number in milliseconds to display each frame in the animation\r\n   * @param loop    Indicates whether the animation should loop after it is completed\r\n   */\r\n  constructor(engineOrConfig: Engine | AnimationArgs, sprites: Sprite[], speed: number, loop?: boolean) {\r\n    let engine = engineOrConfig;\r\n    if (engineOrConfig && !(engineOrConfig instanceof Engine)) {\r\n      const config = engineOrConfig;\r\n      engine = config.engine;\r\n      sprites = config.sprites;\r\n      speed = config.speed;\r\n      loop = config.loop;\r\n    }\r\n\r\n    this.sprites = sprites;\r\n    this.speed = speed;\r\n    this._engine = <Engine>engine;\r\n    this._timeLeftInFrame = this.speed;\r\n\r\n    if (loop != null) {\r\n      this.loop = loop;\r\n    }\r\n\r\n    if (sprites && sprites[0]) {\r\n      this.drawHeight = sprites[0] ? sprites[0].drawHeight : 0;\r\n      this.drawWidth = sprites[0] ? sprites[0].drawWidth : 0;\r\n\r\n      this.width = sprites[0] ? sprites[0].width : 0;\r\n      this.height = sprites[0] ? sprites[0].height : 0;\r\n\r\n      this.freezeFrame = sprites.length - 1;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Applies the opacity effect to a sprite, setting the alpha of all pixels to a given value\r\n   */\r\n  public opacity(value: number) {\r\n    this._opacity = value;\r\n  }\r\n\r\n  /**\r\n   * Applies the grayscale effect to a sprite, removing color information.\r\n   */\r\n  public grayscale() {\r\n    this.addEffect(new Effects.Grayscale());\r\n  }\r\n\r\n  /**\r\n   * Applies the invert effect to a sprite, inverting the pixel colors.\r\n   */\r\n  public invert() {\r\n    this.addEffect(new Effects.Invert());\r\n  }\r\n\r\n  /**\r\n   * Applies the fill effect to a sprite, changing the color channels of all non-transparent pixels to match a given color\r\n   */\r\n  public fill(color: Color) {\r\n    this.addEffect(new Effects.Fill(color));\r\n  }\r\n\r\n  /**\r\n   * Applies the colorize effect to a sprite, changing the color channels of all pixels to be the average of the original color and the\r\n   * provided color.\r\n   */\r\n  public colorize(color: Color) {\r\n    this.addEffect(new Effects.Colorize(color));\r\n  }\r\n\r\n  /**\r\n   * Applies the lighten effect to a sprite, changes the lightness of the color according to hsl\r\n   */\r\n  public lighten(factor: number = 0.1) {\r\n    this.addEffect(new Effects.Lighten(factor));\r\n  }\r\n\r\n  /**\r\n   * Applies the darken effect to a sprite, changes the darkness of the color according to hsl\r\n   */\r\n  public darken(factor: number = 0.1) {\r\n    this.addEffect(new Effects.Darken(factor));\r\n  }\r\n\r\n  /**\r\n   * Applies the saturate effect to a sprite, saturates the color according to hsl\r\n   */\r\n  public saturate(factor: number = 0.1) {\r\n    this.addEffect(new Effects.Saturate(factor));\r\n  }\r\n\r\n  /**\r\n   * Applies the desaturate effect to a sprite, desaturates the color according to hsl\r\n   */\r\n  public desaturate(factor: number = 0.1) {\r\n    this.addEffect(new Effects.Desaturate(factor));\r\n  }\r\n\r\n  /**\r\n   * Add a [[SpriteEffect]] manually\r\n   */\r\n  public addEffect(effect: Effects.SpriteEffect) {\r\n    for (const i in this.sprites) {\r\n      this.sprites[i].addEffect(effect);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Removes an [[SpriteEffect]] from this animation.\r\n   * @param effect Effect to remove from this animation\r\n   */\r\n  public removeEffect(effect: Effects.SpriteEffect): void;\r\n\r\n  /**\r\n   * Removes an effect given the index from this animation.\r\n   * @param index  Index of the effect to remove from this animation\r\n   */\r\n  public removeEffect(index: number): void;\r\n  public removeEffect(param: any) {\r\n    for (const i in this.sprites) {\r\n      this.sprites[i].removeEffect(param);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear all sprite effects\r\n   */\r\n  public clearEffects() {\r\n    for (const i in this.sprites) {\r\n      this.sprites[i].clearEffects();\r\n    }\r\n  }\r\n\r\n  private _setAnchor(point: Vector) {\r\n    //if (!this.anchor.equals(point)) {\r\n    for (const i in this.sprites) {\r\n      this.sprites[i].anchor.setTo(point.x, point.y);\r\n    }\r\n    //}\r\n  }\r\n\r\n  private _setRotation(radians: number) {\r\n    //if (this.rotation !== radians) {\r\n    for (const i in this.sprites) {\r\n      this.sprites[i].rotation = radians;\r\n    }\r\n    //}\r\n  }\r\n\r\n  private _setScale(scale: Vector) {\r\n    //if (!this.scale.equals(scale)) {\r\n    for (const i in this.sprites) {\r\n      this.sprites[i].scale = scale;\r\n    }\r\n    //}\r\n  }\r\n\r\n  /**\r\n   * Resets the animation to first frame.\r\n   */\r\n  public reset() {\r\n    this.currentFrame = 0;\r\n  }\r\n\r\n  /**\r\n   * Indicates whether the animation is complete, animations that loop are never complete.\r\n   */\r\n  public isDone() {\r\n    return !this.loop && this.currentFrame >= this.sprites.length;\r\n  }\r\n\r\n  /**\r\n   * Not meant to be called by game developers. Ticks the animation forward internally and\r\n   * calculates whether to change to the frame.\r\n   * @internal\r\n   */\r\n  public tick(elapsed: number, idempotencyToken?: number) {\r\n    if (this._idempotencyToken === idempotencyToken) {\r\n      return;\r\n    }\r\n    this._idempotencyToken = idempotencyToken;\r\n    this._timeLeftInFrame -= elapsed;\r\n    if (this._timeLeftInFrame <= 0) {\r\n      this.currentFrame = this.loop ? (this.currentFrame + 1) % this.sprites.length : this.currentFrame + 1;\r\n      this._timeLeftInFrame = this.speed;\r\n    }\r\n\r\n    this._updateValues();\r\n    const current = this.sprites[this.currentFrame];\r\n    if (current) {\r\n      this.width = current.width;\r\n      this.height = current.height;\r\n      this.drawWidth = current.drawWidth;\r\n      this.drawHeight = current.drawHeight;\r\n    }\r\n  }\r\n\r\n  private _updateValues(): void {\r\n    this._setAnchor(this.anchor);\r\n    this._setRotation(this.rotation);\r\n    this._setScale(this.scale);\r\n  }\r\n\r\n  /**\r\n   * Skips ahead a specified number of frames in the animation\r\n   * @param frames  Frames to skip ahead\r\n   */\r\n  public skip(frames: number) {\r\n    this.currentFrame = (this.currentFrame + frames) % this.sprites.length;\r\n  }\r\n\r\n  /**\r\n   * Draws the animation appropriately to the 2D rendering context, at an x and y coordinate.\r\n   * @param ctx  The 2D rendering context\r\n   * @param x    The x coordinate of where to draw\r\n   * @param y    The y coordinate of where to draw\r\n   */\r\n  public draw(ctx: CanvasRenderingContext2D, x: number, y: number): void;\r\n  /**\r\n   * Draws the animation with custom options to override internals without mutating them.\r\n   * @param options\r\n   */\r\n  public draw(options: DrawOptions): void;\r\n  public draw(ctxOrOptions: CanvasRenderingContext2D | DrawOptions, x?: number, y?: number) {\r\n    if (ctxOrOptions instanceof CanvasRenderingContext2D) {\r\n      this._drawWithOptions({ ctx: ctxOrOptions, x, y });\r\n    } else {\r\n      this._drawWithOptions(ctxOrOptions);\r\n    }\r\n  }\r\n\r\n  private _drawWithOptions(options: DrawOptions) {\r\n    const animOptions = {\r\n      ...options,\r\n      rotation: options.rotation ?? this.rotation,\r\n      drawWidth: options.drawWidth ?? this.drawWidth,\r\n      drawHeight: options.drawHeight ?? this.drawHeight,\r\n      flipHorizontal: options.flipHorizontal ?? this.flipHorizontal,\r\n      flipVertical: options.flipVertical ?? this.flipVertical,\r\n      anchor: options.anchor ?? this.anchor,\r\n      opacity: (options.opacity ?? 1) * (this._opacity ?? 1)\r\n    };\r\n\r\n    this._updateValues();\r\n    let currSprite: Sprite;\r\n    if (this.currentFrame < this.sprites.length) {\r\n      currSprite = this.sprites[this.currentFrame];\r\n      currSprite.draw(animOptions);\r\n    }\r\n\r\n    if (this.freezeFrame !== -1 && this.currentFrame >= this.sprites.length) {\r\n      currSprite = this.sprites[clamp(this.freezeFrame, 0, this.sprites.length - 1)];\r\n      currSprite.draw(animOptions);\r\n    }\r\n\r\n    // add the calculated width\r\n    if (currSprite) {\r\n      this.drawWidth = currSprite.drawWidth;\r\n      this.drawHeight = currSprite.drawHeight;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Plays an animation at an arbitrary location in the game.\r\n   * @param x  The x position in the game to play\r\n   * @param y  The y position in the game to play\r\n   */\r\n  public play(x: number, y: number) {\r\n    this.reset();\r\n    this._engine.playAnimation(this, x, y);\r\n  }\r\n}\r\n\r\n/**\r\n * @deprecated Use [[Animation]]\r\n */\r\nexport interface AnimationArgs extends Partial<AnimationImpl> {\r\n  engine: Engine;\r\n  sprites: Sprite[];\r\n  speed: number;\r\n  loop?: boolean;\r\n  anchor?: Vector;\r\n  rotation?: number;\r\n  scale?: Vector;\r\n  flipVertical?: boolean;\r\n  flipHorizontal?: boolean;\r\n  width?: number;\r\n  height?: number;\r\n}\r\n\r\n/**\r\n * Animations allow you to display a series of images one after another,\r\n * creating the illusion of change. Generally these images will come from a [[SpriteSheet]] source.\r\n * @deprecated Use [[Animation]]\r\n */\r\n@obsolete({\r\n  message: 'Animation will be removed in v0.26.0',\r\n  alternateMethod: 'Use Graphics.Animation'\r\n})\r\nexport class Animation extends Configurable(AnimationImpl) {\r\n  constructor(config: AnimationArgs);\r\n  constructor(engine: Engine, images: Sprite[], speed: number, loop?: boolean);\r\n  constructor(engineOrConfig: Engine | AnimationArgs, images?: Sprite[], speed?: number, loop?: boolean) {\r\n    super(engineOrConfig, images, speed, loop);\r\n  }\r\n}\r\n","import { BoundingBox } from '../Collision/BoundingBox';\r\nimport { Color } from '../Color';\r\nimport { Vector } from '../Math/vector';\r\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\r\n\r\n/**\r\n * Enum representing the different font size units\r\n * https://developer.mozilla.org/en-US/docs/Web/CSS/font-size\r\n */\r\nexport enum FontUnit {\r\n  /**\r\n   * Em is a scalable unit, 1 em is equal to the current font size of the current element, parent elements can effect em values\r\n   */\r\n  Em = 'em',\r\n  /**\r\n   * Rem is similar to the Em, it is a scalable unit. 1 rem is equal to the font size of the root element\r\n   */\r\n  Rem = 'rem',\r\n  /**\r\n   * Pixel is a unit of length in screen pixels\r\n   */\r\n  Px = 'px',\r\n  /**\r\n   * Point is a physical unit length (1/72 of an inch)\r\n   */\r\n  Pt = 'pt',\r\n  /**\r\n   * Percent is a scalable unit similar to Em, the only difference is the Em units scale faster when Text-Size stuff\r\n   */\r\n  Percent = '%'\r\n}\r\n\r\n/**\r\n * Enum representing the different horizontal text alignments\r\n */\r\nexport enum TextAlign {\r\n  /**\r\n   * The text is left-aligned.\r\n   */\r\n  Left = 'left',\r\n  /**\r\n   * The text is right-aligned.\r\n   */\r\n  Right = 'right',\r\n  /**\r\n   * The text is centered.\r\n   */\r\n  Center = 'center',\r\n  /**\r\n   * The text is aligned at the normal start of the line (left-aligned for left-to-right locales,\r\n   * right-aligned for right-to-left locales).\r\n   */\r\n  Start = 'start',\r\n  /**\r\n   * The text is aligned at the normal end of the line (right-aligned for left-to-right locales,\r\n   * left-aligned for right-to-left locales).\r\n   */\r\n  End = 'end'\r\n}\r\n\r\n/**\r\n * Enum representing the different baseline text alignments\r\n */\r\nexport enum BaseAlign {\r\n  /**\r\n   * The text baseline is the top of the em square.\r\n   */\r\n  Top = 'top',\r\n  /**\r\n   * The text baseline is the hanging baseline.  Currently unsupported; this will act like\r\n   * alphabetic.\r\n   */\r\n  Hanging = 'hanging',\r\n  /**\r\n   * The text baseline is the middle of the em square.\r\n   */\r\n  Middle = 'middle',\r\n  /**\r\n   * The text baseline is the normal alphabetic baseline.\r\n   */\r\n  Alphabetic = 'alphabetic',\r\n  /**\r\n   * The text baseline is the ideographic baseline; this is the bottom of\r\n   * the body of the characters, if the main body of characters protrudes\r\n   * beneath the alphabetic baseline.  Currently unsupported; this will\r\n   * act like alphabetic.\r\n   */\r\n  Ideographic = 'ideographic',\r\n  /**\r\n   * The text baseline is the bottom of the bounding box.  This differs\r\n   * from the ideographic baseline in that the ideographic baseline\r\n   * doesn't consider descenders.\r\n   */\r\n  Bottom = 'bottom'\r\n}\r\n\r\n/**\r\n * Enum representing the different possible font styles\r\n */\r\nexport enum FontStyle {\r\n  Normal = 'normal',\r\n  Italic = 'italic',\r\n  Oblique = 'oblique'\r\n}\r\n\r\n/**\r\n * Enum representing the text direction, useful for other languages, or writing text in reverse\r\n */\r\nexport enum Direction {\r\n  LeftToRight = 'ltr',\r\n  RightToLeft = 'rtl'\r\n}\r\n\r\n/**\r\n * Font rendering option\r\n */\r\nexport interface FontOptions {\r\n  /**\r\n   * Optionally the size of the font in the specified [[FontUnit]] by default 10.\r\n   */\r\n  size?: number;\r\n  /**\r\n   * Optionally specify unit to measure fonts in, by default Pixels\r\n   */\r\n  unit?: FontUnit;\r\n  /**\r\n   * Optionally specify the font family, by default 'sans-serif'\r\n   */\r\n  family?: string;\r\n  /**\r\n   * Optionally specify the font style, by default Normal\r\n   */\r\n  style?: FontStyle;\r\n  /**\r\n   * Optionally set whether the font is bold, by default false\r\n   */\r\n  bold?: boolean;\r\n  /**\r\n   * Optionally specify the text align, by default Left\r\n   */\r\n  textAlign?: TextAlign;\r\n  /**\r\n   * Optionally specify the text base align, by default Alphabetic\r\n   */\r\n  baseAlign?: BaseAlign;\r\n  /**\r\n   * Optionally specify the text direction, by default LeftToRight\r\n   */\r\n  direction?: Direction;\r\n  /**\r\n   * Optionally specify the quality of the text bitmap, it is a multiplier on the size size, by default 2.\r\n   * Higher quality text has a higher memory impact\r\n   */\r\n  quality?: number;\r\n  /**\r\n   * Optionally specify a text shadow, by default none is specified\r\n   */\r\n  shadow?: {\r\n    blur?: number;\r\n    offset?: Vector;\r\n    color?: Color;\r\n  };\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport interface FontRenderer {\r\n  measureText(text: string): BoundingBox;\r\n  render(ex: ExcaliburGraphicsContext, text: string, color: Color, x: number, y: number): void;\r\n}\r\n","import { Sprite, SpriteArgs } from './Sprite';\r\nimport { Animation } from './Animation';\r\nimport { Color } from '../Color';\r\nimport * as Effects from './SpriteEffects';\r\n\r\nimport { Texture } from './Texture';\r\nimport { Engine } from '../Engine';\r\nimport { Logger } from '../Util/Log';\r\nimport { BaseAlign, TextAlign } from '../Graphics/FontCommon';\r\nimport { obsolete } from '../Util/Decorators';\r\nimport { vec } from '../Math/vector';\r\n\r\nexport interface SpriteSheetArgs {\r\n  image: Texture;\r\n  sprites?: Sprite[];\r\n  spWidth: number;\r\n  spHeight: number;\r\n  rows: number;\r\n  columns: number;\r\n  spacing?: number | SpriteSheetSpacingDimensions;\r\n}\r\n\r\nexport interface SpriteSheetSpacingDimensions {\r\n  top?: number;\r\n  left?: number;\r\n  margin?: number;\r\n}\r\n\r\n/**\r\n * Sprite sheets are a useful mechanism for slicing up image resources into\r\n * separate sprites or for generating in game animations. [[Sprite|Sprites]] are organized\r\n * in row major order in the [[SpriteSheet]].\r\n * @deprecated Will be removed in v0.26.0\r\n */\r\nexport class SpriteSheet {\r\n  private _sprites: Sprite[] = [];\r\n  private _image: Texture | null = null;\r\n  private _columns: number = 0;\r\n  private _rows: number = 0;\r\n  private _spWidth: number = 0;\r\n  private _spHeight: number = 0;\r\n  private _spacing: number | SpriteSheetSpacingDimensions = 0;\r\n\r\n  /**\r\n   * @param config    The configuration of the SpriteSheet\r\n   */\r\n  constructor(config: SpriteSheetArgs);\r\n\r\n  /**\r\n   * @param sprites   The backing sprite array to use, if already available\r\n   */\r\n  constructor(sprites: Sprite[]);\r\n\r\n  /**\r\n   * @param image     The backing image texture to build the SpriteSheet\r\n   * @param columns   The number of columns in the image texture\r\n   * @param rows      The number of rows in the image texture\r\n   * @param spWidth   The width of each individual sprite in pixels\r\n   * @param spHeight  The height of each individual sprite in pixels\r\n   * @param spacing   The spacing between every sprite in a spritesheet\r\n   */\r\n  constructor(\r\n    image: Texture,\r\n    columns: number,\r\n    rows: number,\r\n    spWidth: number,\r\n    spHeight: number,\r\n    spacing?: number | SpriteSheetSpacingDimensions\r\n  );\r\n\r\n  /**\r\n   * @param imageOrConfigOrSprites The backing image texture to build the SpriteSheet, option bag, or sprite list\r\n   * @param columns   The number of columns in the image texture\r\n   * @param rows      The number of rows in the image texture\r\n   * @param spWidth   The width of each individual sprite in pixels\r\n   * @param spHeight  The height of each individual sprite in pixels\r\n   * @param spacing   The spacing between every sprite in a spritesheet\r\n   */\r\n  constructor(\r\n    imageOrConfigOrSprites: Texture | SpriteSheetArgs | Sprite[],\r\n    columns?: number,\r\n    rows?: number,\r\n    spWidth?: number,\r\n    spHeight?: number,\r\n    spacing?: number | SpriteSheetSpacingDimensions\r\n  ) {\r\n    let loadFromImage: boolean = false;\r\n    if (imageOrConfigOrSprites instanceof Array) {\r\n      this._sprites = imageOrConfigOrSprites;\r\n    } else {\r\n      if (imageOrConfigOrSprites && !(imageOrConfigOrSprites instanceof Texture)) {\r\n        this._columns = imageOrConfigOrSprites.columns;\r\n        this._rows = imageOrConfigOrSprites.rows;\r\n        this._spWidth = imageOrConfigOrSprites.spWidth;\r\n        this._spHeight = imageOrConfigOrSprites.spHeight;\r\n        this._image = imageOrConfigOrSprites.image;\r\n        this._spacing = imageOrConfigOrSprites.spacing || 0;\r\n      } else {\r\n        this._image = <Texture>imageOrConfigOrSprites;\r\n        this._columns = columns;\r\n        this._rows = rows;\r\n        this._spWidth = spWidth;\r\n        this._spHeight = spHeight;\r\n        this._spacing = spacing || 0;\r\n      }\r\n      this._sprites = new Array(this._columns * this._rows);\r\n      loadFromImage = true;\r\n    }\r\n\r\n    // Inspect actual image dimensions with preloading\r\n    if (this.image instanceof Texture) {\r\n      let isWidthError: boolean = false;\r\n      let isHeightError: boolean = false;\r\n      if (this.image.isLoaded()) {\r\n        isWidthError = this.spWidth * this.columns > this.image.image.naturalWidth;\r\n        isHeightError = this.spHeight * this.rows > this.image.image.naturalHeight;\r\n        if (isWidthError) {\r\n          throw new RangeError(\r\n            `SpriteSheet specified is wider, ` +\r\n              `${this.columns} cols x ${this.spWidth} pixels > ${this.image.image.naturalWidth} ` +\r\n              `pixels than image width`\r\n          );\r\n        }\r\n        if (isHeightError) {\r\n          throw new RangeError(\r\n            `SpriteSheet specified is taller, ` +\r\n              `${this.rows} rows x ${this.spHeight} pixels > ${this.image.image.naturalHeight} ` +\r\n              `pixels than image height`\r\n          );\r\n        }\r\n      }\r\n    }\r\n\r\n    if (loadFromImage) {\r\n      const spacing = this.getSpacingDimensions();\r\n\r\n      for (let row = 0; row < this.rows; row++) {\r\n        for (let col = 0; col < this.columns; col++) {\r\n          this._sprites[col + row * this.columns] = new Sprite(\r\n            this.image,\r\n            col * this.spWidth + spacing.margin * col + spacing.left,\r\n            row * this.spHeight + spacing.margin * row + spacing.top,\r\n            this.spWidth,\r\n            this.spHeight\r\n          );\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Gets the raw spacing dimensions for the sprites in the sheet, which can be a fixed number or custom dimensions.\r\n   */\r\n  public get spacing() {\r\n    return this._spacing;\r\n  }\r\n\r\n  /**\r\n   * Get a copy of the backing sprite array\r\n   */\r\n  public get sprites() {\r\n    return [...this._sprites];\r\n  }\r\n\r\n  /**\r\n   * The backing texture used for the sprite sheet\r\n   */\r\n  public get image() {\r\n    return this._image;\r\n  }\r\n\r\n  /**\r\n   * The number of columns in the sheet\r\n   */\r\n  public get columns() {\r\n    return this._columns;\r\n  }\r\n\r\n  /**\r\n   * The number of rows in the sheet\r\n   */\r\n  public get rows() {\r\n    return this._rows;\r\n  }\r\n\r\n  /**\r\n   * The width of the individual sprites\r\n   */\r\n  public get spWidth() {\r\n    return this._spWidth;\r\n  }\r\n\r\n  /**\r\n   * The height of the individual sprites\r\n   */\r\n  public get spHeight() {\r\n    return this._spHeight;\r\n  }\r\n\r\n  /**\r\n   * Gets the calculated spacing dimensions based on whether spacing\r\n   * is a fixed number or has different values for each dimension\r\n   */\r\n  public getSpacingDimensions(): SpriteSheetSpacingDimensions {\r\n    if (typeof this.spacing === 'number') {\r\n      return {\r\n        left: this.spacing,\r\n        top: this.spacing,\r\n        margin: this.spacing\r\n      };\r\n    } else {\r\n      return {\r\n        left: this.spacing.left ?? 0,\r\n        top: this.spacing.top ?? 0,\r\n        margin: this.spacing.margin ?? 0\r\n      };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Create an animation from the this SpriteSheet by listing out the\r\n   * sprite indices. Sprites are organized in row major order in the SpriteSheet.\r\n   * @param engine   Reference to the current game [[Engine]]\r\n   * @param indices  An array of sprite indices to use in the animation\r\n   * @param speed    The number in milliseconds to display each frame in the animation\r\n   */\r\n  public getAnimationByIndices(engine: Engine, indices: number[], speed: number) {\r\n    let images: Sprite[] = indices.map((index) => {\r\n      return this.sprites[index];\r\n    });\r\n\r\n    images = images.map(function (i) {\r\n      return i.clone();\r\n    });\r\n    return new Animation(engine, images, speed);\r\n  }\r\n\r\n  /**\r\n   * Create an animation from the this SpriteSheet by specifying the range of\r\n   * images with the beginning (inclusive) and ending (exclusive) index\r\n   * For example `getAnimationBetween(engine, 0, 5, 200)` returns an animation with 5 frames.\r\n   * @param engine      Reference to the current game Engine\r\n   * @param beginIndex  The index to start taking frames (inclusive)\r\n   * @param endIndex    The index to stop taking frames (exclusive)\r\n   * @param speed       The number in milliseconds to display each frame in the animation\r\n   */\r\n  public getAnimationBetween(engine: Engine, beginIndex: number, endIndex: number, speed: number) {\r\n    let images = this.sprites.slice(beginIndex, endIndex);\r\n    images = images.map(function (i) {\r\n      return i.clone();\r\n    });\r\n    return new Animation(engine, images, speed);\r\n  }\r\n\r\n  /**\r\n   * Treat the entire SpriteSheet as one animation, organizing the frames in\r\n   * row major order.\r\n   * @param engine  Reference to the current game [[Engine]]\r\n   * @param speed   The number in milliseconds to display each frame the animation\r\n   */\r\n  public getAnimationForAll(engine: Engine, speed: number) {\r\n    const sprites = this.sprites.map(function (i) {\r\n      return i.clone();\r\n    });\r\n    return new Animation(engine, sprites, speed);\r\n  }\r\n\r\n  /**\r\n   * Retrieve a specific sprite from the SpriteSheet by its index. Sprites are organized\r\n   * in row major order in the SpriteSheet.\r\n   * @param index  The index of the sprite\r\n   */\r\n  public getSprite(index: number): Sprite {\r\n    if (index >= 0 && index < this.sprites.length) {\r\n      return this.sprites[index];\r\n    } else {\r\n      throw new Error('Invalid index: ' + index);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get an animation with bespoke sprite coordinates. This is useful if the SpriteSheet is\r\n   * packed and not a uniform width or height. The resulting [[Animation]] will have the height and width of the\r\n   * largest dimension (width, height) from among the sprite coordinates\r\n   * @param engine\r\n   * @param spriteCoordinates\r\n   * @param speed\r\n   */\r\n  public getAnimationByCoords(engine: Engine, spriteCoordinates: SpriteArgs[], speed: number): Animation {\r\n    let maxWidth: number = 0;\r\n    let maxHeight: number = 0;\r\n    const sprites: Sprite[] = new Array(spriteCoordinates.length);\r\n    for (let i = 0; i < spriteCoordinates.length; i++) {\r\n      const coord = spriteCoordinates[i];\r\n      // no need to pass image again if using a spritesheet\r\n      coord.image = coord.image || this.image;\r\n      maxWidth = Math.max(maxWidth, coord.drawWidth);\r\n      maxHeight = Math.max(maxHeight, coord.drawHeight);\r\n      sprites[i] = new Sprite(coord);\r\n    }\r\n\r\n    const anim = new Animation(engine, sprites, speed);\r\n\r\n    anim.drawWidth = maxWidth;\r\n    anim.drawHeight = maxHeight;\r\n    return anim;\r\n  }\r\n}\r\n\r\n/**\r\n * Specify various font attributes for sprite fonts\r\n */\r\nexport interface SpriteFontOptions {\r\n  color?: Color;\r\n  opacity?: number;\r\n  fontSize?: number;\r\n  letterSpacing?: number;\r\n  textAlign?: TextAlign;\r\n  baseAlign?: BaseAlign;\r\n  maxWidth?: number;\r\n}\r\n\r\nexport interface SpriteFontArgs extends SpriteSheetArgs {\r\n  alphabet: string;\r\n  caseInsensitive: boolean;\r\n}\r\n\r\n/**\r\n * Sprite fonts are a used in conjunction with a [[Label]] to specify\r\n * a particular bitmap as a font. Note that some font features are not\r\n * supported by Sprite fonts.\r\n * @deprecated Will be removed into v0.26.0\r\n */\r\n@obsolete({\r\n  message: 'SpriteSheet will be removed in v0.26.0',\r\n  alternateMethod: 'Use Graphics.SpriteSheet'\r\n})\r\nexport class SpriteFont extends SpriteSheet {\r\n  private _currentColor: Color = Color.Black;\r\n  private _currentOpacity: Number = 1.0;\r\n  private _spriteRecord: Record<string, Sprite> = {};\r\n\r\n  // text shadow\r\n  private _textShadowOn: boolean = false;\r\n  private _textShadowDirty: boolean = true;\r\n  private _textShadowColor: Color = Color.Black;\r\n  private _textShadowSprites: { [key: string]: Sprite } = {};\r\n  private _shadowOffsetX: number = 5;\r\n  private _shadowOffsetY: number = 5;\r\n  public readonly alphabet: string;\r\n  public readonly caseInsensitive: boolean;\r\n\r\n  constructor(config: SpriteFontArgs);\r\n\r\n  constructor(\r\n    image: Texture,\r\n    alphabet: string,\r\n    caseInsensitive: boolean,\r\n    columns: number,\r\n    rows: number,\r\n    spWidth: number,\r\n    spHeight: number,\r\n    spacing?: number | SpriteSheetSpacingDimensions\r\n  );\r\n\r\n  /**\r\n   * @param imageOrConfig   The backing image texture to build the SpriteFont or the sprite font option bag\r\n   * @param alphabet        A string representing all the characters in the image, in row major order.\r\n   * @param caseInsensitive  Indicate whether this font takes case into account\r\n   * @param columns         The number of columns of characters in the image\r\n   * @param rows            The number of rows of characters in the image\r\n   * @param spWidth         The width of each character in pixels\r\n   * @param spHeight        The height of each character in pixels\r\n   */\r\n  constructor(\r\n    imageOrConfig: Texture | SpriteFontArgs,\r\n    alphabet?: string,\r\n    caseInsensitive?: boolean,\r\n    columns?: number,\r\n    rows?: number,\r\n    spWidth?: number,\r\n    spHeight?: number,\r\n    spacing?: number | SpriteSheetSpacingDimensions\r\n  ) {\r\n    super(\r\n      imageOrConfig instanceof Texture\r\n        ? {\r\n          image: imageOrConfig,\r\n          spWidth: spWidth,\r\n          spHeight: spHeight,\r\n          rows: rows,\r\n          columns: columns,\r\n          spacing: spacing || 0\r\n        }\r\n        : imageOrConfig\r\n    );\r\n\r\n    if (imageOrConfig && !(imageOrConfig instanceof Texture)) {\r\n      alphabet = imageOrConfig.alphabet;\r\n      caseInsensitive = imageOrConfig.caseInsensitive;\r\n    }\r\n\r\n    this.alphabet = alphabet;\r\n    this.caseInsensitive = caseInsensitive;\r\n    this._spriteRecord = this.getTextSprites();\r\n  }\r\n\r\n  /**\r\n   * Returns a dictionary that maps each character in the alphabet to the appropriate [[Sprite]].\r\n   */\r\n  public getTextSprites(): { [key: string]: Sprite } {\r\n    const lookup: { [key: string]: Sprite } = {};\r\n    for (let i = 0; i < this.alphabet.length; i++) {\r\n      let char = this.alphabet[i];\r\n      if (this.caseInsensitive) {\r\n        char = char.toLowerCase();\r\n      }\r\n      lookup[char] = this.sprites[i].clone();\r\n    }\r\n    return lookup;\r\n  }\r\n\r\n  /**\r\n   * Sets the text shadow for sprite fonts\r\n   * @param offsetX      The x offset in pixels to place the shadow\r\n   * @param offsetY      The y offset in pixels to place the shadow\r\n   * @param shadowColor  The color of the text shadow\r\n   */\r\n  public setTextShadow(offsetX: number, offsetY: number, shadowColor: Color) {\r\n    this._textShadowOn = true;\r\n    this._shadowOffsetX = offsetX;\r\n    this._shadowOffsetY = offsetY;\r\n    this._textShadowColor = shadowColor.clone();\r\n    this._textShadowDirty = true;\r\n    for (const character in this._spriteRecord) {\r\n      this._textShadowSprites[character] = this._spriteRecord[character].clone();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Toggles text shadows on or off\r\n   */\r\n  public useTextShadow(on: boolean) {\r\n    this._textShadowOn = on;\r\n    if (on) {\r\n      this.setTextShadow(5, 5, this._textShadowColor);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Draws the current sprite font\r\n   */\r\n  public draw(ctx: CanvasRenderingContext2D, text: string, x: number, y: number, options: SpriteFontOptions) {\r\n    options = this._parseOptions(options);\r\n\r\n    if (this._currentColor.toString() !== options.color.toString() || this._currentOpacity !== options.opacity) {\r\n      this._currentOpacity = options.opacity;\r\n      this._currentColor = options.color;\r\n      for (const char in this._spriteRecord) {\r\n        this._spriteRecord[char].clearEffects();\r\n        this._spriteRecord[char].fill(options.color);\r\n        this._spriteRecord[char].opacity(options.opacity);\r\n      }\r\n    }\r\n\r\n    if (this._textShadowOn && this._textShadowDirty && this._textShadowColor) {\r\n      for (const characterShadow in this._textShadowSprites) {\r\n        this._textShadowSprites[characterShadow].clearEffects();\r\n        this._textShadowSprites[characterShadow].addEffect(new Effects.Fill(this._textShadowColor.clone()));\r\n      }\r\n      this._textShadowDirty = false;\r\n    }\r\n\r\n    // find the current length of text in pixels\r\n    const sprite = this.sprites[0];\r\n\r\n    // find the current height fo the text in pixels\r\n    const height = sprite.height;\r\n\r\n    // calculate appropriate scale for font size\r\n    const scale = options.fontSize / height;\r\n\r\n    const length = text.length * sprite.width * scale + text.length * options.letterSpacing;\r\n\r\n    let currX = x;\r\n    if (options.textAlign === TextAlign.Left || options.textAlign === TextAlign.Start) {\r\n      currX = x;\r\n    } else if (options.textAlign === TextAlign.Right || options.textAlign === TextAlign.End) {\r\n      currX = x - length;\r\n    } else if (options.textAlign === TextAlign.Center) {\r\n      currX = x - length / 2;\r\n    }\r\n\r\n    let currY = y - height * scale;\r\n    if (options.baseAlign === BaseAlign.Top || options.baseAlign === BaseAlign.Hanging) {\r\n      currY = y;\r\n    } else if (\r\n      options.baseAlign === BaseAlign.Ideographic ||\r\n      options.baseAlign === BaseAlign.Bottom ||\r\n      options.baseAlign === BaseAlign.Alphabetic\r\n    ) {\r\n      currY = y - height * scale;\r\n    } else if (options.baseAlign === BaseAlign.Middle) {\r\n      currY = y - (height * scale) / 2;\r\n    }\r\n\r\n    for (let i = 0; i < text.length; i++) {\r\n      let character = text[i];\r\n      if (this.caseInsensitive) {\r\n        character = character.toLowerCase();\r\n      }\r\n      try {\r\n        // if text shadow\r\n        if (this._textShadowOn) {\r\n          this._textShadowSprites[character].drawAroundAnchor = false;\r\n          this._textShadowSprites[character].scale = vec(scale, scale);\r\n          this._textShadowSprites[character].draw(ctx, currX + this._shadowOffsetX, currY + this._shadowOffsetY);\r\n        }\r\n\r\n        const charSprite = this._spriteRecord[character];\r\n        charSprite.drawAroundAnchor = false;\r\n        charSprite.scale = vec(scale, scale);\r\n        charSprite.draw(ctx, currX, currY);\r\n        currX += charSprite.drawWidth + options.letterSpacing;\r\n      } catch (e) {\r\n        Logger.getInstance().error(`SpriteFont Error drawing char ${character}`);\r\n      }\r\n    }\r\n  }\r\n\r\n  private _parseOptions(options: SpriteFontOptions): SpriteFontOptions {\r\n    return {\r\n      fontSize: options.fontSize || 10,\r\n      letterSpacing: options.letterSpacing || 0,\r\n      color: options.color || Color.Black,\r\n      textAlign: typeof options.textAlign === undefined ? TextAlign.Left : options.textAlign,\r\n      baseAlign: typeof options.baseAlign === undefined ? BaseAlign.Bottom : options.baseAlign,\r\n      maxWidth: options.maxWidth || -1,\r\n      opacity: options.opacity || 0\r\n    };\r\n  }\r\n}\r\n","import { ImageSource } from './ImageSource';\r\nimport { Sprite } from './Sprite';\r\nimport { SpriteSheet as LegacySpriteSheet } from '../Drawing/SpriteSheet';\r\nimport { Logger } from '..';\r\n\r\n\r\n/**\r\n * Specify sprite sheet spacing options, useful if your sprites are not tightly packed\r\n * and have space between them.\r\n */\r\nexport interface SpriteSheetSpacingDimensions {\r\n  /**\r\n   * The starting point to offset and start slicing the sprite sheet from the top left of the image.\r\n   * Default is (0, 0)\r\n   */\r\n  originOffset?: { x?: number, y?: number };\r\n\r\n  /**\r\n   * The margin between sprites.\r\n   * Default is (0, 0)\r\n   */\r\n  margin?: {x?: number, y?: number};\r\n}\r\n\r\n/**\r\n * Sprite sheet options for slicing up images\r\n */\r\nexport interface SpriteSheetGridOptions {\r\n  /**\r\n   * Source image to use for each sprite\r\n   */\r\n  image: ImageSource;\r\n  /**\r\n   * Grid definition for the sprite sheet\r\n   */\r\n  grid: {\r\n    /**\r\n     * Number of rows in the sprite sheet\r\n     */\r\n    rows: number;\r\n    /**\r\n     * Number of columns in the sprite sheet\r\n     */\r\n    columns: number;\r\n    /**\r\n     * Width of each individual sprite\r\n     */\r\n    spriteWidth: number;\r\n    /**\r\n     * Height of each individual sprite\r\n     */\r\n    spriteHeight: number;\r\n  };\r\n  /**\r\n   * Optionally specify any spacing information between sprites\r\n   */\r\n  spacing?: SpriteSheetSpacingDimensions;\r\n}\r\n\r\nexport interface SpriteSheetOptions {\r\n  /**\r\n   * Source sprites for the sprite sheet\r\n   */\r\n  sprites: Sprite[];\r\n  /**\r\n   * Optionally specify the number of rows in a sprite sheet (default 1 row)\r\n   */\r\n  rows?: number;\r\n  /**\r\n   * Optionally specify the number of columns in a sprite sheet (default sprites.length)\r\n   */\r\n  columns?: number;\r\n}\r\n\r\n/**\r\n * Represents a collection of sprites from a source image with some organization in a grid\r\n */\r\nexport class SpriteSheet {\r\n  private _logger = Logger.getInstance();\r\n  public readonly sprites: Sprite[] = [];\r\n  public readonly rows: number;\r\n  public readonly columns: number;\r\n\r\n  /**\r\n   * Build a new sprite sheet from a list of sprites\r\n   *\r\n   * Use [[SpriteSheet.fromImageSource]] to create a SpriteSheet from an [[ImageSource]] organized in a grid\r\n   * @param options\r\n   */\r\n  constructor(options: SpriteSheetOptions) {\r\n    const { sprites, rows, columns } = options;\r\n    this.sprites = sprites;\r\n    this.rows = rows ?? 1;\r\n    this.columns = columns ?? this.sprites.length;\r\n  }\r\n\r\n  /**\r\n   * Find a sprite by their x/y position in the SpriteSheet, for example `getSprite(0, 0)` is the [[Sprite]] in the top-left\r\n   * @param x\r\n   * @param y\r\n   */\r\n  public getSprite(x: number, y: number): Sprite | null {\r\n    if (x >= this.columns || x < 0) {\r\n      this._logger.warn(`No sprite exists in the SpriteSheet at (${x}, ${y}), x: ${x} should be between 0 and ${this.columns - 1}`);\r\n      return null;\r\n    }\r\n    if (y >= this.rows || y < 0) {\r\n      this._logger.warn(`No sprite exists in the SpriteSheet at (${x}, ${y}), y: ${y} should be between 0 and ${this.rows - 1}`);\r\n      return null;\r\n    }\r\n    const spriteIndex = x + y * this.columns;\r\n    return this.sprites[spriteIndex];\r\n  }\r\n\r\n  /**\r\n   * To a graphics sprite sheet from a legacy sprite sheet\r\n   */\r\n  public static fromLegacySpriteSheet(legacySpriteSheet: LegacySpriteSheet): SpriteSheet {\r\n    const sprites = legacySpriteSheet.sprites.map(oldSprite => Sprite.fromLegacySprite(oldSprite));\r\n    return new SpriteSheet({\r\n      sprites\r\n    });\r\n  }\r\n\r\n  /**\r\n   * @deprecated\r\n   * @param spriteSheet\r\n   */\r\n  public static toLegacySpriteSheet(spriteSheet: SpriteSheet): LegacySpriteSheet {\r\n    const sprites = spriteSheet.sprites.map(sprite => Sprite.toLegacySprite(sprite));\r\n    return new LegacySpriteSheet(sprites);\r\n  }\r\n\r\n  /**\r\n   * Create a SpriteSheet from an [[ImageSource]] organized in a grid\r\n   *\r\n   * Example:\r\n   * ```\r\n   * const spriteSheet = SpriteSheet.fromImageSource({\r\n   *   image: imageSource,\r\n   *   grid: {\r\n   *     rows: 5,\r\n   *     columns: 2,\r\n   *     spriteWidth: 32, // pixels\r\n   *     spriteHeight: 32 // pixels\r\n   *   },\r\n   *   // Optionally specify spacing\r\n   *   spacing: {\r\n   *     // pixels from the top left to start the sprite parsing\r\n   *     originOffset: {\r\n   *       x: 5,\r\n   *       y: 5\r\n   *     },\r\n   *     // pixels between each sprite while parsing\r\n   *     margin: {\r\n   *       x: 1,\r\n   *       y: 1\r\n   *     }\r\n   *   }\r\n   * })\r\n   * ```\r\n   *\r\n   * @param options\r\n   */\r\n  public static fromImageSource(options: SpriteSheetGridOptions): SpriteSheet {\r\n    const sprites: Sprite[] = [];\r\n    options.spacing = options.spacing ?? {};\r\n    const {\r\n      image,\r\n      grid: { rows, columns: cols, spriteWidth, spriteHeight },\r\n      spacing: { originOffset, margin }\r\n    } = options;\r\n    const offsetDefaults = { x: 0, y: 0, ...originOffset};\r\n    const marginDefaults = { x: 0, y: 0, ...margin};\r\n    for (let x = 0; x < cols; x++) {\r\n      for (let y = 0; y < rows; y++) {\r\n        sprites[x + y * cols] = new Sprite({\r\n          image: image,\r\n          sourceView: {\r\n            x: x * spriteWidth + marginDefaults.x * x + offsetDefaults.x,\r\n            y: y * spriteHeight + marginDefaults.y * y + offsetDefaults.y,\r\n            width: spriteWidth,\r\n            height: spriteHeight\r\n          },\r\n          destSize: { height: spriteHeight, width: spriteWidth }\r\n        });\r\n      }\r\n    }\r\n    return new SpriteSheet({\r\n      sprites: sprites,\r\n      rows: rows,\r\n      columns: cols\r\n    });\r\n  }\r\n}\r\n","import { Vector } from '../Math/vector';\r\nimport { SpriteFont as LegacySpriteFont } from '../Drawing/Index';\r\nimport { Logger } from '../Util/Log';\r\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\r\nimport { FontRenderer } from './FontCommon';\r\nimport { Graphic, GraphicOptions } from './Graphic';\r\nimport { Sprite } from './Sprite';\r\nimport { SpriteSheet } from './SpriteSheet';\r\nimport { BoundingBox, Color } from '..';\r\n\r\nexport interface SpriteFontOptions {\r\n  /**\r\n   * Alphabet string in spritesheet order (default is row column order)\r\n   * example: 'abcdefghijklmnopqrstuvwxyz'\r\n   */\r\n  alphabet: string;\r\n  /**\r\n   * [[SpriteSheet]] to source character sprites from\r\n   */\r\n  spriteSheet: SpriteSheet;\r\n  /**\r\n   * Optionally ignore case in the supplied text;\r\n   */\r\n  caseInsensitive?: boolean;\r\n  /**\r\n   * Optionally adjust the spacing between character sprites\r\n   */\r\n  spacing?: number;\r\n  /**\r\n   * Optionally specify a \"shadow\"\r\n   */\r\n  shadow?: { offset: Vector };\r\n}\r\n\r\nexport class SpriteFont extends Graphic implements FontRenderer {\r\n  private _text: string = '';\r\n  public alphabet: string = '';\r\n  public spriteSheet: SpriteSheet;\r\n\r\n  public shadow: { offset: Vector } = null;\r\n  public caseInsensitive = false;\r\n  public spacing: number = 0;\r\n\r\n  private _logger = Logger.getInstance();\r\n\r\n  static fromLegacySpriteFont(spriteFont: LegacySpriteFont): SpriteFont {\r\n    const sprites = spriteFont.sprites.map(Sprite.fromLegacySprite);\r\n    return new SpriteFont({\r\n      alphabet: spriteFont.alphabet,\r\n      spacing: 0,\r\n      caseInsensitive: spriteFont.caseInsensitive,\r\n      spriteSheet: new SpriteSheet({\r\n        sprites\r\n      })\r\n    });\r\n  }\r\n\r\n  constructor(options: SpriteFontOptions & GraphicOptions) {\r\n    super(options);\r\n    const { alphabet, spriteSheet, caseInsensitive, spacing, shadow } = options;\r\n    this.alphabet = alphabet;\r\n    this.spriteSheet = spriteSheet;\r\n    this.caseInsensitive = caseInsensitive ?? this.caseInsensitive;\r\n    this.spacing = spacing ?? this.spacing;\r\n    this.shadow = shadow ?? this.shadow;\r\n  }\r\n\r\n  private _alreadyWarnedAlphabet = false;\r\n  private _alreadyWarnedSpriteSheet = false;\r\n  private _getCharacterSprites(text: string): Sprite[] {\r\n    const results: Sprite[] = [];\r\n    // handle case insensitive\r\n    const textToRender = this.caseInsensitive ? text.toLocaleLowerCase() : text;\r\n    const alphabet = this.caseInsensitive ? this.alphabet.toLocaleLowerCase() : this.alphabet;\r\n\r\n    // for each letter in text\r\n    for (let letterIndex = 0; letterIndex < textToRender.length; letterIndex++) {\r\n      // find the sprite index in alphabet , if there is an error pick the first\r\n      const letter = textToRender[letterIndex];\r\n      let spriteIndex = alphabet.indexOf(letter);\r\n      if (spriteIndex === -1) {\r\n        spriteIndex = 0;\r\n        if (!this._alreadyWarnedAlphabet) {\r\n          this._logger.warn(`SpriteFont - Cannot find letter '${letter}' in configured alphabet '${alphabet}'.`);\r\n          this._logger.warn('There maybe be more issues in the SpriteFont configuration. No additional warnings will be logged.');\r\n          this._alreadyWarnedAlphabet = true;\r\n        }\r\n      }\r\n\r\n      const letterSprite = this.spriteSheet.sprites[spriteIndex];\r\n      if (letterSprite) {\r\n        results.push(letterSprite);\r\n      } else {\r\n        if (!this._alreadyWarnedSpriteSheet) {\r\n          this._logger.warn(`SpriteFont - Cannot find sprite for '${letter}' at index '${spriteIndex}' in configured SpriteSheet`);\r\n          this._logger.warn('There maybe be more issues in the SpriteFont configuration. No additional warnings will be logged.');\r\n          this._alreadyWarnedSpriteSheet = true;\r\n        }\r\n      }\r\n    }\r\n    return results;\r\n  }\r\n\r\n  public measureText(text: string): BoundingBox {\r\n    const lines = text.split('\\n');\r\n    const maxWidthLine = lines.reduce((a, b) => {\r\n      return a.length > b.length ? a : b;\r\n    });\r\n    const sprites = this._getCharacterSprites(maxWidthLine);\r\n    let width = 0;\r\n    let height = 0;\r\n    for (const sprite of sprites) {\r\n      width += sprite.width + this.spacing;\r\n      height = Math.max(height, sprite.height);\r\n    }\r\n    return BoundingBox.fromDimension(width, height * lines.length, Vector.Zero);\r\n  }\r\n\r\n  protected _drawImage(ex: ExcaliburGraphicsContext, x: number, y: number): void {\r\n    let xCursor = 0;\r\n    let yCursor = 0;\r\n    let height = 0;\r\n    const lines = this._text.split('\\n');\r\n    for (const line of lines) {\r\n      for (const sprite of this._getCharacterSprites(line)) {\r\n        // draw it in the right spot and increase the cursor by sprite width\r\n        sprite.draw(ex, x + xCursor, y + yCursor);\r\n        xCursor += sprite.width + this.spacing;\r\n        height = Math.max(height, sprite.height);\r\n      }\r\n      xCursor = 0;\r\n      yCursor += height;\r\n    }\r\n  }\r\n\r\n  render(ex: ExcaliburGraphicsContext, text: string, _color: Color, x: number, y: number) {\r\n    // SpriteFont doesn't support _color, yet...\r\n    this._text = text;\r\n    const bounds = this.measureText(text);\r\n    this.width = bounds.width;\r\n    this.height = bounds.height;\r\n    if (this.shadow) {\r\n      ex.save();\r\n      ex.translate(this.shadow.offset.x, this.shadow.offset.y);\r\n      this.draw(ex, x, y);\r\n      ex.restore();\r\n    }\r\n\r\n    this.draw(ex, x, y);\r\n  }\r\n\r\n  clone(): SpriteFont {\r\n    return new SpriteFont({\r\n      alphabet: this.alphabet,\r\n      spriteSheet: this.spriteSheet,\r\n      spacing: this.spacing\r\n    });\r\n  }\r\n}\r\n","export default \"data:image/png;base64,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\"","import { ExcaliburGraphicsContext, ImageSource, SpriteFont, SpriteSheet } from '..';\r\nimport { Vector } from '../..';\r\nimport debugFont from './debug-font.png';\r\n\r\n/**\r\n * Internal debugtext helper\r\n */\r\nexport class DebugText {\r\n  constructor() {\r\n    this.load();\r\n  }\r\n\r\n  /**\r\n   * base64 font\r\n   */\r\n  public readonly fontSheet = debugFont;\r\n  public size: number = 16;\r\n  private _imageSource: ImageSource;\r\n  private _spriteSheet: SpriteSheet;\r\n  private _spriteFont: SpriteFont;\r\n  public load() {\r\n    this._imageSource = new ImageSource(this.fontSheet);\r\n    return this._imageSource.load().then(() => {\r\n      this._spriteSheet = SpriteSheet.fromImageSource({\r\n        image: this._imageSource,\r\n        grid: {\r\n          rows: 3,\r\n          columns: 16,\r\n          spriteWidth: 16,\r\n          spriteHeight: 16\r\n        }\r\n      });\r\n      this._spriteFont = new SpriteFont({\r\n        alphabet: '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ,!\\'&.\"?-()+ ',\r\n        caseInsensitive: true,\r\n        spriteSheet: this._spriteSheet,\r\n        spacing: -6\r\n      });\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Writes debug text using the built in sprint font\r\n   * @param ctx\r\n   * @param text\r\n   * @param pos\r\n   */\r\n  public write(ctx: ExcaliburGraphicsContext, text: string, pos: Vector) {\r\n    if (this._imageSource.isLoaded()) {\r\n      this._spriteFont.render(ctx, text, null, pos.x, pos.y);\r\n    }\r\n  }\r\n}\r\n","export class RenderSource {\r\n  constructor(\r\n    private _gl: WebGLRenderingContext,\r\n    private _texture: WebGLTexture) {}\r\n\r\n  public use() {\r\n    const gl = this._gl;\r\n    gl.activeTexture(gl.TEXTURE0);\r\n    gl.bindTexture(gl.TEXTURE_2D, this._texture);\r\n  }\r\n\r\n  public disable() {\r\n    const gl = this._gl;\r\n    gl.bindTexture(gl.TEXTURE_2D, null);\r\n  }\r\n}","import { RenderSource } from './render-source';\r\n\r\nexport class RenderTarget {\r\n  width: number;\r\n  height: number;\r\n  private _gl: WebGLRenderingContext;\r\n  constructor(options: {gl: WebGLRenderingContext, width: number, height: number}) {\r\n    this.width = options.width;\r\n    this.height = options.height;\r\n    this._gl = options.gl;\r\n    this._setupFramebuffer();\r\n  }\r\n\r\n  setResolution(width: number, height: number) {\r\n    const gl = this._gl;\r\n    this.width = width;\r\n    this.height = height;\r\n    gl.bindTexture(gl.TEXTURE_2D, this._frameTexture);\r\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, this.width, this.height, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\r\n  }\r\n\r\n  private _frameBuffer: WebGLFramebuffer;\r\n  public get frameBuffer() {\r\n    return this._frameBuffer;\r\n  }\r\n  private _frameTexture: WebGLTexture;\r\n  public get frameTexture() {\r\n    return this._frameTexture;\r\n  }\r\n  private _setupFramebuffer() {\r\n    // Allocates frame buffer\r\n    const gl = this._gl;\r\n    this._frameTexture = gl.createTexture();\r\n    gl.bindTexture(gl.TEXTURE_2D, this._frameTexture);\r\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, this.width, this.height, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\r\n\r\n    // set the filtering so we don't need mips\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n\r\n\r\n    // attach the texture as the first color attachment\r\n    const attachmentPoint = gl.COLOR_ATTACHMENT0;\r\n\r\n    // After this bind all draw calls will draw to this framebuffer texture\r\n    this._frameBuffer = gl.createFramebuffer();\r\n    gl.bindFramebuffer(gl.FRAMEBUFFER, this._frameBuffer);\r\n    gl.framebufferTexture2D(gl.FRAMEBUFFER, attachmentPoint, gl.TEXTURE_2D, this._frameTexture, 0);\r\n    // Reset after initialized\r\n    this.disable();\r\n  }\r\n\r\n  public toRenderSource() {\r\n    const source = new RenderSource(this._gl, this._frameTexture);\r\n    return source;\r\n  }\r\n\r\n  /**\r\n   * When called, all drawing gets redirected to this render target\r\n   */\r\n  public use() {\r\n    const gl = this._gl;\r\n    gl.bindFramebuffer(gl.FRAMEBUFFER, this._frameBuffer);\r\n    // very important to set the viewport to the size of the framebuffer texture\r\n    gl.viewport(0, 0, this.width, this.height);\r\n  }\r\n\r\n  /**\r\n   * When called, all drawing is sent back to the canvas\r\n   */\r\n  public disable() {\r\n    const gl = this._gl;\r\n    // passing null switches rendering back to the canvas\r\n    gl.bindFramebuffer(gl.FRAMEBUFFER, null);\r\n    gl.bindTexture(gl.TEXTURE_2D, null);\r\n  }\r\n}","\r\n/**\r\n * Must be accessed after Engine construction time to ensure the context has been created\r\n */\r\nexport class ExcaliburWebGLContextAccessor {\r\n  private static _GL: WebGLRenderingContext;\r\n  public static clear() {\r\n    ExcaliburWebGLContextAccessor._GL = null;\r\n  }\r\n  public static register(gl: WebGLRenderingContext) {\r\n    ExcaliburWebGLContextAccessor._GL = gl;\r\n  }\r\n  // current webgl context\r\n  public static get gl(): WebGLRenderingContext {\r\n    if (!ExcaliburWebGLContextAccessor._GL) {\r\n      throw Error('Attempted gl access before init');\r\n    }\r\n    return ExcaliburWebGLContextAccessor._GL;\r\n  }\r\n}","export default \"attribute vec2 a_position;\\r\\nattribute vec4 a_color;\\r\\n\\r\\nvarying lowp vec4 v_color;\\r\\n\\r\\nuniform mat4 u_matrix;\\r\\n\\r\\n\\r\\nvoid main() {\\r\\n   // Set the vertex position using the ortho transform matrix\\r\\n   gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);\\r\\n\\r\\n   // Passthrough the color\\r\\n   v_color = a_color;\\r\\n}\";","export default \"precision mediump float;\\r\\n\\r\\n// Color\\r\\nvarying lowp vec4 v_color;\\r\\n\\r\\n\\r\\nvoid main() {\\r\\n  gl_FragColor = v_color;\\r\\n}\";","import { Vector } from '../..';\r\nimport { Matrix } from '../../Math/matrix';\r\nimport { ExcaliburWebGLContextAccessor } from './webgl-adapter';\r\nimport { getAttributeComponentSize, getAttributePointerType } from './webgl-util';\r\n\r\nexport type UniformTypeNames =\r\n  'uniform1f' |\r\n  'uniform1i' |\r\n  'uniform2f' |\r\n  'uniform2i' |\r\n  'uniform3f' |\r\n  'uniform3i' |\r\n  'uniform4f' |\r\n  'uniform4i' |\r\n  'uniform1fv' |\r\n  'uniform1iv' |\r\n  'uniform2fv' |\r\n  'uniform2iv' |\r\n  'uniform3fv' |\r\n  'uniform3iv' |\r\n  'uniform4fv' |\r\n  'uniform4iv' |\r\n  'uniformMatrix2fv' |\r\n  'uniformMatrix3fv' |\r\n  'uniformMatrix4fv';\r\n\r\ntype RemoveFirstFromTuple<T extends any[]> =\r\n  T['length'] extends 0 ? undefined :\r\n    (((...b: T) => void) extends (a: any, ...b: infer I) => void ? I : [])\r\n\r\ntype UniformParameters<TUniformType extends UniformTypeNames> = RemoveFirstFromTuple<Parameters<WebGLRenderingContext[TUniformType]>>\r\n\r\nexport interface UniformDefinition {\r\n  name: string;\r\n  glType: number;\r\n  location: WebGLUniformLocation;\r\n}\r\n\r\n\r\nexport interface VertexAttributeDefinition {\r\n  /**\r\n   * string name of the attribute in the shader program, commonly `a_nameofmyvariable`\r\n   */\r\n  name: string;\r\n  /**\r\n   * Number of components for a given attribute\r\n   * Must be 1, 2, 3, or 4\r\n   *\r\n   * For example a vec4 attribute would be `4` floats, so 4\r\n   */\r\n  size: number;\r\n  /**\r\n   * Supported types in webgl 1\r\n   * * gl.BYTE\r\n   * * gl.SHORT\r\n   * * gl.UNSIGNED_BYTE\r\n   * * gl.UNSIGNED_SHORT\r\n   * * gl.FLOAT\r\n   * https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/vertexAttribPointer\r\n   */\r\n  glType: number;\r\n  /**\r\n   * Is the attribute normalized between (0-1)\r\n   */\r\n  normalized: boolean;\r\n  /**\r\n   * Location index in the shader program\r\n   */\r\n  location: number;\r\n}\r\n\r\nexport interface ShaderOptions {\r\n  vertexSource: string;\r\n  fragmentSource: string;\r\n}\r\n\r\nexport class Shader {\r\n  private static _ACTIVE_SHADER_INSTANCE: Shader = null;\r\n  private _gl: WebGLRenderingContext = ExcaliburWebGLContextAccessor.gl;\r\n  public program: WebGLProgram;\r\n  public uniforms: { [variableName: string]: UniformDefinition } = {};\r\n  public attributes: { [variableName: string]: VertexAttributeDefinition } = {};\r\n  private _compiled = false;\r\n  public readonly vertexSource: string;\r\n  public readonly fragmentSource: string;\r\n\r\n  public get compiled() {\r\n    return this._compiled;\r\n  }\r\n\r\n  /**\r\n   * Create a shader program in excalibur\r\n   * @param options specify shader vertex and fragment source\r\n   */\r\n  constructor(options?: ShaderOptions) {\r\n    const { vertexSource, fragmentSource } = options;\r\n    this.vertexSource = vertexSource;\r\n    this.fragmentSource = fragmentSource;\r\n  }\r\n\r\n  /**\r\n   * Binds the shader program\r\n   */\r\n  use() {\r\n    const gl = this._gl;\r\n    gl.useProgram(this.program);\r\n    Shader._ACTIVE_SHADER_INSTANCE = this;\r\n  }\r\n\r\n  isCurrentlyBound() {\r\n    return Shader._ACTIVE_SHADER_INSTANCE === this;\r\n  }\r\n\r\n  /**\r\n   * Compile the current shader against a webgl context\r\n   */\r\n  compile(): WebGLProgram {\r\n    const gl = this._gl;\r\n    const vertexShader = this._compileShader(gl, this.vertexSource, gl.VERTEX_SHADER);\r\n    const fragmentShader = this._compileShader(gl, this.fragmentSource, gl.FRAGMENT_SHADER);\r\n    this.program = this._createProgram(gl, vertexShader, fragmentShader);\r\n\r\n    const attributes = this.getAttributes();\r\n    for (const attribute of attributes) {\r\n      this.attributes[attribute.name] = attribute;\r\n    }\r\n    const uniforms = this.getUniforms();\r\n    for (const uniform of uniforms) {\r\n      this.uniforms[uniform.name] = uniform;\r\n    }\r\n\r\n    this._compiled = true;\r\n    return this.program;\r\n  }\r\n\r\n  getUniforms(): UniformDefinition[] {\r\n    const gl = this._gl;\r\n    const uniformCount = gl.getProgramParameter(this.program, gl.ACTIVE_UNIFORMS);\r\n    const uniforms: UniformDefinition[] = [];\r\n    for (let i = 0; i < uniformCount; i++) {\r\n      const uniform = gl.getActiveUniform(this.program, i);\r\n      const uniformLocation = gl.getUniformLocation(this.program, uniform.name);\r\n      uniforms.push({\r\n        name: uniform.name,\r\n        glType: uniform.type,\r\n        location: uniformLocation\r\n      });\r\n    }\r\n    return uniforms;\r\n  }\r\n\r\n  getAttributes(): VertexAttributeDefinition[] {\r\n    const gl = this._gl;\r\n    const attributeCount = gl.getProgramParameter(this.program, gl.ACTIVE_ATTRIBUTES);\r\n    const attributes: VertexAttributeDefinition[] = [];\r\n    for (let i = 0; i < attributeCount; i++) {\r\n      const attribute = gl.getActiveAttrib(this.program, i);\r\n      const attributeLocation = gl.getAttribLocation(this.program, attribute.name);\r\n      attributes.push({\r\n        name: attribute.name,\r\n        glType: getAttributePointerType(gl, attribute.type),\r\n        size: getAttributeComponentSize(gl, attribute.type),\r\n        location: attributeLocation,\r\n        normalized: false\r\n      });\r\n    }\r\n    return attributes;\r\n  }\r\n\r\n  /**\r\n   * Set a texture in a gpu texture slot\r\n   * @param slotNumber\r\n   * @param texture\r\n   */\r\n  setTexture(slotNumber: number, texture: WebGLTexture) {\r\n    const gl = this._gl;\r\n    gl.activeTexture(gl.TEXTURE0 + slotNumber);\r\n    gl.bindTexture(gl.TEXTURE_2D, texture);\r\n  }\r\n\r\n  /**\r\n   * Set an integer uniform for the current shader\r\n   *\r\n   * **Important** Must call ex.Shader.use() before setting a uniform!\r\n   *\r\n   * @param name\r\n   * @param value\r\n   */\r\n  setUniformInt(name: string, value: number) {\r\n    this.setUniform('uniform1i', name, ~~value);\r\n  }\r\n\r\n  /**\r\n   * Set an integer array uniform for the current shader\r\n   *\r\n   * **Important** Must call ex.Shader.use() before setting a uniform!\r\n   *\r\n   * @param name\r\n   * @param value\r\n   */\r\n  setUniformIntArray(name: string, value: number[]) {\r\n    this.setUniform('uniform1iv', name, value);\r\n  }\r\n\r\n  /**\r\n   * Set a boolean uniform for the current shader\r\n   *\r\n   * **Important** Must call ex.Shader.use() before setting a uniform!\r\n   *\r\n   * @param name\r\n   * @param value\r\n   */\r\n  setUniformBoolean(name: string, value: boolean) {\r\n    this.setUniform('uniform1i', name, value ? 1 : 0);\r\n  }\r\n\r\n  /**\r\n   * Set a float uniform for the current shader\r\n   *\r\n   * **Important** Must call ex.Shader.use() before setting a uniform!\r\n   *\r\n   * @param name\r\n   * @param value\r\n   */\r\n  setUniformFloat(name: string, value: number) {\r\n    this.setUniform('uniform1f', name, value);\r\n  }\r\n\r\n  /**\r\n   * Set a float array uniform for the current shader\r\n   *\r\n   * **Important** Must call ex.Shader.use() before setting a uniform!\r\n   *\r\n   * @param name\r\n   * @param value\r\n   */\r\n  setUniformFloatArray(name: string, value: number[]) {\r\n    this.setUniform('uniform1fv', name, value);\r\n  }\r\n\r\n  /**\r\n   * Set a [[Vector]] uniform for the current shader\r\n   *\r\n   * **Important** Must call ex.Shader.use() before setting a uniform!\r\n   *\r\n   * @param name\r\n   * @param value\r\n   */\r\n  setUniformFloatVector(name: string, value: Vector) {\r\n    this.setUniform('uniform2f', name, value.x, value.y);\r\n  }\r\n\r\n  /**\r\n   * Set an [[Matrix]] uniform for the current shader\r\n   *\r\n   * **Important** Must call ex.Shader.use() before setting a uniform!\r\n   *\r\n   * @param name\r\n   * @param value\r\n   */\r\n  setUniformMatrix(name: string, value: Matrix) {\r\n    this.setUniform('uniformMatrix4fv', name, false, value.data);\r\n  }\r\n\r\n  /**\r\n   * Set any available uniform type in webgl\r\n   *\r\n   * For example setUniform('uniformMatrix2fv', 'u_my2x2_mat`, ...);\r\n   */\r\n  setUniform<TUniformType extends UniformTypeNames>(uniformType: TUniformType, name: string, ...value: UniformParameters<TUniformType>) {\r\n    if (!this._compiled) {\r\n      throw Error(`Must compile shader before setting a uniform ${uniformType}:${name}`);\r\n    }\r\n    if (!this.isCurrentlyBound()) {\r\n      throw Error('Currently accessed shader instance is not the current active shader in WebGL,' +\r\n      ' must call `shader.use()` before setting uniforms');\r\n    }\r\n    const gl = this._gl;\r\n    const location = gl.getUniformLocation(this.program, name);\r\n    if (location) {\r\n      const args = [location, ...value];\r\n      this._gl[uniformType].apply(this._gl, args);\r\n    } else {\r\n      throw Error(`Uniform ${uniformType}:${name} doesn\\'t exist or is not used in the shader source code,`+\r\n      ' unused uniforms are optimized away by most browsers');\r\n    }\r\n  }\r\n\r\n  private _createProgram(gl: WebGLRenderingContext, vertexShader: WebGLShader, fragmentShader: WebGLShader): WebGLProgram {\r\n    const program = gl.createProgram();\r\n    if (program === null) {\r\n      throw Error('Could not create graphics shader program');\r\n    }\r\n\r\n    // attach the shaders.\r\n    gl.attachShader(program, vertexShader);\r\n    gl.attachShader(program, fragmentShader);\r\n\r\n    // link the program.\r\n    gl.linkProgram(program);\r\n\r\n    const success = gl.getProgramParameter(program, gl.LINK_STATUS);\r\n    if (!success) {\r\n      throw Error(`Could not link the program: [${gl.getProgramInfoLog(program)}]`);\r\n    }\r\n\r\n    return program;\r\n  }\r\n\r\n  private _compileShader(gl: WebGLRenderingContext, source: string, type: number): WebGLShader {\r\n    const typeName = gl.VERTEX_SHADER === type ? 'vertex' : 'fragment';\r\n    const shader = gl.createShader(type);\r\n    if (shader === null) {\r\n      throw Error(`Could not build shader: [${source}]`);\r\n    }\r\n\r\n    gl.shaderSource(shader, source);\r\n    gl.compileShader(shader);\r\n\r\n    const success = gl.getShaderParameter(shader, gl.COMPILE_STATUS);\r\n    if (!success) {\r\n      const errorInfo = gl.getShaderInfoLog(shader);\r\n      throw Error(`Could not compile ${typeName} shader:\\n\\n${errorInfo}${this._processSourceForError(source, errorInfo)}`);\r\n    }\r\n    return shader;\r\n  }\r\n\r\n  private _processSourceForError(source: string, errorInfo: string) {\r\n    const lines = source.split('\\n');\r\n    const errorLineStart = errorInfo.search(/\\d:\\d/);\r\n    const errorLineEnd = errorInfo.indexOf(' ', errorLineStart);\r\n    const [_, error2] = errorInfo.slice(errorLineStart, errorLineEnd).split(':').map(v => Number(v));\r\n    for (let i = 0; i < lines.length; i++) {\r\n      lines[i] = `${i+1}: ${lines[i]}${error2 === (i+1)? ' <----- ERROR!' : ''}`;\r\n    }\r\n\r\n    return '\\n\\nSource:\\n' + lines.join('\\n');\r\n  }\r\n}","import { ExcaliburWebGLContextAccessor } from './webgl-adapter';\r\n\r\nexport interface VertexBufferOptions {\r\n  /**\r\n   * Size in number of floats, so [4.2, 4.0, 2.1] is size = 3\r\n   *\r\n   * Ignored if data is passed directly\r\n   */\r\n  size?: number;\r\n  /**\r\n   * If the vertices never change switching 'static' can be more efficient on the gpu\r\n   *\r\n   * Default is 'dynamic'\r\n   */\r\n  type?: 'static' | 'dynamic';\r\n\r\n  /**\r\n   * Optionally pass pre-seeded data, size parameter is ignored\r\n   */\r\n  data?: Float32Array\r\n}\r\n\r\n/**\r\n * Helper around vertex buffer to simplify creating and uploading geometry\r\n *\r\n * Under the hood uses Float32Array\r\n */\r\nexport class VertexBuffer {\r\n  private _gl: WebGLRenderingContext = ExcaliburWebGLContextAccessor.gl;\r\n\r\n  /**\r\n   * Access to the webgl buffer handle\r\n   */\r\n  public readonly buffer: WebGLBuffer;\r\n  /**\r\n   * Access to the raw data of the vertex buffer\r\n   */\r\n  public readonly bufferData: Float32Array;\r\n\r\n  /**\r\n   * If the vertices never change switching 'static' can be more efficient on the gpu\r\n   *\r\n   * Default is 'dynamic'\r\n   */\r\n  public type: 'static' | 'dynamic' = 'dynamic';\r\n\r\n  constructor(options: VertexBufferOptions) {\r\n    const { size, type, data } = options;\r\n    this.buffer = this._gl.createBuffer();\r\n    if (!data && !size) {\r\n      throw Error('Must either provide data or a size to the VertexBuffer');\r\n    }\r\n\r\n    if (!data) {\r\n      this.bufferData = new Float32Array(size);\r\n    } else {\r\n      this.bufferData = data;\r\n    }\r\n    this.type = type ?? this.type;\r\n  }\r\n\r\n  /**\r\n   * Bind this vertex buffer\r\n   */\r\n  bind() {\r\n    const gl = this._gl;\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.buffer);\r\n  }\r\n\r\n  /**\r\n   * Upload vertex buffer geometry to the GPU\r\n   */\r\n  upload() {\r\n    const gl = this._gl;\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.buffer);\r\n    gl.bufferData(gl.ARRAY_BUFFER, this.bufferData, this.type === 'static' ? gl.STATIC_DRAW : gl.DYNAMIC_DRAW);\r\n  }\r\n}","import { Logger } from '../..';\r\nimport { Shader, VertexAttributeDefinition } from './shader';\r\nimport { VertexBuffer } from './vertex-buffer';\r\nimport { ExcaliburWebGLContextAccessor } from './webgl-adapter';\r\nimport { getGlTypeSizeBytes } from './webgl-util';\r\n\r\n\r\nexport interface VertexLayoutOptions {\r\n  /**\r\n   * Shader that this layout will be for\r\n   */\r\n  shader: Shader;\r\n  /**\r\n   * Vertex buffer to use for vertex data\r\n   */\r\n  vertexBuffer: VertexBuffer,\r\n  /**\r\n   * Specify the attributes that will exist in the vertex buffer\r\n   *\r\n   * **Important** must specify them in the order that they will be in the vertex buffer!!\r\n   */\r\n  attributes: [name: string, numberOfComponents: number][]\r\n}\r\n\r\n/**\r\n * Helper around creating vertex attributes in a given [[VertexBuffer]], this is useful for describing\r\n * the memory layout for your vertices inside a particular buffer\r\n *\r\n * Note: This helper assumes interleaved attributes in one [[VertexBuffer]], not many.\r\n *\r\n * Working with `gl.vertexAttribPointer` can be tricky, and this attempts to double check you\r\n */\r\nexport class VertexLayout {\r\n  private _gl: WebGLRenderingContext = ExcaliburWebGLContextAccessor.gl;\r\n  private _logger = Logger.getInstance();\r\n  private _shader: Shader;\r\n  private _layout: VertexAttributeDefinition[] = [];\r\n  private _attributes: [name: string, numberOfComponents: number][] = [];\r\n  private _vertexBuffer: VertexBuffer;\r\n  public get vertexBuffer() {\r\n    return this._vertexBuffer;\r\n  }\r\n\r\n  public get attributes(): readonly [name: string, numberOfComponents: number][] {\r\n    return this._attributes;\r\n  }\r\n\r\n  constructor(options: VertexLayoutOptions) {\r\n    const {shader, vertexBuffer, attributes} = options;\r\n    this._vertexBuffer = vertexBuffer;\r\n    this._attributes = attributes;\r\n    this._shader = shader;\r\n    this.initialize();\r\n  }\r\n\r\n  private _vertexTotalSizeBytes = 0;\r\n  /**\r\n   * Total number of bytes that the vertex will take up\r\n   */\r\n  public get totalVertexSizeBytes(): number {\r\n    return this._vertexTotalSizeBytes;\r\n  }\r\n\r\n  /**\r\n   * Layouts need shader locations and must be bound to a shader\r\n   */\r\n  initialize() {\r\n    if (!this._shader.compiled) {\r\n      throw Error('Shader not compiled, shader must be compiled before defining a vertex layout');\r\n    }\r\n    this._layout.length = 0;\r\n    const shaderAttributes = this._shader.attributes;\r\n    for (const attribute of this._attributes) {\r\n      const attrib = shaderAttributes[attribute[0]];\r\n      if (!attrib) {\r\n        throw Error(`The attribute named: ${attribute[0]} size ${attribute[1]}`+\r\n        ` not found in the shader source code:\\n ${this._shader.vertexSource}`);\r\n      }\r\n      if (attrib.size !== attribute[1]) {\r\n        throw Error(`VertexLayout size definition for attribute: [${attribute[0]}, ${attribute[1]}],`\r\n        +` doesnt match shader source size ${attrib.size}:\\n ${this._shader.vertexSource}`);\r\n      }\r\n      this._layout.push(attrib);\r\n    }\r\n\r\n    // calc size\r\n    let componentsPerVertex = 0;\r\n    for (const vertAttribute of this._layout) {\r\n      const typeSize = getGlTypeSizeBytes(this._gl, vertAttribute.glType);\r\n      this._vertexTotalSizeBytes += typeSize * vertAttribute.size;\r\n      componentsPerVertex += vertAttribute.size;\r\n    }\r\n\r\n    if (this._vertexBuffer.bufferData.length % componentsPerVertex !== 0) {\r\n      this._logger.warn(`The vertex component size (${componentsPerVertex})  does divide evenly into the specified vertex buffer`\r\n      +` (${this._vertexBuffer.bufferData.length})`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Bind this layout with it's associated vertex buffer\r\n   *\r\n   * @param uploadBuffer Optionally indicate you wish to upload the buffer to the GPU associated with this layout\r\n   */\r\n  use(uploadBuffer = false) {\r\n    const gl = this._gl;\r\n    if (!this._shader.isCurrentlyBound()) {\r\n      throw Error('Shader associated with this vertex layout is not active! Call shader.use() before layout.use()');\r\n    }\r\n    this._vertexBuffer.bind();\r\n    if (uploadBuffer) {\r\n      this._vertexBuffer.upload();\r\n    }\r\n    let offset = 0;\r\n    // TODO switch to VAOs if the extension is\r\n    for (const vert of this._layout) {\r\n      gl.vertexAttribPointer(vert.location, vert.size, vert.glType, vert.normalized, this.totalVertexSizeBytes, offset);\r\n      gl.enableVertexAttribArray(vert.location);\r\n      offset += getGlTypeSizeBytes(gl, vert.glType) * vert.size;\r\n    }\r\n  }\r\n}","export class GraphicsDiagnostics {\r\n  public static DrawCallCount: number = 0;\r\n  public static DrawnImagesCount: number = 0;\r\n  public static clear(): void {\r\n    GraphicsDiagnostics.DrawCallCount = 0;\r\n    GraphicsDiagnostics.DrawnImagesCount = 0;\r\n  }\r\n}\r\n","import { Vector } from '../../../Math/vector';\r\nimport { Color } from '../../../Color';\r\nimport lineVertexSource from './line-vertex.glsl';\r\nimport lineFragmentSource from './line-fragment.glsl';\r\nimport { ExcaliburGraphicsContextWebGL } from '../ExcaliburGraphicsContextWebGL';\r\nimport { RendererPlugin } from '../renderer';\r\nimport { Shader, VertexBuffer, VertexLayout } from '../..';\r\nimport { GraphicsDiagnostics } from '../../GraphicsDiagnostics';\r\n\r\nexport class LineRenderer implements RendererPlugin {\r\n  public readonly type = 'ex.line';\r\n  public priority: number = 0;\r\n  private _context: ExcaliburGraphicsContextWebGL;\r\n  private _gl: WebGLRenderingContext;\r\n  private _shader: Shader;\r\n  private _maxLines: number = 10922;\r\n  private _vertexBuffer: VertexBuffer;\r\n  private _layout: VertexLayout;\r\n  private _vertexIndex = 0;\r\n  private _lineCount = 0;\r\n  initialize(gl: WebGLRenderingContext, context: ExcaliburGraphicsContextWebGL): void {\r\n    this._gl = gl;\r\n    this._context = context;\r\n    this._shader = new Shader({\r\n      vertexSource: lineVertexSource,\r\n      fragmentSource: lineFragmentSource\r\n    });\r\n    this._shader.compile();\r\n    this._shader.use();\r\n\r\n    this._shader.setUniformMatrix('u_matrix', this._context.ortho);\r\n\r\n    this._vertexBuffer = new VertexBuffer({\r\n      size: 6 * 2 * this._maxLines,\r\n      type: 'dynamic'\r\n    });\r\n\r\n    this._layout = new VertexLayout({\r\n      vertexBuffer: this._vertexBuffer,\r\n      shader: this._shader,\r\n      attributes: [\r\n        ['a_position', 2],\r\n        ['a_color', 4]\r\n      ]\r\n    });\r\n  }\r\n\r\n  draw(start: Vector, end: Vector, color: Color): void {\r\n    // Force a render if the batch is full\r\n    if (this._isFull()) {\r\n      this.flush();\r\n    }\r\n\r\n    this._lineCount++;\r\n\r\n    const transform = this._context.getTransform();\r\n    const finalStart = transform.multv(start);\r\n    const finalEnd = transform.multv(end);\r\n\r\n\r\n    const vertexBuffer = this._vertexBuffer.bufferData;\r\n    // Start\r\n    vertexBuffer[this._vertexIndex++] = finalStart.x;\r\n    vertexBuffer[this._vertexIndex++] = finalStart.y;\r\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.a;\r\n\r\n    // End\r\n    vertexBuffer[this._vertexIndex++] = finalEnd.x;\r\n    vertexBuffer[this._vertexIndex++] = finalEnd.y;\r\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.a;\r\n  }\r\n\r\n  private _isFull() {\r\n    if (this._lineCount >= this._maxLines) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  hasPendingDraws(): boolean {\r\n    return this._lineCount !== 0;\r\n  }\r\n\r\n  flush(): void {\r\n    // nothing to draw early exit\r\n    if (this._lineCount === 0) {\r\n      return;\r\n    }\r\n\r\n    const gl = this._gl;\r\n    this._shader.use();\r\n    this._layout.use(true);\r\n\r\n    this._shader.setUniformMatrix('u_matrix', this._context.ortho);\r\n\r\n    gl.drawArrays(gl.LINES, 0, this._lineCount * 2); // 2 verts per line\r\n\r\n    GraphicsDiagnostics.DrawnImagesCount += this._lineCount;\r\n    GraphicsDiagnostics.DrawCallCount++;\r\n\r\n    // reset\r\n    this._vertexIndex = 0;\r\n    this._lineCount = 0;\r\n  }\r\n}\r\n","export default \"attribute vec2 a_position;\\r\\nattribute vec4 a_color;\\r\\nattribute float a_size;\\r\\nvarying lowp vec4 v_color;\\r\\nuniform mat4 u_matrix;\\r\\n\\r\\nvoid main() {\\r\\n  gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);\\r\\n  gl_PointSize = a_size * 2.0;\\r\\n  v_color = a_color;\\r\\n}\";","import pointVertexSource from './point-vertex.glsl';\r\nimport pointFragmentSource from './point-fragment.glsl';\r\nimport { Vector } from '../../../Math/vector';\r\nimport { Color } from '../../../Color';\r\nimport { ExcaliburGraphicsContextWebGL } from '../ExcaliburGraphicsContextWebGL';\r\nimport { RendererPlugin } from '../renderer';\r\nimport { Shader } from '../shader';\r\nimport { VertexBuffer } from '../vertex-buffer';\r\nimport { VertexLayout } from '../vertex-layout';\r\nimport { GraphicsDiagnostics } from '../../GraphicsDiagnostics';\r\n\r\nexport class PointRenderer implements RendererPlugin {\r\n  public readonly type = 'ex.point';\r\n  public priority: number = 0;\r\n  private _shader: Shader;\r\n  private _maxPoints: number = 10922;\r\n  private _buffer: VertexBuffer;\r\n  private _layout: VertexLayout;\r\n  private _gl: WebGLRenderingContext;\r\n  private _context: ExcaliburGraphicsContextWebGL;\r\n  private _pointCount: number = 0;\r\n  private _vertexIndex: number = 0;\r\n  initialize(gl: WebGLRenderingContext, context: ExcaliburGraphicsContextWebGL): void {\r\n    this._gl = gl;\r\n    this._context = context;\r\n    this._shader = new Shader({\r\n      vertexSource: pointVertexSource,\r\n      fragmentSource: pointFragmentSource\r\n    });\r\n    this._shader.compile();\r\n    this._shader.use();\r\n    this._shader.setUniformMatrix('u_matrix', this._context.ortho);\r\n    this._buffer = new VertexBuffer({\r\n      size: 7 * this._maxPoints,\r\n      type: 'dynamic'\r\n    });\r\n\r\n    this._layout = new VertexLayout({\r\n      shader: this._shader,\r\n      vertexBuffer: this._buffer,\r\n      attributes: [\r\n        ['a_position', 2],\r\n        ['a_color', 4],\r\n        ['a_size', 1]\r\n      ]\r\n    });\r\n  }\r\n\r\n  draw(point: Vector, color: Color, size: number): void {\r\n    // Force a render if the batch is full\r\n    if (this._isFull()) {\r\n      this.flush();\r\n    }\r\n\r\n    this._pointCount++;\r\n\r\n    const transform = this._context.getTransform();\r\n    const opacity = this._context.opacity;\r\n\r\n    const finalPoint = transform.multv(point);\r\n\r\n    const vertexBuffer = this._buffer.bufferData;\r\n    vertexBuffer[this._vertexIndex++] = finalPoint.x;\r\n    vertexBuffer[this._vertexIndex++] = finalPoint.y;\r\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.a * opacity;\r\n    vertexBuffer[this._vertexIndex++] = size * Math.max(transform.getScaleX(), transform.getScaleY());\r\n  }\r\n\r\n  private _isFull() {\r\n    if (this._pointCount >= this._maxPoints) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  hasPendingDraws(): boolean {\r\n    return this._pointCount !== 0;\r\n  }\r\n\r\n  flush(): void {\r\n    // nothing to draw early exit\r\n    if (this._pointCount === 0) {\r\n      return;\r\n    }\r\n\r\n    const gl = this._gl;\r\n    this._shader.use();\r\n    this._layout.use(true);\r\n\r\n    this._shader.setUniformMatrix('u_matrix', this._context.ortho);\r\n\r\n    gl.drawArrays(gl.POINTS, 0, this._pointCount);\r\n\r\n    GraphicsDiagnostics.DrawnImagesCount += this._pointCount;\r\n    GraphicsDiagnostics.DrawCallCount++;\r\n\r\n    this._pointCount = 0;\r\n    this._vertexIndex = 0;\r\n  }\r\n}\r\n","export default \"attribute vec2 a_position;\\r\\n\\r\\nattribute vec2 a_texcoord;\\r\\nvarying vec2 v_texcoord;\\r\\n\\r\\nvoid main() {\\r\\n  gl_Position = vec4(a_position, 0.0, 1.0);\\r\\n\\r\\n  // Pass the texcoord to the fragment shader.\\r\\n  v_texcoord = a_texcoord;\\r\\n}\";","\r\nimport screenVertex from './screen-vertex.glsl';\r\nimport screenFragment from './screen-fragment.glsl';\r\nimport { Shader } from '../shader';\r\nimport { VertexBuffer } from '../vertex-buffer';\r\nimport { VertexLayout } from '../vertex-layout';\r\nimport { PostProcessor } from '../../PostProcessor/PostProcessor';\r\n\r\n/**\r\n * This is responsible for painting the entire screen during the render passes\r\n */\r\nexport class ScreenPassPainter {\r\n  private _gl: WebGLRenderingContext;\r\n  private _shader: Shader;\r\n  private _buffer: VertexBuffer;\r\n  private _layout: VertexLayout;\r\n  constructor(gl: WebGLRenderingContext) {\r\n    this._gl = gl;\r\n    this._shader = new Shader({\r\n      vertexSource: screenVertex,\r\n      fragmentSource: screenFragment\r\n    });\r\n    this._shader.compile();\r\n    // Setup memory layout\r\n    this._buffer = new VertexBuffer({\r\n      type: 'static',\r\n      // clip space quad + uv since we don't need a camera\r\n      data: new Float32Array([\r\n        -1, -1,          0, 0,\r\n        -1, 1,           0, 1,\r\n        1, -1,           1, 0,\r\n\r\n        1, -1,            1, 0,\r\n        -1, 1,           0, 1,\r\n        1, 1,            1, 1\r\n      ])\r\n    });\r\n    this._layout = new VertexLayout({\r\n      shader: this._shader,\r\n      vertexBuffer: this._buffer,\r\n      attributes: [\r\n        ['a_position', 2],\r\n        ['a_texcoord', 2]\r\n      ]\r\n    });\r\n    this._buffer.upload();\r\n  }\r\n\r\n  renderWithPostProcessor(postprocessor: PostProcessor): void {\r\n    const gl = this._gl;\r\n    postprocessor.getShader().use();\r\n    postprocessor.getLayout().use();\r\n    gl.drawArrays(gl.TRIANGLES, 0, 6);\r\n  }\r\n\r\n  renderToScreen(): void {\r\n    const gl = this._gl;\r\n    this._shader.use();\r\n    this._layout.use();\r\n    gl.drawArrays(gl.TRIANGLES, 0, 6);\r\n  }\r\n}","import { Logger } from '../..';\r\nimport { ExcaliburWebGLContextAccessor } from './webgl-adapter';\r\n\r\n/**\r\n * Helper that defines and index buffer for quad geometry\r\n *\r\n * Index buffers allow you to save space in vertex buffers when you share vertices in geometry\r\n * it is almost always worth it in terms of performance to use an index buffer.\r\n */\r\nexport class QuadIndexBuffer {\r\n  private _gl: WebGLRenderingContext = ExcaliburWebGLContextAccessor.gl;\r\n  private _logger: Logger = Logger.getInstance();\r\n  /**\r\n   * Access to the webgl buffer handle\r\n   */\r\n  public buffer: WebGLBuffer;\r\n  /**\r\n   * Access to the raw data of the index buffer\r\n   */\r\n  public bufferData: Uint16Array | Uint32Array;\r\n  /**\r\n   * Depending on the browser this is either gl.UNSIGNED_SHORT or gl.UNSIGNED_INT\r\n   */\r\n  public bufferGlType: number;\r\n\r\n  /**\r\n   * @param numberOfQuads Specify the max number of quads you want to draw\r\n   * @param useUint16 Optionally force a uint16 buffer\r\n   */\r\n  constructor(numberOfQuads: number, useUint16?: boolean) {\r\n    const gl = this._gl;\r\n    this.buffer = gl.createBuffer();\r\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.buffer);\r\n\r\n    const totalVertices = numberOfQuads * 6;\r\n\r\n    const ext = gl.getExtension('OES_element_index_uint');\r\n    if (ext && !useUint16) {\r\n      this.bufferData = new Uint32Array(totalVertices);\r\n    } else {\r\n      // fall back to using gl.UNSIGNED_SHORT or tell the user they are out of luck\r\n      const maxUint16 = 65_535;\r\n      const maxUint16Index = Math.floor((maxUint16 - 1) / 4); // max quads\r\n\r\n      this.bufferGlType = gl.UNSIGNED_SHORT;\r\n      this.bufferData = new Uint16Array(totalVertices);\r\n      // TODO Should we error if this happens?? maybe not might crash mid game\r\n      if (numberOfQuads > maxUint16Index) {\r\n        this._logger.warn(\r\n          `Total quads exceeds hardware index buffer limit (uint16), max(${maxUint16Index}) requested quads(${numberOfQuads})`);\r\n      }\r\n    }\r\n\r\n\r\n    let currentQuad = 0;\r\n    for (let i = 0; i < totalVertices; i += 6) {\r\n      // first triangle\r\n      this.bufferData[i + 0] = currentQuad + 0;\r\n      this.bufferData[i + 1] = currentQuad + 1;\r\n      this.bufferData[i + 2] = currentQuad + 2;\r\n      // second triangle\r\n      this.bufferData[i + 3] = currentQuad + 2;\r\n      this.bufferData[i + 4] = currentQuad + 1;\r\n      this.bufferData[i + 5] = currentQuad + 3;\r\n      currentQuad += 4;\r\n    }\r\n    gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, this.bufferData, gl.STATIC_DRAW);\r\n  }\r\n\r\n  public get size() {\r\n    return this.bufferData.length;\r\n  }\r\n\r\n  /**\r\n   * Upload data to the GPU\r\n   */\r\n  public upload() {\r\n    const gl = this._gl;\r\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.buffer);\r\n    gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, this.bufferData, gl.STATIC_DRAW);\r\n  }\r\n\r\n  /**\r\n   * Bind this index buffer\r\n   */\r\n  public bind() {\r\n    const gl = this._gl;\r\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.buffer);\r\n  }\r\n}","export default \"precision mediump float;\\r\\n\\r\\n// UV coord\\r\\nvarying vec2 v_texcoord;\\r\\n\\r\\n// Texture index\\r\\nvarying lowp float v_textureIndex;\\r\\n\\r\\n// Textures in the current draw\\r\\nuniform sampler2D u_textures[%%count%%];\\r\\n\\r\\n// Opacity\\r\\nvarying float v_opacity;\\r\\n\\r\\nvoid main() {\\r\\n   // In order to support the most efficient sprite batching, we have multiple\\r\\n   // textures loaded into the gpu (usually 8) this picker logic skips over textures\\r\\n   // that do not apply to a particular sprite.\\r\\n\\r\\n   vec4 color = vec4(1.0, 0, 0, 1.0);\\r\\n\\r\\n   // GLSL is templated out to pick the right texture and set the vec4 color\\r\\n   %%texture_picker%%\\r\\n\\r\\n   color.rgb = color.rgb * v_opacity;\\r\\n   color.a = color.a * v_opacity;\\r\\n   gl_FragColor = color;\\r\\n}\";","export default \"attribute vec2 a_position;\\r\\n\\r\\n// Opacity \\r\\nattribute float a_opacity;\\r\\nvarying float v_opacity;\\r\\n\\r\\n// UV coordinate\\r\\nattribute vec2 a_texcoord;\\r\\nvarying vec2 v_texcoord;\\r\\n\\r\\n// Texture number\\r\\nattribute lowp float a_textureIndex;\\r\\nvarying lowp float v_textureIndex;\\r\\n\\r\\nuniform mat4 u_matrix;\\r\\n\\r\\n\\r\\nvoid main() {\\r\\n   // Set the vertex position using the ortho transform matrix\\r\\n   gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);\\r\\n\\r\\n   // Pass through the Opacity to the fragment shader\\r\\n   v_opacity = a_opacity;\\r\\n   // Pass through the UV coord to the fragment shader\\r\\n   v_texcoord = a_texcoord;\\r\\n   // Pass through the texture number to the fragment shader\\r\\n   v_textureIndex = a_textureIndex;\\r\\n}\";","import { GraphicsDiagnostics } from '../../GraphicsDiagnostics';\r\nimport { HTMLImageSource } from '../ExcaliburGraphicsContext';\r\nimport { ExcaliburGraphicsContextWebGL } from '../ExcaliburGraphicsContextWebGL';\r\nimport { QuadIndexBuffer } from '../quad-index-buffer';\r\nimport { RendererPlugin } from '../renderer';\r\nimport { Shader } from '../shader';\r\nimport { TextureLoader } from '../texture-loader';\r\nimport { VertexBuffer } from '../vertex-buffer';\r\nimport { VertexLayout } from '../vertex-layout';\r\nimport { ensurePowerOfTwo } from '../webgl-util';\r\nimport frag from './image-renderer.frag.glsl';\r\nimport vert from './image-renderer.vert.glsl';\r\n\r\nexport class ImageRenderer implements RendererPlugin {\r\n  public readonly type = 'ex.image';\r\n  public priority: number = 0;\r\n\r\n  private _maxImages: number = 10922; // max(uint16) / 6 verts\r\n  private _maxTextures: number = 0;\r\n\r\n  private _context: ExcaliburGraphicsContextWebGL;\r\n  private _gl: WebGLRenderingContext;\r\n  private _shader: Shader;\r\n  private _buffer: VertexBuffer;\r\n  private _layout: VertexLayout;\r\n  private _quads: QuadIndexBuffer;\r\n\r\n  // Per flush vars\r\n  private _imageCount: number = 0;\r\n  private _textures: WebGLTexture[] = [];\r\n  private _vertexIndex: number = 0;\r\n\r\n  initialize(gl: WebGLRenderingContext, context: ExcaliburGraphicsContextWebGL): void {\r\n    this._gl = gl;\r\n    this._context = context;\r\n    // Transform shader source\r\n    // FIXME: PIXEL 6 complains `ERROR: Expression too complex.` if we use it's reported max texture units, 125 seems to work for now...\r\n    this._maxTextures = Math.min(gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS), 125);\r\n    const transformedFrag = this._transformFragmentSource(frag, this._maxTextures);\r\n    // Compile shader\r\n    this._shader = new Shader({\r\n      fragmentSource: transformedFrag,\r\n      vertexSource: vert\r\n    });\r\n    this._shader.compile();\r\n\r\n    // setup uniforms\r\n    this._shader.use();\r\n    this._shader.setUniformMatrix('u_matrix', context.ortho);\r\n    // Initialize texture slots to [0, 1, 2, 3, 4, .... maxGPUTextures]\r\n    this._shader.setUniformIntArray(\r\n      'u_textures',\r\n      [...Array(this._maxTextures)].map((_, i) => i)\r\n    );\r\n\r\n    // Setup memory layout\r\n    this._buffer = new VertexBuffer({\r\n      size: 6 * 4 * this._maxImages, // 6 components * 4 verts\r\n      type: 'dynamic'\r\n    });\r\n    this._layout = new VertexLayout({\r\n      shader: this._shader,\r\n      vertexBuffer: this._buffer,\r\n      attributes: [\r\n        ['a_position', 2],\r\n        ['a_opacity', 1],\r\n        ['a_texcoord', 2],\r\n        ['a_textureIndex', 1]\r\n      ]\r\n    });\r\n\r\n    // Setup index buffer\r\n    this._quads = new QuadIndexBuffer(this._maxImages, true);\r\n  }\r\n\r\n  private _transformFragmentSource(source: string, maxTextures: number): string {\r\n    let newSource = source.replace('%%count%%', maxTextures.toString());\r\n    let texturePickerBuilder = '';\r\n    for (let i = 0; i < maxTextures; i++) {\r\n      if (i === 0) {\r\n        texturePickerBuilder += `if (v_textureIndex <= ${i}.5) {\\n`;\r\n      } else {\r\n        texturePickerBuilder += `   else if (v_textureIndex <= ${i}.5) {\\n`;\r\n      }\r\n      texturePickerBuilder += `      color = texture2D(u_textures[${i}], v_texcoord);\\n`;\r\n      texturePickerBuilder += `   }\\n`;\r\n    }\r\n    newSource = newSource.replace('%%texture_picker%%', texturePickerBuilder);\r\n    return newSource;\r\n  }\r\n\r\n  private _addImageAsTexture(image: HTMLImageSource) {\r\n    const texture = TextureLoader.load(image);\r\n    if (this._textures.indexOf(texture) === -1) {\r\n      this._textures.push(texture);\r\n    }\r\n  }\r\n\r\n  private _bindTextures(gl: WebGLRenderingContext) {\r\n    // Bind textures in the correct order\r\n    for (let i = 0; i < this._maxTextures; i++) {\r\n      gl.activeTexture(gl.TEXTURE0 + i);\r\n      gl.bindTexture(gl.TEXTURE_2D, this._textures[i] || this._textures[0]);\r\n    }\r\n  }\r\n\r\n  private _getTextureIdForImage(image: HTMLImageSource) {\r\n    if (image) {\r\n      return this._textures.indexOf(TextureLoader.get(image));\r\n    }\r\n    return -1;\r\n  }\r\n\r\n  private _isFull() {\r\n    if (this._imageCount >= this._maxImages) {\r\n      return true;\r\n    }\r\n    if (this._textures.length >= this._maxTextures) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n\r\n  draw(image: HTMLImageSource,\r\n    sx: number,\r\n    sy: number,\r\n    swidth?: number,\r\n    sheight?: number,\r\n    dx?: number,\r\n    dy?: number,\r\n    dwidth?: number,\r\n    dheight?: number): void {\r\n\r\n    // Force a render if the batch is full\r\n    if (this._isFull()) {\r\n      this.flush();\r\n    }\r\n\r\n    this._imageCount++;\r\n    this._addImageAsTexture(image);\r\n\r\n    let width = image?.width || swidth || 0;\r\n    let height = image?.height || sheight || 0;\r\n    let view = [0, 0, swidth ?? image?.width ?? 0, sheight ?? image?.height ?? 0];\r\n    let dest = [sx ?? 1, sy ?? 1];\r\n    // If destination is specified, update view and dest\r\n    if (dx !== undefined && dy !== undefined && dwidth !== undefined && dheight !== undefined) {\r\n      view = [sx ?? 1, sy ?? 1, swidth ?? image?.width ?? 0, sheight ?? image?.height ?? 0];\r\n      dest = [dx, dy];\r\n      width = dwidth;\r\n      height = dheight;\r\n    }\r\n\r\n    sx = view[0];\r\n    sy = view[1];\r\n    const sw = view[2];\r\n    const sh = view[3];\r\n\r\n    // transform based on current context\r\n    const transform = this._context.getTransform();\r\n    const opacity = this._context.opacity;\r\n    const snapToPixel = this._context.snapToPixel;\r\n\r\n    const topleft = transform.multv([dest[0], dest[1]]);\r\n    const topRight = transform.multv([dest[0] + width, dest[1]]);\r\n    const bottomLeft = transform.multv([dest[0], dest[1] + height]);\r\n    const bottomRight = transform.multv([dest[0] + width, dest[1] + height]);\r\n\r\n    if (snapToPixel) {\r\n      topleft[0] = ~~topleft[0];\r\n      topleft[1] = ~~topleft[1];\r\n\r\n      topRight[0] = ~~topRight[0];\r\n      topRight[1] = ~~topRight[1];\r\n\r\n      bottomLeft[0] = ~~bottomLeft[0];\r\n      bottomLeft[1] = ~~bottomLeft[1];\r\n\r\n      bottomRight[0] = ~~bottomRight[0];\r\n      bottomRight[1] = ~~bottomRight[1];\r\n    }\r\n\r\n    const textureId = this._getTextureIdForImage(image);\r\n    const potWidth = ensurePowerOfTwo(image.width || width);\r\n    const potHeight = ensurePowerOfTwo(image.height || height);\r\n\r\n    const uvx0 = (sx) / potWidth;\r\n    const uvy0 = (sy) / potHeight;\r\n    const uvx1 = (sx + sw - 0.01) / potWidth;\r\n    const uvy1 = (sy + sh - 0.01) / potHeight;\r\n\r\n    // update data\r\n    const vertexBuffer = this._layout.vertexBuffer.bufferData;\r\n\r\n    // (0, 0) - 0\r\n    vertexBuffer[this._vertexIndex++] = topleft[0];\r\n    vertexBuffer[this._vertexIndex++] = topleft[1];\r\n    vertexBuffer[this._vertexIndex++] = opacity;\r\n    vertexBuffer[this._vertexIndex++] = uvx0;\r\n    vertexBuffer[this._vertexIndex++] = uvy0;\r\n    vertexBuffer[this._vertexIndex++] = textureId;\r\n\r\n    // (0, 1) - 1\r\n    vertexBuffer[this._vertexIndex++] = bottomLeft[0];\r\n    vertexBuffer[this._vertexIndex++] = bottomLeft[1];\r\n    vertexBuffer[this._vertexIndex++] = opacity;\r\n    vertexBuffer[this._vertexIndex++] = uvx0;\r\n    vertexBuffer[this._vertexIndex++] = uvy1;\r\n    vertexBuffer[this._vertexIndex++] = textureId;\r\n\r\n    // (1, 0) - 2\r\n    vertexBuffer[this._vertexIndex++] = topRight[0];\r\n    vertexBuffer[this._vertexIndex++] = topRight[1];\r\n    vertexBuffer[this._vertexIndex++] = opacity;\r\n    vertexBuffer[this._vertexIndex++] = uvx1;\r\n    vertexBuffer[this._vertexIndex++] = uvy0;\r\n    vertexBuffer[this._vertexIndex++] = textureId;\r\n\r\n    // (1, 1) - 3\r\n    vertexBuffer[this._vertexIndex++] = bottomRight[0];\r\n    vertexBuffer[this._vertexIndex++] = bottomRight[1];\r\n    vertexBuffer[this._vertexIndex++] = opacity;\r\n    vertexBuffer[this._vertexIndex++] = uvx1;\r\n    vertexBuffer[this._vertexIndex++] = uvy1;\r\n    vertexBuffer[this._vertexIndex++] = textureId;\r\n  }\r\n\r\n  hasPendingDraws(): boolean {\r\n    return this._imageCount !== 0;\r\n  }\r\n\r\n  flush(): void {\r\n    // nothing to draw early exit\r\n    if (this._imageCount === 0) {\r\n      return;\r\n    }\r\n\r\n    const gl = this._gl;\r\n    // Bind the shader\r\n    this._shader.use();\r\n\r\n    // Bind the memory layout and upload data\r\n    this._layout.use(true);\r\n\r\n    // Update ortho matrix uniform\r\n    this._shader.setUniformMatrix('u_matrix', this._context.ortho);\r\n\r\n    // Bind textures to\r\n    this._bindTextures(gl);\r\n\r\n    // Bind index buffer\r\n    this._quads.bind();\r\n\r\n    // Draw all the quads\r\n    gl.drawElements(gl.TRIANGLES, this._imageCount * 6, this._quads.bufferGlType, 0);\r\n\r\n    GraphicsDiagnostics.DrawnImagesCount += this._imageCount;\r\n    GraphicsDiagnostics.DrawCallCount++;\r\n\r\n    // Reset\r\n    this._imageCount = 0;\r\n    this._vertexIndex = 0;\r\n    this._textures.length = 0;\r\n  }\r\n}","export default \"#ifdef GL_OES_standard_derivatives\\r\\n#extension GL_OES_standard_derivatives : enable\\r\\n#endif\\r\\nprecision mediump float;\\r\\n\\r\\n// UV coord\\r\\nvarying vec2 v_uv;\\r\\n\\r\\nvarying vec2 v_size; // in pixels\\r\\n\\r\\n// Color coord to blend with image\\r\\nvarying lowp vec4 v_color;\\r\\n\\r\\n// Stroke color if used\\r\\nvarying lowp vec4 v_strokeColor;\\r\\n\\r\\n// Stroke thickness if used\\r\\nvarying lowp float v_strokeThickness; // in pixels\\r\\n\\r\\n// Opacity\\r\\nvarying float v_opacity;\\r\\n\\r\\nvoid main() {\\r\\n    // modified from https://stackoverflow.com/questions/59197671/glsl-rounded-rectangle-with-variable-border\\r\\n    vec2 uv = v_uv;\\r\\n    vec2 fragCoord = uv * v_size;\\r\\n    float maxX = v_size.x - v_strokeThickness;\\r\\n    float minX = v_strokeThickness;\\r\\n    float maxY = v_size.y - v_strokeThickness;\\r\\n    float minY = v_strokeThickness;\\r\\n\\r\\n    if (fragCoord.x < maxX && fragCoord.x > minX &&\\r\\n        fragCoord.y < maxY && fragCoord.y > minY) {\\r\\n      gl_FragColor = v_color;\\r\\n    } else {\\r\\n      gl_FragColor = v_strokeColor;\\r\\n    }\\r\\n    gl_FragColor.a *= v_opacity;\\r\\n    gl_FragColor.rgb *= gl_FragColor.a;\\r\\n\\r\\n    // vec2 v2CenteredPos     = abs(fragCoord - v_size.xy / 2.0);\\r\\n    // vec2 v2HalfShapeSizePx = v_size.xy/2.0 - v_strokeThickness/2.0;\\r\\n\\r\\n    // float fHalfBorderDist      = 0.0;\\r\\n    // float fHalfBorderThickness = 0.0;\\r\\n\\r\\n    // if (fragCoord.x > max(v_radius, v_strokeThickness) && \\r\\n    //     fragCoord.x < v_size.x - max(v_radius, v_strokeThickness))\\r\\n    // {\\r\\n    //     fHalfBorderDist      = v2CenteredPos.y - v2HalfShapeSizePx.y;\\r\\n    //     fHalfBorderThickness = v_strokeThickness / 2.0;\\r\\n    // }\\r\\n    // else if (fragCoord.y > max(v_radius, v_strokeThickness) && \\r\\n    //          fragCoord.y < v_size.y - max(v_radius, v_strokeThickness))\\r\\n    // {\\r\\n    //     fHalfBorderDist      = v2CenteredPos.x - v2HalfShapeSizePx.x;\\r\\n    //     fHalfBorderThickness = v_strokeThickness / 2.0;\\r\\n    // }\\r\\n    // else\\r\\n    // {\\r\\n    //     vec2 edgeVec = max(vec2(0.0), v_radius - vec2(\\r\\n    //         uv.x > 0.5 ? v_size.x - fragCoord.x : fragCoord.x,\\r\\n    //         uv.y > 0.5 ? v_size.y - fragCoord.y : fragCoord.y));\\r\\n        \\r\\n    //     float ellipse_ab    = v_radius-v_strokeThickness;\\r\\n    //     vec2 ellipse_isect = (v_strokeThickness > v_radius || v_strokeThickness > v_radius) ? vec2(0.0) :\\r\\n    //                             edgeVec.xy * ellipse_ab*ellipse_ab / length(ellipse_ab*edgeVec.yx); \\r\\n            \\r\\n    //     fHalfBorderThickness = (v_radius - length(ellipse_isect)) / 2.0;\\r\\n    //     fHalfBorderDist      = length(edgeVec) - (v_radius - fHalfBorderThickness);\\r\\n    // }\\r\\n\\r\\n    // vec4 v4FromColor = v_strokeColor;\\r\\n    // v4FromColor.rgb *= v4FromColor.a;\\r\\n    // vec4 v4ToColor   = vec4(0.0); // background color is transparent\\r\\n    // if (fHalfBorderDist < 0.0) {\\r\\n    //     v4ToColor = v_color;\\r\\n    //     v4ToColor.rgb *= v4ToColor.a;\\r\\n    // }\\r\\n\\r\\n    // float mixPct = abs(fHalfBorderDist) - fHalfBorderThickness;\\r\\n\\r\\n    // vec4 finalColor = mix(v4FromColor, v4ToColor, mixPct);\\r\\n    // gl_FragColor = finalColor;\\r\\n}\";","import { Color } from '../../../Color';\r\nimport { vec, Vector } from '../../../Math/vector';\r\nimport { GraphicsDiagnostics } from '../../GraphicsDiagnostics';\r\nimport { ExcaliburGraphicsContextWebGL } from '../ExcaliburGraphicsContextWebGL';\r\nimport { QuadIndexBuffer } from '../quad-index-buffer';\r\nimport { RendererPlugin } from '../renderer';\r\nimport { Shader } from '../shader';\r\nimport { VertexBuffer } from '../vertex-buffer';\r\nimport { VertexLayout } from '../vertex-layout';\r\n\r\nimport frag from './rectangle-renderer.frag.glsl';\r\nimport vert from './rectangle-renderer.vert.glsl';\r\n\r\nexport class RectangleRenderer implements RendererPlugin {\r\n  public readonly type = 'ex.rectangle';\r\n  public priority: number = 0;\r\n\r\n  private _maxRectangles: number = 10922; // max(uint16) / 6 verts\r\n\r\n  private _shader: Shader;\r\n  private _gl: WebGLRenderingContext;\r\n  private _context: ExcaliburGraphicsContextWebGL;\r\n  private _buffer: VertexBuffer;\r\n  private _layout: VertexLayout;\r\n  private _quads: QuadIndexBuffer;\r\n  private _rectangleCount: number = 0;\r\n  private _vertexIndex: number = 0;\r\n\r\n\r\n  initialize(gl: WebGLRenderingContext, context: ExcaliburGraphicsContextWebGL): void {\r\n    this._gl = gl;\r\n    this._context = context;\r\n    gl.getExtension('OES_standard_derivatives');\r\n    // https://stackoverflow.com/questions/59197671/glsl-rounded-rectangle-with-variable-border\r\n    this._shader = new Shader({\r\n      fragmentSource: frag,\r\n      vertexSource: vert\r\n    });\r\n    this._shader.compile();\r\n\r\n    // setup uniforms\r\n    this._shader.use();\r\n    this._shader.setUniformMatrix('u_matrix', context.ortho);\r\n\r\n    this._buffer = new VertexBuffer({\r\n      size: 16 * 4 * this._maxRectangles,\r\n      type: 'dynamic'\r\n    });\r\n\r\n    this._layout = new VertexLayout({\r\n      shader: this._shader,\r\n      vertexBuffer: this._buffer,\r\n      attributes: [\r\n        ['a_position', 2],\r\n        ['a_uv', 2],\r\n        ['a_size', 2],\r\n        ['a_opacity', 1],\r\n        ['a_color', 4],\r\n        ['a_strokeColor', 4],\r\n        ['a_strokeThickness', 1]\r\n      ]\r\n    });\r\n    this._quads = new QuadIndexBuffer(this._maxRectangles, true);\r\n  }\r\n\r\n  private _isFull() {\r\n    if (this._rectangleCount >= this._maxRectangles) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  drawLine(start: Vector, end: Vector, color: Color, thickness: number = 1) {\r\n\r\n    if (this._isFull()) {\r\n      this.flush();\r\n    }\r\n    this._rectangleCount++;\r\n\r\n    // transform based on current context\r\n    const transform = this._context.getTransform();\r\n    const opacity = this._context.opacity;\r\n\r\n    const dir = end.sub(start);\r\n    const length = dir.size;\r\n    const normal = dir.normalize().perpendicular();\r\n    const halfThick = thickness / 2;\r\n\r\n    /**\r\n     *    +---------------------^----------------------+\r\n     *    |                     | (normal)             |\r\n     *   (startx, starty)------------------>(endx, endy)\r\n     *    |                                            |\r\n     *    + -------------------------------------------+\r\n     */\r\n    const startTop = transform.multv(normal.scale(halfThick).add(start));\r\n    const startBottom = transform.multv(normal.scale(-halfThick).add(start));\r\n    const endTop = transform.multv(normal.scale(halfThick).add(end));\r\n    const endBottom = transform.multv(normal.scale(-halfThick).add(end));\r\n\r\n    // TODO uv could be static vertex buffer\r\n    const uvx0 = 0;\r\n    const uvy0 = 0;\r\n    const uvx1 = 1;\r\n    const uvy1 = 1;\r\n\r\n    const stroke = Color.Transparent;\r\n    const strokeThickness = 0;\r\n    const width = 1;\r\n\r\n    // update data\r\n    const vertexBuffer = this._layout.vertexBuffer.bufferData;\r\n\r\n    // (0, 0) - 0\r\n    vertexBuffer[this._vertexIndex++] = startTop.x;\r\n    vertexBuffer[this._vertexIndex++] = startTop.y;\r\n    vertexBuffer[this._vertexIndex++] = uvx0;\r\n    vertexBuffer[this._vertexIndex++] = uvy0;\r\n    vertexBuffer[this._vertexIndex++] = length;\r\n    vertexBuffer[this._vertexIndex++] = thickness;\r\n    vertexBuffer[this._vertexIndex++] = opacity;\r\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.a;\r\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.a;\r\n    vertexBuffer[this._vertexIndex++] = strokeThickness / width;\r\n\r\n    // (0, 1) - 1\r\n    vertexBuffer[this._vertexIndex++] = startBottom.x;\r\n    vertexBuffer[this._vertexIndex++] = startBottom.y;\r\n    vertexBuffer[this._vertexIndex++] = uvx0;\r\n    vertexBuffer[this._vertexIndex++] = uvy1;\r\n    vertexBuffer[this._vertexIndex++] = length;\r\n    vertexBuffer[this._vertexIndex++] = thickness;\r\n    vertexBuffer[this._vertexIndex++] = opacity;\r\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.a;\r\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.a;\r\n    vertexBuffer[this._vertexIndex++] = strokeThickness / width;\r\n\r\n    // (1, 0) - 2\r\n    vertexBuffer[this._vertexIndex++] = endTop.x;\r\n    vertexBuffer[this._vertexIndex++] = endTop.y;\r\n    vertexBuffer[this._vertexIndex++] = uvx1;\r\n    vertexBuffer[this._vertexIndex++] = uvy0;\r\n    vertexBuffer[this._vertexIndex++] = length;\r\n    vertexBuffer[this._vertexIndex++] = thickness;\r\n    vertexBuffer[this._vertexIndex++] = opacity;\r\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.a;\r\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.a;\r\n    vertexBuffer[this._vertexIndex++] = strokeThickness / width;\r\n\r\n    // (1, 1) - 3\r\n    vertexBuffer[this._vertexIndex++] = endBottom.x;\r\n    vertexBuffer[this._vertexIndex++] = endBottom.y;\r\n    vertexBuffer[this._vertexIndex++] = uvx1;\r\n    vertexBuffer[this._vertexIndex++] = uvy1;\r\n    vertexBuffer[this._vertexIndex++] = length;\r\n    vertexBuffer[this._vertexIndex++] = thickness;\r\n    vertexBuffer[this._vertexIndex++] = opacity;\r\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.a;\r\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.a;\r\n    vertexBuffer[this._vertexIndex++] = strokeThickness / width;\r\n  }\r\n\r\n  draw(pos: Vector, width: number, height: number, color: Color, stroke: Color = Color.Transparent, strokeThickness: number = 0): void {\r\n    if (this._isFull()) {\r\n      this.flush();\r\n    }\r\n    this._rectangleCount++;\r\n\r\n    // transform based on current context\r\n    const transform = this._context.getTransform();\r\n    const opacity = this._context.opacity;\r\n\r\n    const topLeft = transform.multv(pos.add(vec(0, 0)));\r\n    const topRight = transform.multv(pos.add(vec(width, 0)));\r\n    const bottomRight = transform.multv(pos.add(vec(width, height)));\r\n    const bottomLeft = transform.multv(pos.add(vec(0, height)));\r\n\r\n    // TODO uv could be static vertex buffer\r\n    const uvx0 = 0;\r\n    const uvy0 = 0;\r\n    const uvx1 = 1;\r\n    const uvy1 = 1;\r\n\r\n    // update data\r\n    const vertexBuffer = this._layout.vertexBuffer.bufferData;\r\n\r\n    // (0, 0) - 0\r\n    vertexBuffer[this._vertexIndex++] = topLeft.x;\r\n    vertexBuffer[this._vertexIndex++] = topLeft.y;\r\n    vertexBuffer[this._vertexIndex++] = uvx0;\r\n    vertexBuffer[this._vertexIndex++] = uvy0;\r\n    vertexBuffer[this._vertexIndex++] = width;\r\n    vertexBuffer[this._vertexIndex++] = height;\r\n    vertexBuffer[this._vertexIndex++] = opacity;\r\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.a;\r\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.a;\r\n    vertexBuffer[this._vertexIndex++] = strokeThickness;\r\n\r\n    // (0, 1) - 1\r\n    vertexBuffer[this._vertexIndex++] = bottomLeft.x;\r\n    vertexBuffer[this._vertexIndex++] = bottomLeft.y;\r\n    vertexBuffer[this._vertexIndex++] = uvx0;\r\n    vertexBuffer[this._vertexIndex++] = uvy1;\r\n    vertexBuffer[this._vertexIndex++] = width;\r\n    vertexBuffer[this._vertexIndex++] = height;\r\n    vertexBuffer[this._vertexIndex++] = opacity;\r\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.a;\r\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.a;\r\n    vertexBuffer[this._vertexIndex++] = strokeThickness;\r\n\r\n    // (1, 0) - 2\r\n    vertexBuffer[this._vertexIndex++] = topRight.x;\r\n    vertexBuffer[this._vertexIndex++] = topRight.y;\r\n    vertexBuffer[this._vertexIndex++] = uvx1;\r\n    vertexBuffer[this._vertexIndex++] = uvy0;\r\n    vertexBuffer[this._vertexIndex++] = width;\r\n    vertexBuffer[this._vertexIndex++] = height;\r\n    vertexBuffer[this._vertexIndex++] = opacity;\r\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.a;\r\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.a;\r\n    vertexBuffer[this._vertexIndex++] = strokeThickness;\r\n\r\n    // (1, 1) - 3\r\n    vertexBuffer[this._vertexIndex++] = bottomRight.x;\r\n    vertexBuffer[this._vertexIndex++] = bottomRight.y;\r\n    vertexBuffer[this._vertexIndex++] = uvx1;\r\n    vertexBuffer[this._vertexIndex++] = uvy1;\r\n    vertexBuffer[this._vertexIndex++] = width;\r\n    vertexBuffer[this._vertexIndex++] = height;\r\n    vertexBuffer[this._vertexIndex++] = opacity;\r\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.a;\r\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.a;\r\n    vertexBuffer[this._vertexIndex++] = strokeThickness;\r\n\r\n  }\r\n\r\n  hasPendingDraws(): boolean {\r\n    return this._rectangleCount !== 0;\r\n  }\r\n\r\n  flush(): void {\r\n    // nothing to draw early exit\r\n    if (this._rectangleCount === 0) {\r\n      return;\r\n    }\r\n\r\n    const gl = this._gl;\r\n    // Bind the shader\r\n    this._shader.use();\r\n\r\n    // Bind the memory layout and upload data\r\n    this._layout.use(true);\r\n\r\n    // Update ortho matrix uniform\r\n    this._shader.setUniformMatrix('u_matrix', this._context.ortho);\r\n\r\n    // Bind index buffer\r\n    this._quads.bind();\r\n\r\n    // Draw all the quads\r\n    gl.drawElements(gl.TRIANGLES, this._rectangleCount * 6, this._quads.bufferGlType, 0);\r\n\r\n    GraphicsDiagnostics.DrawnImagesCount += this._rectangleCount;\r\n    GraphicsDiagnostics.DrawCallCount++;\r\n\r\n    // Reset\r\n    this._rectangleCount = 0;\r\n    this._vertexIndex = 0;\r\n  }\r\n\r\n}","export default \"attribute vec2 a_position;\\r\\n\\r\\n// UV coordinate\\r\\nattribute vec2 a_uv;\\r\\nvarying vec2 v_uv;\\r\\n\\r\\n// Opacity \\r\\nattribute float a_opacity;\\r\\nvarying float v_opacity;\\r\\n\\r\\nattribute vec4 a_color;\\r\\nvarying vec4 v_color;\\r\\n\\r\\nattribute vec4 a_strokeColor;\\r\\nvarying vec4 v_strokeColor;\\r\\n\\r\\nattribute float a_strokeThickness;\\r\\nvarying float v_strokeThickness;\\r\\n\\r\\nuniform mat4 u_matrix;\\r\\n\\r\\n\\r\\nvoid main() {\\r\\n   // Set the vertex position using the ortho transform matrix\\r\\n   gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);\\r\\n\\r\\n   // Pass through UV coords\\r\\n   v_uv = a_uv;\\r\\n   // Pass through the Opacity to the fragment shader\\r\\n   v_opacity = a_opacity;\\r\\n   // Pass through the color to the fragment shader\\r\\n   v_color = a_color;\\r\\n   // Pass through the stroke color to the fragment shader\\r\\n   v_strokeColor = a_strokeColor;\\r\\n   // Pass through the stroke thickenss to the fragment shader\\r\\n   v_strokeThickness = a_strokeThickness;\\r\\n}\";","import { Color } from '../../../Color';\r\nimport { vec, Vector } from '../../../Math/vector';\r\nimport { GraphicsDiagnostics } from '../../GraphicsDiagnostics';\r\nimport { ExcaliburGraphicsContextWebGL } from '../ExcaliburGraphicsContextWebGL';\r\nimport { QuadIndexBuffer } from '../quad-index-buffer';\r\nimport { RendererPlugin } from '../renderer';\r\nimport { Shader } from '../shader';\r\nimport { VertexBuffer } from '../vertex-buffer';\r\nimport { VertexLayout } from '../vertex-layout';\r\n\r\nimport frag from './circle-renderer.frag.glsl';\r\nimport vert from './circle-renderer.vert.glsl';\r\n\r\nexport class CircleRenderer implements RendererPlugin {\r\n  public readonly type = 'ex.circle';\r\n  public priority: number = 0;\r\n\r\n  private _maxCircles: number = 10922; // max(uint16) / 6 verts\r\n\r\n  private _shader: Shader;\r\n  private _context: ExcaliburGraphicsContextWebGL;\r\n  private _gl: WebGLRenderingContext;\r\n  private _buffer: VertexBuffer;\r\n  private _layout: VertexLayout;\r\n  private _quads: QuadIndexBuffer;\r\n\r\n  private _circleCount: number = 0;\r\n  private _vertexIndex: number = 0;\r\n\r\n  initialize(gl: WebGLRenderingContext, context: ExcaliburGraphicsContextWebGL): void {\r\n    this._gl = gl;\r\n    this._context = context;\r\n    gl.getExtension('OES_standard_derivatives');\r\n    this._shader = new Shader({\r\n      fragmentSource: frag,\r\n      vertexSource: vert\r\n    });\r\n    this._shader.compile();\r\n\r\n    // setup uniforms\r\n    this._shader.use();\r\n    this._shader.setUniformMatrix('u_matrix', context.ortho);\r\n\r\n    this._buffer = new VertexBuffer({\r\n      size: 14 * 4 * this._maxCircles,\r\n      type: 'dynamic'\r\n    });\r\n\r\n    this._layout = new VertexLayout({\r\n      shader: this._shader,\r\n      vertexBuffer: this._buffer,\r\n      attributes: [\r\n        ['a_position', 2],\r\n        ['a_uv', 2],\r\n        ['a_opacity', 1],\r\n        ['a_color', 4],\r\n        ['a_strokeColor', 4],\r\n        ['a_strokeThickness', 1]\r\n      ]\r\n    });\r\n\r\n    this._quads = new QuadIndexBuffer(this._maxCircles, true);\r\n  }\r\n\r\n  private _isFull() {\r\n    if (this._circleCount >= this._maxCircles) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  draw(pos: Vector, radius: number, color: Color, stroke: Color = Color.Transparent, strokeThickness: number = 0): void {\r\n    if (this._isFull()) {\r\n      this.flush();\r\n    }\r\n    this._circleCount++;\r\n\r\n    // transform based on current context\r\n    const transform = this._context.getTransform();\r\n    const opacity = this._context.opacity;\r\n\r\n    const topLeft = transform.multv(pos.add(vec(-radius, -radius)));\r\n    const topRight = transform.multv(pos.add(vec(radius, -radius)));\r\n    const bottomRight = transform.multv(pos.add(vec(radius, radius)));\r\n    const bottomLeft = transform.multv(pos.add(vec(-radius, radius)));\r\n\r\n    // TODO UV could be static vertex buffer\r\n    const uvx0 = 0;\r\n    const uvy0 = 0;\r\n    const uvx1 = 1;\r\n    const uvy1 = 1;\r\n\r\n    // update data\r\n    const vertexBuffer = this._layout.vertexBuffer.bufferData;\r\n\r\n    // (0, 0) - 0\r\n    vertexBuffer[this._vertexIndex++] = topLeft.x;\r\n    vertexBuffer[this._vertexIndex++] = topLeft.y;\r\n    vertexBuffer[this._vertexIndex++] = uvx0;\r\n    vertexBuffer[this._vertexIndex++] = uvy0;\r\n    vertexBuffer[this._vertexIndex++] = opacity;\r\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.a;\r\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.a;\r\n    vertexBuffer[this._vertexIndex++] = strokeThickness / radius;\r\n\r\n    // (0, 1) - 1\r\n    vertexBuffer[this._vertexIndex++] = bottomLeft.x;\r\n    vertexBuffer[this._vertexIndex++] = bottomLeft.y;\r\n    vertexBuffer[this._vertexIndex++] = uvx0;\r\n    vertexBuffer[this._vertexIndex++] = uvy1;\r\n    vertexBuffer[this._vertexIndex++] = opacity;\r\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.a;\r\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.a;\r\n    vertexBuffer[this._vertexIndex++] = strokeThickness / radius;\r\n\r\n    // (1, 0) - 2\r\n    vertexBuffer[this._vertexIndex++] = topRight.x;\r\n    vertexBuffer[this._vertexIndex++] = topRight.y;\r\n    vertexBuffer[this._vertexIndex++] = uvx1;\r\n    vertexBuffer[this._vertexIndex++] = uvy0;\r\n    vertexBuffer[this._vertexIndex++] = opacity;\r\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.a;\r\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.a;\r\n    vertexBuffer[this._vertexIndex++] = strokeThickness / radius;\r\n\r\n    // (1, 1) - 3\r\n    vertexBuffer[this._vertexIndex++] = bottomRight.x;\r\n    vertexBuffer[this._vertexIndex++] = bottomRight.y;\r\n    vertexBuffer[this._vertexIndex++] = uvx1;\r\n    vertexBuffer[this._vertexIndex++] = uvy1;\r\n    vertexBuffer[this._vertexIndex++] = opacity;\r\n    vertexBuffer[this._vertexIndex++] = color.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = color.a;\r\n    vertexBuffer[this._vertexIndex++] = stroke.r / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.g / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.b / 255;\r\n    vertexBuffer[this._vertexIndex++] = stroke.a;\r\n    vertexBuffer[this._vertexIndex++] = strokeThickness / radius;\r\n  }\r\n\r\n  hasPendingDraws(): boolean {\r\n    return this._circleCount !== 0;\r\n  }\r\n\r\n  flush(): void {\r\n    // nothing to draw early exit\r\n    if (this._circleCount === 0) {\r\n      return;\r\n    }\r\n\r\n    const gl = this._gl;\r\n    // Bind the shader\r\n    this._shader.use();\r\n\r\n    // Bind the memory layout and upload data\r\n    this._layout.use(true);\r\n\r\n    // Update ortho matrix uniform\r\n    this._shader.setUniformMatrix('u_matrix', this._context.ortho);\r\n\r\n    // Bind index buffer\r\n    this._quads.bind();\r\n\r\n    // Draw all the quads\r\n    gl.drawElements(gl.TRIANGLES, this._circleCount * 6, this._quads.bufferGlType, 0);\r\n\r\n    GraphicsDiagnostics.DrawnImagesCount += this._circleCount;\r\n    GraphicsDiagnostics.DrawCallCount++;\r\n\r\n    // Reset\r\n    this._circleCount = 0;\r\n    this._vertexIndex = 0;\r\n  }\r\n\r\n}","import {\r\n  ExcaliburGraphicsContext,\r\n  LineGraphicsOptions,\r\n  RectGraphicsOptions,\r\n  PointGraphicsOptions,\r\n  ExcaliburGraphicsContextOptions,\r\n  DebugDraw,\r\n  HTMLImageSource\r\n} from './ExcaliburGraphicsContext';\r\n\r\nimport { Matrix } from '../../Math/matrix';\r\nimport { TransformStack } from './transform-stack';\r\nimport { Vector, vec } from '../../Math/vector';\r\nimport { Color } from '../../Color';\r\nimport { StateStack } from './state-stack';\r\nimport { Logger } from '../../Util/Log';\r\nimport { Canvas } from '../Canvas';\r\nimport { DebugText } from './debug-text';\r\nimport { ScreenDimension } from '../../Screen';\r\nimport { RenderTarget } from './render-target';\r\nimport { PostProcessor } from '../PostProcessor/PostProcessor';\r\nimport { ExcaliburWebGLContextAccessor } from './webgl-adapter';\r\nimport { TextureLoader } from './texture-loader';\r\nimport { RendererPlugin } from './renderer';\r\n\r\n// renderers\r\nimport { LineRenderer } from './line-renderer/line-renderer';\r\nimport { PointRenderer } from './point-renderer/point-renderer';\r\nimport { ScreenPassPainter } from './screen-pass-painter/screen-pass-painter';\r\nimport { ImageRenderer } from './image-renderer/image-renderer';\r\nimport { RectangleRenderer } from './rectangle-renderer/rectangle-renderer';\r\nimport { CircleRenderer } from './circle-renderer/circle-renderer';\r\n\r\nclass ExcaliburGraphicsContextWebGLDebug implements DebugDraw {\r\n  private _debugText = new DebugText();\r\n  constructor(private _webglCtx: ExcaliburGraphicsContextWebGL) {}\r\n\r\n  /**\r\n   * Draw a debugging rectangle to the context\r\n   * @param x\r\n   * @param y\r\n   * @param width\r\n   * @param height\r\n   */\r\n  drawRect(x: number, y: number, width: number, height: number, rectOptions: RectGraphicsOptions = { color: Color.Black }): void {\r\n    this.drawLine(vec(x, y), vec(x + width, y), { ...rectOptions });\r\n    this.drawLine(vec(x + width, y), vec(x + width, y + height), { ...rectOptions });\r\n    this.drawLine(vec(x + width, y + height), vec(x, y + height), { ...rectOptions });\r\n    this.drawLine(vec(x, y + height), vec(x, y), { ...rectOptions });\r\n  }\r\n\r\n  /**\r\n   * Draw a debugging line to the context\r\n   * @param start\r\n   * @param end\r\n   * @param lineOptions\r\n   */\r\n  drawLine(start: Vector, end: Vector, lineOptions: LineGraphicsOptions = { color: Color.Black }): void {\r\n    this._webglCtx.draw<LineRenderer>('ex.line', start, end, lineOptions.color);\r\n  }\r\n\r\n  /**\r\n   * Draw a debugging point to the context\r\n   * @param point\r\n   * @param pointOptions\r\n   */\r\n  drawPoint(point: Vector, pointOptions: PointGraphicsOptions = { color: Color.Black, size: 5 }): void {\r\n    this._webglCtx.draw<PointRenderer>('ex.point', point, pointOptions.color, pointOptions.size);\r\n  }\r\n\r\n  drawText(text: string, pos: Vector) {\r\n    this._debugText.write(this._webglCtx, text, pos);\r\n  }\r\n}\r\n\r\nexport interface WebGLGraphicsContextInfo {\r\n  transform: TransformStack;\r\n  state: StateStack;\r\n  ortho: Matrix;\r\n  context: ExcaliburGraphicsContextWebGL;\r\n}\r\n\r\nexport class ExcaliburGraphicsContextWebGL implements ExcaliburGraphicsContext {\r\n  private _logger = Logger.getInstance();\r\n  private _renderers: Map<string, RendererPlugin> = new Map<string, RendererPlugin>();\r\n  private _isDrawLifecycle = false;\r\n\r\n  // Main render target\r\n  private _renderTarget: RenderTarget;\r\n\r\n  // Postprocessing is a tuple with 2 render targets, these are flip-flopped during the postprocessing process\r\n  private _postProcessTargets: RenderTarget[] = [];\r\n\r\n  private _screenRenderer: ScreenPassPainter;\r\n\r\n  private _postprocessors: PostProcessor[] = [];\r\n  /**\r\n   * Meant for internal use only. Access the internal context at your own risk and no guarantees this will exist in the future.\r\n   * @internal\r\n   */\r\n  public __gl: WebGLRenderingContext;\r\n\r\n  /**\r\n   * Holds the 2d context shim\r\n   */\r\n  private _canvas: Canvas; // Configure z for shim?\r\n  /**\r\n   * Meant for internal use only. Access the internal context at your own risk and no guarantees this will exist in the future.\r\n   * @internal\r\n   */\r\n  public __ctx: CanvasRenderingContext2D;\r\n\r\n  private _transform = new TransformStack();\r\n  private _state = new StateStack();\r\n  private _ortho!: Matrix;\r\n\r\n  /**\r\n   * Meant for internal use only. Access the internal context at your own risk and no guarantees this will exist in the future.\r\n   * @internal\r\n   */\r\n  public __lineRenderer: LineRenderer;\r\n\r\n  /**\r\n   * Meant for internal use only. Access the internal context at your own risk and no guarantees this will exist in the future.\r\n   * @internal\r\n   */\r\n  // public __imageRenderer: ImageRenderer;\r\n\r\n  public snapToPixel: boolean = true;\r\n\r\n  public smoothing: boolean = false;\r\n\r\n  public backgroundColor: Color = Color.ExcaliburBlue;\r\n\r\n  public get opacity(): number {\r\n    return this._state.current.opacity;\r\n  }\r\n\r\n  public set opacity(value: number) {\r\n    this._state.current.opacity = value;\r\n  }\r\n\r\n  public get width() {\r\n    return this.__gl.canvas.width;\r\n  }\r\n\r\n  public get height() {\r\n    return this.__gl.canvas.height;\r\n  }\r\n\r\n  public get ortho(): Matrix {\r\n    return this._ortho;\r\n  }\r\n\r\n  /**\r\n   * Checks the underlying webgl implementation if the requested internal resolution is supported\r\n   * @param dim\r\n   */\r\n  public checkIfResolutionSupported(dim: ScreenDimension): boolean {\r\n    // Slight hack based on this thread https://groups.google.com/g/webgl-dev-list/c/AHONvz3oQTo\r\n    let supported = true;\r\n    if (dim.width > 4096 || dim.height > 4096) {\r\n      supported = false;\r\n    }\r\n    return supported;\r\n  }\r\n\r\n  constructor(options: ExcaliburGraphicsContextOptions) {\r\n    const { canvasElement, enableTransparency, smoothing, snapToPixel, backgroundColor } = options;\r\n    this.__gl = canvasElement.getContext('webgl', {\r\n      antialias: smoothing ?? this.smoothing,\r\n      premultipliedAlpha: false,\r\n      alpha: enableTransparency ?? true,\r\n      depth: true,\r\n      powerPreference: 'high-performance'\r\n    });\r\n    ExcaliburWebGLContextAccessor.register(this.__gl);\r\n    TextureLoader.register(this.__gl);\r\n    this.snapToPixel = snapToPixel ?? this.snapToPixel;\r\n    this.smoothing = smoothing ?? this.smoothing;\r\n    this.backgroundColor = backgroundColor ?? this.backgroundColor;\r\n    this._init();\r\n  }\r\n\r\n  private _init() {\r\n    const gl = this.__gl;\r\n    // Setup viewport and view matrix\r\n    this._ortho = Matrix.ortho(0, gl.canvas.width, gl.canvas.height, 0, 400, -400);\r\n    gl.viewport(0, 0, gl.canvas.width, gl.canvas.height);\r\n\r\n    // Clear background\r\n    gl.clearColor(this.backgroundColor.r / 255, this.backgroundColor.g / 255, this.backgroundColor.b / 255, this.backgroundColor.a);\r\n    gl.clear(gl.COLOR_BUFFER_BIT);\r\n\r\n    // Enable alpha blending\r\n    // https://www.realtimerendering.com/blog/gpus-prefer-premultiplication/\r\n    gl.enable(gl.BLEND);\r\n    gl.blendEquation(gl.FUNC_ADD);\r\n    gl.blendFunc(gl.ONE, gl.ONE_MINUS_SRC_ALPHA);\r\n    gl.blendEquationSeparate(gl.FUNC_ADD, gl.FUNC_ADD);\r\n    gl.blendFuncSeparate(gl.ONE, gl.ONE_MINUS_SRC_ALPHA, gl.ONE, gl.ONE_MINUS_SRC_ALPHA);\r\n\r\n    // Setup builtin renderers\r\n    this.register(new ImageRenderer());\r\n    this.register(new RectangleRenderer());\r\n    this.register(new CircleRenderer());\r\n    this.register(new PointRenderer());\r\n    this.register(new LineRenderer());\r\n\r\n    this._screenRenderer = new ScreenPassPainter(gl);\r\n\r\n    this._renderTarget = new RenderTarget({\r\n      gl,\r\n      width: gl.canvas.width,\r\n      height: gl.canvas.height\r\n    });\r\n\r\n\r\n    this._postProcessTargets = [\r\n      new RenderTarget({\r\n        gl,\r\n        width: gl.canvas.width,\r\n        height: gl.canvas.height\r\n      }),\r\n      new RenderTarget({\r\n        gl,\r\n        width: gl.canvas.width,\r\n        height: gl.canvas.height\r\n      })\r\n    ];\r\n\r\n    // 2D ctx shim\r\n    this._canvas = new Canvas({\r\n      width: gl.canvas.width,\r\n      height: gl.canvas.height\r\n    });\r\n    this.__ctx = this._canvas.ctx;\r\n  }\r\n\r\n  public register<T extends RendererPlugin>(renderer: T) {\r\n    this._renderers.set(renderer.type, renderer);\r\n    renderer.initialize(this.__gl, this);\r\n  }\r\n\r\n  public get(rendererName: string): RendererPlugin {\r\n    return this._renderers.get(rendererName);\r\n  }\r\n\r\n  private _currentRenderer: RendererPlugin;\r\n\r\n  private _isCurrentRenderer(renderer: RendererPlugin): boolean {\r\n    if (!this._currentRenderer || this._currentRenderer === renderer) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  public beginDrawLifecycle() {\r\n    this._isDrawLifecycle = true;\r\n  }\r\n\r\n  public endDrawLifecycle() {\r\n    this._isDrawLifecycle = false;\r\n  }\r\n\r\n  private _alreadyWarnedDrawLifecycle = false;\r\n\r\n  public draw<TRenderer extends RendererPlugin>(rendererName: TRenderer['type'], ...args: Parameters<TRenderer['draw']>) {\r\n    if (!this._isDrawLifecycle && !this._alreadyWarnedDrawLifecycle) {\r\n      this._logger.warn(\r\n        `Attempting to draw outside the the drawing lifecycle (preDraw/postDraw) is not supported and is a source of bugs/errors.\\n` +\r\n        `If you want to do custom drawing, use Actor.graphics, or any onPreDraw or onPostDraw handler.`);\r\n      this._alreadyWarnedDrawLifecycle = true;\r\n    }\r\n    // TODO does not handle priority yet...\r\n    //  in order to do this draw commands need to be captured and fed in priority order\r\n    const renderer = this._renderers.get(rendererName);\r\n    if (renderer) {\r\n      // Set the current renderer if not defined\r\n      if (!this._currentRenderer) {\r\n        this._currentRenderer = renderer;\r\n      }\r\n\r\n      if (!this._isCurrentRenderer(renderer)) {\r\n        // switching graphics means we must flush the previous\r\n        this._currentRenderer.flush();\r\n      }\r\n\r\n      // If we are still using the same renderer we can add to the current batch\r\n      renderer.draw(...args);\r\n\r\n      this._currentRenderer = renderer;\r\n    } else {\r\n      throw Error(`No renderer with name ${rendererName} has been registered`);\r\n    }\r\n  }\r\n\r\n  public resetTransform(): void {\r\n    this._transform.current = Matrix.identity();\r\n  }\r\n\r\n  public updateViewport(resolution: ScreenDimension): void {\r\n    const gl = this.__gl;\r\n    this._ortho = this._ortho = Matrix.ortho(0, resolution.width, resolution.height, 0, 400, -400);\r\n\r\n    this._renderTarget.setResolution(gl.canvas.width, gl.canvas.height);\r\n    this._postProcessTargets[0].setResolution(gl.canvas.width, gl.canvas.height);\r\n    this._postProcessTargets[1].setResolution(gl.canvas.width, gl.canvas.height);\r\n\r\n    // 2D ctx shim\r\n    this._canvas.width = gl.canvas.width;\r\n    this._canvas.height = gl.canvas.height;\r\n  }\r\n\r\n  drawImage(image: HTMLImageSource, x: number, y: number): void;\r\n  drawImage(image: HTMLImageSource, x: number, y: number, width: number, height: number): void;\r\n  drawImage(\r\n    image: HTMLImageSource,\r\n    sx: number,\r\n    sy: number,\r\n    swidth?: number,\r\n    sheight?: number,\r\n    dx?: number,\r\n    dy?: number,\r\n    dwidth?: number,\r\n    dheight?: number\r\n  ): void;\r\n  drawImage(\r\n    image: HTMLImageSource,\r\n    sx: number,\r\n    sy: number,\r\n    swidth?: number,\r\n    sheight?: number,\r\n    dx?: number,\r\n    dy?: number,\r\n    dwidth?: number,\r\n    dheight?: number\r\n  ): void {\r\n    if (swidth === 0 || sheight === 0) {\r\n      return; // zero dimension dest exit early\r\n    } else if (dwidth === 0 || dheight === 0) {\r\n      return; // zero dimension dest exit early\r\n    } else if (image.width === 0 || image.height === 0) {\r\n      return; // zero dimension source exit early\r\n    }\r\n\r\n    if (!image) {\r\n      Logger.getInstance().warn('Cannot draw a null or undefined image');\r\n      // tslint:disable-next-line: no-console\r\n      if (console.trace) {\r\n        // tslint:disable-next-line: no-console\r\n        console.trace();\r\n      }\r\n      return;\r\n    }\r\n    this.draw<ImageRenderer>('ex.image', image, sx, sy, swidth, sheight, dx, dy, dwidth, dheight);\r\n  }\r\n\r\n  public drawLine(start: Vector, end: Vector, color: Color, thickness = 1) {\r\n    const rectangleRenderer = this._renderers.get('ex.rectangle') as RectangleRenderer;\r\n    rectangleRenderer.drawLine(start, end, color, thickness);\r\n  }\r\n\r\n  public drawRectangle(pos: Vector, width: number, height: number, color: Color, stroke?: Color, strokeThickness?: number) {\r\n    this.draw<RectangleRenderer>('ex.rectangle', pos, width, height, color, stroke, strokeThickness);\r\n  }\r\n\r\n  public drawCircle(pos: Vector, radius: number, color: Color, stroke?: Color, thickness?: number) {\r\n    this.draw<CircleRenderer>('ex.circle', pos, radius, color, stroke, thickness);\r\n  }\r\n\r\n  debug = new ExcaliburGraphicsContextWebGLDebug(this);\r\n\r\n  public save(): void {\r\n    this._transform.save();\r\n    this._state.save();\r\n  }\r\n\r\n  public restore(): void {\r\n    this._transform.restore();\r\n    this._state.restore();\r\n  }\r\n\r\n  public translate(x: number, y: number): void {\r\n    this._transform.translate(this.snapToPixel ? ~~x : x, this.snapToPixel ? ~~y : y);\r\n  }\r\n\r\n  public rotate(angle: number): void {\r\n    this._transform.rotate(angle);\r\n  }\r\n\r\n  public scale(x: number, y: number): void {\r\n    this._transform.scale(x, y);\r\n  }\r\n\r\n  public transform(matrix: Matrix) {\r\n    this._transform.current = matrix;\r\n  }\r\n\r\n  public getTransform(): Matrix {\r\n    return this._transform.current;\r\n  }\r\n\r\n  public multiply(m: Matrix) {\r\n    this._transform.current = this._transform.current.multm(m);\r\n  }\r\n\r\n  public addPostProcessor(postprocessor: PostProcessor) {\r\n    this._postprocessors.push(postprocessor);\r\n    postprocessor.initialize(this.__gl);\r\n  }\r\n\r\n  public removePostProcessor(postprocessor: PostProcessor) {\r\n    const index = this._postprocessors.indexOf(postprocessor);\r\n    if (index !== -1) {\r\n      this._postprocessors.splice(index, 1);\r\n    }\r\n  }\r\n\r\n  public clearPostProcessors() {\r\n    this._postprocessors.length = 0;\r\n  }\r\n\r\n  clear() {\r\n    const gl = this.__gl;\r\n    this._renderTarget.use();\r\n    gl.clearColor(this.backgroundColor.r / 255, this.backgroundColor.g / 255, this.backgroundColor.b / 255, this.backgroundColor.a);\r\n    // Clear the context with the newly set color. This is\r\n    // the function call that actually does the drawing.\r\n    gl.clear(gl.COLOR_BUFFER_BIT);\r\n  }\r\n\r\n  /**\r\n   * Flushes all batched rendering to the screen\r\n   */\r\n  flush() {\r\n    const gl = this.__gl;\r\n\r\n    // render target captures all draws and redirects to the render target\r\n    this._renderTarget.use();\r\n    // This is the final flush at the moment to draw any leftover pending draw\r\n    // TODO sort by priority and flush in order\r\n    for (const renderer of this._renderers.values()) {\r\n      if (renderer.hasPendingDraws()) {\r\n        renderer.flush();\r\n      }\r\n    }\r\n    this._renderTarget.disable();\r\n\r\n    // post process step\r\n    const source = this._renderTarget.toRenderSource();\r\n    source.use();\r\n\r\n    // flip flop render targets\r\n    for (let i = 0; i < this._postprocessors.length; i++) {\r\n      this._postProcessTargets[i % 2].use();\r\n      this._screenRenderer.renderWithPostProcessor(this._postprocessors[i]);\r\n      this._postProcessTargets[i % 2].toRenderSource().use();\r\n    }\r\n\r\n    // passing null switches rendering back to the canvas\r\n    gl.bindFramebuffer(gl.FRAMEBUFFER, null);\r\n    this._screenRenderer.renderToScreen();\r\n  }\r\n}\r\n","import { Vector, vec } from './Math/vector';\r\nimport { Logger } from './Util/Log';\r\nimport { Camera } from './Camera';\r\nimport { BrowserEvents } from './Util/Browser';\r\nimport { BoundingBox } from './Collision/Index';\r\nimport { ExcaliburGraphicsContext } from './Graphics/Context/ExcaliburGraphicsContext';\r\nimport { getPosition } from './Util/Util';\r\nimport { ExcaliburGraphicsContextWebGL } from './Graphics/Context/ExcaliburGraphicsContextWebGL';\r\n\r\n/**\r\n * Enum representing the different display modes available to Excalibur.\r\n */\r\nexport enum DisplayMode {\r\n  /**\r\n   * Default, use a specified resolution for the game. Like 800x600 pixels for example.\r\n   */\r\n  Fixed = 'Fixed',\r\n\r\n  /**\r\n   * Fit to screen using as much space as possible while maintaining aspect ratio and resolution.\r\n   * This is not the same as [[Screen.goFullScreen]] but behaves in a similar way maintaining aspect ratio.\r\n   *\r\n   * You may want to center your game here is an example\r\n   * ```html\r\n   * <!-- html -->\r\n   * <body>\r\n   * <main>\r\n   *   <canvas id=\"game\"></canvas>\r\n   * </main>\r\n   * </body>\r\n   * ```\r\n   *\r\n   * ```css\r\n   * // css\r\n   * main {\r\n   *   display: flex;\r\n   *   align-items: center;\r\n   *   justify-content: center;\r\n   *   height: 100%;\r\n   *   width: 100%;\r\n   * }\r\n   * ```\r\n   *\r\n   */\r\n  FitScreen = 'FitScreen',\r\n\r\n  /**\r\n   * Fill the entire screen's css width/height for the game resolution dynamically. This means the resolution of the game will\r\n   * change dynamically as the window is resized. This is not the same as [[Screen.goFullScreen]]\r\n   */\r\n  FillScreen = 'FillScreen',\r\n\r\n  /**\r\n   * Fit to parent element width/height using as much space as possible while maintaining aspect ratio and resolution.\r\n   */\r\n  FitContainer = 'FitContainer',\r\n\r\n  /**\r\n   * Use the parent DOM container's css width/height for the game resolution dynamically\r\n   */\r\n  FillContainer = 'FillContainer',\r\n\r\n  /**\r\n   * Allow the game to be positioned with the [[EngineOptions.position]] option\r\n   * @deprecated Use CSS to position the game canvas, will be removed in v0.26.0\r\n   */\r\n  Position = 'Position'\r\n}\r\n\r\n/**\r\n * Convenience class for quick resolutions\r\n * Mostly sourced from https://emulation.gametechwiki.com/index.php/Resolution\r\n */\r\nexport class Resolution {\r\n  /* istanbul ignore next */\r\n  public static get SVGA(): ScreenDimension {\r\n    return { width: 800, height: 600 };\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  public static get Standard(): ScreenDimension {\r\n    return { width: 1920, height: 1080 };\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  public static get Atari2600(): ScreenDimension {\r\n    return { width: 160, height: 192 };\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  public static get GameBoy(): ScreenDimension {\r\n    return { width: 160, height: 144 };\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  public static get GameBoyAdvance(): ScreenDimension {\r\n    return { width: 240, height: 160 };\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  public static get NintendoDS(): ScreenDimension {\r\n    return { width: 256, height: 192 };\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  public static get NES(): ScreenDimension {\r\n    return { width: 256, height: 224 };\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  public static get SNES(): ScreenDimension {\r\n    return { width: 256, height: 244 };\r\n  }\r\n}\r\n\r\n/**\r\n * Interface describing the absolute CSS position of the game window. For use when [[DisplayMode.Position]]\r\n * is specified and when the user wants to define exact pixel spacing of the window.\r\n * When a number is given, the value is interpreted as pixels\r\n */\r\nexport interface AbsolutePosition {\r\n  top?: number | string;\r\n  left?: number | string;\r\n  right?: number | string;\r\n  bottom?: number | string;\r\n}\r\n\r\nexport type CanvasPosition = string | AbsolutePosition;\r\n\r\nexport interface ScreenDimension {\r\n  width: number;\r\n  height: number;\r\n}\r\n\r\nexport interface ScreenOptions {\r\n  /**\r\n   * Canvas element to build a screen on\r\n   */\r\n  canvas: HTMLCanvasElement;\r\n\r\n  /**\r\n   * Graphics context for the screen\r\n   */\r\n  context: ExcaliburGraphicsContext;\r\n\r\n  /**\r\n   * Browser abstraction\r\n   */\r\n  browser: BrowserEvents;\r\n  /**\r\n   * Optionally set antialiasing, defaults to true. If set to true, images will be smoothed\r\n   */\r\n  antialiasing?: boolean;\r\n  /**\r\n   * Optionally override the pixel ratio to use for the screen, otherwise calculated automatically from the browser\r\n   */\r\n  pixelRatio?: number;\r\n  /**\r\n   * Optionally specify the actual pixel resolution in width/height pixels (also known as logical resolution), by default the\r\n   * resolution will be the same as the viewport. Resolution will be overridden by [[DisplayMode.FillContainer]] and\r\n   * [[DisplayMode.FillScreen]].\r\n   */\r\n  resolution?: ScreenDimension;\r\n  /**\r\n   * Visual viewport size in css pixel, if resolution is not specified it will be the same as the viewport\r\n   */\r\n  viewport: ScreenDimension;\r\n  /**\r\n   * Set the display mode of the screen, by default DisplayMode.Fixed.\r\n   */\r\n  displayMode?: DisplayMode;\r\n  /**\r\n   * Specify how the game window is to be positioned when the [[DisplayMode.Position]] is chosen. This option MUST be specified\r\n   * if the DisplayMode is set as [[DisplayMode.Position]]. The position can be either a string or an [[AbsolutePosition]].\r\n   * String must be in the format of css style background-position. The vertical position must precede the horizontal position in strings.\r\n   *\r\n   * Valid String examples: \"top left\", \"top\", \"bottom\", \"middle\", \"middle center\", \"bottom right\"\r\n   * Valid [[AbsolutePosition]] examples: `{top: 5, right: 10%}`, `{bottom: 49em, left: 10px}`, `{left: 10, bottom: 40}`\r\n   */\r\n  position?: CanvasPosition;\r\n}\r\n\r\n/**\r\n * The Screen handles all aspects of interacting with the screen for Excalibur.\r\n */\r\nexport class Screen {\r\n  public graphicsContext: ExcaliburGraphicsContext;\r\n  private _canvas: HTMLCanvasElement;\r\n  private _antialiasing: boolean = true;\r\n  private _browser: BrowserEvents;\r\n  private _camera: Camera;\r\n  private _resolution: ScreenDimension;\r\n  private _resolutionStack: ScreenDimension[] = [];\r\n  private _viewport: ScreenDimension;\r\n  private _viewportStack: ScreenDimension[] = [];\r\n  private _pixelRatioOverride: number | null = null;\r\n  private _position: CanvasPosition;\r\n  private _displayMode: DisplayMode;\r\n  private _isFullScreen = false;\r\n  private _mediaQueryList: MediaQueryList;\r\n  private _isDisposed = false;\r\n  private _logger = Logger.getInstance();\r\n  private _resizeObserver: ResizeObserver;\r\n\r\n  constructor(options: ScreenOptions) {\r\n    this.viewport = options.viewport;\r\n    this.resolution = options.resolution ?? { ...this.viewport };\r\n    this._displayMode = options.displayMode ?? DisplayMode.Fixed;\r\n    this._canvas = options.canvas;\r\n    this.graphicsContext = options.context;\r\n    this._antialiasing = options.antialiasing ?? this._antialiasing;\r\n    this._browser = options.browser;\r\n    this._position = options.position;\r\n    this._pixelRatioOverride = options.pixelRatio;\r\n\r\n    this._applyDisplayMode();\r\n\r\n    this._listenForPixelRatio();\r\n\r\n    this._canvas.addEventListener('fullscreenchange', this._fullscreenChangeHandler);\r\n    this.applyResolutionAndViewport();\r\n  }\r\n\r\n  private _listenForPixelRatio() {\r\n    if (this._mediaQueryList && !this._mediaQueryList.addEventListener) {\r\n      // Safari <=13.1 workaround, remove any existing handlers\r\n      this._mediaQueryList.removeListener(this._pixelRatioChangeHandler);\r\n    }\r\n    this._mediaQueryList = this._browser.window.nativeComponent.matchMedia(`(resolution: ${window.devicePixelRatio}dppx)`);\r\n\r\n    // Safari <=13.1 workaround\r\n    if (this._mediaQueryList.addEventListener) {\r\n      this._mediaQueryList.addEventListener('change', this._pixelRatioChangeHandler, { once: true });\r\n    } else {\r\n      this._mediaQueryList.addListener(this._pixelRatioChangeHandler);\r\n    }\r\n  }\r\n\r\n  public dispose(): void {\r\n    if (!this._isDisposed) {\r\n      // Clean up handlers\r\n      this._isDisposed = true;\r\n      this._browser.window.off('resize', this._resizeHandler);\r\n      if (this._resizeObserver) {\r\n        this._resizeObserver.disconnect();\r\n      }\r\n      this.parent.removeEventListener('resize', this._resizeHandler);\r\n      // Safari <=13.1 workaround\r\n      if (this._mediaQueryList.removeEventListener) {\r\n        this._mediaQueryList.removeEventListener('change', this._pixelRatioChangeHandler);\r\n      } else {\r\n        this._mediaQueryList.removeListener(this._pixelRatioChangeHandler);\r\n      }\r\n      this._canvas.removeEventListener('fullscreenchange', this._fullscreenChangeHandler);\r\n    }\r\n  }\r\n\r\n  private _fullscreenChangeHandler = () => {\r\n    this._isFullScreen = !this._isFullScreen;\r\n    this._logger.debug('Fullscreen Change', this._isFullScreen);\r\n  };\r\n\r\n  private _pixelRatioChangeHandler = () => {\r\n    this._logger.debug('Pixel Ratio Change', window.devicePixelRatio);\r\n    this._listenForPixelRatio();\r\n    this._devicePixelRatio = this._calculateDevicePixelRatio();\r\n    this.applyResolutionAndViewport();\r\n  };\r\n\r\n  private _resizeHandler = () => {\r\n    const parent = this.parent;\r\n    this._logger.debug('View port resized');\r\n    this._setResolutionAndViewportByDisplayMode(parent);\r\n    this.applyResolutionAndViewport();\r\n  };\r\n\r\n  private _calculateDevicePixelRatio() {\r\n    if (window.devicePixelRatio < 1) {\r\n      return 1;\r\n    }\r\n\r\n    const devicePixelRatio = window.devicePixelRatio || 1;\r\n\r\n    return devicePixelRatio;\r\n  }\r\n\r\n  // Asking the window.devicePixelRatio is expensive we do it once\r\n  private _devicePixelRatio = this._calculateDevicePixelRatio();\r\n\r\n  public get pixelRatio(): number {\r\n    if (this._pixelRatioOverride) {\r\n      return this._pixelRatioOverride;\r\n    }\r\n\r\n    return this._devicePixelRatio;\r\n  }\r\n\r\n  public get isHiDpi() {\r\n    return this.pixelRatio !== 1;\r\n  }\r\n\r\n  public get displayMode(): DisplayMode {\r\n    return this._displayMode;\r\n  }\r\n\r\n  public get canvas(): HTMLCanvasElement {\r\n    return this._canvas;\r\n  }\r\n\r\n  public get parent(): HTMLElement | Window {\r\n    return <HTMLElement | Window>(\r\n      (this.displayMode === DisplayMode.FillContainer || this.displayMode === DisplayMode.FitContainer\r\n        ? this.canvas.parentElement || document.body\r\n        : window)\r\n    );\r\n  }\r\n\r\n  public get resolution(): ScreenDimension {\r\n    return this._resolution;\r\n  }\r\n\r\n  public set resolution(resolution: ScreenDimension) {\r\n    this._resolution = resolution;\r\n  }\r\n\r\n  public get viewport(): ScreenDimension {\r\n    if (this._viewport) {\r\n      return this._viewport;\r\n    }\r\n    return this._resolution;\r\n  }\r\n\r\n  public set viewport(viewport: ScreenDimension) {\r\n    this._viewport = viewport;\r\n  }\r\n\r\n  public get aspectRatio() {\r\n    return this._resolution.width / this._resolution.height;\r\n  }\r\n\r\n  public get scaledWidth() {\r\n    return this._resolution.width * this.pixelRatio;\r\n  }\r\n\r\n  public get scaledHeight() {\r\n    return this._resolution.height * this.pixelRatio;\r\n  }\r\n\r\n  public setCurrentCamera(camera: Camera) {\r\n    this._camera = camera;\r\n  }\r\n\r\n  public pushResolutionAndViewport() {\r\n    this._resolutionStack.push(this.resolution);\r\n    this._viewportStack.push(this.viewport);\r\n\r\n    this.resolution = { ...this.resolution };\r\n    this.viewport = { ...this.viewport };\r\n  }\r\n\r\n  public peekViewport(): ScreenDimension {\r\n    return this._viewportStack[this._viewportStack.length - 1];\r\n  }\r\n\r\n  public peekResolution(): ScreenDimension {\r\n    return this._resolutionStack[this._resolutionStack.length - 1];\r\n  }\r\n\r\n  public popResolutionAndViewport() {\r\n    this.resolution = this._resolutionStack.pop();\r\n    this.viewport = this._viewportStack.pop();\r\n  }\r\n\r\n  private _alreadyWarned = false;\r\n  public applyResolutionAndViewport() {\r\n    this._canvas.width = this.scaledWidth;\r\n    this._canvas.height = this.scaledHeight;\r\n\r\n    if (this.graphicsContext instanceof ExcaliburGraphicsContextWebGL) {\r\n      const supported = this.graphicsContext.checkIfResolutionSupported({\r\n        width: this.scaledWidth,\r\n        height: this.scaledHeight\r\n      });\r\n      if (!supported && !this._alreadyWarned) {\r\n        this._alreadyWarned = true; // warn once\r\n        this._logger.warn(\r\n          `The currently configured resolution (${this.resolution.width}x${this.resolution.height})` +\r\n          ' is too large for the platform WebGL implementation, this may work but cause WebGL rendering to behave oddly.' +\r\n          ' Try reducing the resolution or disabling Hi DPI scaling to avoid this' +\r\n          ' (read more here https://excaliburjs.com/docs/screens#understanding-viewport--resolution).');\r\n      }\r\n    }\r\n\r\n    if (this._antialiasing) {\r\n      this._canvas.style.imageRendering = 'auto';\r\n    } else {\r\n      this._canvas.style.imageRendering = 'pixelated';\r\n      // Fall back to 'crisp-edges' if 'pixelated' is not supported\r\n      // Currently for firefox https://developer.mozilla.org/en-US/docs/Web/CSS/image-rendering\r\n      if (this._canvas.style.imageRendering === '') {\r\n        this._canvas.style.imageRendering = 'crisp-edges';\r\n      }\r\n    }\r\n    this._canvas.style.width = this.viewport.width + 'px';\r\n    this._canvas.style.height = this.viewport.height + 'px';\r\n\r\n    // After messing with the canvas width/height the graphics context is invalidated and needs to have some properties reset\r\n    this.graphicsContext.updateViewport(this.resolution);\r\n    this.graphicsContext.resetTransform();\r\n    this.graphicsContext.smoothing = this._antialiasing;\r\n  }\r\n\r\n  public get antialiasing() {\r\n    return this._antialiasing;\r\n  }\r\n\r\n  public set antialiasing(isSmooth: boolean) {\r\n    this._antialiasing = isSmooth;\r\n    this.graphicsContext.smoothing = this._antialiasing;\r\n  }\r\n\r\n  /**\r\n   * Returns true if excalibur is fullscreen using the browser fullscreen api\r\n   */\r\n  public get isFullScreen() {\r\n    return this._isFullScreen;\r\n  }\r\n\r\n  /**\r\n   * Requests to go fullscreen using the browser fullscreen api, requires user interaction to be successful.\r\n   * For example, wire this to a user click handler.\r\n   */\r\n  public goFullScreen(): Promise<void> {\r\n    return this._canvas.requestFullscreen();\r\n  }\r\n\r\n  /**\r\n   * Requests to exit fullscreen using the browser fullscreen api\r\n   */\r\n  public exitFullScreen(): Promise<void> {\r\n    return document.exitFullscreen();\r\n  }\r\n\r\n  /**\r\n   * Takes a coordinate in normal html page space, for example from a pointer move event, and translates it to\r\n   * Excalibur screen space.\r\n   *\r\n   * Excalibur screen space starts at the top left (0, 0) corner of the viewport, and extends to the\r\n   * bottom right corner (resolutionX, resolutionY)\r\n   * @param point\r\n   */\r\n  public pageToScreenCoordinates(point: Vector): Vector {\r\n    let newX = point.x;\r\n    let newY = point.y;\r\n\r\n    if (!this._isFullScreen) {\r\n      newX -= getPosition(this._canvas).x;\r\n      newY -= getPosition(this._canvas).y;\r\n    }\r\n\r\n    // if fullscreen api on it centers with black bars\r\n    // we need to adjust the screen to world coordinates in this case\r\n    if (this._isFullScreen) {\r\n      if (window.innerWidth / this.aspectRatio < window.innerHeight) {\r\n        const screenHeight = window.innerWidth / this.aspectRatio;\r\n        const screenMarginY = (window.innerHeight - screenHeight) / 2;\r\n        newY = ((newY - screenMarginY) / screenHeight) * this.viewport.height;\r\n        newX = (newX / window.innerWidth) * this.viewport.width;\r\n      } else {\r\n        const screenWidth = window.innerHeight * this.aspectRatio;\r\n        const screenMarginX = (window.innerWidth - screenWidth) / 2;\r\n        newX = ((newX - screenMarginX) / screenWidth) * this.viewport.width;\r\n        newY = (newY / window.innerHeight) * this.viewport.height;\r\n      }\r\n    }\r\n\r\n    newX = (newX / this.viewport.width) * this.resolution.width;\r\n    newY = (newY / this.viewport.height) * this.resolution.height;\r\n\r\n    return new Vector(newX, newY);\r\n  }\r\n\r\n  /**\r\n   * Takes a coordinate in Excalibur screen space, and translates it to normal html page space. For example,\r\n   * this is where html elements might live if you want to position them relative to Excalibur.\r\n   *\r\n   * Excalibur screen space starts at the top left (0, 0) corner of the viewport, and extends to the\r\n   * bottom right corner (resolutionX, resolutionY)\r\n   * @param point\r\n   */\r\n  public screenToPageCoordinates(point: Vector): Vector {\r\n    let newX = point.x;\r\n    let newY = point.y;\r\n\r\n    newX = (newX / this.resolution.width) * this.viewport.width;\r\n    newY = (newY / this.resolution.height) * this.viewport.height;\r\n\r\n    if (this._isFullScreen) {\r\n      if (window.innerWidth / this.aspectRatio < window.innerHeight) {\r\n        const screenHeight = window.innerWidth / this.aspectRatio;\r\n        const screenMarginY = (window.innerHeight - screenHeight) / 2;\r\n        newY = (newY / this.viewport.height) * screenHeight + screenMarginY;\r\n        newX = (newX / this.viewport.width) * window.innerWidth;\r\n      } else {\r\n        const screenWidth = window.innerHeight * this.aspectRatio;\r\n        const screenMarginX = (window.innerWidth - screenWidth) / 2;\r\n        newX = (newX / this.viewport.width) * screenWidth + screenMarginX;\r\n        newY = (newY / this.viewport.height) * window.innerHeight;\r\n      }\r\n    }\r\n\r\n    if (!this._isFullScreen) {\r\n      newX += getPosition(this._canvas).x;\r\n      newY += getPosition(this._canvas).y;\r\n    }\r\n\r\n    return new Vector(newX, newY);\r\n  }\r\n\r\n  /**\r\n   * Takes a coordinate in Excalibur screen space, and translates it to Excalibur world space.\r\n   *\r\n   * World space is where [[Entity|entities]] in Excalibur live by default [[CoordPlane.World]]\r\n   * and extends infinitely out relative from the [[Camera]].\r\n   * @param point  Screen coordinate to convert\r\n   */\r\n  public screenToWorldCoordinates(point: Vector): Vector {\r\n    // the only difference between screen & world is the camera transform\r\n    if (this._camera) {\r\n      return this._camera.inverse.multv(point);\r\n    }\r\n    return point.sub(vec(this.resolution.width / 2, this.resolution.height / 2));\r\n  }\r\n\r\n  /**\r\n   * Takes a coordinate in Excalibur world space, and translates it to Excalibur screen space.\r\n   *\r\n   * Screen space is where [[ScreenElement|screen elements]] and [[Entity|entities]] with [[CoordPlane.Screen]] live.\r\n   * @param point  World coordinate to convert\r\n   */\r\n  public worldToScreenCoordinates(point: Vector): Vector {\r\n    if (this._camera) {\r\n      return this._camera.transform.multv(point);\r\n    }\r\n    return point.add(vec(this.resolution.width / 2, this.resolution.height / 2));\r\n  }\r\n\r\n  public pageToWorldCoordinates(point: Vector): Vector {\r\n    const screen = this.pageToScreenCoordinates(point);\r\n    return this.screenToWorldCoordinates(screen);\r\n  }\r\n\r\n  public worldToPageCoordinates(point: Vector): Vector {\r\n    const screen = this.worldToScreenCoordinates(point);\r\n    return this.screenToPageCoordinates(screen);\r\n  }\r\n\r\n  /**\r\n   * Returns a BoundingBox of the top left corner of the screen\r\n   * and the bottom right corner of the screen.\r\n   *\r\n   * World bounds are in world coordinates, useful for culling objects offscreen\r\n   */\r\n  public getWorldBounds(): BoundingBox {\r\n    const topLeft = this.screenToWorldCoordinates(Vector.Zero);\r\n    const right = topLeft.x + this.drawWidth;\r\n    const bottom = topLeft.y + this.drawHeight;\r\n\r\n    return new BoundingBox(topLeft.x, topLeft.y, right, bottom);\r\n  }\r\n\r\n  /**\r\n   * The width of the game canvas in pixels (physical width component of the\r\n   * resolution of the canvas element)\r\n   */\r\n  public get canvasWidth(): number {\r\n    return this.canvas.width;\r\n  }\r\n\r\n  /**\r\n   * Returns half width of the game canvas in pixels (half physical width component)\r\n   */\r\n  public get halfCanvasWidth(): number {\r\n    return this.canvas.width / 2;\r\n  }\r\n\r\n  /**\r\n   * The height of the game canvas in pixels, (physical height component of\r\n   * the resolution of the canvas element)\r\n   */\r\n  public get canvasHeight(): number {\r\n    return this.canvas.height;\r\n  }\r\n\r\n  /**\r\n   * Returns half height of the game canvas in pixels (half physical height component)\r\n   */\r\n  public get halfCanvasHeight(): number {\r\n    return this.canvas.height / 2;\r\n  }\r\n\r\n  /**\r\n   * Returns the width of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\r\n   */\r\n  public get drawWidth(): number {\r\n    if (this._camera) {\r\n      return this.resolution.width / this._camera.zoom;\r\n    }\r\n    return this.resolution.width;\r\n  }\r\n\r\n  /**\r\n   * Returns half the width of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\r\n   */\r\n  public get halfDrawWidth(): number {\r\n    return this.drawWidth / 2;\r\n  }\r\n\r\n  /**\r\n   * Returns the height of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\r\n   */\r\n  public get drawHeight(): number {\r\n    if (this._camera) {\r\n      return this.resolution.height / this._camera.zoom;\r\n    }\r\n    return this.resolution.height;\r\n  }\r\n\r\n  /**\r\n   * Returns half the height of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\r\n   */\r\n  public get halfDrawHeight(): number {\r\n    return this.drawHeight / 2;\r\n  }\r\n\r\n  /**\r\n   * Returns screen center coordinates including zoom and device pixel ratio.\r\n   */\r\n  public get center(): Vector {\r\n    return vec(this.halfDrawWidth, this.halfDrawHeight);\r\n  }\r\n\r\n  private _computeFit() {\r\n    document.body.style.margin = '0px';\r\n    document.body.style.overflow = 'hidden';\r\n    const aspect = this.aspectRatio;\r\n    let adjustedWidth = 0;\r\n    let adjustedHeight = 0;\r\n    if (window.innerWidth / aspect < window.innerHeight) {\r\n      adjustedWidth = window.innerWidth;\r\n      adjustedHeight = window.innerWidth / aspect;\r\n    } else {\r\n      adjustedWidth = window.innerHeight * aspect;\r\n      adjustedHeight = window.innerHeight;\r\n    }\r\n\r\n    this.viewport = {\r\n      width: adjustedWidth,\r\n      height: adjustedHeight\r\n    };\r\n  }\r\n\r\n  private _computeFitContainer() {\r\n    const aspect = this.aspectRatio;\r\n    let adjustedWidth = 0;\r\n    let adjustedHeight = 0;\r\n    const parent = this.canvas.parentElement;\r\n    if (parent.clientWidth / aspect < parent.clientHeight) {\r\n      adjustedWidth = parent.clientWidth;\r\n      adjustedHeight = parent.clientWidth / aspect;\r\n    } else {\r\n      adjustedWidth = parent.clientHeight * aspect;\r\n      adjustedHeight = parent.clientHeight;\r\n    }\r\n\r\n    this.viewport = {\r\n      width: adjustedWidth,\r\n      height: adjustedHeight\r\n    };\r\n  }\r\n\r\n  private _applyDisplayMode() {\r\n    if (this.displayMode === DisplayMode.Position) {\r\n      this._initializeDisplayModePosition(this._position);\r\n    } else {\r\n      this._setResolutionAndViewportByDisplayMode(this.parent);\r\n\r\n      // watch resizing\r\n      if (this.parent instanceof Window) {\r\n        this._browser.window.on('resize', this._resizeHandler);\r\n      } else {\r\n        this._resizeObserver = new ResizeObserver(() => {\r\n          this._resizeHandler();\r\n        });\r\n        this._resizeObserver.observe(this.parent);\r\n      }\r\n      this.parent.addEventListener('resize', this._resizeHandler);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Sets the resolution and viewport based on the selected display mode.\r\n   */\r\n  private _setResolutionAndViewportByDisplayMode(parent: HTMLElement | Window) {\r\n    if (this.displayMode === DisplayMode.FillContainer) {\r\n      this.resolution = {\r\n        width: (<HTMLElement>parent).clientWidth,\r\n        height: (<HTMLElement>parent).clientHeight\r\n      };\r\n\r\n      this.viewport = this.resolution;\r\n    }\r\n\r\n    if (this.displayMode === DisplayMode.FillScreen) {\r\n      document.body.style.margin = '0px';\r\n      document.body.style.overflow = 'hidden';\r\n      this.resolution = {\r\n        width: (<Window>parent).innerWidth,\r\n        height: (<Window>parent).innerHeight\r\n      };\r\n\r\n      this.viewport = this.resolution;\r\n    }\r\n\r\n    if (this.displayMode === DisplayMode.FitScreen) {\r\n      this._computeFit();\r\n    }\r\n\r\n    if (this.displayMode === DisplayMode.FitContainer) {\r\n      this._computeFitContainer();\r\n    }\r\n  }\r\n\r\n  private _initializeDisplayModePosition(position: CanvasPosition) {\r\n    if (!position) {\r\n      throw new Error('DisplayMode of Position was selected but no position option was given');\r\n    } else {\r\n      this.canvas.style.display = 'block';\r\n      this.canvas.style.position = 'absolute';\r\n\r\n      if (typeof position === 'string') {\r\n        const specifiedPosition = position.split(' ');\r\n\r\n        switch (specifiedPosition[0]) {\r\n          case 'top':\r\n            this.canvas.style.top = '0px';\r\n            break;\r\n          case 'bottom':\r\n            this.canvas.style.bottom = '0px';\r\n            break;\r\n          case 'middle':\r\n            this.canvas.style.top = '50%';\r\n            const offsetY = -this.halfDrawHeight;\r\n            this.canvas.style.marginTop = offsetY.toString();\r\n            break;\r\n          default:\r\n            throw new Error('Invalid Position Given');\r\n        }\r\n\r\n        if (specifiedPosition[1]) {\r\n          switch (specifiedPosition[1]) {\r\n            case 'left':\r\n              this.canvas.style.left = '0px';\r\n              break;\r\n            case 'right':\r\n              this.canvas.style.right = '0px';\r\n              break;\r\n            case 'center':\r\n              this.canvas.style.left = '50%';\r\n              const offsetX = -this.halfDrawWidth;\r\n              this.canvas.style.marginLeft = offsetX.toString();\r\n              break;\r\n            default:\r\n              throw new Error('Invalid Position Given');\r\n          }\r\n        }\r\n      } else {\r\n        if (position.top) {\r\n          typeof position.top === 'number'\r\n            ? (this.canvas.style.top = position.top.toString() + 'px')\r\n            : (this.canvas.style.top = position.top);\r\n        }\r\n        if (position.right) {\r\n          typeof position.right === 'number'\r\n            ? (this.canvas.style.right = position.right.toString() + 'px')\r\n            : (this.canvas.style.right = position.right);\r\n        }\r\n        if (position.bottom) {\r\n          typeof position.bottom === 'number'\r\n            ? (this.canvas.style.bottom = position.bottom.toString() + 'px')\r\n            : (this.canvas.style.bottom = position.bottom);\r\n        }\r\n        if (position.left) {\r\n          typeof position.left === 'number'\r\n            ? (this.canvas.style.left = position.left.toString() + 'px')\r\n            : (this.canvas.style.left = position.left);\r\n        }\r\n      }\r\n    }\r\n  }\r\n}","/**\r\n * Internal class used to build instances of AudioContext\r\n */\r\n/* istanbul ignore next */\r\nexport class AudioContextFactory {\r\n  private static _INSTANCE: AudioContext = null;\r\n\r\n  public static create(): AudioContext {\r\n    if (!this._INSTANCE) {\r\n      if ((<any>window).AudioContext || (<any>window).webkitAudioContext) {\r\n        this._INSTANCE = new AudioContext();\r\n      }\r\n    }\r\n\r\n    return this._INSTANCE;\r\n  }\r\n}\r\n","import { AudioContextFactory } from '../Resources/Sound/AudioContext';\r\nimport { Logger } from './Log';\r\n\r\nexport interface LegacyWebAudioSource {\r\n  playbackState: string;\r\n  PLAYING_STATE: 'playing';\r\n  FINISHED_STATE: 'finished';\r\n}\r\n\r\n/**\r\n * Patch for detecting legacy web audio in browsers\r\n * @internal\r\n * @param source\r\n */\r\nfunction isLegacyWebAudioSource(source: any): source is LegacyWebAudioSource {\r\n  return !!source.playbackState;\r\n}\r\n\r\nexport class WebAudio {\r\n  private static _UNLOCKED: boolean = false;\r\n\r\n  /**\r\n   * Play an empty sound to unlock Safari WebAudio context. Call this function\r\n   * right after a user interaction event.\r\n   * @source https://paulbakaus.com/tutorials/html5/web-audio-on-ios/\r\n   */\r\n  static unlock(): Promise<boolean> {\r\n    const promise = new Promise<boolean>((resolve, reject) => {\r\n      if (WebAudio._UNLOCKED || !AudioContextFactory.create()) {\r\n        return resolve(true);\r\n      }\r\n      const unlockTimeoutTimer = setTimeout(() => {\r\n        Logger.getInstance().warn('Excalibur was unable to unlock the audio context, audio probably will not play in this browser.');\r\n        resolve(false);\r\n      }, 200);\r\n\r\n      const audioContext = AudioContextFactory.create();\r\n      audioContext.resume().then(\r\n        () => {\r\n          // create empty buffer and play it\r\n          const buffer = audioContext.createBuffer(1, 1, 22050);\r\n          const source = audioContext.createBufferSource();\r\n          let ended = false;\r\n\r\n          source.buffer = buffer;\r\n          source.connect(audioContext.destination);\r\n          source.onended = () => (ended = true);\r\n\r\n          source.start(0);\r\n\r\n          // by checking the play state after some time, we know if we're really unlocked\r\n          setTimeout(() => {\r\n            if (isLegacyWebAudioSource(source)) {\r\n              if (source.playbackState === source.PLAYING_STATE || source.playbackState === source.FINISHED_STATE) {\r\n                WebAudio._UNLOCKED = true;\r\n              }\r\n            } else {\r\n              if (audioContext.currentTime > 0 || ended) {\r\n                WebAudio._UNLOCKED = true;\r\n              }\r\n            }\r\n          }, 0);\r\n\r\n          clearTimeout(unlockTimeoutTimer);\r\n          resolve(true);\r\n        },\r\n        () => {\r\n          reject();\r\n        }\r\n      );\r\n    });\r\n\r\n    return promise;\r\n  }\r\n\r\n  static isUnlocked() {\r\n    return this._UNLOCKED;\r\n  }\r\n}\r\n","import { EventDispatcher } from './EventDispatcher';\r\nimport { Eventable } from './Interfaces/Evented';\r\n\r\n/**\r\n * Excalibur base class that provides basic functionality such as [[EventDispatcher]]\r\n * and extending abilities for vanilla Javascript projects\r\n */\r\nexport class Class implements Eventable {\r\n  /**\r\n   * Direct access to the game object event dispatcher.\r\n   */\r\n  public eventDispatcher: EventDispatcher;\r\n\r\n  constructor() {\r\n    this.eventDispatcher = new EventDispatcher();\r\n  }\r\n\r\n  /**\r\n   * Alias for `addEventListener`. You can listen for a variety of\r\n   * events off of the engine; see the events section below for a complete list.\r\n   * @param eventName  Name of the event to listen for\r\n   * @param handler    Event handler for the thrown event\r\n   */\r\n  public on(eventName: string, handler: (event: any) => void) {\r\n    this.eventDispatcher.on(eventName, handler);\r\n  }\r\n\r\n  /**\r\n   * Alias for `removeEventListener`. If only the eventName is specified\r\n   * it will remove all handlers registered for that specific event. If the eventName\r\n   * and the handler instance are specified only that handler will be removed.\r\n   *\r\n   * @param eventName  Name of the event to listen for\r\n   * @param handler    Event handler for the thrown event\r\n   */\r\n  public off(eventName: string, handler?: (event: any) => void) {\r\n    this.eventDispatcher.off(eventName, handler);\r\n  }\r\n\r\n  /**\r\n   * Emits a new event\r\n   * @param eventName   Name of the event to emit\r\n   * @param eventObject Data associated with this event\r\n   */\r\n  public emit(eventName: string, eventObject: any) {\r\n    this.eventDispatcher.emit(eventName, eventObject);\r\n  }\r\n\r\n  /**\r\n   * Once listens to an event one time, then unsubscribes from that event\r\n   *\r\n   * @param eventName The name of the event to subscribe to once\r\n   * @param handler   The handler of the event that will be auto unsubscribed\r\n   */\r\n  public once(eventName: string, handler: (event: any) => void) {\r\n    this.eventDispatcher.once(eventName, handler);\r\n  }\r\n}\r\n","import { Color } from '../Color';\r\nimport { Vector } from '../Math/vector';\r\n\r\n/**\r\n * A canvas linecap style. \"butt\" is the default flush style, \"round\" is a semi-circle cap with a radius half the width of\r\n * the line, and \"square\" is a rectangle that is an equal width and half height cap.\r\n */\r\nexport type LineCapStyle = 'butt' | 'round' | 'square';\r\n\r\n/* istanbul ignore next */\r\n/**\r\n * Draw a line on canvas context\r\n *\r\n * @param ctx The canvas context\r\n * @param color The color of the line\r\n * @param x1 The start x coordinate\r\n * @param y1 The start y coordinate\r\n * @param x2 The ending x coordinate\r\n * @param y2 The ending y coordinate\r\n * @param thickness The line thickness\r\n * @param cap The [[LineCapStyle]] (butt, round, or square)\r\n */\r\nexport function line(\r\n  ctx: CanvasRenderingContext2D,\r\n  color: Color = Color.Red,\r\n  x1: number,\r\n  y1: number,\r\n  x2: number,\r\n  y2: number,\r\n  thickness: number = 1,\r\n  cap: LineCapStyle = 'butt'\r\n) {\r\n  ctx.save();\r\n  ctx.beginPath();\r\n  ctx.lineWidth = thickness;\r\n  ctx.lineCap = cap;\r\n  ctx.strokeStyle = color.toString();\r\n  ctx.moveTo(x1, y1);\r\n  ctx.lineTo(x2, y2);\r\n  ctx.closePath();\r\n  ctx.stroke();\r\n  ctx.restore();\r\n}\r\n\r\n/* istanbul ignore next */\r\n/**\r\n * Draw the vector as a point onto the canvas.\r\n */\r\nexport function point(ctx: CanvasRenderingContext2D, color: Color = Color.Red, point: Vector): void {\r\n  ctx.beginPath();\r\n  ctx.strokeStyle = color.toString();\r\n  ctx.arc(point.x, point.y, 5, 0, Math.PI * 2);\r\n  ctx.closePath();\r\n  ctx.stroke();\r\n}\r\n\r\n/**\r\n * Draw the vector as a line onto the canvas starting a origin point.\r\n */\r\n/* istanbul ignore next */\r\n/**\r\n *\r\n */\r\nexport function vector(ctx: CanvasRenderingContext2D, color: Color, origin: Vector, vector: Vector, scale: number = 1.0): void {\r\n  const c = color ? color.toString() : 'blue';\r\n  const v = vector.scale(scale);\r\n  ctx.beginPath();\r\n  ctx.strokeStyle = c;\r\n  ctx.moveTo(origin.x, origin.y);\r\n  ctx.lineTo(origin.x + v.x, origin.y + v.y);\r\n  ctx.closePath();\r\n  ctx.stroke();\r\n}\r\n\r\n/**\r\n * Represents border radius values\r\n */\r\nexport interface BorderRadius {\r\n  /**\r\n   * Top-left\r\n   */\r\n  tl: number;\r\n  /**\r\n   * Top-right\r\n   */\r\n  tr: number;\r\n  /**\r\n   * Bottom-right\r\n   */\r\n  br: number;\r\n  /**\r\n   * Bottom-left\r\n   */\r\n  bl: number;\r\n}\r\n\r\n/**\r\n * Draw a round rectangle on a canvas context\r\n *\r\n * @param ctx The canvas context\r\n * @param x The top-left x coordinate\r\n * @param y The top-left y coordinate\r\n * @param width The width of the rectangle\r\n * @param height The height of the rectangle\r\n * @param radius The border radius of the rectangle\r\n * @param stroke The [[Color]] to stroke rectangle with\r\n * @param fill The [[Color]] to fill rectangle with\r\n */\r\nexport function roundRect(\r\n  ctx: CanvasRenderingContext2D,\r\n  x: number,\r\n  y: number,\r\n  width: number,\r\n  height: number,\r\n  radius: number | BorderRadius = 5,\r\n  stroke: Color = Color.White,\r\n  fill: Color = null\r\n) {\r\n  let br: BorderRadius;\r\n\r\n  if (typeof radius === 'number') {\r\n    br = { tl: radius, tr: radius, br: radius, bl: radius };\r\n  } else {\r\n    const defaultRadius: BorderRadius = { tl: 0, tr: 0, br: 0, bl: 0 };\r\n\r\n    for (const prop in defaultRadius) {\r\n      if (defaultRadius.hasOwnProperty(prop)) {\r\n        const side = <keyof BorderRadius>prop;\r\n        br[side] = radius[side] || defaultRadius[side];\r\n      }\r\n    }\r\n  }\r\n\r\n  ctx.beginPath();\r\n  ctx.moveTo(x + br.tl, y);\r\n  ctx.lineTo(x + width - br.tr, y);\r\n  ctx.quadraticCurveTo(x + width, y, x + width, y + br.tr);\r\n  ctx.lineTo(x + width, y + height - br.br);\r\n  ctx.quadraticCurveTo(x + width, y + height, x + width - br.br, y + height);\r\n  ctx.lineTo(x + br.bl, y + height);\r\n  ctx.quadraticCurveTo(x, y + height, x, y + height - br.bl);\r\n  ctx.lineTo(x, y + br.tl);\r\n  ctx.quadraticCurveTo(x, y, x + br.tl, y);\r\n  ctx.closePath();\r\n\r\n  if (fill) {\r\n    ctx.fillStyle = fill.toString();\r\n    ctx.fill();\r\n  }\r\n\r\n  if (stroke) {\r\n    ctx.strokeStyle = stroke.toString();\r\n    ctx.stroke();\r\n  }\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function circle(\r\n  ctx: CanvasRenderingContext2D,\r\n  x: number,\r\n  y: number,\r\n  radius: number,\r\n  stroke: Color = Color.White,\r\n  fill: Color = null\r\n) {\r\n  ctx.beginPath();\r\n  ctx.arc(x, y, radius, 0, Math.PI * 2);\r\n  ctx.closePath();\r\n\r\n  if (fill) {\r\n    ctx.fillStyle = fill.toString();\r\n    ctx.fill();\r\n  }\r\n\r\n  if (stroke) {\r\n    ctx.strokeStyle = stroke.toString();\r\n    ctx.stroke();\r\n  }\r\n}\r\n","export default \"data:image/png;base64,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\"","import { Color } from './Color';\r\nimport { WebAudio } from './Util/WebAudio';\r\nimport { Engine } from './Engine';\r\nimport { Loadable } from './Interfaces/Loadable';\r\nimport { Class } from './Class';\r\nimport * as DrawUtil from './Util/DrawUtil';\r\n\r\nimport logoImg from './Loader.logo.png';\r\nimport loaderCss from './Loader.css';\r\nimport { Canvas } from './Graphics/Canvas';\r\nimport { Vector } from './Math/vector';\r\nimport { delay } from './Util/Util';\r\nimport { ImageFiltering } from './Graphics/Filtering';\r\nimport { clamp } from './Math/util';\r\n\r\n/**\r\n * Pre-loading assets\r\n *\r\n * The loader provides a mechanism to preload multiple resources at\r\n * one time. The loader must be passed to the engine in order to\r\n * trigger the loading progress bar.\r\n *\r\n * The [[Loader]] itself implements [[Loadable]] so you can load loaders.\r\n *\r\n * ## Example: Pre-loading resources for a game\r\n *\r\n * ```js\r\n * // create a loader\r\n * var loader = new ex.Loader();\r\n *\r\n * // create a resource dictionary (best practice is to keep a separate file)\r\n * var resources = {\r\n *   TextureGround: new ex.Texture(\"/images/textures/ground.png\"),\r\n *   SoundDeath: new ex.Sound(\"/sound/death.wav\", \"/sound/death.mp3\")\r\n * };\r\n *\r\n * // loop through dictionary and add to loader\r\n * for (var loadable in resources) {\r\n *   if (resources.hasOwnProperty(loadable)) {\r\n *     loader.addResource(resources[loadable]);\r\n *   }\r\n * }\r\n *\r\n * // start game\r\n * game.start(loader).then(function () {\r\n *   console.log(\"Game started!\");\r\n * });\r\n * ```\r\n *\r\n * ## Customize the Loader\r\n *\r\n * The loader can be customized to show different, text, logo, background color, and button.\r\n *\r\n * ```typescript\r\n * const loader = new ex.Loader([playerTexture]);\r\n *\r\n * // The loaders button text can simply modified using this\r\n * loader.playButtonText = 'Start the best game ever';\r\n *\r\n * // The logo can be changed by inserting a base64 image string here\r\n *\r\n * loader.logo = 'data:image/png;base64,iVBORw...';\r\n * loader.logoWidth = 15;\r\n * loader.logoHeight = 14;\r\n *\r\n * // The background color can be changed like so by supplying a valid CSS color string\r\n *\r\n * loader.backgroundColor = 'red'\r\n * loader.backgroundColor = '#176BAA'\r\n *\r\n * // To build a completely new button\r\n * loader.startButtonFactory = () => {\r\n *     let myButton = document.createElement('button');\r\n *     myButton.textContent = 'The best button';\r\n *     return myButton;\r\n * };\r\n *\r\n * engine.start(loader).then(() => {});\r\n * ```\r\n */\r\nexport class Loader extends Class implements Loadable<Loadable<any>[]> {\r\n  public canvas: Canvas = new Canvas({\r\n    filtering: ImageFiltering.Blended,\r\n    smoothing: true,\r\n    draw: this.draw.bind(this)\r\n  });\r\n  private _resourceList: Loadable<any>[] = [];\r\n  private _index = 0;\r\n\r\n  private _playButtonShown: boolean = false;\r\n  private _resourceCount: number = 0;\r\n  private _numLoaded: number = 0;\r\n  private _progressCounts: { [key: string]: number } = {};\r\n  private _totalCounts: { [key: string]: number } = {};\r\n  private _engine: Engine;\r\n\r\n  // logo drawing stuff\r\n\r\n  // base64 string encoding of the excalibur logo (logo-white.png)\r\n  public logo = logoImg;\r\n  public logoWidth = 468;\r\n  public logoHeight = 118;\r\n  /**\r\n   * Positions the top left corner of the logo image\r\n   * If not set, the loader automatically positions the logo\r\n   */\r\n  public logoPosition: Vector | null;\r\n  /**\r\n   * Positions the top left corner of the play button.\r\n   * If not set, the loader automatically positions the play button\r\n   */\r\n  public playButtonPosition: Vector | null;\r\n  /**\r\n   * Positions the top left corner of the loading bar\r\n   * If not set, the loader automatically positions the loading bar\r\n   */\r\n  public loadingBarPosition: Vector | null;\r\n\r\n  /**\r\n   * Gets or sets the color of the loading bar, default is [[Color.White]]\r\n   */\r\n  public loadingBarColor: Color = Color.White;\r\n\r\n  /**\r\n   * Gets or sets the background color of the loader as a hex string\r\n   */\r\n  public backgroundColor: string = '#176BAA';\r\n\r\n  protected _imageElement: HTMLImageElement;\r\n  protected get _image() {\r\n    if (!this._imageElement) {\r\n      this._imageElement = new Image();\r\n      this._imageElement.src = this.logo;\r\n    }\r\n\r\n    return this._imageElement;\r\n  }\r\n\r\n  public suppressPlayButton: boolean = false;\r\n  public get playButtonRootElement(): HTMLElement | null {\r\n    return this._playButtonRootElement;\r\n  }\r\n  public get playButtonElement(): HTMLButtonElement | null {\r\n    return this._playButtonElement;\r\n  }\r\n  protected _playButtonRootElement: HTMLElement;\r\n  protected _playButtonElement: HTMLButtonElement;\r\n  protected _styleBlock: HTMLStyleElement;\r\n  /** Loads the css from Loader.css */\r\n  protected _playButtonStyles: string = loaderCss.toString();\r\n  protected get _playButton() {\r\n    const existingRoot = document.getElementById('excalibur-play-root');\r\n    if (existingRoot) {\r\n      this._playButtonRootElement = existingRoot;\r\n    }\r\n    if (!this._playButtonRootElement) {\r\n      this._playButtonRootElement = document.createElement('div');\r\n      this._playButtonRootElement.id = 'excalibur-play-root';\r\n      this._playButtonRootElement.style.position = 'absolute';\r\n      document.body.appendChild(this._playButtonRootElement);\r\n    }\r\n    if (!this._styleBlock) {\r\n      this._styleBlock = document.createElement('style');\r\n      this._styleBlock.textContent = this._playButtonStyles;\r\n      document.head.appendChild(this._styleBlock);\r\n    }\r\n    if (!this._playButtonElement) {\r\n      this._playButtonElement = this.startButtonFactory();\r\n      this._playButtonRootElement.appendChild(this._playButtonElement);\r\n    }\r\n    return this._playButtonElement;\r\n  }\r\n\r\n  /**\r\n   * Get/set play button text\r\n   */\r\n  public playButtonText: string = 'Play game';\r\n\r\n  /**\r\n   * Return a html button element for excalibur to use as a play button\r\n   */\r\n  public startButtonFactory = () => {\r\n    let buttonElement: HTMLButtonElement = document.getElementById('excalibur-play') as HTMLButtonElement;\r\n    if (!buttonElement) {\r\n      buttonElement = document.createElement('button');\r\n    }\r\n\r\n    buttonElement.id = 'excalibur-play';\r\n    buttonElement.textContent = this.playButtonText;\r\n    buttonElement.style.display = 'none';\r\n    return buttonElement;\r\n  };\r\n\r\n  /**\r\n   * @param loadables  Optionally provide the list of resources you want to load at constructor time\r\n   */\r\n  constructor(loadables?: Loadable<any>[]) {\r\n    super();\r\n\r\n    if (loadables) {\r\n      this.addResources(loadables);\r\n    }\r\n  }\r\n\r\n  public wireEngine(engine: Engine) {\r\n    this._engine = engine;\r\n    this.canvas.width = this._engine.canvas.width;\r\n    this.canvas.height = this._engine.canvas.height;\r\n  }\r\n\r\n  /**\r\n   * Add a resource to the loader to load\r\n   * @param loadable  Resource to add\r\n   */\r\n  public addResource(loadable: Loadable<any>) {\r\n    const key = this._index++;\r\n    this._resourceList.push(loadable);\r\n    this._progressCounts[key] = 0;\r\n    this._totalCounts[key] = 1;\r\n    this._resourceCount++;\r\n  }\r\n\r\n  /**\r\n   * Add a list of resources to the loader to load\r\n   * @param loadables  The list of resources to load\r\n   */\r\n  public addResources(loadables: Loadable<any>[]) {\r\n    let i = 0;\r\n    const len = loadables.length;\r\n\r\n    for (i; i < len; i++) {\r\n      this.addResource(loadables[i]);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns true if the loader has completely loaded all resources\r\n   */\r\n  public isLoaded() {\r\n    return this._numLoaded === this._resourceCount;\r\n  }\r\n\r\n  /**\r\n   * Shows the play button and returns a promise that resolves when clicked\r\n   */\r\n  public async showPlayButton(): Promise<void> {\r\n    if (this.suppressPlayButton) {\r\n      this.hidePlayButton();\r\n      // Delay is to give the logo a chance to show, otherwise don't delay\r\n      await delay(500, this._engine?.clock);\r\n    } else {\r\n      const resizeHandler = () => {\r\n        this._positionPlayButton();\r\n      };\r\n      if (this._engine?.browser) {\r\n        this._engine.browser.window.on('resize', resizeHandler);\r\n      }\r\n      this._playButtonShown = true;\r\n      this._playButton.style.display = 'block';\r\n      document.body.addEventListener('keyup', (evt: KeyboardEvent) => {\r\n        if (evt.key === 'Enter') {\r\n          this._playButton.click();\r\n        }\r\n      });\r\n      this._positionPlayButton();\r\n      const playButtonClicked = new Promise<void>((resolve) => {\r\n        const startButtonHandler = (e: Event) => {\r\n          // We want to stop propagation to keep bubbling to the engine pointer handlers\r\n          e.stopPropagation();\r\n          // Hide Button after click\r\n          this.hidePlayButton();\r\n          if (this._engine?.browser) {\r\n            this._engine.browser.window.off('resize', resizeHandler);\r\n          }\r\n          resolve();\r\n        };\r\n        this._playButton.addEventListener('click', startButtonHandler);\r\n        this._playButton.addEventListener('touchend', startButtonHandler);\r\n        this._playButton.addEventListener('pointerup', startButtonHandler);\r\n      });\r\n\r\n      return await playButtonClicked;\r\n    }\r\n  }\r\n\r\n  public hidePlayButton() {\r\n    this._playButtonShown = false;\r\n    this._playButton.style.display = 'none';\r\n  }\r\n\r\n  /**\r\n   * Clean up generated elements for the loader\r\n   */\r\n  public dispose() {\r\n    if (this._playButtonRootElement.parentElement) {\r\n      this._playButtonRootElement.removeChild(this._playButtonElement);\r\n      document.body.removeChild(this._playButtonRootElement);\r\n      document.head.removeChild(this._styleBlock);\r\n      this._playButtonRootElement = null;\r\n      this._playButtonElement = null;\r\n      this._styleBlock = null;\r\n    }\r\n  }\r\n\r\n  update(_engine: Engine, _delta: number): void {\r\n    // override me\r\n  }\r\n\r\n  data: Loadable<any>[];\r\n\r\n  private _isLoadedResolve: () => any;\r\n  private _isLoadedPromise = new Promise<void>(resolve => {\r\n    this._isLoadedResolve = resolve;\r\n  });\r\n  public areResourcesLoaded() {\r\n    return this._isLoadedPromise;\r\n  }\r\n\r\n  /**\r\n   * Begin loading all of the supplied resources, returning a promise\r\n   * that resolves when loading of all is complete AND the user has clicked the \"Play button\"\r\n   */\r\n  public async load(): Promise<Loadable<any>[]> {\r\n    await this._image?.decode(); // decode logo if it exists\r\n\r\n    await Promise.all(\r\n      this._resourceList.map((r) =>\r\n        r.load().finally(() => {\r\n          // capture progress\r\n          this._numLoaded++;\r\n        })\r\n      )\r\n    );\r\n    this._isLoadedResolve();\r\n\r\n    // short delay in showing the button for aesthetics\r\n    await delay(200, this._engine?.clock);\r\n\r\n    await this.showPlayButton();\r\n    // Unlock browser AudioContext in after user gesture\r\n    // See: https://github.com/excaliburjs/Excalibur/issues/262\r\n    // See: https://github.com/excaliburjs/Excalibur/issues/1031\r\n    await WebAudio.unlock();\r\n\r\n    return (this.data = this._resourceList);\r\n  }\r\n\r\n  public markResourceComplete(): void {\r\n    this._numLoaded++;\r\n  }\r\n\r\n  /**\r\n   * Returns the progress of the loader as a number between [0, 1] inclusive.\r\n   */\r\n  public get progress(): number {\r\n    return this._resourceCount > 0 ? clamp(this._numLoaded, 0, this._resourceCount) / this._resourceCount : 1;\r\n  }\r\n\r\n  private _positionPlayButton() {\r\n    if (this._engine) {\r\n      const screenHeight = this._engine.screen.viewport.height;\r\n      const screenWidth = this._engine.screen.viewport.width;\r\n      if (this._playButtonRootElement) {\r\n        const left = this._engine.canvas.offsetLeft;\r\n        const top = this._engine.canvas.offsetTop;\r\n        const buttonWidth = this._playButton.clientWidth;\r\n        const buttonHeight = this._playButton.clientHeight;\r\n        if (this.playButtonPosition) {\r\n          this._playButtonRootElement.style.left = `${this.playButtonPosition.x}px`;\r\n          this._playButtonRootElement.style.top = `${this.playButtonPosition.y}px`;\r\n        } else {\r\n          this._playButtonRootElement.style.left = `${left + screenWidth / 2 - buttonWidth / 2}px`;\r\n          this._playButtonRootElement.style.top = `${top + screenHeight / 2 - buttonHeight / 2 + 100}px`;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Loader draw function. Draws the default Excalibur loading screen.\r\n   * Override `logo`, `logoWidth`, `logoHeight` and `backgroundColor` properties\r\n   * to customize the drawing, or just override entire method.\r\n   */\r\n  public draw(ctx: CanvasRenderingContext2D) {\r\n    const canvasHeight = this._engine.canvasHeight / this._engine.pixelRatio;\r\n    const canvasWidth = this._engine.canvasWidth / this._engine.pixelRatio;\r\n\r\n    this._positionPlayButton();\r\n\r\n    ctx.fillStyle = this.backgroundColor;\r\n    ctx.fillRect(0, 0, canvasWidth, canvasHeight);\r\n\r\n    let logoY = canvasHeight / 2;\r\n    const width = Math.min(this.logoWidth, canvasWidth * 0.75);\r\n    let logoX = canvasWidth / 2 - width / 2;\r\n\r\n    if (this.logoPosition) {\r\n      logoX = this.logoPosition.x;\r\n      logoY = this.logoPosition.y;\r\n    }\r\n\r\n    const imageHeight = Math.floor(width * (this.logoHeight / this.logoWidth)); // OG height/width factor\r\n    const oldAntialias = this._engine.getAntialiasing();\r\n    this._engine.setAntialiasing(true);\r\n    if (!this.logoPosition) {\r\n      ctx.drawImage(this._image, 0, 0, this.logoWidth, this.logoHeight, logoX, logoY - imageHeight - 20, width, imageHeight);\r\n    } else {\r\n      ctx.drawImage(this._image, 0, 0, this.logoWidth, this.logoHeight, logoX, logoY, width, imageHeight);\r\n    }\r\n\r\n    // loading box\r\n    if (!this.suppressPlayButton && this._playButtonShown) {\r\n      this._engine.setAntialiasing(oldAntialias);\r\n      return;\r\n    }\r\n\r\n    let loadingX = logoX;\r\n    let loadingY = logoY;\r\n    if (this.loadingBarPosition) {\r\n      loadingX = this.loadingBarPosition.x;\r\n      loadingY = this.loadingBarPosition.y;\r\n    }\r\n\r\n    ctx.lineWidth = 2;\r\n    DrawUtil.roundRect(ctx, loadingX, loadingY, width, 20, 10, this.loadingBarColor);\r\n    const progress = width * this.progress;\r\n    const margin = 5;\r\n    const progressWidth = progress - margin * 2;\r\n    const height = 20 - margin * 2;\r\n    DrawUtil.roundRect(\r\n      ctx,\r\n      loadingX + margin,\r\n      loadingY + margin,\r\n      progressWidth > 10 ? progressWidth : 10,\r\n      height,\r\n      5,\r\n      null,\r\n      this.loadingBarColor\r\n    );\r\n    this._engine.setAntialiasing(oldAntialias);\r\n  }\r\n}\r\n","import { Logger } from './Log';\r\n/**\r\n * This is the list of features that will be used to log the supported\r\n * features to the console when Detector.logBrowserFeatures() is called.\r\n */\r\n\r\nconst REPORTED_FEATURES: { [key: string]: string } = {\r\n  webgl: 'WebGL',\r\n  webaudio: 'WebAudio',\r\n  gamepadapi: 'Gamepad API'\r\n};\r\n\r\n/**\r\n * Interface for detected browser features matrix\r\n */\r\nexport interface DetectedFeatures {\r\n  readonly canvas: boolean;\r\n  readonly arraybuffer: boolean;\r\n  readonly dataurl: boolean;\r\n  readonly objecturl: boolean;\r\n  readonly rgba: boolean;\r\n  readonly webaudio: boolean;\r\n  readonly webgl: boolean;\r\n  readonly gamepadapi: boolean;\r\n}\r\n\r\ninterface CriticalTests {\r\n  canvasSupport(): boolean;\r\n  arrayBufferSupport(): boolean;\r\n  dataUrlSupport(): boolean;\r\n  objectUrlSupport(): boolean;\r\n  rgbaSupport(): boolean;\r\n}\r\n\r\ninterface WarningTests {\r\n  webAudioSupport(): boolean;\r\n  webglSupport(): boolean;\r\n}\r\n\r\n/**\r\n * Excalibur internal feature detection helper class\r\n */\r\nexport class Detector {\r\n  private _features: DetectedFeatures = null;\r\n\r\n  public failedTests: string[] = [];\r\n\r\n  public constructor() {\r\n    this._features = this._loadBrowserFeatures();\r\n  }\r\n\r\n  /**\r\n   * Returns a map of currently supported browser features. This method\r\n   * treats the features as a singleton and will only calculate feature\r\n   * support if it has not previously been done.\r\n   */\r\n  public getBrowserFeatures(): DetectedFeatures {\r\n    if (this._features === null) {\r\n      this._features = this._loadBrowserFeatures();\r\n    }\r\n    return this._features;\r\n  }\r\n\r\n  /**\r\n   * Report on non-critical browser support for debugging purposes.\r\n   * Use native browser console colors for visibility.\r\n   */\r\n  public logBrowserFeatures(): void {\r\n    let msg = '%cSUPPORTED BROWSER FEATURES\\n==========================%c\\n';\r\n    const args = ['font-weight: bold; color: navy', 'font-weight: normal; color: inherit'];\r\n\r\n    const supported: any = this.getBrowserFeatures();\r\n    for (const feature of Object.keys(REPORTED_FEATURES)) {\r\n      if (supported[feature]) {\r\n        msg += '(%c\\u2713%c)'; // ()\r\n        args.push('font-weight: bold; color: green');\r\n        args.push('font-weight: normal; color: inherit');\r\n      } else {\r\n        msg += '(%c\\u2717%c)'; // ()\r\n        args.push('font-weight: bold; color: red');\r\n        args.push('font-weight: normal; color: inherit');\r\n      }\r\n\r\n      msg += ' ' + REPORTED_FEATURES[feature] + '\\n';\r\n    }\r\n\r\n    args.unshift(msg);\r\n    // eslint-disable-next-line no-console\r\n    console.log.apply(console, args);\r\n  }\r\n\r\n  /**\r\n   * Executes several IIFE's to get a constant reference to supported\r\n   * features within the current execution context.\r\n   */\r\n  private _loadBrowserFeatures(): DetectedFeatures {\r\n    return {\r\n      // IIFE to check canvas support\r\n      canvas: (() => {\r\n        return this._criticalTests.canvasSupport();\r\n      })(),\r\n\r\n      // IIFE to check arraybuffer support\r\n      arraybuffer: (() => {\r\n        return this._criticalTests.arrayBufferSupport();\r\n      })(),\r\n\r\n      // IIFE to check dataurl support\r\n      dataurl: (() => {\r\n        return this._criticalTests.dataUrlSupport();\r\n      })(),\r\n\r\n      // IIFE to check objecturl support\r\n      objecturl: (() => {\r\n        return this._criticalTests.objectUrlSupport();\r\n      })(),\r\n\r\n      // IIFE to check rgba support\r\n      rgba: (() => {\r\n        return this._criticalTests.rgbaSupport();\r\n      })(),\r\n\r\n      // IIFE to check webaudio support\r\n      webaudio: (() => {\r\n        return this._warningTest.webAudioSupport();\r\n      })(),\r\n\r\n      // IIFE to check webgl support\r\n      webgl: (() => {\r\n        return this._warningTest.webglSupport();\r\n      })(),\r\n\r\n      // IIFE to check gamepadapi support\r\n      gamepadapi: (() => {\r\n        return !!(<any>navigator).getGamepads;\r\n      })()\r\n    };\r\n  }\r\n\r\n  // critical browser features required for ex to run\r\n  private _criticalTests: CriticalTests = {\r\n    // Test canvas/2d context support\r\n    canvasSupport: function() {\r\n      const elem = document.createElement('canvas');\r\n      return !!(elem.getContext && elem.getContext('2d'));\r\n    },\r\n\r\n    // Test array buffer support ex uses for downloading binary data\r\n    arrayBufferSupport: function() {\r\n      const xhr = new XMLHttpRequest();\r\n      xhr.open('GET', '/');\r\n      try {\r\n        xhr.responseType = 'arraybuffer';\r\n      } catch (e) {\r\n        return false;\r\n      }\r\n      return xhr.responseType === 'arraybuffer';\r\n    },\r\n\r\n    // Test data urls ex uses for sprites\r\n    dataUrlSupport: function() {\r\n      const canvas = document.createElement('canvas');\r\n      return canvas.toDataURL('image/png').indexOf('data:image/png') === 0;\r\n    },\r\n\r\n    // Test object url support for loading\r\n    objectUrlSupport: function() {\r\n      return 'URL' in window && 'revokeObjectURL' in URL && 'createObjectURL' in URL;\r\n    },\r\n\r\n    // RGBA support for colors\r\n    rgbaSupport: function() {\r\n      const style = document.createElement('a').style;\r\n      style.cssText = 'background-color:rgba(150,255,150,.5)';\r\n      return ('' + style.backgroundColor).indexOf('rgba') > -1;\r\n    }\r\n  };\r\n\r\n  // warnings excalibur performance will be degraded\r\n  private _warningTest: WarningTests = {\r\n    webAudioSupport: function() {\r\n      return !!(\r\n        (<any>window).AudioContext ||\r\n        (<any>window).webkitAudioContext ||\r\n        (<any>window).mozAudioContext ||\r\n        (<any>window).msAudioContext ||\r\n        (<any>window).oAudioContext\r\n      );\r\n    },\r\n    webglSupport: function() {\r\n      const elem = document.createElement('canvas');\r\n      return !!(elem.getContext && elem.getContext('webgl'));\r\n    }\r\n  };\r\n\r\n  public test(): boolean {\r\n    // Critical test will for ex not to run\r\n    let failedCritical = false;\r\n    for (const test in this._criticalTests) {\r\n      if (!this._criticalTests[<keyof CriticalTests>test].call(this)) {\r\n        this.failedTests.push(test);\r\n        Logger.getInstance().error('Critical browser feature missing, Excalibur requires:', test);\r\n        failedCritical = true;\r\n      }\r\n    }\r\n    if (failedCritical) {\r\n      return false;\r\n    }\r\n\r\n    // Warning tests do not for ex to return false to compatibility\r\n    for (const warning in this._warningTest) {\r\n      if (!this._warningTest[<keyof WarningTests>warning]()) {\r\n        Logger.getInstance().warn('Warning browser feature missing, Excalibur will have reduced performance:', warning);\r\n      }\r\n    }\r\n\r\n    return true;\r\n  }\r\n}\r\n","/**\r\n * An enum that describes the types of collisions bodies can participate in\r\n */\r\nexport enum CollisionType {\r\n  /**\r\n   * Bodies with the `PreventCollision` setting do not participate in any\r\n   * collisions and do not raise collision events.\r\n   */\r\n  PreventCollision = 'PreventCollision',\r\n  /**\r\n   * Bodies with the `Passive` setting only raise collision events, but are not\r\n   * influenced or moved by other bodies and do not influence or move other bodies.\r\n   * This is useful for use in trigger type behavior.\r\n   */\r\n  Passive = 'Passive',\r\n  /**\r\n   * Bodies with the `Active` setting raise collision events and participate\r\n   * in collisions with other bodies and will be push or moved by bodies sharing\r\n   * the `Active` or `Fixed` setting.\r\n   */\r\n  Active = 'Active',\r\n  /**\r\n   * Bodies with the `Fixed` setting raise collision events and participate in\r\n   * collisions with other bodies. Actors with the `Fixed` setting will not be\r\n   * pushed or moved by other bodies sharing the `Fixed`. Think of Fixed\r\n   * bodies as \"immovable/unstoppable\" objects. If two `Fixed` bodies meet they will\r\n   * not be pushed or moved by each other, they will not interact except to throw\r\n   * collision events.\r\n   */\r\n  Fixed = 'Fixed'\r\n}\r\n","import { Vector } from '../Math/vector';\r\nimport { obsolete } from '../Util/Decorators';\r\n\r\n\r\n/**\r\n * Possible collision resolution strategies\r\n *\r\n * The default is [[CollisionResolutionStrategy.Arcade]] which performs simple axis aligned arcade style physics. This is useful for things\r\n * like platformers or top down games.\r\n *\r\n * More advanced rigid body physics are enabled by setting [[CollisionResolutionStrategy.Realistic]] which allows for complicated\r\n * simulated physical interactions.\r\n */\r\nexport enum CollisionResolutionStrategy {\r\n  Arcade = 'arcade',\r\n  Realistic = 'realistic'\r\n}\r\n\r\n/**\r\n * Possible broadphase collision pair identification strategies\r\n *\r\n * The default strategy is [[BroadphaseStrategy.DynamicAABBTree]] which uses a binary tree of axis-aligned bounding boxes to identify\r\n * potential collision pairs which is O(nlog(n)) faster.\r\n */\r\nexport enum BroadphaseStrategy {\r\n  DynamicAABBTree\r\n}\r\n\r\n/**\r\n * Possible numerical integrators for position and velocity\r\n */\r\nexport enum Integrator {\r\n  Euler\r\n}\r\n\r\n/**\r\n * The [[Physics]] object is the global configuration object for all Excalibur physics.\r\n */\r\n/* istanbul ignore next */\r\nexport class Physics {\r\n  /**\r\n   * Global acceleration that is applied to all vanilla actors that have a [[CollisionType.Active|active]] collision type.\r\n   * Global acceleration won't effect [[Label|labels]], [[ScreenElement|ui actors]], or [[Trigger|triggers]] in Excalibur.\r\n   *\r\n   * This is a great way to globally simulate effects like gravity.\r\n   */\r\n  public static acc = new Vector(0, 0);\r\n  public static get gravity() {\r\n    return Physics.acc;\r\n  }\r\n  public static set gravity(v: Vector) {\r\n    Physics.acc = v;\r\n  }\r\n\r\n  /**\r\n   * Globally switches all Excalibur physics behavior on or off.\r\n   */\r\n  public static enabled = true;\r\n\r\n  /**\r\n   * Gets or sets the broadphase pair identification strategy.\r\n   *\r\n   * The default strategy is [[BroadphaseStrategy.DynamicAABBTree]] which uses a binary tree of axis-aligned bounding boxes to identify\r\n   * potential collision pairs which is O(nlog(n)) faster.\r\n   */\r\n  public static broadphaseStrategy: BroadphaseStrategy = BroadphaseStrategy.DynamicAABBTree;\r\n\r\n  /**\r\n   * Gets or sets the global collision resolution strategy (narrowphase).\r\n   *\r\n   * The default is [[CollisionResolutionStrategy.Arcade]] which performs simple axis aligned arcade style physics.\r\n   *\r\n   * More advanced rigid body physics are enabled by setting [[CollisionResolutionStrategy.Realistic]] which allows for complicated\r\n   * simulated physical interactions.\r\n   */\r\n  public static collisionResolutionStrategy: CollisionResolutionStrategy = CollisionResolutionStrategy.Arcade;\r\n  /**\r\n   * The default mass to use if none is specified\r\n   */\r\n  public static defaultMass: number = 10;\r\n  /**\r\n   * Gets or sets the position and velocity positional integrator, currently only Euler is supported.\r\n   */\r\n  public static integrator: Integrator = Integrator.Euler;\r\n\r\n  /**\r\n   * Configures Excalibur to use \"arcade\" physics. Arcade physics which performs simple axis aligned arcade style physics.\r\n   */\r\n  public static useArcadePhysics(): void {\r\n    Physics.collisionResolutionStrategy = CollisionResolutionStrategy.Arcade;\r\n  }\r\n\r\n  /**\r\n   * Configures Excalibur to use rigid body physics. Rigid body physics allows for complicated\r\n   * simulated physical interactions.\r\n   */\r\n  public static useRealisticPhysics(): void {\r\n    Physics.collisionResolutionStrategy = CollisionResolutionStrategy.Realistic;\r\n  }\r\n\r\n  /**\r\n   * Factor to add to the RigidBody BoundingBox, bounding box (dimensions += vel * dynamicTreeVelocityMultiplier);\r\n   */\r\n  public static dynamicTreeVelocityMultiplier = 2;\r\n\r\n  @obsolete({\r\n    message: 'Alias for incorrect spelling used in older versions, will be removed in v0.25.0',\r\n    alternateMethod: 'dynamicTreeVelocityMultiplier'\r\n  })\r\n  public static get dynamicTreeVelocityMultiplyer() {\r\n    return Physics.dynamicTreeVelocityMultiplier;\r\n  }\r\n\r\n  public static set dynamicTreeVelocityMultiplyer(value: number) {\r\n    Physics.dynamicTreeVelocityMultiplier = value;\r\n  }\r\n\r\n  /**\r\n   * Pad RigidBody BoundingBox by a constant amount\r\n   */\r\n  public static boundsPadding = 5;\r\n\r\n  /**\r\n   * Number of position iterations (overlap) to run in the solver\r\n   */\r\n  public static positionIterations = 3;\r\n\r\n  /**\r\n   * Number of velocity iteration (response) to run in the solver\r\n   */\r\n  public static velocityIterations = 8;\r\n\r\n  /**\r\n   * Amount of overlap to tolerate in pixels\r\n   */\r\n  public static slop = 1;\r\n\r\n  /**\r\n   * Amount of positional overlap correction to apply each position iteration of the solver\r\n   * O - meaning no correction, 1 - meaning correct all overlap\r\n   */\r\n  public static steeringFactor = 0.2;\r\n\r\n  /**\r\n   * Warm start set to true re-uses impulses from previous frames back in the solver\r\n   */\r\n  public static warmStart = true;\r\n\r\n  /**\r\n   * By default bodies do not sleep\r\n   */\r\n  public static bodiesCanSleepByDefault = false;\r\n\r\n  /**\r\n   * Surface epsilon is used to help deal with surface penetration\r\n   */\r\n  public static surfaceEpsilon = 0.1;\r\n\r\n  public static sleepEpsilon = 0.07;\r\n\r\n  public static wakeThreshold = Physics.sleepEpsilon * 3;\r\n\r\n  public static sleepBias = 0.9;\r\n\r\n  /**\r\n   * Enable fast moving body checking, this enables checking for collision pairs via raycast for fast moving objects to prevent\r\n   * bodies from tunneling through one another.\r\n   */\r\n  public static checkForFastBodies = true;\r\n\r\n  /**\r\n   * Disable minimum fast moving body raycast, by default if ex.Physics.checkForFastBodies = true Excalibur will only check if the\r\n   * body is moving at least half of its minimum dimension in an update. If ex.Physics.disableMinimumSpeedForFastBody is set to true,\r\n   * Excalibur will always perform the fast body raycast regardless of speed.\r\n   */\r\n  public static disableMinimumSpeedForFastBody = false;\r\n}\r\n","import { Vector } from './vector';\r\n\r\nexport interface VectorViewOptions {\r\n  getX: () => number;\r\n  getY: () => number;\r\n  setX: (x: number) => void;\r\n  setY: (y: number) => void;\r\n}\r\nexport class VectorView extends Vector {\r\n  private _getX: () => number;\r\n  private _getY: () => number;\r\n  private _setX: (x: number) => void;\r\n  private _setY: (y: number) => void;\r\n  constructor(options: VectorViewOptions) {\r\n    super(0, 0);\r\n    this._getX = options.getX;\r\n    this._getY = options.getY;\r\n    this._setX = options.setX;\r\n    this._setY = options.setY;\r\n  }\r\n  public get x() {\r\n    return (this._x = this._getX());\r\n  }\r\n\r\n  public set x(val) {\r\n    this._setX(val);\r\n    this._x = val;\r\n  }\r\n\r\n  public get y() {\r\n    return (this._y = this._getY());\r\n  }\r\n  public set y(val) {\r\n    this._setY(val);\r\n    this._y = val;\r\n  }\r\n}\r\n","import { Entity } from './Entity';\r\n\r\n/**\r\n * Component Contructor Types\r\n */\r\nexport declare type ComponentCtor<T extends Component = Component> = new (...args:any[]) => T;\r\n\r\n/**\r\n * Type guard to check if a component implements clone\r\n * @param x\r\n */\r\nfunction hasClone(x: any): x is { clone(): any } {\r\n  return !!x?.clone;\r\n}\r\n\r\nexport type ComponentType<ComponentToParse> = ComponentToParse extends Component<infer TypeName> ? TypeName : never;\r\n\r\n/**\r\n * Plucks the string type out of a component type\r\n */\r\nexport type ComponentStringType<T> = T extends Component<infer R> ? R : string;\r\n\r\n/**\r\n * Components are containers for state in Excalibur, the are meant to convey capabilities that an Entity possesses\r\n *\r\n * Implementations of Component must have a zero-arg constructor to support dependencies\r\n *\r\n * ```typescript\r\n * class MyComponent extends ex.Component<'my'> {\r\n *   public readonly type = 'my';\r\n *   // zero arg support required if you want to use component dependencies\r\n *   constructor(public optionalPos?: ex.Vector) {}\r\n * }\r\n * ```\r\n */\r\nexport abstract class Component<TypeName extends string = string> {\r\n  /**\r\n   * Optionally list any component types this component depends on\r\n   * If the owner entity does not have these components, new components will be added to the entity\r\n   *\r\n   * Only components with zero-arg constructors are supported as automatic component dependencies\r\n   */\r\n  readonly dependencies?: ComponentCtor[];\r\n\r\n  // todo implement optional\r\n  readonly optional?: ComponentCtor[];\r\n\r\n  /**\r\n   * Type of this component, must be a unique type among component types in you game.\r\n   */\r\n  abstract readonly type: TypeName;\r\n\r\n  /**\r\n   * Current owning [[Entity]], if any, of this component. Null if not added to any [[Entity]]\r\n   */\r\n  owner?: Entity = null;\r\n\r\n  /**\r\n   * Clones any properties on this component, if that property value has a `clone()` method it will be called\r\n   */\r\n  clone(): this {\r\n    const newComponent = new (this.constructor as any)();\r\n    for (const prop in this) {\r\n      if (this.hasOwnProperty(prop)) {\r\n        const val = this[prop];\r\n        if (hasClone(val) && prop !== 'owner' && prop !== 'clone') {\r\n          newComponent[prop] = val.clone();\r\n        } else {\r\n          newComponent[prop] = val;\r\n        }\r\n      }\r\n    }\r\n    return newComponent;\r\n  }\r\n\r\n  /**\r\n   * Optional callback called when a component is added to an entity\r\n   */\r\n  onAdd?(owner: Entity): void;\r\n\r\n  /**\r\n   * Optional callback called when a component is added to an entity\r\n   */\r\n  onRemove?(previousOwner: Entity): void;\r\n}\r\n\r\n/**\r\n * Tag components are a way of tagging a component with label and a simple value\r\n *\r\n * For example:\r\n *\r\n * ```typescript\r\n * const isOffscreen = new TagComponent('offscreen');\r\n * entity.addComponent(isOffscreen);\r\n * entity.tags.includes\r\n * ```\r\n */\r\nexport class TagComponent<TypeName extends string, MaybeValueType extends string | symbol | number | boolean = never> extends Component<\r\nTypeName\r\n> {\r\n  constructor(public readonly type: TypeName, public readonly value?: MaybeValueType) {\r\n    super();\r\n  }\r\n}\r\n","import { Matrix, MatrixLocations } from '../../Math/matrix';\r\nimport { VectorView } from '../../Math/vector-view';\r\nimport { Vector, vec } from '../../Math/vector';\r\nimport { Component } from '../Component';\r\n\r\nexport interface Transform {\r\n  /**\r\n   * The [[CoordPlane|coordinate plane]] for this transform for the entity.\r\n   */\r\n  coordPlane: CoordPlane;\r\n\r\n  /**\r\n   * The current position of the entity in world space or in screen space depending on the the [[CoordPlane|coordinate plane]].\r\n   *\r\n   * If the entity has a parent this position is relative to the parent entity.\r\n   */\r\n  pos: Vector;\r\n\r\n  /**\r\n   * The z-index ordering of the entity, a higher values are drawn on top of lower values.\r\n   * For example z=99 would be drawn on top of z=0.\r\n   */\r\n  z: number;\r\n\r\n  /**\r\n   * The rotation of the entity in radians. For example `Math.PI` radians is the same as 180 degrees.\r\n   *\r\n   * If the entity has a parent this rotation is relative to the parent.\r\n   */\r\n  rotation: number;\r\n\r\n  /**\r\n   * The scale of the entity. If the entity has a parent this scale is relative to the parent.\r\n   */\r\n  scale: Vector;\r\n}\r\n\r\nconst createPosView = (matrix: Matrix) => {\r\n  const source = matrix;\r\n  return new VectorView({\r\n    setX: (x) => {\r\n      source.data[MatrixLocations.X] = x;\r\n    },\r\n    setY: (y) => {\r\n      source.data[MatrixLocations.Y] = y;\r\n    },\r\n    getX: () => {\r\n      return source.data[MatrixLocations.X];\r\n    },\r\n    getY: () => {\r\n      return source.data[MatrixLocations.Y];\r\n    }\r\n  });\r\n};\r\n\r\nconst createScaleView = (matrix: Matrix) => {\r\n  const source = matrix;\r\n  return new VectorView({\r\n    setX: (x) => {\r\n      source.setScaleX(x);\r\n    },\r\n    setY: (y) => {\r\n      source.setScaleY(y);\r\n    },\r\n    getX: () => {\r\n      return source.getScaleX();\r\n    },\r\n    getY: () => {\r\n      return source.getScaleY();\r\n    }\r\n  });\r\n};\r\n\r\n/**\r\n * Enum representing the coordinate plane for the position 2D vector in the [[TransformComponent]]\r\n */\r\nexport enum CoordPlane {\r\n  /**\r\n   * The world coordinate plane (default) represents world space, any entities drawn with world\r\n   * space move when the camera moves.\r\n   */\r\n  World = 'world',\r\n  /**\r\n   * The screen coordinate plane represents screen space, entities drawn in screen space are pinned\r\n   * to screen coordinates ignoring the camera.\r\n   */\r\n  Screen = 'screen'\r\n}\r\n\r\nexport class TransformComponent extends Component<'ex.transform'> implements Transform {\r\n  public readonly type = 'ex.transform';\r\n\r\n  private _dirty = false;\r\n\r\n  public readonly matrix = Matrix.identity().translate(0, 0).rotate(0).scale(1, 1);\r\n  private _position = createPosView(this.matrix);\r\n  private _rotation = 0;\r\n  private _scale = createScaleView(this.matrix);\r\n\r\n  private _recalculate() {\r\n    this._rotation = this.matrix.getRotation();\r\n    this._dirty = false;\r\n  }\r\n\r\n  public getGlobalMatrix(): Matrix {\r\n    if (!this.parent) {\r\n      return this.matrix;\r\n    } else {\r\n      return this.parent.getGlobalMatrix().multm(this.matrix);\r\n    }\r\n  }\r\n\r\n  public getGlobalTransform(): Transform {\r\n    return {\r\n      pos: this.globalPos,\r\n      scale: this.globalScale,\r\n      rotation: this.globalRotation,\r\n      z: this.z,\r\n      coordPlane: this.coordPlane\r\n    };\r\n  }\r\n\r\n  public get parent(): TransformComponent | null {\r\n    return this?.owner?.parent?.get(TransformComponent);\r\n  }\r\n\r\n  /**\r\n   * The [[CoordPlane|coordinate plane|]] for this transform for the entity.\r\n   */\r\n  public coordPlane = CoordPlane.World;\r\n\r\n  /**\r\n   * The current position of the entity in world space or in screen space depending on the the [[CoordPlane|coordinate plane]].\r\n   *\r\n   * If a parent entity exists coordinates are local to the parent.\r\n   */\r\n  public get pos(): Vector {\r\n    if (this._dirty) {\r\n      this._recalculate();\r\n    }\r\n    return this._position;\r\n  }\r\n\r\n  public set pos(val: Vector) {\r\n    this.matrix.setPosition(val.x, val.y);\r\n    this._dirty = true;\r\n  }\r\n\r\n  // Dirty flag check up the chain\r\n  public get dirty(): boolean {\r\n    if (this?.owner?.parent) {\r\n      const parent = this.parent;\r\n      return parent.dirty || this._dirty;\r\n    }\r\n    return this._dirty;\r\n  }\r\n\r\n  /**\r\n   * The current world position calculated\r\n   */\r\n  public get globalPos(): Vector {\r\n    const source = this.getGlobalMatrix();\r\n    return new VectorView({\r\n      getX: () => source.data[MatrixLocations.X],\r\n      getY: () => source.data[MatrixLocations.Y],\r\n      setX: (x) => {\r\n        if (this.parent) {\r\n          const [newX] = this.parent?.getGlobalMatrix().getAffineInverse().multv([x, source.data[MatrixLocations.Y]]);\r\n          this.matrix.data[MatrixLocations.X] = newX;\r\n        } else {\r\n          this.matrix.data[MatrixLocations.X] = x;\r\n        }\r\n      },\r\n      setY: (y) => {\r\n        if (this.parent) {\r\n          const [, newY] = this.parent?.getGlobalMatrix().getAffineInverse().multv([source.data[MatrixLocations.X], y]);\r\n          this.matrix.data[MatrixLocations.Y] = newY;\r\n        } else {\r\n          this.matrix.data[MatrixLocations.Y] = y;\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  public set globalPos(val: Vector) {\r\n    const parentTransform = this.parent;\r\n    if (!parentTransform) {\r\n      this.pos = val;\r\n    } else {\r\n      this.pos = parentTransform.getGlobalMatrix().getAffineInverse().multv(val);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * The z-index ordering of the entity, a higher values are drawn on top of lower values.\r\n   * For example z=99 would be drawn on top of z=0.\r\n   */\r\n  public z: number = 0;\r\n\r\n  /**\r\n   * The rotation of the entity in radians. For example `Math.PI` radians is the same as 180 degrees.\r\n   */\r\n  public get rotation(): number {\r\n    if (this._dirty) {\r\n      this._recalculate();\r\n    }\r\n    return this._rotation;\r\n  }\r\n\r\n  public set rotation(val: number) {\r\n    this.matrix.setRotation(val);\r\n    this._dirty = true;\r\n  }\r\n\r\n  public get globalRotation(): number {\r\n    return this.getGlobalMatrix().getRotation();\r\n  }\r\n\r\n  public set globalRotation(val: number) {\r\n    const parentTransform = this.parent;\r\n    if (!parentTransform) {\r\n      this.rotation = val;\r\n    } else {\r\n      this.rotation = val - parentTransform.globalRotation;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * The scale of the entity.\r\n   */\r\n  public get scale(): Vector {\r\n    if (this._dirty) {\r\n      this._recalculate();\r\n    }\r\n    return this._scale;\r\n  }\r\n\r\n  public set scale(val: Vector) {\r\n    this.matrix.setScale(val);\r\n    this._dirty = true;\r\n  }\r\n\r\n  public get globalScale(): Vector {\r\n    const source = this.getGlobalMatrix();\r\n    return new VectorView({\r\n      getX: () => source.getScaleX(),\r\n      getY: () => source.getScaleY(),\r\n      setX: (x) => {\r\n        if (this.parent) {\r\n          const globalScaleX = this.parent.globalScale.x;\r\n          this.matrix.setScaleX(x / globalScaleX);\r\n        } else {\r\n          this.matrix.setScaleX(x);\r\n        }\r\n      },\r\n      setY: (y) => {\r\n        if (this.parent) {\r\n          const globalScaleY = this.parent.globalScale.y;\r\n          this.matrix.setScaleY(y / globalScaleY);\r\n        } else {\r\n          this.matrix.setScaleY(y);\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  public set globalScale(val: Vector) {\r\n    const parentTransform = this.parent;\r\n    if (!parentTransform) {\r\n      this.scale = val;\r\n    } else {\r\n      this.scale = vec(val.x / parentTransform.globalScale.x, val.y / parentTransform.globalScale.y);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Apply the transform to a point\r\n   * @param point\r\n   */\r\n  public apply(point: Vector): Vector {\r\n    return this.matrix.multv(point);\r\n  }\r\n\r\n  /**\r\n   * Apply the inverse transform to a point\r\n   * @param point\r\n   */\r\n  public applyInverse(point: Vector): Vector {\r\n    return this.matrix.getAffineInverse().multv(point);\r\n  }\r\n}\r\n","import { Vector } from '../../Math/vector';\r\nimport { Component } from '../Component';\r\n\r\nexport interface Motion {\r\n  /**\r\n   * The velocity of an entity in pixels per second\r\n   */\r\n  vel: Vector;\r\n\r\n  /**\r\n   * The acceleration of entity in pixels per second^2\r\n   */\r\n  acc: Vector;\r\n\r\n  /**\r\n   * The scale rate of change in scale units per second\r\n   */\r\n  scaleFactor: Vector;\r\n\r\n  /**\r\n   * The angular velocity which is how quickly the entity is rotating in radians per second\r\n   */\r\n  angularVelocity: number;\r\n\r\n  /**\r\n   * The amount of torque applied to the entity, angular acceleration is torque * inertia\r\n   */\r\n  torque: number;\r\n\r\n  /**\r\n   * Inertia can be thought of as the resistance to motion\r\n   */\r\n  inertia: number;\r\n}\r\n\r\nexport class MotionComponent extends Component<'ex.motion'> {\r\n  public readonly type = 'ex.motion';\r\n\r\n  /**\r\n   * The velocity of an entity in pixels per second\r\n   */\r\n  public vel: Vector = Vector.Zero;\r\n\r\n  /**\r\n   * The acceleration of entity in pixels per second^2\r\n   */\r\n  public acc: Vector = Vector.Zero;\r\n\r\n  /**\r\n   * The scale rate of change in scale units per second\r\n   */\r\n  public scaleFactor: Vector = Vector.Zero;\r\n\r\n  /**\r\n   * The angular velocity which is how quickly the entity is rotating in radians per second\r\n   */\r\n  public angularVelocity = 0;\r\n\r\n  /**\r\n   * The amount of torque applied to the entity, angular acceleration is torque * inertia\r\n   */\r\n  public torque: number = 0;\r\n\r\n  /**\r\n   * Inertia can be thought of as the resistance to motion\r\n   */\r\n  public inertia: number = 1;\r\n}\r\n","/**\r\n * CollisionGroups indicate like members that do not collide with each other. Use [[CollisionGroupManager]] to create [[CollisionGroup]]s\r\n *\r\n * For example:\r\n *\r\n * Players have collision group \"player\"\r\n *\r\n * ![Player Collision Group](/assets/images/docs/CollisionGroupsPlayer.png)\r\n *\r\n * Enemies have collision group \"enemy\"\r\n *\r\n * ![Enemy Collision Group](/assets/images/docs/CollisionGroupsEnemy.png)\r\n *\r\n * Blocks have collision group \"ground\"\r\n *\r\n * ![Ground collision group](/assets/images/docs/CollisionGroupsGround.png)\r\n *\r\n * Players don't collide with each other, but enemies and blocks. Likewise, enemies don't collide with each other but collide\r\n * with players and blocks.\r\n *\r\n * This is done with bitmasking, see the following pseudo-code\r\n *\r\n * PlayerGroup = `0b001`\r\n * PlayerGroupMask = `0b110`\r\n *\r\n * EnemyGroup = `0b010`\r\n * EnemyGroupMask = `0b101`\r\n *\r\n * BlockGroup = `0b100`\r\n * BlockGroupMask = `0b011`\r\n *\r\n * Should Players collide? No because the bitwise mask evaluates to 0\r\n * `(player1.group & player2.mask) === 0`\r\n * `(0b001 & 0b110) === 0`\r\n *\r\n * Should Players and Enemies collide? Yes because the bitwise mask is non-zero\r\n * `(player1.group & enemy1.mask) === 1`\r\n * `(0b001 & 0b101) === 1`\r\n *\r\n * Should Players and Blocks collide? Yes because the bitwise mask is non-zero\r\n * `(player1.group & blocks1.mask) === 1`\r\n * `(0b001 & 0b011) === 1`\r\n */\r\nexport class CollisionGroup {\r\n  /**\r\n   * The `All` [[CollisionGroup]] is a special group that collides with all other groups including itself,\r\n   * it is the default collision group on colliders.\r\n   */\r\n  public static All = new CollisionGroup('Collide with all groups', -1, -1);\r\n\r\n  private _name: string;\r\n  private _category: number;\r\n  private _mask: number;\r\n\r\n  /**\r\n   * STOP!!** It is preferred that [[CollisionGroupManager.create]] is used to create collision groups\r\n   *  unless you know how to construct the proper bitmasks. See https://github.com/excaliburjs/Excalibur/issues/1091 for more info.\r\n   * @param name Name of the collision group\r\n   * @param category 32 bit category for the group, should be a unique power of 2. For example `0b001` or `0b010`\r\n   * @param mask 32 bit mask of category, or `~category` generally. For a category of `0b001`, the mask would be `0b110`\r\n   */\r\n  constructor(name: string, category: number, mask: number) {\r\n    this._name = name;\r\n    this._category = category;\r\n    this._mask = mask;\r\n  }\r\n\r\n  /**\r\n   * Get the name of the collision group\r\n   */\r\n  public get name() {\r\n    return this._name;\r\n  }\r\n\r\n  /**\r\n   * Get the category of the collision group, a 32 bit number which should be a unique power of 2\r\n   */\r\n  public get category() {\r\n    return this._category;\r\n  }\r\n\r\n  /**\r\n   * Get the mask for this collision group\r\n   */\r\n  public get mask() {\r\n    return this._mask;\r\n  }\r\n\r\n  /**\r\n   * Evaluates whether 2 collision groups can collide\r\n   * @param other  CollisionGroup\r\n   */\r\n  public canCollide(other: CollisionGroup): boolean {\r\n    return (this.category & other.mask) !== 0 && (other.category & this.mask) !== 0;\r\n  }\r\n\r\n  /**\r\n   * Inverts the collision group. For example, if before the group specified \"players\",\r\n   * inverting would specify all groups except players\r\n   * @returns CollisionGroup\r\n   */\r\n  public invert(): CollisionGroup {\r\n    return new CollisionGroup('~(' + this.name + ')', ~this.category, ~this.mask);\r\n  }\r\n\r\n  /**\r\n   * Combine collision groups with each other. The new group includes all of the previous groups.\r\n   *\r\n   * @param collisionGroups\r\n   */\r\n  public static combine(collisionGroups: CollisionGroup[]) {\r\n    const combinedName = collisionGroups.map((c) => c.name).join('+');\r\n    const combinedCategory = collisionGroups.reduce((current, g) => g.category | current, 0b0);\r\n    const combinedMask = ~combinedCategory;\r\n\r\n    return new CollisionGroup(combinedName, combinedCategory, combinedMask);\r\n  }\r\n\r\n  /**\r\n   * Creates a collision group that collides with the listed groups\r\n   * @param collisionGroups\r\n   */\r\n  public static collidesWith(collisionGroups: CollisionGroup[]) {\r\n    return CollisionGroup.combine(collisionGroups).invert();\r\n  }\r\n}\r\n","/**\r\n * Defines a generic message that can contain any data\r\n * @template T is the typescript Type of the data\r\n */\r\nexport interface Message<T> {\r\n  type: string;\r\n  data: T;\r\n}\r\n\r\n/**\r\n * Defines an interface for an observer to receive a message via a notify() method\r\n */\r\nexport interface Observer<T> {\r\n  notify(message: T): void;\r\n}\r\n\r\n/**\r\n * Defines an interface for something that might be an observer if a notify() is present\r\n */\r\nexport type MaybeObserver<T> = Partial<Observer<T>>;\r\n\r\n/**\r\n * Simple Observable implementation\r\n * @template T is the typescript Type that defines the data being observed\r\n */\r\nexport class Observable<T> {\r\n  public observers: Observer<T>[] = [];\r\n  public subscriptions: ((val: T) => any)[] = [];\r\n\r\n  /**\r\n   * Register an observer to listen to this observable\r\n   * @param observer\r\n   */\r\n  register(observer: Observer<T>) {\r\n    this.observers.push(observer);\r\n  }\r\n\r\n  /**\r\n   * Register a callback to listen to this observable\r\n   * @param func\r\n   */\r\n  subscribe(func: (val: T) => any) {\r\n    this.subscriptions.push(func);\r\n  }\r\n\r\n  /**\r\n   * Remove an observer from the observable\r\n   * @param observer\r\n   */\r\n  unregister(observer: Observer<T>) {\r\n    const i = this.observers.indexOf(observer);\r\n    if (i !== -1) {\r\n      this.observers.splice(i, 1);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Remove a callback that is listening to this observable\r\n   * @param func\r\n   */\r\n  unsubscribe(func: (val: T) => any) {\r\n    const i = this.subscriptions.indexOf(func);\r\n    if (i !== -1) {\r\n      this.subscriptions.splice(i, 1);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Broadcasts a message to all observers and callbacks\r\n   * @param message\r\n   */\r\n  notifyAll(message: T) {\r\n    this.observers.forEach((o) => o.notify(message));\r\n    this.subscriptions.forEach(cb => cb(message));\r\n  }\r\n\r\n  /**\r\n   * Removes all observers and callbacks\r\n   */\r\n  clear() {\r\n    this.observers.length = 0;\r\n    this.subscriptions.length = 0;\r\n  }\r\n}\r\n","import { CollisionContact } from './CollisionContact';\r\nimport { CollisionType } from '../CollisionType';\r\nimport { BodyComponent } from '../BodyComponent';\r\nimport { Id } from '../../Id';\r\nimport { Collider } from '../Colliders/Collider';\r\n\r\n/**\r\n * Models a potential collision between 2 colliders\r\n */\r\nexport class Pair {\r\n  public id: string = null;\r\n  constructor(public colliderA: Collider, public colliderB: Collider) {\r\n    this.id = Pair.calculatePairHash(colliderA.id, colliderB.id);\r\n  }\r\n\r\n  /**\r\n   * Returns whether a it is allowed for 2 colliders in a Pair to collide\r\n   * @param colliderA\r\n   * @param colliderB\r\n   */\r\n  public static canCollide(colliderA: Collider, colliderB: Collider) {\r\n    const bodyA = colliderA?.owner?.get(BodyComponent);\r\n    const bodyB = colliderB?.owner?.get(BodyComponent);\r\n\r\n    // Prevent self collision\r\n    if (colliderA.id === colliderB.id) {\r\n      return false;\r\n    }\r\n\r\n    // Colliders with the same owner do not collide (composite colliders)\r\n    if (colliderA.owner &&\r\n        colliderB.owner &&\r\n        colliderA.owner.id === colliderB.owner.id) {\r\n      return false;\r\n    }\r\n\r\n    // if the pair has a member with zero dimension don't collide\r\n    if (colliderA.localBounds.hasZeroDimensions() || colliderB.localBounds.hasZeroDimensions()) {\r\n      return false;\r\n    }\r\n\r\n    // Body's needed for collision in the current state\r\n    // TODO can we collide without a body?\r\n    if (!bodyA || !bodyB) {\r\n      return false;\r\n    }\r\n\r\n    // If both are in the same collision group short circuit\r\n    if (!bodyA.group.canCollide(bodyB.group)) {\r\n      return false;\r\n    }\r\n\r\n    // if both are fixed short circuit\r\n    if (bodyA.collisionType === CollisionType.Fixed && bodyB.collisionType === CollisionType.Fixed) {\r\n      return false;\r\n    }\r\n\r\n    // if the either is prevent collision short circuit\r\n    if (bodyB.collisionType === CollisionType.PreventCollision || bodyA.collisionType === CollisionType.PreventCollision) {\r\n      return false;\r\n    }\r\n\r\n    // if either is dead short circuit\r\n    if (!bodyA.active || !bodyB.active) {\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Returns whether or not it is possible for the pairs to collide\r\n   */\r\n  public get canCollide(): boolean {\r\n    const colliderA = this.colliderA;\r\n    const colliderB = this.colliderB;\r\n    return Pair.canCollide(colliderA, colliderB);\r\n  }\r\n\r\n  /**\r\n   * Runs the collision intersection logic on the members of this pair\r\n   */\r\n  public collide(): CollisionContact[] {\r\n    return this.colliderA.collide(this.colliderB);\r\n  }\r\n\r\n  /**\r\n   * Check if the collider is part of the pair\r\n   * @param collider\r\n   */\r\n  public hasCollider(collider: Collider) {\r\n    return collider === this.colliderA || collider === this.colliderB;\r\n  }\r\n\r\n  /**\r\n   * Calculates the unique pair hash id for this collision pair (owning id)\r\n   */\r\n  public static calculatePairHash(idA: Id<'collider'>, idB: Id<'collider'>): string {\r\n    if (idA.value < idB.value) {\r\n      return `#${idA.value}+${idB.value}`;\r\n    } else {\r\n      return `#${idB.value}+${idA.value}`;\r\n    }\r\n  }\r\n}\r\n","/**\r\n * A 1 dimensional projection on an axis, used to test overlaps\r\n */\r\n\r\nexport class Projection {\r\n  constructor(public min: number, public max: number) {}\r\n  public overlaps(projection: Projection): boolean {\r\n    return this.max > projection.min && projection.max > this.min;\r\n  }\r\n\r\n  public getOverlap(projection: Projection): number {\r\n    if (this.overlaps(projection)) {\r\n      if (this.max > projection.max) {\r\n        return projection.max - this.min;\r\n      } else {\r\n        return this.max - projection.min;\r\n      }\r\n    }\r\n    return 0;\r\n  }\r\n}\r\n","import { Physics } from '../Physics';\r\nimport { BoundingBox } from '../BoundingBox';\r\n\r\nimport { Ray } from '../../Math/ray';\r\nimport { Logger } from '../../Util/Log';\r\nimport { Id } from '../../Id';\r\nimport { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { BodyComponent } from '../BodyComponent';\r\nimport { Color, ExcaliburGraphicsContext } from '../..';\r\n\r\n/**\r\n * Dynamic Tree Node used for tracking bounds within the tree\r\n */\r\nexport class TreeNode<T> {\r\n  public left: TreeNode<T>;\r\n  public right: TreeNode<T>;\r\n  public bounds: BoundingBox;\r\n  public height: number;\r\n  public data: T;\r\n  constructor(public parent?: TreeNode<T>) {\r\n    this.parent = parent || null;\r\n    this.data = null;\r\n    this.bounds = new BoundingBox();\r\n    this.left = null;\r\n    this.right = null;\r\n    this.height = 0;\r\n  }\r\n\r\n  public isLeaf(): boolean {\r\n    return !this.left && !this.right;\r\n  }\r\n}\r\n\r\nexport interface ColliderProxy<T> {\r\n  id: Id<'collider'>;\r\n  owner: T;\r\n  bounds: BoundingBox;\r\n}\r\n\r\n/**\r\n * The DynamicTrees provides a spatial partitioning data structure for quickly querying for overlapping bounding boxes for\r\n * all tracked bodies. The worst case performance of this is O(n*log(n)) where n is the number of bodies in the tree.\r\n *\r\n * Internally the bounding boxes are organized as a balanced binary tree of bounding boxes, where the leaf nodes are tracked bodies.\r\n * Every non-leaf node is a bounding box that contains child bounding boxes.\r\n */\r\nexport class DynamicTree<T extends ColliderProxy<Entity>> {\r\n  public root: TreeNode<T>;\r\n  public nodes: { [key: number]: TreeNode<T> };\r\n  constructor(public worldBounds: BoundingBox = new BoundingBox(-Number.MAX_VALUE, -Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE)) {\r\n    this.root = null;\r\n    this.nodes = {};\r\n  }\r\n\r\n  /**\r\n   * Inserts a node into the dynamic tree\r\n   */\r\n  private _insert(leaf: TreeNode<T>): void {\r\n    // If there are no nodes in the tree, make this the root leaf\r\n    if (this.root === null) {\r\n      this.root = leaf;\r\n      this.root.parent = null;\r\n      return;\r\n    }\r\n\r\n    // Search the tree for a node that is not a leaf and find the best place to insert\r\n    const leafAABB = leaf.bounds;\r\n    let currentRoot = this.root;\r\n    while (!currentRoot.isLeaf()) {\r\n      const left = currentRoot.left;\r\n      const right = currentRoot.right;\r\n\r\n      const area = currentRoot.bounds.getPerimeter();\r\n      const combinedAABB = currentRoot.bounds.combine(leafAABB);\r\n      const combinedArea = combinedAABB.getPerimeter();\r\n\r\n      // Calculate cost heuristic for creating a new parent and leaf\r\n      const cost = 2 * combinedArea;\r\n\r\n      // Minimum cost of pushing the leaf down the tree\r\n      const inheritanceCost = 2 * (combinedArea - area);\r\n\r\n      // Cost of descending\r\n      let leftCost = 0;\r\n      const leftCombined = leafAABB.combine(left.bounds);\r\n      let newArea;\r\n      let oldArea;\r\n      if (left.isLeaf()) {\r\n        leftCost = leftCombined.getPerimeter() + inheritanceCost;\r\n      } else {\r\n        oldArea = left.bounds.getPerimeter();\r\n        newArea = leftCombined.getPerimeter();\r\n        leftCost = newArea - oldArea + inheritanceCost;\r\n      }\r\n\r\n      let rightCost = 0;\r\n      const rightCombined = leafAABB.combine(right.bounds);\r\n      if (right.isLeaf()) {\r\n        rightCost = rightCombined.getPerimeter() + inheritanceCost;\r\n      } else {\r\n        oldArea = right.bounds.getPerimeter();\r\n        newArea = rightCombined.getPerimeter();\r\n        rightCost = newArea - oldArea + inheritanceCost;\r\n      }\r\n\r\n      // cost is acceptable\r\n      if (cost < leftCost && cost < rightCost) {\r\n        break;\r\n      }\r\n\r\n      // Descend to the depths\r\n      if (leftCost < rightCost) {\r\n        currentRoot = left;\r\n      } else {\r\n        currentRoot = right;\r\n      }\r\n    }\r\n\r\n    // Create the new parent node and insert into the tree\r\n    const oldParent = currentRoot.parent;\r\n    const newParent = new TreeNode(oldParent);\r\n    newParent.bounds = leafAABB.combine(currentRoot.bounds);\r\n    newParent.height = currentRoot.height + 1;\r\n\r\n    if (oldParent !== null) {\r\n      // The sibling node was not the root\r\n      if (oldParent.left === currentRoot) {\r\n        oldParent.left = newParent;\r\n      } else {\r\n        oldParent.right = newParent;\r\n      }\r\n\r\n      newParent.left = currentRoot;\r\n      newParent.right = leaf;\r\n\r\n      currentRoot.parent = newParent;\r\n      leaf.parent = newParent;\r\n    } else {\r\n      // The sibling node was the root\r\n      newParent.left = currentRoot;\r\n      newParent.right = leaf;\r\n\r\n      currentRoot.parent = newParent;\r\n      leaf.parent = newParent;\r\n      this.root = newParent;\r\n    }\r\n\r\n    // Walk up the tree fixing heights and AABBs\r\n    let currentNode = leaf.parent;\r\n    while (currentNode) {\r\n      currentNode = this._balance(currentNode);\r\n\r\n      if (!currentNode.left) {\r\n        throw new Error('Parent of current leaf cannot have a null left child' + currentNode);\r\n      }\r\n      if (!currentNode.right) {\r\n        throw new Error('Parent of current leaf cannot have a null right child' + currentNode);\r\n      }\r\n\r\n      currentNode.height = 1 + Math.max(currentNode.left.height, currentNode.right.height);\r\n      currentNode.bounds = currentNode.left.bounds.combine(currentNode.right.bounds);\r\n\r\n      currentNode = currentNode.parent;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Removes a node from the dynamic tree\r\n   */\r\n  private _remove(leaf: TreeNode<T>) {\r\n    if (leaf === this.root) {\r\n      this.root = null;\r\n      return;\r\n    }\r\n\r\n    const parent = leaf.parent;\r\n    const grandParent = parent.parent;\r\n    let sibling: TreeNode<T>;\r\n    if (parent.left === leaf) {\r\n      sibling = parent.right;\r\n    } else {\r\n      sibling = parent.left;\r\n    }\r\n\r\n    if (grandParent) {\r\n      if (grandParent.left === parent) {\r\n        grandParent.left = sibling;\r\n      } else {\r\n        grandParent.right = sibling;\r\n      }\r\n      sibling.parent = grandParent;\r\n\r\n      let currentNode = grandParent;\r\n      while (currentNode) {\r\n        currentNode = this._balance(currentNode);\r\n        currentNode.bounds = currentNode.left.bounds.combine(currentNode.right.bounds);\r\n        currentNode.height = 1 + Math.max(currentNode.left.height, currentNode.right.height);\r\n\r\n        currentNode = currentNode.parent;\r\n      }\r\n    } else {\r\n      this.root = sibling;\r\n      sibling.parent = null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Tracks a body in the dynamic tree\r\n   */\r\n  public trackCollider(collider: T) {\r\n    const node = new TreeNode<T>();\r\n    node.data = collider;\r\n    node.bounds = collider.bounds;\r\n    node.bounds.left -= 2;\r\n    node.bounds.top -= 2;\r\n    node.bounds.right += 2;\r\n    node.bounds.bottom += 2;\r\n    this.nodes[collider.id.value] = node;\r\n    this._insert(node);\r\n  }\r\n\r\n  /**\r\n   * Updates the dynamic tree given the current bounds of each body being tracked\r\n   */\r\n  public updateCollider(collider: T) {\r\n    const node = this.nodes[collider.id.value];\r\n    if (!node) {\r\n      return false;\r\n    }\r\n    const b = collider.bounds;\r\n\r\n    // if the body is outside the world no longer update it\r\n    if (!this.worldBounds.contains(b)) {\r\n      Logger.getInstance().warn(\r\n        'Collider with id ' + collider.id.value + ' is outside the world bounds and will no longer be tracked for physics'\r\n      );\r\n      this.untrackCollider(collider);\r\n      return false;\r\n    }\r\n\r\n    if (node.bounds.contains(b)) {\r\n      return false;\r\n    }\r\n\r\n    this._remove(node);\r\n    b.left -= Physics.boundsPadding;\r\n    b.top -= Physics.boundsPadding;\r\n    b.right += Physics.boundsPadding;\r\n    b.bottom += Physics.boundsPadding;\r\n\r\n    // THIS IS CAUSING UNECESSARY CHECKS\r\n    if (collider.owner) {\r\n      const body = collider.owner?.get(BodyComponent);\r\n      if (body) {\r\n        const multdx = ((body.vel.x * 32) / 1000) * Physics.dynamicTreeVelocityMultiplier;\r\n        const multdy = ((body.vel.y * 32) / 1000) * Physics.dynamicTreeVelocityMultiplier;\r\n\r\n        if (multdx < 0) {\r\n          b.left += multdx;\r\n        } else {\r\n          b.right += multdx;\r\n        }\r\n\r\n        if (multdy < 0) {\r\n          b.top += multdy;\r\n        } else {\r\n          b.bottom += multdy;\r\n        }\r\n      }\r\n    }\r\n\r\n    node.bounds = b;\r\n    this._insert(node);\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Untracks a body from the dynamic tree\r\n   */\r\n  public untrackCollider(collider: T) {\r\n    const node = this.nodes[collider.id.value];\r\n    if (!node) {\r\n      return;\r\n    }\r\n    this._remove(node);\r\n    this.nodes[collider.id.value] = null;\r\n    delete this.nodes[collider.id.value];\r\n  }\r\n\r\n  /**\r\n   * Balances the tree about a node\r\n   */\r\n  private _balance(node: TreeNode<T>) {\r\n    if (node === null) {\r\n      throw new Error('Cannot balance at null node');\r\n    }\r\n\r\n    if (node.isLeaf() || node.height < 2) {\r\n      return node;\r\n    }\r\n\r\n    const left = node.left;\r\n    const right = node.right;\r\n\r\n    const a = node;\r\n    const b = left;\r\n    const c = right;\r\n    const d = left.left;\r\n    const e = left.right;\r\n    const f = right.left;\r\n    const g = right.right;\r\n\r\n    const balance = c.height - b.height;\r\n    // Rotate c node up\r\n    if (balance > 1) {\r\n      // Swap the right node with it's parent\r\n      c.left = a;\r\n      c.parent = a.parent;\r\n      a.parent = c;\r\n\r\n      // The original node's old parent should point to the right node\r\n      // this is mega confusing\r\n      if (c.parent) {\r\n        if (c.parent.left === a) {\r\n          c.parent.left = c;\r\n        } else {\r\n          c.parent.right = c;\r\n        }\r\n      } else {\r\n        this.root = c;\r\n      }\r\n\r\n      // Rotate\r\n      if (f.height > g.height) {\r\n        c.right = f;\r\n        a.right = g;\r\n        g.parent = a;\r\n\r\n        a.bounds = b.bounds.combine(g.bounds);\r\n        c.bounds = a.bounds.combine(f.bounds);\r\n\r\n        a.height = 1 + Math.max(b.height, g.height);\r\n        c.height = 1 + Math.max(a.height, f.height);\r\n      } else {\r\n        c.right = g;\r\n        a.right = f;\r\n        f.parent = a;\r\n\r\n        a.bounds = b.bounds.combine(f.bounds);\r\n        c.bounds = a.bounds.combine(g.bounds);\r\n\r\n        a.height = 1 + Math.max(b.height, f.height);\r\n        c.height = 1 + Math.max(a.height, g.height);\r\n      }\r\n\r\n      return c;\r\n    }\r\n    // Rotate left node up\r\n    if (balance < -1) {\r\n      // swap\r\n      b.left = a;\r\n      b.parent = a.parent;\r\n      a.parent = b;\r\n\r\n      // node's old parent should point to b\r\n      if (b.parent) {\r\n        if (b.parent.left === a) {\r\n          b.parent.left = b;\r\n        } else {\r\n          if (b.parent.right !== a) {\r\n            throw 'Error rotating Dynamic Tree';\r\n          }\r\n          b.parent.right = b;\r\n        }\r\n      } else {\r\n        this.root = b;\r\n      }\r\n\r\n      // rotate\r\n      if (d.height > e.height) {\r\n        b.right = d;\r\n        a.left = e;\r\n        e.parent = a;\r\n\r\n        a.bounds = c.bounds.combine(e.bounds);\r\n        b.bounds = a.bounds.combine(d.bounds);\r\n\r\n        a.height = 1 + Math.max(c.height, e.height);\r\n        b.height = 1 + Math.max(a.height, d.height);\r\n      } else {\r\n        b.right = e;\r\n        a.left = d;\r\n        d.parent = a;\r\n\r\n        a.bounds = c.bounds.combine(d.bounds);\r\n        b.bounds = a.bounds.combine(e.bounds);\r\n\r\n        a.height = 1 + Math.max(c.height, d.height);\r\n        b.height = 1 + Math.max(a.height, e.height);\r\n      }\r\n      return b;\r\n    }\r\n\r\n    return node;\r\n  }\r\n\r\n  /**\r\n   * Returns the internal height of the tree, shorter trees are better. Performance drops as the tree grows\r\n   */\r\n  public getHeight(): number {\r\n    if (this.root === null) {\r\n      return 0;\r\n    }\r\n    return this.root.height;\r\n  }\r\n\r\n  /**\r\n   * Queries the Dynamic Axis Aligned Tree for bodies that could be colliding with the provided body.\r\n   *\r\n   * In the query callback, it will be passed a potential collider. Returning true from this callback indicates\r\n   * that you are complete with your query and you do not want to continue. Returning false will continue searching\r\n   * the tree until all possible colliders have been returned.\r\n   */\r\n  public query(collider: T, callback: (other: T) => boolean): void {\r\n    const bounds = collider.bounds;\r\n    const helper = (currentNode: TreeNode<T>): boolean => {\r\n      if (currentNode && currentNode.bounds.intersect(bounds)) {\r\n        if (currentNode.isLeaf() && currentNode.data !== collider) {\r\n          if (callback.call(collider, currentNode.data)) {\r\n            return true;\r\n          }\r\n        } else {\r\n          return helper(currentNode.left) || helper(currentNode.right);\r\n        }\r\n      }\r\n      return false;\r\n    };\r\n    helper(this.root);\r\n  }\r\n\r\n  /**\r\n   * Queries the Dynamic Axis Aligned Tree for bodies that could be intersecting. By default the raycast query uses an infinitely\r\n   * long ray to test the tree specified by `max`.\r\n   *\r\n   * In the query callback, it will be passed a potential body that intersects with the raycast. Returning true from this\r\n   * callback indicates that your are complete with your query and do not want to continue. Return false will continue searching\r\n   * the tree until all possible bodies that would intersect with the ray have been returned.\r\n   */\r\n  public rayCastQuery(ray: Ray, max: number = Infinity, callback: (other: T) => boolean): void {\r\n    const helper = (currentNode: TreeNode<T>): boolean => {\r\n      if (currentNode && currentNode.bounds.rayCast(ray, max)) {\r\n        if (currentNode.isLeaf()) {\r\n          if (callback.call(ray, currentNode.data)) {\r\n            // ray hit a leaf! return the body\r\n            return true;\r\n          }\r\n        } else {\r\n          // ray hit but not at a leaf, recurse deeper\r\n          return helper(currentNode.left) || helper(currentNode.right);\r\n        }\r\n      }\r\n      return false; // ray missed\r\n    };\r\n    helper(this.root);\r\n  }\r\n\r\n  public getNodes(): TreeNode<T>[] {\r\n    const helper = (currentNode: TreeNode<T>): TreeNode<T>[] => {\r\n      if (currentNode) {\r\n        return [currentNode].concat(helper(currentNode.left), helper(currentNode.right));\r\n      } else {\r\n        return [];\r\n      }\r\n    };\r\n    return helper(this.root);\r\n  }\r\n\r\n  public debug(ex: ExcaliburGraphicsContext) {\r\n    // draw all the nodes in the Dynamic Tree\r\n    const helper = (currentNode: TreeNode<T>) => {\r\n      if (currentNode) {\r\n        if (currentNode.isLeaf()) {\r\n          currentNode.bounds.draw(ex, Color.Green);\r\n        } else {\r\n          currentNode.bounds.draw(ex, Color.White);\r\n        }\r\n\r\n        if (currentNode.left) {\r\n          helper(currentNode.left);\r\n        }\r\n        if (currentNode.right) {\r\n          helper(currentNode.right);\r\n        }\r\n      }\r\n    };\r\n\r\n    helper(this.root);\r\n  }\r\n}\r\n","import { Line } from './line';\r\nimport { Vector } from './vector';\r\n\r\n/**\r\n * A 2D ray that can be cast into the scene to do collision detection\r\n */\r\n\r\nexport class Ray {\r\n  public pos: Vector;\r\n  public dir: Vector;\r\n\r\n  /**\r\n   * @param pos The starting position for the ray\r\n   * @param dir The vector indicating the direction of the ray\r\n   */\r\n  constructor(pos: Vector, dir: Vector) {\r\n    this.pos = pos;\r\n    this.dir = dir.normalize();\r\n  }\r\n\r\n  /**\r\n   * Tests a whether this ray intersects with a line segment. Returns a number greater than or equal to 0 on success.\r\n   * This number indicates the mathematical intersection time.\r\n   * @param line  The line to test\r\n   */\r\n  public intersect(line: Line): number {\r\n    const numerator = line.begin.sub(this.pos);\r\n\r\n    // Test is line and ray are parallel and non intersecting\r\n    if (this.dir.cross(line.getSlope()) === 0 && numerator.cross(this.dir) !== 0) {\r\n      return -1;\r\n    }\r\n\r\n    // Lines are parallel\r\n    const divisor = this.dir.cross(line.getSlope());\r\n    if (divisor === 0) {\r\n      return -1;\r\n    }\r\n\r\n    const t = numerator.cross(line.getSlope()) / divisor;\r\n\r\n    if (t >= 0) {\r\n      const u = numerator.cross(this.dir) / divisor / line.getLength();\r\n      if (u >= 0 && u <= 1) {\r\n        return t;\r\n      }\r\n    }\r\n    return -1;\r\n  }\r\n\r\n  public intersectPoint(line: Line): Vector {\r\n    const time = this.intersect(line);\r\n    if (time < 0) {\r\n      return null;\r\n    }\r\n    return this.getPoint(time);\r\n  }\r\n\r\n  /**\r\n   * Returns the point of intersection given the intersection time\r\n   */\r\n  public getPoint(time: number): Vector {\r\n    return this.pos.add(this.dir.scale(time));\r\n  }\r\n}\r\n","import { Physics } from '../Physics';\r\nimport { CollisionProcessor } from './CollisionProcessor';\r\nimport { DynamicTree } from './DynamicTree';\r\nimport { Pair } from './Pair';\r\n\r\nimport { Vector } from '../../Math/vector';\r\nimport { Ray } from '../../Math/ray';\r\nimport { FrameStats } from '../../Debug';\r\nimport { Logger } from '../../Util/Log';\r\nimport { CollisionType } from '../CollisionType';\r\nimport { Collider } from '../Colliders/Collider';\r\nimport { CollisionContact } from '../Detection/CollisionContact';\r\nimport { BodyComponent } from '../BodyComponent';\r\nimport { CompositeCollider } from '../Colliders/CompositeCollider';\r\nimport { ExcaliburGraphicsContext } from '../..';\r\n\r\n/**\r\n * Responsible for performing the collision broadphase (locating potential collisions) and\r\n * the narrowphase (actual collision contacts)\r\n */\r\nexport class DynamicTreeCollisionProcessor implements CollisionProcessor {\r\n  private _dynamicCollisionTree = new DynamicTree<Collider>();\r\n  private _pairs = new Set<string>();\r\n\r\n  private _collisionPairCache: Pair[] = [];\r\n  private _colliders: Collider[] = [];\r\n\r\n  public getColliders(): readonly Collider[] {\r\n    return this._colliders;\r\n  }\r\n\r\n  /**\r\n   * Tracks a physics body for collisions\r\n   */\r\n  public track(target: Collider): void {\r\n    if (!target) {\r\n      Logger.getInstance().warn('Cannot track null collider');\r\n      return;\r\n    }\r\n    if (target instanceof CompositeCollider) {\r\n      const colliders = target.getColliders();\r\n      for (const c of colliders) {\r\n        c.owner = target.owner;\r\n        this._colliders.push(c);\r\n        this._dynamicCollisionTree.trackCollider(c);\r\n      }\r\n    } else {\r\n      this._colliders.push(target);\r\n      this._dynamicCollisionTree.trackCollider(target);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Untracks a physics body\r\n   */\r\n  public untrack(target: Collider): void {\r\n    if (!target) {\r\n      Logger.getInstance().warn('Cannot untrack a null collider');\r\n      return;\r\n    }\r\n\r\n    if (target instanceof CompositeCollider) {\r\n      const colliders = target.getColliders();\r\n      for (const c of colliders) {\r\n        const index = this._colliders.indexOf(c);\r\n        if (index !== -1) {\r\n          this._colliders.splice(index, 1);\r\n        }\r\n        this._dynamicCollisionTree.untrackCollider(c);\r\n      }\r\n    } else {\r\n      const index = this._colliders.indexOf(target);\r\n      if (index !== -1) {\r\n        this._colliders.splice(index, 1);\r\n      }\r\n      this._dynamicCollisionTree.untrackCollider(target);\r\n    }\r\n  }\r\n\r\n  private _pairExists(colliderA: Collider, colliderB: Collider) {\r\n    // if the collision pair has been calculated already short circuit\r\n    const hash = Pair.calculatePairHash(colliderA.id, colliderB.id);\r\n    return this._pairs.has(hash);\r\n  }\r\n\r\n  /**\r\n   * Detects potential collision pairs in a broadphase approach with the dynamic AABB tree strategy\r\n   */\r\n  public broadphase(targets: Collider[], delta: number, stats?: FrameStats): Pair[] {\r\n    const seconds = delta / 1000;\r\n\r\n    // Retrieve the list of potential colliders, exclude killed, prevented, and self\r\n    const potentialColliders = targets.filter((other) => {\r\n      const body = other.owner?.get(BodyComponent);\r\n      return other.owner?.active && body.collisionType !== CollisionType.PreventCollision;\r\n    });\r\n\r\n    // clear old list of collision pairs\r\n    this._collisionPairCache = [];\r\n    this._pairs.clear();\r\n\r\n    // check for normal collision pairs\r\n    let collider: Collider;\r\n    for (let j = 0, l = potentialColliders.length; j < l; j++) {\r\n      collider = potentialColliders[j];\r\n      // Query the collision tree for potential colliders\r\n      this._dynamicCollisionTree.query(collider, (other: Collider) => {\r\n        if (!this._pairExists(collider, other) && Pair.canCollide(collider, other)) {\r\n          const pair = new Pair(collider, other);\r\n          this._pairs.add(pair.id);\r\n          this._collisionPairCache.push(pair);\r\n        }\r\n        // Always return false, to query whole tree. Returning true in the query method stops searching\r\n        return false;\r\n      });\r\n    }\r\n    if (stats) {\r\n      stats.physics.pairs = this._collisionPairCache.length;\r\n    }\r\n\r\n    // Check dynamic tree for fast moving objects\r\n    // Fast moving objects are those moving at least there smallest bound per frame\r\n    if (Physics.checkForFastBodies) {\r\n      for (const collider of potentialColliders) {\r\n        const body = collider.owner.get(BodyComponent);\r\n        // Skip non-active objects. Does not make sense on other collision types\r\n        if (body.collisionType !== CollisionType.Active) {\r\n          continue;\r\n        }\r\n\r\n        // Maximum travel distance next frame\r\n        const updateDistance =\r\n          body.vel.size * seconds + // velocity term\r\n          body.acc.size * 0.5 * seconds * seconds; // acc term\r\n\r\n        // Find the minimum dimension\r\n        const minDimension = Math.min(collider.bounds.height, collider.bounds.width);\r\n        if (Physics.disableMinimumSpeedForFastBody || updateDistance > minDimension / 2) {\r\n          if (stats) {\r\n            stats.physics.fastBodies++;\r\n          }\r\n\r\n          // start with the oldPos because the integration for actors has already happened\r\n          // objects resting on a surface may be slightly penetrating in the current position\r\n          const updateVec = body.pos.sub(body.oldPos);\r\n          const centerPoint = collider.center;\r\n          const furthestPoint = collider.getFurthestPoint(body.vel);\r\n          const origin: Vector = furthestPoint.sub(updateVec);\r\n\r\n          const ray: Ray = new Ray(origin, body.vel);\r\n\r\n          // back the ray up by -2x surfaceEpsilon to account for fast moving objects starting on the surface\r\n          ray.pos = ray.pos.add(ray.dir.scale(-2 * Physics.surfaceEpsilon));\r\n          let minCollider: Collider;\r\n          let minTranslate: Vector = new Vector(Infinity, Infinity);\r\n          this._dynamicCollisionTree.rayCastQuery(ray, updateDistance + Physics.surfaceEpsilon * 2, (other: Collider) => {\r\n            if (!this._pairExists(collider, other) && Pair.canCollide(collider, other)) {\r\n              const hitPoint = other.rayCast(ray, updateDistance + Physics.surfaceEpsilon * 10);\r\n              if (hitPoint) {\r\n                const translate = hitPoint.sub(origin);\r\n                if (translate.size < minTranslate.size) {\r\n                  minTranslate = translate;\r\n                  minCollider = other;\r\n                }\r\n              }\r\n            }\r\n            return false;\r\n          });\r\n\r\n          if (minCollider && Vector.isValid(minTranslate)) {\r\n            const pair = new Pair(collider, minCollider);\r\n            if (!this._pairs.has(pair.id)) {\r\n              this._pairs.add(pair.id);\r\n              this._collisionPairCache.push(pair);\r\n            }\r\n            // move the fast moving object to the other body\r\n            // need to push into the surface by ex.Physics.surfaceEpsilon\r\n            const shift = centerPoint.sub(furthestPoint);\r\n            body.pos = origin\r\n              .add(shift)\r\n              .add(minTranslate)\r\n              .add(ray.dir.scale(10 * Physics.surfaceEpsilon)); // needed to push the shape slightly into contact\r\n            collider.update(body.transform);\r\n\r\n            if (stats) {\r\n              stats.physics.fastBodyCollisions++;\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n    // return cache\r\n    return this._collisionPairCache;\r\n  }\r\n\r\n  /**\r\n   * Applies narrow phase on collision pairs to find actual area intersections\r\n   * Adds actual colliding pairs to stats' Frame data\r\n   */\r\n  public narrowphase(pairs: Pair[], stats?: FrameStats): CollisionContact[] {\r\n    let contacts: CollisionContact[] = [];\r\n    for (let i = 0; i < pairs.length; i++) {\r\n      const newContacts = pairs[i].collide();\r\n      contacts = contacts.concat(newContacts);\r\n      if (stats && newContacts.length > 0) {\r\n        for (const c of newContacts) {\r\n          stats.physics.contacts.set(c.id, c);\r\n        }\r\n      }\r\n    }\r\n    if (stats) {\r\n      stats.physics.collisions += contacts.length;\r\n    }\r\n    return contacts;\r\n  }\r\n\r\n  /**\r\n   * Update the dynamic tree positions\r\n   */\r\n  public update(targets: Collider[]): number {\r\n    let updated = 0;\r\n    const len = targets.length;\r\n\r\n    for (let i = 0; i < len; i++) {\r\n      if (this._dynamicCollisionTree.updateCollider(targets[i])) {\r\n        updated++;\r\n      }\r\n    }\r\n    return updated;\r\n  }\r\n\r\n  public debug(ex: ExcaliburGraphicsContext) {\r\n    this._dynamicCollisionTree.debug(ex);\r\n  }\r\n}\r\n","import { Color } from '../../Color';\r\nimport { CollisionContact } from '../Detection/CollisionContact';\r\nimport { BoundingBox } from '../BoundingBox';\r\nimport { Projection } from '../../Math/projection';\r\nimport { Line } from '../../Math/line';\r\nimport { Vector } from '../../Math/vector';\r\nimport { Ray } from '../../Math/ray';\r\nimport { Clonable } from '../../Interfaces/Clonable';\r\nimport { Entity, Transform } from '../../EntityComponentSystem';\r\nimport { createId, Id } from '../../Id';\r\nimport { EventDispatcher } from '../../EventDispatcher';\r\nimport { ExcaliburGraphicsContext } from '../../Graphics/Context/ExcaliburGraphicsContext';\r\n\r\n/**\r\n * A collision collider specifies the geometry that can detect when other collision colliders intersect\r\n * for the purposes of colliding 2 objects in excalibur.\r\n */\r\nexport abstract class Collider implements Clonable<Collider> {\r\n  private static _ID = 0;\r\n  public readonly id: Id<'collider'> = createId('collider', Collider._ID++);\r\n  public events: EventDispatcher<Collider> = new EventDispatcher<Collider>();\r\n\r\n  /**\r\n   * Returns a boolean indicating whether this body collided with\r\n   * or was in stationary contact with\r\n   * the body of the other [[Collider]]\r\n   */\r\n  public touching(other: Collider): boolean {\r\n    const contact = this.collide(other);\r\n\r\n    if (contact) {\r\n      return true;\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  public owner: Entity;\r\n\r\n  /**\r\n   * Pixel offset of the collision collider relative to the collider, by default (0, 0) meaning the collider is positioned\r\n   * on top of the collider.\r\n   */\r\n  offset: Vector;\r\n\r\n  /**\r\n   * Position of the collision collider in world coordinates\r\n   */\r\n  abstract get worldPos(): Vector;\r\n\r\n  /**\r\n   * The center point of the collision collider, for example if the collider is a circle it would be the center.\r\n   */\r\n  abstract get center(): Vector;\r\n\r\n  /**\r\n   * Return the axis-aligned bounding box of the collision collider in world coordinates\r\n   */\r\n  abstract get bounds(): BoundingBox;\r\n\r\n  /**\r\n   * Return the axis-aligned bounding box of the collision collider in local coordinates\r\n   */\r\n  abstract get localBounds(): BoundingBox;\r\n\r\n  /**\r\n   * Return the axes of this particular collider\r\n   */\r\n  abstract get axes(): Vector[];\r\n  /**\r\n   * Find the furthest point on the convex hull of this particular collider in a certain direction.\r\n   */\r\n  abstract getFurthestPoint(direction: Vector): Vector;\r\n\r\n  abstract getInertia(mass: number): number;\r\n\r\n  // All new CollisionShape need to do the following\r\n  // Create a new collision function in the CollisionJumpTable against all the primitives\r\n  // Currently there are 3 primitive collision collider 3! = 6 jump functions\r\n  abstract collide(collider: Collider): CollisionContact[];\r\n\r\n  /**\r\n   * Returns the closest line between the surfaces this collider and another\r\n   * @param collider\r\n   */\r\n  abstract getClosestLineBetween(collider: Collider): Line;\r\n\r\n  /**\r\n   * Return wether the collider contains a point inclusive to it's border\r\n   */\r\n  abstract contains(point: Vector): boolean;\r\n\r\n  /**\r\n   * Return the point on the border of the collision collider that intersects with a ray (if any).\r\n   */\r\n  abstract rayCast(ray: Ray, max?: number): Vector;\r\n\r\n  /**\r\n   * Create a projection of this collider along an axis. Think of this as casting a \"shadow\" along an axis\r\n   */\r\n  abstract project(axis: Vector): Projection;\r\n\r\n  /**\r\n   * Updates collider world space geometry\r\n   */\r\n  abstract update(transform: Transform): void;\r\n\r\n  /**\r\n   * Draw the collider\r\n   * @deprecated Will be removed in 0.26.0\r\n   * @param ctx\r\n   * @param color\r\n   */\r\n  abstract draw(ctx: CanvasRenderingContext2D, color?: Color, pos?: Vector): void;\r\n\r\n  abstract debug(ex: ExcaliburGraphicsContext, color: Color): void;\r\n  /**\r\n   * Draw any debug information\r\n   * @deprecated Will be removed in 0.26.0\r\n   */\r\n  abstract debugDraw(ctx: CanvasRenderingContext2D, color: Color): void;\r\n\r\n  abstract clone(): Collider;\r\n}\r\n","import { Util } from '../..';\r\nimport { Pair } from '../Detection/Pair';\r\nimport { Color } from '../../Color';\r\nimport { Transform } from '../../EntityComponentSystem';\r\nimport { ExcaliburGraphicsContext } from '../../Graphics/Context/ExcaliburGraphicsContext';\r\nimport { Line } from '../../Math/line';\r\nimport { Projection } from '../../Math/projection';\r\nimport { Ray } from '../../Math/ray';\r\nimport { Vector } from '../../Math/vector';\r\nimport { BoundingBox } from '../BoundingBox';\r\nimport { CollisionContact } from '../Detection/CollisionContact';\r\nimport { DynamicTree } from '../Detection/DynamicTree';\r\nimport { DynamicTreeCollisionProcessor } from '../Detection/DynamicTreeCollisionProcessor';\r\nimport { Collider } from './Collider';\r\n\r\nexport class CompositeCollider extends Collider {\r\n  private _transform: Transform;\r\n  private _collisionProcessor = new DynamicTreeCollisionProcessor();\r\n  private _dynamicAABBTree = new DynamicTree();\r\n  private _colliders: Collider[] = [];\r\n\r\n  constructor(colliders: Collider[]) {\r\n    super();\r\n    for (const c of colliders) {\r\n      this.addCollider(c);\r\n    }\r\n  }\r\n\r\n  clearColliders() {\r\n    this._colliders = [];\r\n  }\r\n\r\n  addCollider(collider: Collider) {\r\n    this.events.wire(collider.events);\r\n    this._colliders.push(collider);\r\n    this._collisionProcessor.track(collider);\r\n    this._dynamicAABBTree.trackCollider(collider);\r\n  }\r\n\r\n  removeCollider(collider: Collider) {\r\n    this.events.unwire(collider.events);\r\n    Util.removeItemFromArray(collider, this._colliders);\r\n    this._collisionProcessor.untrack(collider);\r\n    this._dynamicAABBTree.untrackCollider(collider);\r\n  }\r\n\r\n  getColliders(): Collider[] {\r\n    return this._colliders;\r\n  }\r\n\r\n  get worldPos(): Vector {\r\n    // TODO transform component world pos\r\n    return this._transform?.pos ?? Vector.Zero;\r\n  }\r\n\r\n  get center(): Vector {\r\n    return this._transform?.pos ?? Vector.Zero;\r\n  }\r\n\r\n  get bounds(): BoundingBox {\r\n    // TODO cache this\r\n    const colliders = this.getColliders();\r\n    const results = colliders.reduce(\r\n      (acc, collider) => acc.combine(collider.bounds),\r\n      colliders[0]?.bounds ?? new BoundingBox().translate(this.worldPos)\r\n    );\r\n\r\n    return results;\r\n  }\r\n\r\n  get localBounds(): BoundingBox {\r\n    // TODO cache this\r\n    const colliders = this.getColliders();\r\n    const results = colliders.reduce((acc, collider) => acc.combine(collider.localBounds), colliders[0]?.localBounds ?? new BoundingBox());\r\n\r\n    return results;\r\n  }\r\n\r\n  get axes(): Vector[] {\r\n    // TODO cache this\r\n    const colliders = this.getColliders();\r\n    let axes: Vector[] = [];\r\n    for (const collider of colliders) {\r\n      axes = axes.concat(collider.axes);\r\n    }\r\n    return axes;\r\n  }\r\n\r\n  getFurthestPoint(direction: Vector): Vector {\r\n    const colliders = this.getColliders();\r\n    const furthestPoints: Vector[] = [];\r\n    for (const collider of colliders) {\r\n      furthestPoints.push(collider.getFurthestPoint(direction));\r\n    }\r\n    // Pick best point from all colliders\r\n    let bestPoint = furthestPoints[0];\r\n    let maxDistance = -Number.MAX_VALUE;\r\n    for (const point of furthestPoints) {\r\n      const distance = point.dot(direction);\r\n      if (distance > maxDistance) {\r\n        bestPoint = point;\r\n        maxDistance = distance;\r\n      }\r\n    }\r\n    return bestPoint;\r\n  }\r\n\r\n  getInertia(mass: number): number {\r\n    const colliders = this.getColliders();\r\n    let totalInertia = 0;\r\n    for (const collider of colliders) {\r\n      totalInertia += collider.getInertia(mass);\r\n    }\r\n    return totalInertia;\r\n  }\r\n\r\n  collide(other: Collider): CollisionContact[] {\r\n    let otherColliders = [other];\r\n    if (other instanceof CompositeCollider) {\r\n      otherColliders = other.getColliders();\r\n    }\r\n\r\n    const pairs: Pair[] = [];\r\n    for (const c of otherColliders) {\r\n      this._dynamicAABBTree.query(c, (potentialCollider: Collider) => {\r\n        pairs.push(new Pair(c, potentialCollider));\r\n        return false;\r\n      });\r\n    }\r\n\r\n    let contacts: CollisionContact[] = [];\r\n    for (const p of pairs) {\r\n      contacts = contacts.concat(p.collide());\r\n    }\r\n    return contacts;\r\n  }\r\n\r\n  getClosestLineBetween(other: Collider): Line {\r\n    const colliders = this.getColliders();\r\n    const lines: Line[] = [];\r\n    if (other instanceof CompositeCollider) {\r\n      const otherColliders = other.getColliders();\r\n      for (const colliderA of colliders) {\r\n        for (const colliderB of otherColliders) {\r\n          const maybeLine = colliderA.getClosestLineBetween(colliderB);\r\n          if (maybeLine) {\r\n            lines.push(maybeLine);\r\n          }\r\n        }\r\n      }\r\n    } else {\r\n      for (const collider of colliders) {\r\n        const maybeLine = other.getClosestLineBetween(collider);\r\n        if (maybeLine) {\r\n          lines.push(maybeLine);\r\n        }\r\n      }\r\n    }\r\n\r\n    if (lines.length) {\r\n      let minLength = lines[0].getLength();\r\n      let minLine = lines[0];\r\n      for (const line of lines) {\r\n        const length = line.getLength();\r\n        if (length < minLength) {\r\n          minLength = length;\r\n          minLine = line;\r\n        }\r\n      }\r\n      return minLine;\r\n    }\r\n    return null;\r\n  }\r\n  contains(point: Vector): boolean {\r\n    const colliders = this.getColliders();\r\n    for (const collider of colliders) {\r\n      if (collider.contains(point)) {\r\n        return true;\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n  rayCast(ray: Ray, max?: number): Vector {\r\n    const colliders = this.getColliders();\r\n    const points: Vector[] = [];\r\n    for (const collider of colliders) {\r\n      const vec = collider.rayCast(ray, max);\r\n      if (vec) {\r\n        points.push(vec);\r\n      }\r\n    }\r\n    if (points.length) {\r\n      let minPoint = points[0];\r\n      let minDistance = minPoint.dot(ray.dir);\r\n      for (const point of points) {\r\n        const distance = ray.dir.dot(point);\r\n        if (distance < minDistance) {\r\n          minPoint = point;\r\n          minDistance = distance;\r\n        }\r\n      }\r\n      return minPoint;\r\n    }\r\n    return null;\r\n  }\r\n  project(axis: Vector): Projection {\r\n    const colliders = this.getColliders();\r\n    const projs: Projection[] = [];\r\n    for (const collider of colliders) {\r\n      const proj = collider.project(axis);\r\n      if (proj) {\r\n        projs.push(proj);\r\n      }\r\n    }\r\n    // Merge all proj's on the same axis\r\n    if (projs.length) {\r\n      const newProjection = new Projection(projs[0].min, projs[0].max);\r\n      for (const proj of projs) {\r\n        newProjection.min = Math.min(proj.min, newProjection.min);\r\n        newProjection.max = Math.max(proj.max, newProjection.max);\r\n      }\r\n      return newProjection;\r\n    }\r\n    return null;\r\n  }\r\n\r\n  update(transform: Transform): void {\r\n    if (transform) {\r\n      const colliders = this.getColliders();\r\n      for (const collider of colliders) {\r\n        collider.owner = this.owner;\r\n        collider.update(transform);\r\n      }\r\n    }\r\n  }\r\n\r\n  draw(ctx: CanvasRenderingContext2D, color?: Color, pos?: Vector): void {\r\n    const colliders = this.getColliders();\r\n    for (const collider of colliders) {\r\n      collider.draw(ctx, color, pos);\r\n    }\r\n  }\r\n\r\n  public debug(ex: ExcaliburGraphicsContext, color: Color) {\r\n    const colliders = this.getColliders();\r\n    for (const collider of colliders) {\r\n      collider.debug(ex, color);\r\n    }\r\n  }\r\n\r\n  debugDraw(ctx: CanvasRenderingContext2D, color: Color): void {\r\n    const colliders = this.getColliders();\r\n    for (const collider of colliders) {\r\n      collider.draw(ctx, color);\r\n    }\r\n  }\r\n  clone(): Collider {\r\n    return new CompositeCollider(this._colliders.map((c) => c.clone()));\r\n  }\r\n}\r\n","import { Vector } from './vector';\r\n\r\n/**\r\n * A 2D line segment\r\n */\r\n\r\nexport class Line {\r\n  /**\r\n   * @param begin  The starting point of the line segment\r\n   * @param end  The ending point of the line segment\r\n   */\r\n  constructor(public begin: Vector, public end: Vector) {}\r\n\r\n  /**\r\n   * Gets the raw slope (m) of the line. Will return (+/-)Infinity for vertical lines.\r\n   */\r\n  public get slope() {\r\n    return (this.end.y - this.begin.y) / (this.end.x - this.begin.x);\r\n  }\r\n\r\n  /**\r\n   * Gets the Y-intercept (b) of the line. Will return (+/-)Infinity if there is no intercept.\r\n   */\r\n  public get intercept() {\r\n    return this.begin.y - this.slope * this.begin.x;\r\n  }\r\n\r\n  /**\r\n   * Gets the normal of the line\r\n   */\r\n  public normal(): Vector {\r\n    return this.end.sub(this.begin).normal();\r\n  }\r\n\r\n  public dir(): Vector {\r\n    return this.end.sub(this.begin);\r\n  }\r\n\r\n  public getPoints(): Vector[] {\r\n    return [this.begin, this.end];\r\n  }\r\n\r\n  /**\r\n   * Returns the slope of the line in the form of a vector of length 1\r\n   */\r\n  public getSlope(): Vector {\r\n    const begin = this.begin;\r\n    const end = this.end;\r\n    const distance = begin.distance(end);\r\n    return end.sub(begin).scale(1 / distance);\r\n  }\r\n\r\n  /**\r\n   * Returns the edge of the line as vector, the length of the vector is the length of the edge\r\n   */\r\n  public getEdge(): Vector {\r\n    const begin = this.begin;\r\n    const end = this.end;\r\n    return end.sub(begin);\r\n  }\r\n\r\n  /**\r\n   * Returns the length of the line segment in pixels\r\n   */\r\n  public getLength(): number {\r\n    const begin = this.begin;\r\n    const end = this.end;\r\n    const distance = begin.distance(end);\r\n    return distance;\r\n  }\r\n\r\n  /**\r\n   * Returns the midpoint of the edge\r\n   */\r\n  public get midpoint(): Vector {\r\n    return this.begin.add(this.end).scale(0.5);\r\n  }\r\n\r\n  /**\r\n   * Flips the direction of the line segment\r\n   */\r\n  public flip(): Line {\r\n    return new Line(this.end, this.begin);\r\n  }\r\n\r\n  /**\r\n   * Tests if a given point is below the line, points in the normal direction above the line are considered above.\r\n   * @param point\r\n   */\r\n  public below(point: Vector): boolean {\r\n    const above2 = (this.end.x - this.begin.x) * (point.y - this.begin.y) - (this.end.y - this.begin.y) * (point.x - this.begin.x);\r\n    return above2 >= 0;\r\n  }\r\n\r\n  /**\r\n   * Returns the clip point\r\n   * @param sideVector Vector that traces the line\r\n   * @param length Length to clip along side\r\n   */\r\n  public clip(sideVector: Vector, length: number): Line {\r\n    let dir = sideVector;\r\n    dir = dir.normalize();\r\n\r\n    const near = dir.dot(this.begin) - length;\r\n    const far = dir.dot(this.end) - length;\r\n\r\n    const results = [];\r\n    if (near <= 0) {\r\n      results.push(this.begin);\r\n    }\r\n    if (far <= 0) {\r\n      results.push(this.end);\r\n    }\r\n\r\n    if (near * far < 0) {\r\n      const clipTime = near / (near - far);\r\n      results.push(this.begin.add(this.end.sub(this.begin).scale(clipTime)));\r\n    }\r\n    if (results.length !== 2) {\r\n      return null;\r\n    }\r\n\r\n    return new Line(results[0], results[1]);\r\n  }\r\n\r\n  /**\r\n   * Find the perpendicular distance from the line to a point\r\n   * https://en.wikipedia.org/wiki/Distance_from_a_point_to_a_line\r\n   * @param point\r\n   */\r\n  public distanceToPoint(point: Vector, signed: boolean = false) {\r\n    const x0 = point.x;\r\n    const y0 = point.y;\r\n\r\n    const l = this.getLength();\r\n\r\n    const dy = this.end.y - this.begin.y;\r\n    const dx = this.end.x - this.begin.x;\r\n    const distance = (dy * x0 - dx * y0 + this.end.x * this.begin.y - this.end.y * this.begin.x) / l;\r\n    return signed ? distance : Math.abs(distance);\r\n  }\r\n\r\n  /**\r\n   * Find the perpendicular line from the line to a point\r\n   * https://en.wikipedia.org/wiki/Distance_from_a_point_to_a_line\r\n   * (a - p) - ((a - p) * n)n\r\n   * a is a point on the line\r\n   * p is the arbitrary point above the line\r\n   * n is a unit vector in direction of the line\r\n   * @param point\r\n   */\r\n  public findVectorToPoint(point: Vector): Vector {\r\n    const aMinusP = this.begin.sub(point);\r\n    const n = this.getSlope();\r\n\r\n    return aMinusP.sub(n.scale(aMinusP.dot(n)));\r\n  }\r\n\r\n  /**\r\n   * Finds a point on the line given only an X or a Y value. Given an X value, the function returns\r\n   * a new point with the calculated Y value and vice-versa.\r\n   *\r\n   * @param x The known X value of the target point\r\n   * @param y The known Y value of the target point\r\n   * @returns A new point with the other calculated axis value\r\n   */\r\n  public findPoint(x: number = null, y: number = null): Vector {\r\n    const m = this.slope;\r\n    const b = this.intercept;\r\n\r\n    if (x !== null) {\r\n      return new Vector(x, m * x + b);\r\n    } else if (y !== null) {\r\n      return new Vector((y - b) / m, y);\r\n    } else {\r\n      throw new Error('You must provide an X or a Y value');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Whether or not the given point lies on this line. This method is precise by default\r\n   * meaning the point must lie exactly on the line. Adjust threshold to\r\n   * loosen the strictness of the check for floating-point calculations.\r\n   */\r\n  public hasPoint(x: number, y: number, threshold?: number): boolean;\r\n\r\n  /**\r\n   * Whether or not the given point lies on this line. This method is precise by default\r\n   * meaning the point must lie exactly on the line. Adjust threshold to\r\n   * loosen the strictness of the check for floating-point calculations.\r\n   */\r\n  public hasPoint(v: Vector, threshold?: number): boolean;\r\n\r\n  /**\r\n   * @see http://stackoverflow.com/a/11908158/109458\r\n   */\r\n  public hasPoint(): boolean {\r\n    let currPoint: Vector;\r\n    let threshold = 0;\r\n\r\n    if (typeof arguments[0] === 'number' && typeof arguments[1] === 'number') {\r\n      currPoint = new Vector(arguments[0], arguments[1]);\r\n      threshold = arguments[2] || 0;\r\n    } else if (arguments[0] instanceof Vector) {\r\n      currPoint = arguments[0];\r\n      threshold = arguments[1] || 0;\r\n    } else {\r\n      throw 'Could not determine the arguments for Vector.hasPoint';\r\n    }\r\n\r\n    const dxc = currPoint.x - this.begin.x;\r\n    const dyc = currPoint.y - this.begin.y;\r\n\r\n    const dx1 = this.end.x - this.begin.x;\r\n    const dy1 = this.end.y - this.begin.y;\r\n\r\n    const cross = dxc * dy1 - dyc * dx1;\r\n\r\n    // check whether point lines on the line\r\n    if (Math.abs(cross) > threshold) {\r\n      return false;\r\n    }\r\n\r\n    // check whether point lies in-between start and end\r\n    if (Math.abs(dx1) >= Math.abs(dy1)) {\r\n      return dx1 > 0 ? this.begin.x <= currPoint.x && currPoint.x <= this.end.x : this.end.x <= currPoint.x && currPoint.x <= this.begin.x;\r\n    } else {\r\n      return dy1 > 0 ? this.begin.y <= currPoint.y && currPoint.y <= this.end.y : this.end.y <= currPoint.y && currPoint.y <= this.begin.y;\r\n    }\r\n  }\r\n}\r\n","import { Line } from '../../Math/line';\r\nimport { Vector } from '../../Math/vector';\r\nimport { Ray } from '../../Math/ray';\r\nimport { PolygonCollider } from './PolygonCollider';\r\nimport { EdgeCollider } from './EdgeCollider';\r\nimport { CircleCollider } from './CircleCollider';\r\n\r\n/**\r\n * Finds the closes line between 2 line segments, were the magnitude of u, v are the lengths of each segment\r\n * L1 = P(s) = p0 + s * u, where s is time and p0 is the start of the line\r\n * L2 = Q(t) = q0 + t * v, where t is time and q0 is the start of the line\r\n * @param p0 Point where L1 begins\r\n * @param u Direction and length of L1\r\n * @param q0 Point were L2 begins\r\n * @param v Direction and length of L2\r\n */\r\nexport function ClosestLine(p0: Vector, u: Vector, q0: Vector, v: Vector) {\r\n  // Distance between 2 lines http://geomalgorithms.com/a07-_distance.html\r\n\r\n  // w(s, t) = P(s) - Q(t)\r\n  // The w(s, t) that has the minimum distance we will say is w(sClosest, tClosest) = wClosest\r\n  //\r\n  // wClosest is the vector that is uniquely perpendicular to the 2 line directions u & v.\r\n  // wClosest = w0 + sClosest * u - tClosest * v, where w0 is p0 - q0\r\n  //\r\n  // The closest point between 2 lines then satisfies this pair of equations\r\n  // 1: u * wClosest = 0\r\n  // 2: v * wClosest = 0\r\n  //\r\n  // Substituting wClosest into the equations we get\r\n  //\r\n  // 1: (u * u) * sClosest - (u * v) tClosest = -u * w0\r\n  // 2: (v * u) * sClosest - (v * v) tClosest = -v * w0\r\n\r\n  // simplify w0\r\n  const w0 = p0.sub(q0);\r\n\r\n  // simplify (u * u);\r\n  const a = u.dot(u);\r\n  // simplify (u * v);\r\n  const b = u.dot(v);\r\n  // simplify (v * v)\r\n  const c = v.dot(v);\r\n  // simplify (u * w0)\r\n  const d = u.dot(w0);\r\n  // simplify (v * w0)\r\n  const e = v.dot(w0);\r\n\r\n  // denominator ac - b^2\r\n  const denom = a * c - b * b;\r\n  let sDenom = denom;\r\n  let tDenom = denom;\r\n  // if denom is 0 they are parallel, use any point from either as the start in this case p0\r\n  if (denom === 0 || denom <= 0.01) {\r\n    const tClosestParallel = d / b;\r\n    return new Line(p0, q0.add(v.scale(tClosestParallel)));\r\n  }\r\n\r\n  // Solve for sClosest for infinite line\r\n  let sClosest = b * e - c * d; // / denom;\r\n\r\n  // Solve for tClosest for infinite line\r\n  let tClosest = a * e - b * d; // / denom;\r\n\r\n  // Solve for segments candidate edges, if sClosest and tClosest are outside their segments\r\n  if (sClosest < 0) {\r\n    sClosest = 0;\r\n    tClosest = e;\r\n    tDenom = c;\r\n  } else if (sClosest > sDenom) {\r\n    sClosest = sDenom;\r\n    tClosest = e + b;\r\n    tDenom = c;\r\n  }\r\n\r\n  if (tClosest < 0) {\r\n    tClosest = 0;\r\n    if (-d < 0) {\r\n      sClosest = 0;\r\n    } else if (-d > a) {\r\n      sClosest = sDenom;\r\n    } else {\r\n      sClosest = -d;\r\n      sDenom = a;\r\n    }\r\n  } else if (tClosest > tDenom) {\r\n    tClosest = tDenom;\r\n    if (-d + b < 0) {\r\n      sClosest = 0;\r\n    } else if (-d + b > a) {\r\n      sClosest = sDenom;\r\n    } else {\r\n      sClosest = -d + b;\r\n      sDenom = a;\r\n    }\r\n  }\r\n  sClosest = Math.abs(sClosest) < 0.001 ? 0 : sClosest / sDenom;\r\n  tClosest = Math.abs(tClosest) < 0.001 ? 0 : tClosest / tDenom;\r\n\r\n  return new Line(p0.add(u.scale(sClosest)), q0.add(v.scale(tClosest)));\r\n}\r\n\r\nexport const ClosestLineJumpTable = {\r\n  PolygonPolygonClosestLine(polygonA: PolygonCollider, polygonB: PolygonCollider) {\r\n    // Find the 2 closest faces on each polygon\r\n    const otherWorldPos = polygonB.worldPos;\r\n    const otherDirection = otherWorldPos.sub(polygonA.worldPos);\r\n    const thisDirection = otherDirection.negate();\r\n\r\n    const rayTowardsOther = new Ray(polygonA.worldPos, otherDirection);\r\n    const rayTowardsThis = new Ray(otherWorldPos, thisDirection);\r\n\r\n    const thisPoint = polygonA.rayCast(rayTowardsOther).add(rayTowardsOther.dir.scale(0.1));\r\n    const otherPoint = polygonB.rayCast(rayTowardsThis).add(rayTowardsThis.dir.scale(0.1));\r\n\r\n    const thisFace = polygonA.getClosestFace(thisPoint);\r\n    const otherFace = polygonB.getClosestFace(otherPoint);\r\n\r\n    // L1 = P(s) = p0 + s * u, where s is time and p0 is the start of the line\r\n    const p0 = thisFace.face.begin;\r\n    const u = thisFace.face.getEdge();\r\n\r\n    // L2 = Q(t) = q0 + t * v, where t is time and q0 is the start of the line\r\n    const q0 = otherFace.face.begin;\r\n    const v = otherFace.face.getEdge();\r\n\r\n    return ClosestLine(p0, u, q0, v);\r\n  },\r\n\r\n  PolygonEdgeClosestLine(polygon: PolygonCollider, edge: EdgeCollider) {\r\n    // Find the 2 closest faces on each polygon\r\n    const otherWorldPos = edge.worldPos;\r\n    const otherDirection = otherWorldPos.sub(polygon.worldPos);\r\n\r\n    const rayTowardsOther = new Ray(polygon.worldPos, otherDirection);\r\n\r\n    const thisPoint = polygon.rayCast(rayTowardsOther).add(rayTowardsOther.dir.scale(0.1));\r\n\r\n    const thisFace = polygon.getClosestFace(thisPoint);\r\n\r\n    // L1 = P(s) = p0 + s * u, where s is time and p0 is the start of the line\r\n    const p0 = thisFace.face.begin;\r\n    const u = thisFace.face.getEdge();\r\n\r\n    // L2 = Q(t) = q0 + t * v, where t is time and q0 is the start of the line\r\n    const edgeLine = edge.asLine();\r\n    const edgeStart = edgeLine.begin;\r\n    const edgeVector = edgeLine.getEdge();\r\n    const q0 = edgeStart;\r\n    const v = edgeVector;\r\n\r\n    return ClosestLine(p0, u, q0, v);\r\n  },\r\n\r\n  PolygonCircleClosestLine(polygon: PolygonCollider, circle: CircleCollider) {\r\n    // https://math.stackexchange.com/questions/1919177/how-to-find-point-on-line-closest-to-sphere\r\n    // Find the 2 closest faces on each polygon\r\n    const otherWorldPos = circle.worldPos;\r\n    const otherDirection = otherWorldPos.sub(polygon.worldPos);\r\n\r\n    const rayTowardsOther = new Ray(polygon.worldPos, otherDirection.normalize());\r\n\r\n    const thisPoint = polygon.rayCast(rayTowardsOther).add(rayTowardsOther.dir.scale(0.1));\r\n\r\n    const thisFace = polygon.getClosestFace(thisPoint);\r\n\r\n    // L1 = P(s) = p0 + s * u, where s is time and p0 is the start of the line\r\n    const p0 = thisFace.face.begin;\r\n    const u = thisFace.face.getEdge();\r\n\r\n    // Time of minimum distance\r\n    let t = (u.x * (otherWorldPos.x - p0.x) + u.y * (otherWorldPos.y - p0.y)) / (u.x * u.x + u.y * u.y);\r\n\r\n    // If time of minimum is past the edge clamp\r\n    if (t > 1) {\r\n      t = 1;\r\n    } else if (t < 0) {\r\n      t = 0;\r\n    }\r\n\r\n    // Minimum distance\r\n    const d = Math.sqrt(Math.pow(p0.x + u.x * t - otherWorldPos.x, 2) + Math.pow(p0.y + u.y * t - otherWorldPos.y, 2)) - circle.radius;\r\n\r\n    const circlex = ((p0.x + u.x * t - otherWorldPos.x) * circle.radius) / (circle.radius + d);\r\n    const circley = ((p0.y + u.y * t - otherWorldPos.y) * circle.radius) / (circle.radius + d);\r\n    return new Line(u.scale(t).add(p0), new Vector(otherWorldPos.x + circlex, otherWorldPos.y + circley));\r\n  },\r\n\r\n  CircleCircleClosestLine(circleA: CircleCollider, circleB: CircleCollider) {\r\n    // Find the 2 closest faces on each polygon\r\n    const otherWorldPos = circleB.worldPos;\r\n    const otherDirection = otherWorldPos.sub(circleA.worldPos);\r\n\r\n    const thisWorldPos = circleA.worldPos;\r\n    const thisDirection = thisWorldPos.sub(circleB.worldPos);\r\n\r\n    const rayTowardsOther = new Ray(circleA.worldPos, otherDirection);\r\n    const rayTowardsThis = new Ray(circleB.worldPos, thisDirection);\r\n\r\n    const thisPoint = circleA.rayCast(rayTowardsOther);\r\n    const otherPoint = circleB.rayCast(rayTowardsThis);\r\n\r\n    return new Line(thisPoint, otherPoint);\r\n  },\r\n\r\n  CircleEdgeClosestLine(circle: CircleCollider, edge: EdgeCollider) {\r\n    // https://math.stackexchange.com/questions/1919177/how-to-find-point-on-line-closest-to-sphere\r\n    const circleWorlPos = circle.worldPos;\r\n\r\n    // L1 = P(s) = p0 + s * u, where s is time and p0 is the start of the line\r\n    const edgeLine = edge.asLine();\r\n    const edgeStart = edgeLine.begin;\r\n    const edgeVector = edgeLine.getEdge();\r\n    const p0 = edgeStart;\r\n    const u = edgeVector;\r\n\r\n    // Time of minimum distance\r\n    let t = (u.x * (circleWorlPos.x - p0.x) + u.y * (circleWorlPos.y - p0.y)) / (u.x * u.x + u.y * u.y);\r\n\r\n    // If time of minimum is past the edge clamp to edge\r\n    if (t > 1) {\r\n      t = 1;\r\n    } else if (t < 0) {\r\n      t = 0;\r\n    }\r\n\r\n    // Minimum distance\r\n    const d = Math.sqrt(Math.pow(p0.x + u.x * t - circleWorlPos.x, 2) + Math.pow(p0.y + u.y * t - circleWorlPos.y, 2)) - circle.radius;\r\n\r\n    const circlex = ((p0.x + u.x * t - circleWorlPos.x) * circle.radius) / (circle.radius + d);\r\n    const circley = ((p0.y + u.y * t - circleWorlPos.y) * circle.radius) / (circle.radius + d);\r\n    return new Line(u.scale(t).add(p0), new Vector(circleWorlPos.x + circlex, circleWorlPos.y + circley));\r\n  },\r\n\r\n  EdgeEdgeClosestLine(edgeA: EdgeCollider, edgeB: EdgeCollider) {\r\n    // L1 = P(s) = p0 + s * u, where s is time and p0 is the start of the line\r\n    const edgeLineA = edgeA.asLine();\r\n    const edgeStartA = edgeLineA.begin;\r\n    const edgeVectorA = edgeLineA.getEdge();\r\n    const p0 = edgeStartA;\r\n    const u = edgeVectorA;\r\n\r\n    // L2 = Q(t) = q0 + t * v, where t is time and q0 is the start of the line\r\n    const edgeLineB = edgeB.asLine();\r\n    const edgeStartB = edgeLineB.begin;\r\n    const edgeVectorB = edgeLineB.getEdge();\r\n    const q0 = edgeStartB;\r\n    const v = edgeVectorB;\r\n\r\n    return ClosestLine(p0, u, q0, v);\r\n  }\r\n};\r\n","import { BoundingBox } from '../BoundingBox';\r\nimport { CollisionJumpTable } from './CollisionJumpTable';\r\nimport { CollisionContact } from '../Detection/CollisionContact';\r\nimport { PolygonCollider } from './PolygonCollider';\r\nimport { EdgeCollider } from './EdgeCollider';\r\n\r\nimport { Projection } from '../../Math/projection';\r\nimport { Line } from '../../Math/line';\r\nimport { Vector } from '../../Math/vector';\r\nimport { Ray } from '../../Math/ray';\r\nimport { Color } from '../../Color';\r\nimport { Collider } from './Collider';\r\n\r\nimport { ClosestLineJumpTable } from './ClosestLineJumpTable';\r\nimport { Transform, TransformComponent } from '../../EntityComponentSystem';\r\nimport { ExcaliburGraphicsContext } from '../../Graphics/Context/ExcaliburGraphicsContext';\r\n\r\nexport interface CircleColliderOptions {\r\n  /**\r\n   * Optional pixel offset to shift the circle relative to the collider, by default (0, 0).\r\n   */\r\n  offset?: Vector;\r\n  /**\r\n   * Required radius of the circle\r\n   */\r\n  radius: number;\r\n}\r\n\r\n/**\r\n * This is a circle collider for the excalibur rigid body physics simulation\r\n */\r\nexport class CircleCollider extends Collider {\r\n  /**\r\n   * Position of the circle relative to the collider, by default (0, 0).\r\n   */\r\n  public offset: Vector = Vector.Zero;\r\n\r\n  public get worldPos(): Vector {\r\n    const tx = this._transform as TransformComponent;\r\n    const scale = tx?.globalScale ?? Vector.One;\r\n    const rotation = tx?.globalRotation ?? 0;\r\n    const pos = (tx?.globalPos ?? Vector.Zero);\r\n\r\n    return (this.offset ?? Vector.Zero).scale(scale).rotate(rotation).add(pos);\r\n  }\r\n\r\n  private _naturalRadius: number;\r\n  /**\r\n   * Get the radius of the circle\r\n   */\r\n  public get radius(): number {\r\n    const tx = this._transform as TransformComponent;\r\n    const scale = tx?.globalScale ?? Vector.One;\r\n    // This is a trade off, the alternative is retooling circles to support ellipse collisions\r\n    return this._naturalRadius * Math.min(scale.x, scale.y);\r\n  }\r\n\r\n  /**\r\n   * Set the radius of the circle\r\n   */\r\n  public set radius(val: number) {\r\n    const tx = this._transform as TransformComponent;\r\n    const scale = tx?.globalScale ?? Vector.One;\r\n    // This is a trade off, the alternative is retooling circles to support ellipse collisions\r\n    this._naturalRadius = val / Math.min(scale.x, scale.y);\r\n  }\r\n\r\n  private _transform: Transform;\r\n\r\n  constructor(options: CircleColliderOptions) {\r\n    super();\r\n    this.offset = options.offset || Vector.Zero;\r\n    this.radius = options.radius || 0;\r\n  }\r\n\r\n  /**\r\n   * Returns a clone of this shape, not associated with any collider\r\n   */\r\n  public clone(): CircleCollider {\r\n    return new CircleCollider({\r\n      offset: this.offset.clone(),\r\n      radius: this.radius\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Get the center of the collider in world coordinates\r\n   */\r\n  public get center(): Vector {\r\n    const tx = this._transform as TransformComponent;\r\n    const scale = tx?.globalScale ?? Vector.One;\r\n    const rotation = tx?.globalRotation ?? 0;\r\n    const pos = (tx?.globalPos ?? Vector.Zero);\r\n\r\n    return (this.offset ?? Vector.Zero).scale(scale).rotate(rotation).add(pos);\r\n  }\r\n\r\n  /**\r\n   * Tests if a point is contained in this collider\r\n   */\r\n  public contains(point: Vector): boolean {\r\n    const pos = this._transform?.pos ?? this.offset;\r\n    const distance = pos.distance(point);\r\n    if (distance <= this.radius) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Casts a ray at the Circle collider and returns the nearest point of collision\r\n   * @param ray\r\n   */\r\n  public rayCast(ray: Ray, max: number = Infinity): Vector {\r\n    //https://en.wikipedia.org/wiki/Line%E2%80%93sphere_intersection\r\n    const c = this.center;\r\n    const dir = ray.dir;\r\n    const orig = ray.pos;\r\n\r\n    const discriminant = Math.sqrt(Math.pow(dir.dot(orig.sub(c)), 2) - Math.pow(orig.sub(c).distance(), 2) + Math.pow(this.radius, 2));\r\n\r\n    if (discriminant < 0) {\r\n      // no intersection\r\n      return null;\r\n    } else {\r\n      let toi = 0;\r\n      if (discriminant === 0) {\r\n        toi = -dir.dot(orig.sub(c));\r\n        if (toi > 0 && toi < max) {\r\n          return ray.getPoint(toi);\r\n        }\r\n        return null;\r\n      } else {\r\n        const toi1 = -dir.dot(orig.sub(c)) + discriminant;\r\n        const toi2 = -dir.dot(orig.sub(c)) - discriminant;\r\n\r\n        const positiveToi: number[] = [];\r\n        if (toi1 >= 0) {\r\n          positiveToi.push(toi1);\r\n        }\r\n\r\n        if (toi2 >= 0) {\r\n          positiveToi.push(toi2);\r\n        }\r\n\r\n        const mintoi = Math.min(...positiveToi);\r\n        if (mintoi <= max) {\r\n          return ray.getPoint(mintoi);\r\n        }\r\n        return null;\r\n      }\r\n    }\r\n  }\r\n\r\n  public getClosestLineBetween(shape: Collider): Line {\r\n    if (shape instanceof CircleCollider) {\r\n      return ClosestLineJumpTable.CircleCircleClosestLine(this, shape);\r\n    } else if (shape instanceof PolygonCollider) {\r\n      return ClosestLineJumpTable.PolygonCircleClosestLine(shape, this).flip();\r\n    } else if (shape instanceof EdgeCollider) {\r\n      return ClosestLineJumpTable.CircleEdgeClosestLine(this, shape).flip();\r\n    } else {\r\n      throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof shape}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @inheritdoc\r\n   */\r\n  public collide(collider: Collider): CollisionContact[] {\r\n    if (collider instanceof CircleCollider) {\r\n      return CollisionJumpTable.CollideCircleCircle(this, collider);\r\n    } else if (collider instanceof PolygonCollider) {\r\n      return CollisionJumpTable.CollideCirclePolygon(this, collider);\r\n    } else if (collider instanceof EdgeCollider) {\r\n      return CollisionJumpTable.CollideCircleEdge(this, collider);\r\n    } else {\r\n      throw new Error(`Circle could not collide with unknown CollisionShape ${typeof collider}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Find the point on the collider furthest in the direction specified\r\n   */\r\n  public getFurthestPoint(direction: Vector): Vector {\r\n    return this.center.add(direction.normalize().scale(this.radius));\r\n  }\r\n\r\n  /**\r\n   * Find the local point on the shape in the direction specified\r\n   * @param direction\r\n   */\r\n  public getFurthestLocalPoint(direction: Vector): Vector {\r\n    const dir = direction.normalize();\r\n    return dir.scale(this.radius);\r\n  }\r\n\r\n  /**\r\n   * Get the axis aligned bounding box for the circle collider in world coordinates\r\n   */\r\n  public get bounds(): BoundingBox {\r\n    const tx = this._transform as TransformComponent;\r\n    const scale = tx?.globalScale ?? Vector.One;\r\n    const rotation = tx?.globalRotation ?? 0;\r\n    const pos = (tx?.globalPos ?? Vector.Zero);\r\n    return new BoundingBox(\r\n      this.offset.x - this._naturalRadius,\r\n      this.offset.y - this._naturalRadius,\r\n      this.offset.x + this._naturalRadius,\r\n      this.offset.y + this._naturalRadius\r\n    ).rotate(rotation).scale(scale).translate(pos);\r\n  }\r\n\r\n  /**\r\n   * Get the axis aligned bounding box for the circle collider in local coordinates\r\n   */\r\n  public get localBounds(): BoundingBox {\r\n    return new BoundingBox(\r\n      this.offset.x - this._naturalRadius,\r\n      this.offset.y - this._naturalRadius,\r\n      this.offset.x + this._naturalRadius,\r\n      this.offset.y + this._naturalRadius\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Get axis not implemented on circles, since there are infinite axis in a circle\r\n   */\r\n  public get axes(): Vector[] {\r\n    return [];\r\n  }\r\n\r\n  /**\r\n   * Returns the moment of inertia of a circle given it's mass\r\n   * https://en.wikipedia.org/wiki/List_of_moments_of_inertia\r\n   */\r\n  public getInertia(mass: number): number {\r\n    return (mass * this.radius * this.radius) / 2;\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  public update(transform: Transform): void {\r\n    this._transform = transform;\r\n  }\r\n\r\n  /**\r\n   * Project the circle along a specified axis\r\n   */\r\n  public project(axis: Vector): Projection {\r\n    const scalars = [];\r\n    const point = this.center;\r\n    const dotProduct = point.dot(axis);\r\n    scalars.push(dotProduct);\r\n    scalars.push(dotProduct + this.radius);\r\n    scalars.push(dotProduct - this.radius);\r\n    return new Projection(Math.min.apply(Math, scalars), Math.max.apply(Math, scalars));\r\n  }\r\n\r\n  /**\r\n   * @deprecated signature will change in v0.26.0\r\n   * @param ctx\r\n   * @param color\r\n   * @param pos\r\n   */\r\n  public draw(ctx: CanvasRenderingContext2D, color: Color = Color.Green, pos: Vector = Vector.Zero) {\r\n    const newPos = pos.add(this.offset);\r\n    ctx.beginPath();\r\n    ctx.fillStyle = color.toString();\r\n    ctx.arc(newPos.x, newPos.y, this.radius, 0, Math.PI * 2);\r\n    ctx.closePath();\r\n    ctx.fill();\r\n  }\r\n\r\n  public debug(ex: ExcaliburGraphicsContext, color: Color) {\r\n    const tx = this._transform as TransformComponent;\r\n    const scale = tx?.globalScale ?? Vector.One;\r\n    const rotation = tx?.globalRotation ?? 0;\r\n    const pos = (tx?.globalPos ?? Vector.Zero);\r\n    ex.save();\r\n    ex.translate(pos.x, pos.y);\r\n    ex.rotate(rotation);\r\n    ex.scale(scale.x, scale.y);\r\n    ex.drawCircle((this.offset ?? Vector.Zero), this._naturalRadius, Color.Transparent, color, 2);\r\n    ex.restore();\r\n  }\r\n\r\n  /**\r\n   * @deprecated signature will change in v0.26.0\r\n   * @param ctx\r\n   * @param color\r\n   */\r\n  /* istanbul ignore next */\r\n  public debugDraw(ctx: CanvasRenderingContext2D, color: Color = Color.Green) {\r\n    const transform = this._transform;\r\n    const pos = transform ? transform.pos.add(this.offset) : this.offset;\r\n    const rotation = transform ? transform.rotation : 0;\r\n\r\n    ctx.beginPath();\r\n    ctx.strokeStyle = color.toString();\r\n    ctx.arc(pos.x, pos.y, this.radius, 0, Math.PI * 2);\r\n    ctx.closePath();\r\n    ctx.stroke();\r\n    ctx.beginPath();\r\n    ctx.moveTo(pos.x, pos.y);\r\n    ctx.lineTo(Math.cos(rotation) * this.radius + pos.x, Math.sin(rotation) * this.radius + pos.y);\r\n    ctx.closePath();\r\n    ctx.stroke();\r\n  }\r\n}\r\n","import { Vector } from '../../Math/vector';\r\nimport { Physics } from '../Physics';\r\nimport { Collider } from '../Colliders/Collider';\r\nimport { CollisionType } from '../CollisionType';\r\nimport { Pair } from './Pair';\r\nimport { SeparationInfo } from '../Colliders/SeparatingAxis';\r\nimport { BodyComponent } from '../BodyComponent';\r\n\r\n/**\r\n * Collision contacts are used internally by Excalibur to resolve collision between colliders. This\r\n * Pair prevents collisions from being evaluated more than one time\r\n */\r\nexport class CollisionContact {\r\n  private _canceled = false;\r\n\r\n  /**\r\n   * Currently the ids between colliders\r\n   */\r\n  readonly id: string;\r\n\r\n  /**\r\n   * The first collider in the collision\r\n   */\r\n  colliderA: Collider;\r\n\r\n  /**\r\n   * The second collider in the collision\r\n   */\r\n  colliderB: Collider;\r\n\r\n  /**\r\n   * The minimum translation vector to resolve overlap, pointing away from colliderA\r\n   */\r\n  mtv: Vector;\r\n\r\n  /**\r\n   * World space contact points between colliderA and colliderB\r\n   */\r\n  points: Vector[];\r\n\r\n  /**\r\n   * Local space contact points between colliderA and colliderB\r\n   */\r\n  localPoints: Vector[];\r\n\r\n  /**\r\n   * The collision normal, pointing away from colliderA\r\n   */\r\n  normal: Vector;\r\n\r\n  /**\r\n   * The collision tangent\r\n   */\r\n  tangent: Vector;\r\n\r\n  /**\r\n   * Information about the specifics of the collision contact separation\r\n   */\r\n  info: SeparationInfo;\r\n\r\n  constructor(\r\n    colliderA: Collider,\r\n    colliderB: Collider,\r\n    mtv: Vector,\r\n    normal: Vector,\r\n    tangent: Vector,\r\n    points: Vector[],\r\n    localPoints: Vector[],\r\n    info: SeparationInfo\r\n  ) {\r\n    this.colliderA = colliderA;\r\n    this.colliderB = colliderB;\r\n    this.mtv = mtv;\r\n    this.normal = normal;\r\n    this.tangent = tangent;\r\n    this.points = points;\r\n    this.localPoints = localPoints;\r\n    this.info = info;\r\n    this.id = Pair.calculatePairHash(colliderA.id, colliderB.id);\r\n  }\r\n\r\n  /**\r\n   * Match contact awake state, except if body's are Fixed\r\n   */\r\n  public matchAwake(): void {\r\n    const bodyA = this.colliderA.owner.get(BodyComponent);\r\n    const bodyB = this.colliderB.owner.get(BodyComponent);\r\n    if (bodyA && bodyB) {\r\n      if (bodyA.sleeping !== bodyB.sleeping) {\r\n        if (bodyA.sleeping && bodyA.collisionType !== CollisionType.Fixed && bodyB.sleepMotion >= Physics.wakeThreshold) {\r\n          bodyA.setSleeping(false);\r\n        }\r\n        if (bodyB.sleeping && bodyB.collisionType !== CollisionType.Fixed && bodyA.sleepMotion >= Physics.wakeThreshold) {\r\n          bodyB.setSleeping(false);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  public isCanceled() {\r\n    return this._canceled;\r\n  }\r\n\r\n  public cancel(): void {\r\n    this._canceled = true;\r\n  }\r\n}\r\n","import { Line } from '../../Math/line';\r\nimport { Vector } from '../../Math/vector';\r\nimport { Collider } from './Collider';\r\nimport { CircleCollider } from './CircleCollider';\r\nimport { PolygonCollider } from './PolygonCollider';\r\n\r\n/**\r\n * Specific information about a contact and it's separation\r\n */\r\nexport interface SeparationInfo {\r\n  /**\r\n   * Collider A\r\n   */\r\n  collider: Collider;\r\n\r\n  /**\r\n   * Signed value (negative means overlap, positive no overlap)\r\n   */\r\n  separation: number;\r\n\r\n  /**\r\n   * Axis of separation from the collider's perspective\r\n   */\r\n  axis: Vector;\r\n\r\n  /**\r\n   * Side of separation (reference) from the collider's perspective\r\n   */\r\n\r\n  side?: Line;\r\n\r\n  /**\r\n   * Local side of separation (reference) from the collider's perspective\r\n   */\r\n  localSide?: Line;\r\n\r\n  /**\r\n   * Index of the separation side (reference) from the collider's perspective\r\n   */\r\n  sideId?: number;\r\n\r\n  /**\r\n   * Point on collider B (incident point)\r\n   */\r\n  point: Vector;\r\n\r\n  /**\r\n   * Local point on collider B (incident point)\r\n   */\r\n  localPoint?: Vector;\r\n}\r\n\r\nexport class SeparatingAxis {\r\n  static findPolygonPolygonSeparation(polyA: PolygonCollider, polyB: PolygonCollider): SeparationInfo {\r\n    let bestSeparation = -Number.MAX_VALUE;\r\n    let bestSide: Line | null = null;\r\n    let bestAxis: Vector | null = null;\r\n    let bestSideIndex: number = -1;\r\n    let bestOtherPoint: Vector | null = null;\r\n    const sides = polyA.getSides();\r\n    const localSides = polyA.getLocalSides();\r\n    for (let i = 0; i < sides.length; i++) {\r\n      const side = sides[i];\r\n      const axis = side.normal();\r\n      const vertB = polyB.getFurthestPoint(axis.negate());\r\n      // Separation on side i's axis\r\n      // We are looking for the largest separation between poly A's sides\r\n      const vertSeparation = side.distanceToPoint(vertB, true);\r\n      if (vertSeparation > bestSeparation) {\r\n        bestSeparation = vertSeparation;\r\n        bestSide = side;\r\n        bestAxis = axis;\r\n        bestSideIndex = i;\r\n        bestOtherPoint = vertB;\r\n      }\r\n    }\r\n\r\n    return {\r\n      collider: polyA,\r\n      separation: bestAxis ? bestSeparation : 99,\r\n      axis: bestAxis as Vector,\r\n      side: bestSide,\r\n      localSide: localSides[bestSideIndex],\r\n      sideId: bestSideIndex,\r\n      point: bestOtherPoint as Vector,\r\n      localPoint: bestAxis ? polyB.getFurthestLocalPoint(bestAxis!.negate()) : null\r\n    };\r\n  }\r\n\r\n  static findCirclePolygonSeparation(circle: CircleCollider, polygon: PolygonCollider): Vector | null {\r\n    const axes = polygon.axes;\r\n    const pc = polygon.center;\r\n    // Special SAT with circles\r\n    const polyDir = pc.sub(circle.worldPos);\r\n    const closestPointOnPoly = polygon.getFurthestPoint(polyDir.negate());\r\n    axes.push(closestPointOnPoly.sub(circle.worldPos).normalize());\r\n\r\n    let minOverlap = Number.MAX_VALUE;\r\n    let minAxis = null;\r\n    let minIndex = -1;\r\n    for (let i = 0; i < axes.length; i++) {\r\n      const proj1 = polygon.project(axes[i]);\r\n      const proj2 = circle.project(axes[i]);\r\n      const overlap = proj1.getOverlap(proj2);\r\n      if (overlap <= 0) {\r\n        return null;\r\n      } else {\r\n        if (overlap < minOverlap) {\r\n          minOverlap = overlap;\r\n          minAxis = axes[i];\r\n          minIndex = i;\r\n        }\r\n      }\r\n    }\r\n    if (minIndex < 0) {\r\n      return null;\r\n    }\r\n    return minAxis.normalize().scale(minOverlap);\r\n  }\r\n}\r\n","import { CircleCollider } from './CircleCollider';\r\nimport { CollisionContact } from '../Detection/CollisionContact';\r\nimport { PolygonCollider } from './PolygonCollider';\r\nimport { EdgeCollider } from './EdgeCollider';\r\nimport { SeparatingAxis, SeparationInfo } from './SeparatingAxis';\r\nimport { Line } from '../../Math/line';\r\nimport { Vector } from '../../Math/vector';\r\nimport { TransformComponent } from '../../EntityComponentSystem';\r\nimport { Pair } from '../Detection/Pair';\r\n\r\nexport const CollisionJumpTable = {\r\n  CollideCircleCircle(circleA: CircleCollider, circleB: CircleCollider): CollisionContact[] {\r\n    const circleAPos = circleA.worldPos;\r\n    const circleBPos = circleB.worldPos;\r\n    const combinedRadius = circleA.radius + circleB.radius;\r\n    const distance = circleAPos.distance(circleBPos);\r\n\r\n    if (distance > combinedRadius) {\r\n      return [];\r\n    }\r\n\r\n    // negative means overlap\r\n    const separation = combinedRadius - distance;\r\n\r\n    // Normal points from A -> B\r\n    const normal = circleBPos.sub(circleAPos).normalize();\r\n    const tangent = normal.perpendicular();\r\n    const mvt = normal.scale(separation);\r\n\r\n    const point = circleA.getFurthestPoint(normal);\r\n    const local = circleA.getFurthestLocalPoint(normal);\r\n\r\n    const info: SeparationInfo = {\r\n      collider: circleA,\r\n      separation,\r\n      axis: normal,\r\n      point: point\r\n    };\r\n\r\n    return [new CollisionContact(circleA, circleB, mvt, normal, tangent, [point], [local], info)];\r\n  },\r\n\r\n  CollideCirclePolygon(circle: CircleCollider, polygon: PolygonCollider): CollisionContact[] {\r\n    let minAxis = SeparatingAxis.findCirclePolygonSeparation(circle, polygon);\r\n    if (!minAxis) {\r\n      return [];\r\n    }\r\n\r\n    // make sure that the minAxis is pointing away from circle\r\n    const samedir = minAxis.dot(polygon.center.sub(circle.center));\r\n    minAxis = samedir < 0 ? minAxis.negate() : minAxis;\r\n\r\n    const point = circle.getFurthestPoint(minAxis);\r\n    const xf = circle.owner?.get(TransformComponent) ?? new TransformComponent();\r\n    const local = xf.applyInverse(point);\r\n    const normal = minAxis.normalize();\r\n\r\n    const info: SeparationInfo = {\r\n      collider: circle,\r\n      separation: -minAxis.size,\r\n      axis: normal,\r\n      point: point,\r\n      localPoint: local,\r\n      side: polygon.findSide(normal.negate()),\r\n      localSide: polygon.findLocalSide(normal.negate())\r\n    };\r\n\r\n    return [new CollisionContact(circle, polygon, minAxis, normal, normal.perpendicular(), [point], [local], info)];\r\n  },\r\n\r\n  CollideCircleEdge(circle: CircleCollider, edge: EdgeCollider): CollisionContact[] {\r\n    // TODO not sure this actually abides by local/world collisions\r\n    // Are edge.begin and edge.end local space or world space? I think they should be local\r\n\r\n    // center of the circle in world pos\r\n    const cc = circle.center;\r\n    // vector in the direction of the edge\r\n    const edgeWorld = edge.asLine();\r\n    const e = edgeWorld.end.sub(edgeWorld.begin);\r\n\r\n    // amount of overlap with the circle's center along the edge direction\r\n    const u = e.dot(edgeWorld.end.sub(cc));\r\n    const v = e.dot(cc.sub(edgeWorld.begin));\r\n    const side = edge.asLine();\r\n    const localSide = edge.asLocalLine();\r\n\r\n    // Potential region A collision (circle is on the left side of the edge, before the beginning)\r\n    if (v <= 0) {\r\n      const da = edgeWorld.begin.sub(cc);\r\n      const dda = da.dot(da); // quick and dirty way of calc'n distance in r^2 terms saves some sqrts\r\n      // save some sqrts\r\n      if (dda > circle.radius * circle.radius) {\r\n        return []; // no collision\r\n      }\r\n\r\n      const normal = da.normalize();\r\n      const separation = circle.radius - Math.sqrt(dda);\r\n\r\n      const info: SeparationInfo = {\r\n        collider: circle,\r\n        separation: separation,\r\n        axis: normal,\r\n        point: side.begin,\r\n        side: side,\r\n        localSide: localSide\r\n      };\r\n\r\n      return [\r\n        new CollisionContact(circle, edge, normal.scale(separation), normal, normal.perpendicular(), [side.begin], [localSide.begin], info)\r\n      ];\r\n    }\r\n\r\n    // Potential region B collision (circle is on the right side of the edge, after the end)\r\n    if (u <= 0) {\r\n      const db = edgeWorld.end.sub(cc);\r\n      const ddb = db.dot(db);\r\n      if (ddb > circle.radius * circle.radius) {\r\n        return [];\r\n      }\r\n\r\n      const normal = db.normalize();\r\n      const separation = circle.radius - Math.sqrt(ddb);\r\n\r\n      const info: SeparationInfo = {\r\n        collider: circle,\r\n        separation: separation,\r\n        axis: normal,\r\n        point: side.end,\r\n        side: side,\r\n        localSide: localSide\r\n      };\r\n\r\n      return [\r\n        new CollisionContact(circle, edge, normal.scale(separation), normal, normal.perpendicular(), [side.end], [localSide.end], info)\r\n      ];\r\n    }\r\n\r\n    // Otherwise potential region AB collision (circle is in the middle of the edge between the beginning and end)\r\n    const den = e.dot(e);\r\n    const pointOnEdge = edgeWorld.begin\r\n      .scale(u)\r\n      .add(edgeWorld.end.scale(v))\r\n      .scale(1 / den);\r\n    const d = cc.sub(pointOnEdge);\r\n\r\n    const dd = d.dot(d);\r\n    if (dd > circle.radius * circle.radius) {\r\n      return []; // no collision\r\n    }\r\n\r\n    let normal = e.perpendicular();\r\n    // flip correct direction\r\n    if (normal.dot(cc.sub(edgeWorld.begin)) < 0) {\r\n      normal.x = -normal.x;\r\n      normal.y = -normal.y;\r\n    }\r\n\r\n    normal = normal.normalize();\r\n    const separation = circle.radius - Math.sqrt(dd);\r\n\r\n    const mvt = normal.scale(separation);\r\n    const info: SeparationInfo = {\r\n      collider: circle,\r\n      separation: separation,\r\n      axis: normal,\r\n      point: pointOnEdge,\r\n      side: side,\r\n      localSide: localSide\r\n    };\r\n\r\n    return [\r\n      new CollisionContact(\r\n        circle,\r\n        edge,\r\n        mvt,\r\n        normal.negate(),\r\n        normal.negate().perpendicular(),\r\n        [pointOnEdge],\r\n        [pointOnEdge.sub(edge.worldPos)],\r\n        info\r\n      )\r\n    ];\r\n  },\r\n\r\n  CollideEdgeEdge(): CollisionContact[] {\r\n    // Edge-edge collision doesn't make sense\r\n    return [];\r\n  },\r\n\r\n  CollidePolygonEdge(polygon: PolygonCollider, edge: EdgeCollider): CollisionContact[] {\r\n    const pc = polygon.center;\r\n    const ec = edge.center;\r\n    const dir = ec.sub(pc).normalize();\r\n\r\n    // build a temporary polygon from the edge to use SAT\r\n    const linePoly = new PolygonCollider({\r\n      points: [edge.begin, edge.end, edge.end.add(dir.scale(100)), edge.begin.add(dir.scale(100))],\r\n      offset: edge.offset\r\n    });\r\n    linePoly.owner = edge.owner;\r\n    const tx = edge.owner?.get(TransformComponent);\r\n    if (tx) {\r\n      linePoly.update(edge.owner.get(TransformComponent));\r\n    }\r\n    // Gross hack but poly-poly works well\r\n    const contact = this.CollidePolygonPolygon(polygon, linePoly);\r\n    if (contact.length) {\r\n      // Fudge the contact back to edge\r\n      contact[0].colliderB = edge;\r\n      (contact[0].id as any) = Pair.calculatePairHash(polygon.id, edge.id);\r\n      // contact[0].info.collider\r\n    }\r\n    return contact;\r\n  },\r\n\r\n  CollidePolygonPolygon(polyA: PolygonCollider, polyB: PolygonCollider): CollisionContact[] {\r\n    // Multi contact from SAT\r\n    // https://gamedev.stackexchange.com/questions/111390/multiple-contacts-for-sat-collision-detection\r\n    // do a SAT test to find a min axis if it exists\r\n    const separationA = SeparatingAxis.findPolygonPolygonSeparation(polyA, polyB);\r\n    // If there is no overlap from boxA's perspective we can end early\r\n    if (separationA.separation > 0) {\r\n      return [];\r\n    }\r\n\r\n    const separationB = SeparatingAxis.findPolygonPolygonSeparation(polyB, polyA);\r\n    // If there is no overlap from boxB's perspective exit now\r\n    if (separationB.separation > 0) {\r\n      return [];\r\n    }\r\n\r\n    // Separations are both negative, we want to pick the least negative (minimal movement)\r\n    const separation = separationA.separation > separationB.separation ? separationA : separationB;\r\n\r\n    // The incident side is the most opposite from the axes of collision on the other collider\r\n    const other = separation.collider === polyA ? polyB : polyA;\r\n    const incident = other.findSide(separation.axis.negate()) as Line;\r\n\r\n    // Clip incident side by the perpendicular lines at each end of the reference side\r\n    // https://en.wikipedia.org/wiki/Sutherland%E2%80%93Hodgman_algorithm\r\n    const reference = separation.side;\r\n    const refDir = reference.dir().normalize();\r\n\r\n    // Find our contact points by clipping the incident by the collision side\r\n    const clipRight = incident.clip(refDir.negate(), -refDir.dot(reference.begin));\r\n    let clipLeft: Line | null = null;\r\n    if (clipRight) {\r\n      clipLeft = clipRight.clip(refDir, refDir.dot(reference.end));\r\n    }\r\n\r\n    // If there is no left there is no collision\r\n    if (clipLeft) {\r\n      // We only want clip points below the reference edge, discard the others\r\n      const points = clipLeft.getPoints().filter((p) => {\r\n        return reference.below(p);\r\n      });\r\n\r\n      let normal = separation.axis;\r\n      let tangent = normal.perpendicular();\r\n      // Point Contact A -> B\r\n      if (polyB.center.sub(polyA.center).dot(normal) < 0) {\r\n        normal = normal.negate();\r\n        tangent = normal.perpendicular();\r\n      }\r\n      // Points are clipped from incident which is the other collider\r\n      // Store those as locals\r\n      let localPoints: Vector[] = [];\r\n      if (separation.collider === polyA) {\r\n        const xf = polyB.owner?.get(TransformComponent) ?? new TransformComponent();\r\n        localPoints = points.map((p) => xf.applyInverse(p));\r\n      } else {\r\n        const xf = polyA.owner?.get(TransformComponent) ?? new TransformComponent();\r\n        localPoints = points.map((p) => xf.applyInverse(p));\r\n      }\r\n      return [new CollisionContact(polyA, polyB, normal.scale(-separation.separation), normal, tangent, points, localPoints, separation)];\r\n    }\r\n    return [];\r\n  },\r\n\r\n  FindContactSeparation(contact: CollisionContact, localPoint: Vector) {\r\n    const shapeA = contact.colliderA;\r\n    const txA = contact.colliderA.owner?.get(TransformComponent) ?? new TransformComponent();\r\n    const shapeB = contact.colliderB;\r\n    const txB = contact.colliderB.owner?.get(TransformComponent) ?? new TransformComponent();\r\n\r\n    // both are circles\r\n    if (shapeA instanceof CircleCollider && shapeB instanceof CircleCollider) {\r\n      const combinedRadius = shapeA.radius + shapeB.radius;\r\n      const distance = txA.pos.distance(txB.pos);\r\n      const separation = combinedRadius - distance;\r\n      return -separation;\r\n    }\r\n\r\n    // both are polygons\r\n    if (shapeA instanceof PolygonCollider && shapeB instanceof PolygonCollider) {\r\n      if (contact.info.localSide) {\r\n        let side: Line;\r\n        let worldPoint: Vector;\r\n        if (contact.info.collider === shapeA) {\r\n          side = new Line(txA.apply(contact.info.localSide.begin), txA.apply(contact.info.localSide.end));\r\n          worldPoint = txB.apply(localPoint);\r\n        } else {\r\n          side = new Line(txB.apply(contact.info.localSide.begin), txB.apply(contact.info.localSide.end));\r\n          worldPoint = txA.apply(localPoint);\r\n        }\r\n\r\n        return side.distanceToPoint(worldPoint, true);\r\n      }\r\n    }\r\n\r\n    // polygon v circle\r\n    if (\r\n      (shapeA instanceof PolygonCollider && shapeB instanceof CircleCollider) ||\r\n      (shapeB instanceof PolygonCollider && shapeA instanceof CircleCollider)\r\n    ) {\r\n      const worldPoint = txA.apply(localPoint);\r\n      if (contact.info.side) {\r\n        return contact.info.side.distanceToPoint(worldPoint, true);\r\n      }\r\n    }\r\n\r\n    // polygon v edge\r\n    if (\r\n      (shapeA instanceof EdgeCollider && shapeB instanceof PolygonCollider) ||\r\n      (shapeB instanceof EdgeCollider && shapeA instanceof PolygonCollider)\r\n    ) {\r\n      let worldPoint: Vector;\r\n      if (contact.info.collider === shapeA) {\r\n        worldPoint = txB.apply(localPoint);\r\n      } else {\r\n        worldPoint = txA.apply(localPoint);\r\n      }\r\n      if (contact.info.side) {\r\n        return contact.info.side.distanceToPoint(worldPoint, true);\r\n      }\r\n    }\r\n\r\n    // circle v edge\r\n    if (\r\n      (shapeA instanceof CircleCollider && shapeB instanceof EdgeCollider) ||\r\n      (shapeB instanceof CircleCollider && shapeA instanceof EdgeCollider)\r\n    ) {\r\n      // Local point is always on the edge which is always shapeB\r\n      const worldPoint = txB.apply(localPoint);\r\n\r\n      let circlePoint: Vector;\r\n      if (shapeA instanceof CircleCollider) {\r\n        circlePoint = shapeA.getFurthestPoint(contact.normal);\r\n      }\r\n\r\n      const dist = worldPoint.distance(circlePoint);\r\n\r\n      if (contact.info.side) {\r\n        return dist > 0 ? -dist : 0;\r\n      }\r\n    }\r\n\r\n    return 0;\r\n  }\r\n};\r\n","import { BoundingBox } from '../BoundingBox';\r\nimport { CollisionContact } from '../Detection/CollisionContact';\r\nimport { CollisionJumpTable } from './CollisionJumpTable';\r\nimport { CircleCollider } from './CircleCollider';\r\nimport { PolygonCollider } from './PolygonCollider';\r\n\r\nimport { Projection } from '../../Math/projection';\r\nimport { Line } from '../../Math/line';\r\nimport { Vector } from '../../Math/vector';\r\nimport { Ray } from '../../Math/ray';\r\nimport { Color } from '../../Color';\r\nimport { Collider } from './Collider';\r\nimport { ClosestLineJumpTable } from './ClosestLineJumpTable';\r\nimport { Transform, TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\r\nimport { ExcaliburGraphicsContext } from '../../Graphics/Context/ExcaliburGraphicsContext';\r\n\r\nexport interface EdgeColliderOptions {\r\n  /**\r\n   * The beginning of the edge defined in local coordinates to the collider\r\n   */\r\n  begin: Vector;\r\n  /**\r\n   * The ending of the edge defined in local coordinates to the collider\r\n   */\r\n  end: Vector;\r\n  /**\r\n   * Optionally specify an offset\r\n   */\r\n  offset?: Vector;\r\n}\r\n\r\n/**\r\n * Edge is a single line collider to create collisions with a single line.\r\n */\r\nexport class EdgeCollider extends Collider {\r\n  offset: Vector;\r\n  begin: Vector;\r\n  end: Vector;\r\n\r\n  private _transform: Transform;\r\n\r\n  constructor(options: EdgeColliderOptions) {\r\n    super();\r\n    this.begin = options.begin || Vector.Zero;\r\n    this.end = options.end || Vector.Zero;\r\n    this.offset = options.offset ?? Vector.Zero;\r\n  }\r\n\r\n  /**\r\n   * Returns a clone of this Edge, not associated with any collider\r\n   */\r\n  public clone(): EdgeCollider {\r\n    return new EdgeCollider({\r\n      begin: this.begin.clone(),\r\n      end: this.end.clone()\r\n    });\r\n  }\r\n\r\n  public get worldPos(): Vector {\r\n    const tx = this._transform as TransformComponent;\r\n    return tx?.globalPos.add(this.offset) ?? this.offset;\r\n  }\r\n\r\n  /**\r\n   * Get the center of the collision area in world coordinates\r\n   */\r\n  public get center(): Vector {\r\n    const pos = this.begin.average(this.end).add(this._getBodyPos());\r\n    return pos;\r\n  }\r\n\r\n  private _getBodyPos(): Vector {\r\n    const tx = this._transform as TransformComponent;\r\n    const bodyPos = tx?.globalPos ?? Vector.Zero;\r\n    return bodyPos;\r\n  }\r\n\r\n  private _getTransformedBegin(): Vector {\r\n    const tx = this._transform as TransformComponent;\r\n    const angle = tx ? tx.globalRotation : 0;\r\n    return this.begin.rotate(angle).add(this._getBodyPos());\r\n  }\r\n\r\n  private _getTransformedEnd(): Vector {\r\n    const tx = this._transform as TransformComponent;\r\n    const angle = tx ? tx.globalRotation : 0;\r\n    return this.end.rotate(angle).add(this._getBodyPos());\r\n  }\r\n\r\n  /**\r\n   * Returns the slope of the line in the form of a vector\r\n   */\r\n  public getSlope(): Vector {\r\n    const begin = this._getTransformedBegin();\r\n    const end = this._getTransformedEnd();\r\n    const distance = begin.distance(end);\r\n    return end.sub(begin).scale(1 / distance);\r\n  }\r\n\r\n  /**\r\n   * Returns the length of the line segment in pixels\r\n   */\r\n  public getLength(): number {\r\n    const begin = this._getTransformedBegin();\r\n    const end = this._getTransformedEnd();\r\n    const distance = begin.distance(end);\r\n    return distance;\r\n  }\r\n\r\n  /**\r\n   * Tests if a point is contained in this collision area\r\n   */\r\n  public contains(): boolean {\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * @inheritdoc\r\n   */\r\n  public rayCast(ray: Ray, max: number = Infinity): Vector {\r\n    const numerator = this._getTransformedBegin().sub(ray.pos);\r\n\r\n    // Test is line and ray are parallel and non intersecting\r\n    if (ray.dir.cross(this.getSlope()) === 0 && numerator.cross(ray.dir) !== 0) {\r\n      return null;\r\n    }\r\n\r\n    // Lines are parallel\r\n    const divisor = ray.dir.cross(this.getSlope());\r\n    if (divisor === 0) {\r\n      return null;\r\n    }\r\n\r\n    const t = numerator.cross(this.getSlope()) / divisor;\r\n\r\n    if (t >= 0 && t <= max) {\r\n      const u = numerator.cross(ray.dir) / divisor / this.getLength();\r\n      if (u >= 0 && u <= 1) {\r\n        return ray.getPoint(t);\r\n      }\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Returns the closes line between this and another collider, from this -> collider\r\n   * @param shape\r\n   */\r\n  public getClosestLineBetween(shape: Collider): Line {\r\n    if (shape instanceof CircleCollider) {\r\n      return ClosestLineJumpTable.CircleEdgeClosestLine(shape, this);\r\n    } else if (shape instanceof PolygonCollider) {\r\n      return ClosestLineJumpTable.PolygonEdgeClosestLine(shape, this).flip();\r\n    } else if (shape instanceof EdgeCollider) {\r\n      return ClosestLineJumpTable.EdgeEdgeClosestLine(this, shape);\r\n    } else {\r\n      throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof shape}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @inheritdoc\r\n   */\r\n  public collide(shape: Collider): CollisionContact[] {\r\n    if (shape instanceof CircleCollider) {\r\n      return CollisionJumpTable.CollideCircleEdge(shape, this);\r\n    } else if (shape instanceof PolygonCollider) {\r\n      return CollisionJumpTable.CollidePolygonEdge(shape, this);\r\n    } else if (shape instanceof EdgeCollider) {\r\n      return CollisionJumpTable.CollideEdgeEdge();\r\n    } else {\r\n      throw new Error(`Edge could not collide with unknown CollisionShape ${typeof shape}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Find the point on the collider furthest in the direction specified\r\n   */\r\n  public getFurthestPoint(direction: Vector): Vector {\r\n    const transformedBegin = this._getTransformedBegin();\r\n    const transformedEnd = this._getTransformedEnd();\r\n    if (direction.dot(transformedBegin) > 0) {\r\n      return transformedBegin;\r\n    } else {\r\n      return transformedEnd;\r\n    }\r\n  }\r\n\r\n  private _boundsFromBeginEnd(begin: Vector, end: Vector, padding = 10) {\r\n    // A perfectly vertical or horizontal edge would have a bounds 0 width or height\r\n    // this causes problems for the collision system so we give them some padding\r\n    return new BoundingBox(\r\n      Math.min(begin.x, end.x) - padding,\r\n      Math.min(begin.y, end.y) - padding,\r\n      Math.max(begin.x, end.x) + padding,\r\n      Math.max(begin.y, end.y) + padding\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Get the axis aligned bounding box for the edge collider in world space\r\n   */\r\n  public get bounds(): BoundingBox {\r\n    const transformedBegin = this._getTransformedBegin();\r\n    const transformedEnd = this._getTransformedEnd();\r\n    return this._boundsFromBeginEnd(transformedBegin, transformedEnd);\r\n  }\r\n\r\n  /**\r\n   * Get the axis aligned bounding box for the edge collider in local space\r\n   */\r\n  public get localBounds(): BoundingBox {\r\n    return this._boundsFromBeginEnd(this.begin, this.end);\r\n  }\r\n\r\n  /**\r\n   * Returns this edge represented as a line in world coordinates\r\n   */\r\n  public asLine(): Line {\r\n    return new Line(this._getTransformedBegin(), this._getTransformedEnd());\r\n  }\r\n\r\n  /**\r\n   * Return this edge as a line in local line coordinates (relative to the position)\r\n   */\r\n  public asLocalLine(): Line {\r\n    return new Line(this.begin, this.end);\r\n  }\r\n\r\n  /**\r\n   * Get the axis associated with the edge\r\n   */\r\n  public get axes(): Vector[] {\r\n    const e = this._getTransformedEnd().sub(this._getTransformedBegin());\r\n    const edgeNormal = e.normal();\r\n\r\n    const axes = [];\r\n    axes.push(edgeNormal);\r\n    axes.push(edgeNormal.negate());\r\n    axes.push(edgeNormal.normal());\r\n    axes.push(edgeNormal.normal().negate());\r\n    return axes;\r\n  }\r\n\r\n  /**\r\n   * Get the moment of inertia for an edge\r\n   * https://en.wikipedia.org/wiki/List_of_moments_of_inertia\r\n   */\r\n  public getInertia(mass: number): number {\r\n    const length = this.end.sub(this.begin).distance() / 2;\r\n    return mass * length * length;\r\n  }\r\n\r\n  /**\r\n   * @inheritdoc\r\n   */\r\n  public update(transform: Transform): void {\r\n    this._transform = transform;\r\n  }\r\n\r\n  /**\r\n   * Project the edge along a specified axis\r\n   */\r\n  public project(axis: Vector): Projection {\r\n    const scalars = [];\r\n\r\n    const points = [this._getTransformedBegin(), this._getTransformedEnd()];\r\n    const len = points.length;\r\n    for (let i = 0; i < len; i++) {\r\n      scalars.push(points[i].dot(axis));\r\n    }\r\n\r\n    return new Projection(Math.min.apply(Math, scalars), Math.max.apply(Math, scalars));\r\n  }\r\n\r\n  public draw(ctx: CanvasRenderingContext2D, color: Color = Color.Green, pos: Vector = Vector.Zero) {\r\n    const begin = this.begin.add(pos);\r\n    const end = this.end.add(pos);\r\n    ctx.strokeStyle = color.toString();\r\n    ctx.beginPath();\r\n    ctx.moveTo(begin.x, begin.y);\r\n    ctx.lineTo(end.x, end.y);\r\n    ctx.closePath();\r\n    ctx.stroke();\r\n  }\r\n\r\n  public debug(ex: ExcaliburGraphicsContext, color: Color) {\r\n    const begin = this._getTransformedBegin();\r\n    const end = this._getTransformedEnd();\r\n    ex.drawLine(begin, end, color, 2);\r\n    ex.drawCircle(begin, 2, color);\r\n    ex.drawCircle(end, 2, color);\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  public debugDraw(ctx: CanvasRenderingContext2D, color: Color = Color.Red) {\r\n    const begin = this._getTransformedBegin();\r\n    const end = this._getTransformedEnd();\r\n    ctx.strokeStyle = color.toString();\r\n    ctx.beginPath();\r\n    ctx.moveTo(begin.x, begin.y);\r\n    ctx.lineTo(end.x, end.y);\r\n    ctx.closePath();\r\n    ctx.stroke();\r\n  }\r\n}\r\n","import { Color } from '../../Color';\r\nimport { BoundingBox } from '../BoundingBox';\r\nimport { EdgeCollider } from './EdgeCollider';\r\nimport { CollisionJumpTable } from './CollisionJumpTable';\r\nimport { CircleCollider } from './CircleCollider';\r\nimport { CollisionContact } from '../Detection/CollisionContact';\r\nimport { Projection } from '../../Math/projection';\r\nimport { Line } from '../../Math/line';\r\nimport { Vector } from '../../Math/vector';\r\nimport { Ray } from '../../Math/ray';\r\nimport { ClosestLineJumpTable } from './ClosestLineJumpTable';\r\nimport { Transform, TransformComponent } from '../../EntityComponentSystem';\r\nimport { Collider } from './Collider';\r\nimport { ExcaliburGraphicsContext } from '../..';\r\n\r\nexport interface PolygonColliderOptions {\r\n  /**\r\n   * Pixel offset relative to a collider's body transform position.\r\n   */\r\n  offset?: Vector;\r\n  /**\r\n   * Points in the polygon in order around the perimeter in local coordinates. These are relative from the body transform position.\r\n   */\r\n  points: Vector[];\r\n  /**\r\n   * Whether points are specified in clockwise or counter clockwise order, default counter-clockwise\r\n   */\r\n  clockwiseWinding?: boolean;\r\n}\r\n\r\n/**\r\n * Polygon collider for detecting collisions\r\n */\r\nexport class PolygonCollider extends Collider {\r\n  /**\r\n   * Pixel offset relative to a collider's body transform position.\r\n   */\r\n  public offset: Vector;\r\n\r\n  /**\r\n   * Points in the polygon in order around the perimeter in local coordinates. These are relative from the body transform position.\r\n   */\r\n  public points: Vector[];\r\n\r\n  private _transform: Transform;\r\n\r\n  private _transformedPoints: Vector[] = [];\r\n  private _axes: Vector[] = [];\r\n  private _sides: Line[] = [];\r\n  private _localSides: Line[] = [];\r\n\r\n  constructor(options: PolygonColliderOptions) {\r\n    super();\r\n    this.offset = options.offset ?? Vector.Zero;\r\n    const winding = !!options.clockwiseWinding;\r\n    this.points = (winding ? options.points.reverse() : options.points) || [];\r\n\r\n    // calculate initial transformation\r\n    this._calculateTransformation();\r\n  }\r\n\r\n  /**\r\n   * Returns a clone of this ConvexPolygon, not associated with any collider\r\n   */\r\n  public clone(): PolygonCollider {\r\n    return new PolygonCollider({\r\n      offset: this.offset.clone(),\r\n      points: this.points.map((p) => p.clone())\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Returns the world position of the collider, which is the current body transform plus any defined offset\r\n   */\r\n  public get worldPos(): Vector {\r\n    if (this._transform) {\r\n      return this._transform.pos.add(this.offset);\r\n    }\r\n    return this.offset;\r\n  }\r\n\r\n  /**\r\n   * Get the center of the collider in world coordinates\r\n   */\r\n  public get center(): Vector {\r\n    return this.bounds.center;\r\n  }\r\n\r\n  /**\r\n   * Calculates the underlying transformation from the body relative space to world space\r\n   */\r\n  private _calculateTransformation() {\r\n    const transform = this._transform as TransformComponent;\r\n\r\n    const pos = transform ? transform.globalPos.add(this.offset) : this.offset;\r\n    const angle = transform ? transform.globalRotation : 0;\r\n    const scale = transform ? transform.globalScale : Vector.One;\r\n\r\n    const len = this.points.length;\r\n    this._transformedPoints.length = 0; // clear out old transform\r\n    for (let i = 0; i < len; i++) {\r\n      this._transformedPoints[i] = this.points[i].scale(scale).rotate(angle).add(pos);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Gets the points that make up the polygon in world space, from actor relative space (if specified)\r\n   */\r\n  public getTransformedPoints(): Vector[] {\r\n    this._calculateTransformation();\r\n    return this._transformedPoints;\r\n  }\r\n\r\n  /**\r\n   * Gets the sides of the polygon in world space\r\n   */\r\n  public getSides(): Line[] {\r\n    if (this._sides.length) {\r\n      return this._sides;\r\n    }\r\n    const lines = [];\r\n    const points = this.getTransformedPoints();\r\n    const len = points.length;\r\n    for (let i = 0; i < len; i++) {\r\n      // This winding is important\r\n      lines.push(new Line(points[i], points[(i + 1) % len]));\r\n    }\r\n    this._sides = lines;\r\n    return this._sides;\r\n  }\r\n\r\n  /**\r\n   * Returns the local coordinate space sides\r\n   */\r\n  public getLocalSides(): Line[] {\r\n    if (this._localSides.length) {\r\n      return this._localSides;\r\n    }\r\n    const lines = [];\r\n    const points = this.points;\r\n    const len = points.length;\r\n    for (let i = 0; i < len; i++) {\r\n      // This winding is important\r\n      lines.push(new Line(points[i], points[(i + 1) % len]));\r\n    }\r\n    this._localSides = lines;\r\n    return this._localSides;\r\n  }\r\n\r\n  /**\r\n   * Given a direction vector find the world space side that is most in that direction\r\n   * @param direction\r\n   */\r\n  public findSide(direction: Vector): Line {\r\n    const sides = this.getSides();\r\n    let bestSide = sides[0];\r\n    let maxDistance = -Number.MAX_VALUE;\r\n    for (let side = 0; side < sides.length; side++) {\r\n      const currentSide = sides[side];\r\n      const sideNormal = currentSide.normal();\r\n      const mostDirection = sideNormal.dot(direction);\r\n      if (mostDirection > maxDistance) {\r\n        bestSide = currentSide;\r\n        maxDistance = mostDirection;\r\n      }\r\n    }\r\n    return bestSide;\r\n  }\r\n\r\n  /**\r\n   * Given a direction vector find the local space side that is most in that direction\r\n   * @param direction\r\n   */\r\n  public findLocalSide(direction: Vector): Line {\r\n    const sides = this.getLocalSides();\r\n    let bestSide = sides[0];\r\n    let maxDistance = -Number.MAX_VALUE;\r\n    for (let side = 0; side < sides.length; side++) {\r\n      const currentSide = sides[side];\r\n      const sideNormal = currentSide.normal();\r\n      const mostDirection = sideNormal.dot(direction);\r\n      if (mostDirection > maxDistance) {\r\n        bestSide = currentSide;\r\n        maxDistance = mostDirection;\r\n      }\r\n    }\r\n    return bestSide;\r\n  }\r\n\r\n  /**\r\n   * Get the axis associated with the convex polygon\r\n   */\r\n  public get axes(): Vector[] {\r\n    if (this._axes.length) {\r\n      return this._axes;\r\n    }\r\n    const axes = this.getSides().map((s) => s.normal());\r\n    this._axes = axes;\r\n    return this._axes;\r\n  }\r\n\r\n  public update(transform: Transform): void {\r\n    this._transform = transform;\r\n    this._sides.length = 0;\r\n    this._localSides.length = 0;\r\n    this._axes.length = 0;\r\n    this._transformedPoints.length = 0;\r\n    this.getTransformedPoints();\r\n    this.getSides();\r\n    this.getLocalSides();\r\n  }\r\n\r\n  /**\r\n   * Tests if a point is contained in this collider in world space\r\n   */\r\n  public contains(point: Vector): boolean {\r\n    // Always cast to the right, as long as we cast in a consistent fixed direction we\r\n    // will be fine\r\n    const testRay = new Ray(point, new Vector(1, 0));\r\n    const intersectCount = this.getSides().reduce(function (accum, side) {\r\n      if (testRay.intersect(side) >= 0) {\r\n        return accum + 1;\r\n      }\r\n      return accum;\r\n    }, 0);\r\n\r\n    if (intersectCount % 2 === 0) {\r\n      return false;\r\n    }\r\n    return true;\r\n  }\r\n\r\n  public getClosestLineBetween(collider: Collider): Line {\r\n    if (collider instanceof CircleCollider) {\r\n      return ClosestLineJumpTable.PolygonCircleClosestLine(this, collider);\r\n    } else if (collider instanceof PolygonCollider) {\r\n      return ClosestLineJumpTable.PolygonPolygonClosestLine(this, collider);\r\n    } else if (collider instanceof EdgeCollider) {\r\n      return ClosestLineJumpTable.PolygonEdgeClosestLine(this, collider);\r\n    } else {\r\n      throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof collider}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns a collision contact if the 2 colliders collide, otherwise collide will\r\n   * return null.\r\n   * @param collider\r\n   */\r\n  public collide(collider: Collider): CollisionContact[] {\r\n    if (collider instanceof CircleCollider) {\r\n      return CollisionJumpTable.CollideCirclePolygon(collider, this);\r\n    } else if (collider instanceof PolygonCollider) {\r\n      return CollisionJumpTable.CollidePolygonPolygon(this, collider);\r\n    } else if (collider instanceof EdgeCollider) {\r\n      return CollisionJumpTable.CollidePolygonEdge(this, collider);\r\n    } else {\r\n      throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof collider}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Find the point on the collider furthest in the direction specified\r\n   */\r\n  public getFurthestPoint(direction: Vector): Vector {\r\n    const pts = this.getTransformedPoints();\r\n    let furthestPoint = null;\r\n    let maxDistance = -Number.MAX_VALUE;\r\n    for (let i = 0; i < pts.length; i++) {\r\n      const distance = direction.dot(pts[i]);\r\n      if (distance > maxDistance) {\r\n        maxDistance = distance;\r\n        furthestPoint = pts[i];\r\n      }\r\n    }\r\n    return furthestPoint;\r\n  }\r\n\r\n  /**\r\n   * Find the local point on the collider furthest in the direction specified\r\n   * @param direction\r\n   */\r\n  public getFurthestLocalPoint(direction: Vector): Vector {\r\n    const pts = this.points;\r\n    let furthestPoint = pts[0];\r\n    let maxDistance = -Number.MAX_VALUE;\r\n    for (let i = 0; i < pts.length; i++) {\r\n      const distance = direction.dot(pts[i]);\r\n      if (distance > maxDistance) {\r\n        maxDistance = distance;\r\n        furthestPoint = pts[i];\r\n      }\r\n    }\r\n    return furthestPoint;\r\n  }\r\n\r\n  /**\r\n   * Finds the closes face to the point using perpendicular distance\r\n   * @param point point to test against polygon\r\n   */\r\n  public getClosestFace(point: Vector): { distance: Vector; face: Line } {\r\n    const sides = this.getSides();\r\n    let min = Number.POSITIVE_INFINITY;\r\n    let faceIndex = -1;\r\n    let distance = -1;\r\n    for (let i = 0; i < sides.length; i++) {\r\n      const dist = sides[i].distanceToPoint(point);\r\n      if (dist < min) {\r\n        min = dist;\r\n        faceIndex = i;\r\n        distance = dist;\r\n      }\r\n    }\r\n\r\n    if (faceIndex !== -1) {\r\n      return {\r\n        distance: sides[faceIndex].normal().scale(distance),\r\n        face: sides[faceIndex]\r\n      };\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Get the axis aligned bounding box for the polygon collider in world coordinates\r\n   */\r\n  public get bounds(): BoundingBox {\r\n    const tx = this._transform as TransformComponent;\r\n    const scale = tx?.globalScale ?? Vector.One;\r\n    const rotation = tx?.globalRotation ?? 0;\r\n    const pos = (tx?.globalPos ?? Vector.Zero).add(this.offset);\r\n    return this.localBounds.scale(scale).rotate(rotation).translate(pos);\r\n  }\r\n\r\n  /**\r\n   * Get the axis aligned bounding box for the polygon collider in local coordinates\r\n   */\r\n  public get localBounds(): BoundingBox {\r\n    return BoundingBox.fromPoints(this.points);\r\n  }\r\n\r\n  /**\r\n   * Get the moment of inertia for an arbitrary polygon\r\n   * https://en.wikipedia.org/wiki/List_of_moments_of_inertia\r\n   */\r\n  public getInertia(mass: number): number {\r\n    let numerator = 0;\r\n    let denominator = 0;\r\n    for (let i = 0; i < this.points.length; i++) {\r\n      const iplusone = (i + 1) % this.points.length;\r\n      const crossTerm = this.points[iplusone].cross(this.points[i]);\r\n      numerator +=\r\n        crossTerm *\r\n        (this.points[i].dot(this.points[i]) + this.points[i].dot(this.points[iplusone]) + this.points[iplusone].dot(this.points[iplusone]));\r\n      denominator += crossTerm;\r\n    }\r\n    return (mass / 6) * (numerator / denominator);\r\n  }\r\n\r\n  /**\r\n   * Casts a ray into the polygon and returns a vector representing the point of contact (in world space) or null if no collision.\r\n   */\r\n  public rayCast(ray: Ray, max: number = Infinity) {\r\n    // find the minimum contact time greater than 0\r\n    // contact times less than 0 are behind the ray and we don't want those\r\n    const sides = this.getSides();\r\n    const len = sides.length;\r\n    let minContactTime = Number.MAX_VALUE;\r\n    let contactIndex = -1;\r\n    for (let i = 0; i < len; i++) {\r\n      const contactTime = ray.intersect(sides[i]);\r\n      if (contactTime >= 0 && contactTime < minContactTime && contactTime <= max) {\r\n        minContactTime = contactTime;\r\n        contactIndex = i;\r\n      }\r\n    }\r\n\r\n    // contact was found\r\n    if (contactIndex >= 0) {\r\n      return ray.getPoint(minContactTime);\r\n    }\r\n\r\n    // no contact found\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Project the edges of the polygon along a specified axis\r\n   */\r\n  public project(axis: Vector): Projection {\r\n    const points = this.getTransformedPoints();\r\n    const len = points.length;\r\n    let min = Number.MAX_VALUE;\r\n    let max = -Number.MAX_VALUE;\r\n    for (let i = 0; i < len; i++) {\r\n      const scalar = points[i].dot(axis);\r\n      min = Math.min(min, scalar);\r\n      max = Math.max(max, scalar);\r\n    }\r\n\r\n    return new Projection(min, max);\r\n  }\r\n\r\n  public draw(ctx: CanvasRenderingContext2D, color: Color = Color.Green, pos: Vector = Vector.Zero) {\r\n    const effectiveOffset = pos.add(this.offset);\r\n    ctx.beginPath();\r\n    ctx.fillStyle = color.toString();\r\n\r\n    const firstPoint = this.points[0].add(effectiveOffset);\r\n    ctx.moveTo(firstPoint.x, firstPoint.y);\r\n\r\n    // Points are relative\r\n    this.points\r\n      .map((p) => p.add(effectiveOffset))\r\n      .forEach(function (point) {\r\n        ctx.lineTo(point.x, point.y);\r\n      });\r\n    ctx.lineTo(firstPoint.x, firstPoint.y);\r\n    ctx.closePath();\r\n    ctx.fill();\r\n  }\r\n  public debug(ex: ExcaliburGraphicsContext, color: Color) {\r\n    const firstPoint = this.getTransformedPoints()[0];\r\n    const points = [firstPoint, ...this.getTransformedPoints(), firstPoint];\r\n    for (let i = 0; i < points.length - 1; i++) {\r\n      ex.drawLine(points[i], points[i + 1], color, 2);\r\n      ex.drawCircle(points[i], 2, color);\r\n      ex.drawCircle(points[i + 1], 2, color);\r\n    }\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  public debugDraw(ctx: CanvasRenderingContext2D, color: Color = Color.Red) {\r\n    ctx.beginPath();\r\n    ctx.strokeStyle = color.toString();\r\n    // Iterate through the supplied points and construct a 'polygon'\r\n    const firstPoint = this.getTransformedPoints()[0];\r\n    ctx.moveTo(firstPoint.x, firstPoint.y);\r\n    this.getTransformedPoints().forEach(function (point) {\r\n      ctx.lineTo(point.x, point.y);\r\n    });\r\n    ctx.lineTo(firstPoint.x, firstPoint.y);\r\n    ctx.closePath();\r\n    ctx.stroke();\r\n  }\r\n}\r\n","import { PolygonCollider } from './PolygonCollider';\r\nimport { CircleCollider } from './CircleCollider';\r\nimport { EdgeCollider } from './EdgeCollider';\r\nimport { BoundingBox } from '../BoundingBox';\r\nimport { vec, Vector } from '../../Math/vector';\r\nimport { CompositeCollider } from './CompositeCollider';\r\nimport { Logger } from '../..';\r\n\r\n/**\r\n * Excalibur helper for defining colliders quickly\r\n */\r\nexport class Shape {\r\n  /**\r\n   * Creates a box collider, under the hood defines a [[PolygonCollider]] collider\r\n   * @param width Width of the box\r\n   * @param height Height of the box\r\n   * @param anchor Anchor of the box (default (.5, .5)) which positions the box relative to the center of the collider's position\r\n   * @param offset Optional offset relative to the collider in local coordinates\r\n   */\r\n  static Box(width: number, height: number, anchor: Vector = Vector.Half, offset: Vector = Vector.Zero): PolygonCollider {\r\n    return new PolygonCollider({\r\n      points: new BoundingBox(-width * anchor.x, -height * anchor.y, width - width * anchor.x, height - height * anchor.y).getPoints(),\r\n      offset: offset\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Creates a new [[PolygonCollider|arbitrary polygon]] collider\r\n   *\r\n   * PolygonColliders are useful for creating convex polygon shapes\r\n   * @param points Points specified in counter clockwise\r\n   * @param clockwiseWinding Optionally changed the winding of points, by default false meaning counter-clockwise winding.\r\n   * @param offset Optional offset relative to the collider in local coordinates\r\n   */\r\n  static Polygon(points: Vector[], clockwiseWinding: boolean = false, offset: Vector = Vector.Zero): PolygonCollider {\r\n    return new PolygonCollider({\r\n      points: points,\r\n      offset: offset,\r\n      clockwiseWinding: clockwiseWinding\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Creates a new [[CircleCollider|circle]] collider\r\n   *\r\n   * Circle colliders are useful for balls, or to make collisions more forgiving on sharp edges\r\n   * @param radius Radius of the circle collider\r\n   * @param offset Optional offset relative to the collider in local coordinates\r\n   */\r\n  static Circle(radius: number, offset: Vector = Vector.Zero): CircleCollider {\r\n    return new CircleCollider({\r\n      radius: radius,\r\n      offset: offset\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Creates a new [[EdgeCollider|edge]] collider\r\n   *\r\n   * Edge colliders are useful for  floors, walls, and other barriers\r\n   * @param begin Beginning of the edge in local coordinates to the collider\r\n   * @param end Ending of the edge in local coordinates to the collider\r\n   */\r\n  static Edge(begin: Vector, end: Vector): EdgeCollider {\r\n    return new EdgeCollider({\r\n      begin: begin,\r\n      end: end\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Creates a new capsule shaped [[CompositeCollider]] using 2 circles and a box\r\n   *\r\n   * Capsule colliders are useful for platformers with incline or jagged floors to have a smooth\r\n   * player experience.\r\n   *\r\n   * @param width\r\n   * @param height\r\n   * @param offset Optional offset\r\n   */\r\n  static Capsule(width: number, height: number, offset = Vector.Zero): CompositeCollider {\r\n    const logger = Logger.getInstance();\r\n    if (width === height) {\r\n      logger.warn('A capsule collider with equal width and height is a circle, consider using a ex.Shape.Circle or ex.CircleCollider');\r\n    }\r\n\r\n    const vertical = height >= width;\r\n\r\n    if (vertical) {\r\n      // height > width, if equal maybe use a circle\r\n      const capsule = new CompositeCollider([\r\n        Shape.Circle(width / 2, vec(0, -height / 2 + width / 2).add(offset)),\r\n        Shape.Box(width, height - width, Vector.Half, offset),\r\n        Shape.Circle(width / 2, vec(0, height / 2 - width / 2).add(offset))\r\n      ]);\r\n      return capsule;\r\n    } else {\r\n      // width > height, if equal maybe use a circle\r\n      const capsule = new CompositeCollider([\r\n        Shape.Circle(height / 2, vec(-width / 2 + height / 2, 0).add(offset)),\r\n        Shape.Box(width - height, height, Vector.Half, offset),\r\n        Shape.Circle(height / 2, vec(width / 2 - height / 2, 0).add(offset))\r\n      ]);\r\n      return capsule;\r\n    }\r\n  }\r\n}\r\n","import { Vector } from '../Math/vector';\r\nimport { TransformComponent } from '../EntityComponentSystem';\r\nimport { Component } from '../EntityComponentSystem/Component';\r\nimport { Entity } from '../EntityComponentSystem/Entity';\r\nimport { EventDispatcher } from '../EventDispatcher';\r\nimport { CollisionEndEvent, CollisionStartEvent, PostCollisionEvent, PreCollisionEvent } from '../Events';\r\nimport { Observable } from '../Util/Observable';\r\nimport { BoundingBox } from './BoundingBox';\r\nimport { CollisionContact } from './Detection/CollisionContact';\r\nimport { CircleCollider } from './Colliders/CircleCollider';\r\nimport { Collider } from './Colliders/Collider';\r\nimport { CompositeCollider } from './Colliders/CompositeCollider';\r\nimport { PolygonCollider } from './Colliders/PolygonCollider';\r\nimport { EdgeCollider } from './Colliders/EdgeCollider';\r\nimport { Shape } from './Colliders/Shape';\r\n\r\nexport class ColliderComponent extends Component<'ex.collider'> {\r\n  public readonly type = 'ex.collider';\r\n\r\n  public events = new EventDispatcher();\r\n  /**\r\n   * Observable that notifies when a collider is added to the body\r\n   */\r\n  public $colliderAdded = new Observable<Collider>();\r\n\r\n  /**\r\n   * Observable that notifies when a collider is removed from the body\r\n   */\r\n  public $colliderRemoved = new Observable<Collider>();\r\n\r\n  constructor(collider?: Collider) {\r\n    super();\r\n    this.set(collider);\r\n  }\r\n\r\n  private _collider: Collider;\r\n  /**\r\n   * Get the current collider geometry\r\n   */\r\n  public get() {\r\n    return this._collider;\r\n  }\r\n\r\n  /**\r\n   * Set the collider geometry\r\n   * @param collider\r\n   * @returns the collider you set\r\n   */\r\n  public set<T extends Collider>(collider: T): T {\r\n    this.clear();\r\n    if (collider) {\r\n      this._collider = collider;\r\n      this._collider.owner = this.owner;\r\n      this.events.wire(collider.events);\r\n      this.$colliderAdded.notifyAll(collider);\r\n      this.update();\r\n    }\r\n    return collider;\r\n  }\r\n\r\n  /**\r\n   * Remove collider geometry from collider component\r\n   */\r\n  public clear() {\r\n    if (this._collider) {\r\n      this.events.unwire(this._collider.events);\r\n      this.$colliderRemoved.notifyAll(this._collider);\r\n      this._collider.owner = null;\r\n      this._collider = null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Return world space bounds\r\n   */\r\n  public get bounds() {\r\n    return this._collider?.bounds ?? new BoundingBox();\r\n  }\r\n\r\n  /**\r\n   * Return local space bounds\r\n   */\r\n  public get localBounds() {\r\n    return this._collider?.localBounds ?? new BoundingBox();\r\n  }\r\n\r\n  /**\r\n   * Update the collider's transformed geometry\r\n   */\r\n  public update() {\r\n    const tx = this.owner?.get(TransformComponent);\r\n    if (this._collider) {\r\n      this._collider.owner = this.owner;\r\n      if (tx) {\r\n        this._collider.update(tx);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Collide component with another\r\n   * @param other\r\n   */\r\n  collide(other: ColliderComponent): CollisionContact[] {\r\n    let colliderA = this._collider;\r\n    let colliderB = other._collider;\r\n    if (!colliderA || !colliderB) {\r\n      return [];\r\n    }\r\n\r\n    // If we have a composite lefthand side :(\r\n    // Might bite us, but to avoid updating all the handlers make composite always left side\r\n    let flipped = false;\r\n    if (colliderB instanceof CompositeCollider) {\r\n      colliderA = colliderB;\r\n      colliderB = this._collider;\r\n      flipped = true;\r\n    }\r\n\r\n    if (this._collider) {\r\n      const contacts = colliderA.collide(colliderB);\r\n      if (contacts) {\r\n        if (flipped) {\r\n          contacts.forEach((contact) => {\r\n            contact.mtv = contact.mtv.negate();\r\n            contact.normal = contact.normal.negate();\r\n            contact.tangent = contact.normal.perpendicular();\r\n            contact.colliderA = this._collider;\r\n            contact.colliderB = other._collider;\r\n          });\r\n        }\r\n        return contacts;\r\n      }\r\n      return [];\r\n    }\r\n    return [];\r\n  }\r\n\r\n  onAdd(entity: Entity) {\r\n    if (this._collider) {\r\n      this.update();\r\n    }\r\n    // Wire up the collider events to the owning entity\r\n    this.events.on('precollision', (evt: any) => {\r\n      const precollision = evt as PreCollisionEvent<Collider>;\r\n      entity.events.emit(\r\n        'precollision',\r\n        new PreCollisionEvent(precollision.target.owner, precollision.other.owner, precollision.side, precollision.intersection)\r\n      );\r\n    });\r\n    this.events.on('postcollision', (evt: any) => {\r\n      const postcollision = evt as PostCollisionEvent<Collider>;\r\n      entity.events.emit(\r\n        'postcollision',\r\n        new PostCollisionEvent(postcollision.target.owner, postcollision.other.owner, postcollision.side, postcollision.intersection)\r\n      );\r\n    });\r\n    this.events.on('collisionstart', (evt: any) => {\r\n      const start = evt as CollisionStartEvent<Collider>;\r\n      entity.events.emit('collisionstart', new CollisionStartEvent(start.target.owner, start.other.owner, start.contact));\r\n    });\r\n    this.events.on('collisionend', (evt: any) => {\r\n      const end = evt as CollisionEndEvent<Collider>;\r\n      entity.events.emit('collisionend', new CollisionEndEvent(end.target.owner, end.other.owner));\r\n    });\r\n  }\r\n\r\n  onRemove() {\r\n    this.events.clear();\r\n    this.$colliderRemoved.notifyAll(this._collider);\r\n  }\r\n\r\n  /**\r\n   * Sets up a box geometry based on the current bounds of the associated actor of this physics body.\r\n   *\r\n   * If no width/height are specified the body will attempt to use the associated actor's width/height.\r\n   *\r\n   * By default, the box is center is at (0, 0) which means it is centered around the actors anchor.\r\n   */\r\n  useBoxCollider(width: number, height: number, anchor: Vector = Vector.Half, center: Vector = Vector.Zero): PolygonCollider {\r\n    const collider = Shape.Box(width, height, anchor, center);\r\n    return (this.set(collider));\r\n  }\r\n\r\n  /**\r\n   * Sets up a [[PolygonCollider|polygon]] collision geometry based on a list of of points relative\r\n   *  to the anchor of the associated actor\r\n   * of this physics body.\r\n   *\r\n   * Only [convex polygon](https://en.wikipedia.org/wiki/Convex_polygon) definitions are supported.\r\n   *\r\n   * By default, the box is center is at (0, 0) which means it is centered around the actors anchor.\r\n   */\r\n  usePolygonCollider(points: Vector[], center: Vector = Vector.Zero): PolygonCollider {\r\n    const poly = Shape.Polygon(points, false, center);\r\n    return (this.set(poly));\r\n  }\r\n\r\n  /**\r\n   * Sets up a [[Circle|circle collision geometry]] as the only collider with a specified radius in pixels.\r\n   *\r\n   * By default, the box is center is at (0, 0) which means it is centered around the actors anchor.\r\n   */\r\n  useCircleCollider(radius: number, center: Vector = Vector.Zero): CircleCollider {\r\n    const collider = Shape.Circle(radius, center);\r\n    return (this.set(collider));\r\n  }\r\n\r\n  /**\r\n   * Sets up an [[Edge|edge collision geometry]] with a start point and an end point relative to the anchor of the associated actor\r\n   * of this physics body.\r\n   *\r\n   * By default, the box is center is at (0, 0) which means it is centered around the actors anchor.\r\n   */\r\n  useEdgeCollider(begin: Vector, end: Vector): EdgeCollider {\r\n    const collider = Shape.Edge(begin, end);\r\n    return (this.set(collider));\r\n  }\r\n\r\n  /**\r\n   * Setups up a [[CompositeCollider]] which can define any arbitrary set of excalibur colliders\r\n   * @param colliders\r\n   */\r\n  useCompositeCollider(colliders: Collider[]): CompositeCollider {\r\n    return (this.set(new CompositeCollider(colliders)));\r\n  }\r\n}\r\n","import { Vector } from '../Math/vector';\r\nimport { CollisionType } from './CollisionType';\r\nimport { Physics } from './Physics';\r\nimport { Clonable } from '../Interfaces/Clonable';\r\nimport { TransformComponent } from '../EntityComponentSystem/Components/TransformComponent';\r\nimport { MotionComponent } from '../EntityComponentSystem/Components/MotionComponent';\r\nimport { Component } from '../EntityComponentSystem/Component';\r\nimport { CollisionGroup } from './Group/CollisionGroup';\r\nimport { EventDispatcher } from '../EventDispatcher';\r\nimport { createId, Id } from '../Id';\r\nimport { clamp } from '../Math/util';\r\nimport { ColliderComponent } from './ColliderComponent';\r\n\r\nexport interface BodyComponentOptions {\r\n  type?: CollisionType;\r\n  group?: CollisionGroup;\r\n  useGravity?: boolean;\r\n}\r\n\r\nexport enum DegreeOfFreedom {\r\n  Rotation = 'rotation',\r\n  X = 'x',\r\n  Y = 'y'\r\n}\r\n\r\n/**\r\n * Body describes all the physical properties pos, vel, acc, rotation, angular velocity for the purpose of\r\n * of physics simulation.\r\n */\r\nexport class BodyComponent extends Component<'ex.body'> implements Clonable<BodyComponent> {\r\n  public readonly type = 'ex.body';\r\n  public dependencies = [TransformComponent, MotionComponent];\r\n  public static _ID = 0;\r\n  public readonly id: Id<'body'> = createId('body', BodyComponent._ID++);\r\n  public events = new EventDispatcher();\r\n\r\n  constructor(options?: BodyComponentOptions) {\r\n    super();\r\n    if (options) {\r\n      this.collisionType = options.type ?? this.collisionType;\r\n      this.group = options.group ?? this.group;\r\n      this.useGravity = options.useGravity ?? this.useGravity;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Collision type for the rigidbody physics simulation, by default [[CollisionType.PreventCollision]]\r\n   */\r\n  public collisionType: CollisionType = CollisionType.PreventCollision;\r\n\r\n  /**\r\n   * The collision group for the body's colliders, by default body colliders collide with everything\r\n   */\r\n  public group: CollisionGroup = CollisionGroup.All;\r\n\r\n  /**\r\n   * The amount of mass the body has\r\n   */\r\n  public mass: number = Physics.defaultMass;\r\n\r\n  /**\r\n   * The inverse mass (1/mass) of the body. If [[CollisionType.Fixed]] this is 0, meaning \"infinite\" mass\r\n   */\r\n  public get inverseMass(): number {\r\n    return this.collisionType === CollisionType.Fixed ? 0 : 1 / this.mass;\r\n  }\r\n\r\n  /**\r\n   * Amount of \"motion\" the body has before sleeping. If below [[Physics.sleepEpsilon]] it goes to \"sleep\"\r\n   */\r\n  public sleepMotion: number = Physics.sleepEpsilon * 5;\r\n\r\n  /**\r\n   * Can this body sleep, by default bodies do not sleep\r\n   */\r\n  public canSleep: boolean = Physics.bodiesCanSleepByDefault;\r\n\r\n  private _sleeping = false;\r\n  /**\r\n   * Whether this body is sleeping or not\r\n   */\r\n  public get sleeping(): boolean {\r\n    return this._sleeping;\r\n  }\r\n\r\n  /**\r\n   * Set the sleep state of the body\r\n   * @param sleeping\r\n   */\r\n  public setSleeping(sleeping: boolean) {\r\n    this._sleeping = sleeping;\r\n    if (!sleeping) {\r\n      // Give it a kick to keep it from falling asleep immediately\r\n      this.sleepMotion = Physics.sleepEpsilon * 5;\r\n    } else {\r\n      this.vel = Vector.Zero;\r\n      this.acc = Vector.Zero;\r\n      this.angularVelocity = 0;\r\n      this.sleepMotion = 0;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update body's [[BodyComponent.sleepMotion]] for the purpose of sleeping\r\n   */\r\n  public updateMotion() {\r\n    if (this._sleeping) {\r\n      this.setSleeping(true);\r\n    }\r\n    const currentMotion = this.vel.size * this.vel.size + Math.abs(this.angularVelocity * this.angularVelocity);\r\n    const bias = Physics.sleepBias;\r\n    this.sleepMotion = bias * this.sleepMotion + (1 - bias) * currentMotion;\r\n    this.sleepMotion = clamp(this.sleepMotion, 0, 10 * Physics.sleepEpsilon);\r\n    if (this.canSleep && this.sleepMotion < Physics.sleepEpsilon) {\r\n      this.setSleeping(true);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get the moment of inertia from the [[ColliderComponent]]\r\n   */\r\n  public get inertia() {\r\n    // Inertia is a property of the geometry, so this is a little goofy but seems to be okay?\r\n    const collider = this.owner.get(ColliderComponent);\r\n    if (collider?.get()) {\r\n      return collider.get().getInertia(this.mass);\r\n    }\r\n    return 0;\r\n  }\r\n\r\n  /**\r\n   * Get the inverse moment of inertial from the [[ColliderComponent]]. If [[CollisionType.Fixed]] this is 0, meaning \"infinite\" mass\r\n   */\r\n  public get inverseInertia() {\r\n    return this.collisionType === CollisionType.Fixed ? 0 : 1 / this.inertia;\r\n  }\r\n\r\n  /**\r\n   * The also known as coefficient of restitution of this actor, represents the amount of energy preserved after collision or the\r\n   * bounciness. If 1, it is 100% bouncy, 0 it completely absorbs.\r\n   */\r\n  public bounciness: number = 0.2;\r\n\r\n  /**\r\n   * The coefficient of friction on this actor\r\n   */\r\n  public friction: number = 0.99;\r\n\r\n  /**\r\n   * Should use global gravity [[Physics.gravity]] in it's physics simulation, default is true\r\n   */\r\n  public useGravity: boolean = true;\r\n\r\n  /**\r\n   * Degrees of freedom to limit\r\n   */\r\n  public limitDegreeOfFreedom: DegreeOfFreedom[] = [];\r\n\r\n  /**\r\n   * Returns if the owner is active\r\n   */\r\n  public get active() {\r\n    return !!this.owner?.active;\r\n  }\r\n\r\n  public get center() {\r\n    return this.pos;\r\n  }\r\n\r\n  public get transform(): TransformComponent {\r\n    return this.owner?.get(TransformComponent);\r\n  }\r\n\r\n  public get motion(): MotionComponent {\r\n    return this.owner?.get(MotionComponent);\r\n  }\r\n\r\n  /**\r\n   * The (x, y) position of the actor this will be in the middle of the actor if the\r\n   * [[Actor.anchor]] is set to (0.5, 0.5) which is default.\r\n   * If you want the (x, y) position to be the top left of the actor specify an anchor of (0, 0).\r\n   */\r\n  public get pos(): Vector {\r\n    return this.transform.globalPos;\r\n  }\r\n\r\n  public set pos(val: Vector) {\r\n    this.transform.globalPos = val;\r\n  }\r\n\r\n  /**\r\n   * The position of the actor last frame (x, y) in pixels\r\n   */\r\n  public oldPos: Vector = new Vector(0, 0);\r\n\r\n  /**\r\n   * The current velocity vector (vx, vy) of the actor in pixels/second\r\n   */\r\n  public get vel(): Vector {\r\n    return this.motion.vel;\r\n  }\r\n\r\n  public set vel(val: Vector) {\r\n    this.motion.vel = val;\r\n  }\r\n\r\n  /**\r\n   * The velocity of the actor last frame (vx, vy) in pixels/second\r\n   */\r\n  public oldVel: Vector = new Vector(0, 0);\r\n\r\n  /**\r\n   * The current acceleration vector (ax, ay) of the actor in pixels/second/second. An acceleration pointing down such as (0, 100) may\r\n   * be useful to simulate a gravitational effect.\r\n   */\r\n  public get acc(): Vector {\r\n    return this.motion.acc;\r\n  }\r\n\r\n  public set acc(val: Vector) {\r\n    this.motion.acc = val;\r\n  }\r\n\r\n  /**\r\n   * Gets/sets the acceleration of the actor from the last frame. This does not include the global acc [[Physics.acc]].\r\n   */\r\n  public oldAcc: Vector = Vector.Zero;\r\n\r\n  /**\r\n   * The current torque applied to the actor\r\n   */\r\n  public get torque(): number {\r\n    return this.motion.torque;\r\n  }\r\n\r\n  public set torque(val: number) {\r\n    this.motion.torque = val;\r\n  }\r\n\r\n  /**\r\n   * Gets/sets the rotation of the body from the last frame.\r\n   */\r\n  public oldRotation: number = 0; // radians\r\n\r\n  /**\r\n   * The rotation of the body in radians\r\n   */\r\n  public get rotation() {\r\n    return this.transform.globalRotation;\r\n  }\r\n\r\n  public set rotation(val: number) {\r\n    this.transform.globalRotation = val;\r\n  }\r\n\r\n  /**\r\n   * The scale vector of the actor\r\n   * @deprecated ex.Body.scale will be removed in v0.25.0, Use ex.Transform.scale\r\n   */\r\n  public get scale(): Vector {\r\n    return this.transform.globalScale;\r\n  }\r\n\r\n  public set scale(val: Vector) {\r\n    this.transform.globalScale = val;\r\n  }\r\n\r\n  /**\r\n   * The scale of the actor last frame\r\n   * @deprecated ex.Body.scale will be removed in v0.25.0\r\n   */\r\n  public oldScale: Vector = Vector.One;\r\n\r\n  /**\r\n   * The x scalar velocity of the actor in scale/second\r\n   * @deprecated ex.Body.scale will be removed in v0.25.0\r\n   */\r\n  public get sx(): number {\r\n    return this.motion.scaleFactor.x;\r\n  }\r\n\r\n  public set sx(xFactor: number) {\r\n    this.motion.scaleFactor.x = xFactor;\r\n  }\r\n\r\n  /**\r\n   * The y scalar velocity of the actor in scale/second\r\n   * @deprecated ex.Body.scale will be removed in v0.25.0\r\n   */\r\n  public get sy(): number {\r\n    return this.motion.scaleFactor.y;\r\n  }\r\n\r\n  public set sy(yFactor: number) {\r\n    this.motion.scaleFactor.y = yFactor;\r\n  }\r\n\r\n  /**\r\n   * The rotational velocity of the actor in radians/second\r\n   * @deprecated\r\n   */\r\n  public get rx(): number {\r\n    return this.motion.angularVelocity;\r\n  }\r\n\r\n  /**\r\n   * The rotational velocity of the actor in radians/second\r\n   * @deprecated\r\n   */\r\n  public set rx(value: number) {\r\n    this.motion.angularVelocity = value;\r\n  }\r\n\r\n  /**\r\n   * Get the angular velocity in radians/second\r\n   */\r\n  public get angularVelocity(): number {\r\n    return this.motion.angularVelocity;\r\n  }\r\n\r\n  /**\r\n   * Set the angular velocity in radians/second\r\n   */\r\n  public set angularVelocity(value: number) {\r\n    this.motion.angularVelocity = value;\r\n  }\r\n\r\n  /**\r\n   * Apply a specific impulse to the body\r\n   * @param point\r\n   * @param impulse\r\n   */\r\n  public applyImpulse(point: Vector, impulse: Vector) {\r\n    if (this.collisionType !== CollisionType.Active) {\r\n      return; // only active objects participate in the simulation\r\n    }\r\n\r\n    const finalImpulse = impulse.scale(this.inverseMass);\r\n    if (this.limitDegreeOfFreedom.includes(DegreeOfFreedom.X)) {\r\n      finalImpulse.x = 0;\r\n    }\r\n    if (this.limitDegreeOfFreedom.includes(DegreeOfFreedom.Y)) {\r\n      finalImpulse.y = 0;\r\n    }\r\n\r\n    this.vel.addEqual(finalImpulse);\r\n\r\n    if (!this.limitDegreeOfFreedom.includes(DegreeOfFreedom.Rotation)) {\r\n      const distanceFromCenter = point.sub(this.pos);\r\n      this.angularVelocity += this.inverseInertia * distanceFromCenter.cross(impulse);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Apply only linear impulse to the body\r\n   * @param impulse\r\n   */\r\n  public applyLinearImpulse(impulse: Vector) {\r\n    if (this.collisionType !== CollisionType.Active) {\r\n      return; // only active objects participate in the simulation\r\n    }\r\n\r\n    const finalImpulse = impulse.scale(this.inverseMass);\r\n\r\n    if (this.limitDegreeOfFreedom.includes(DegreeOfFreedom.X)) {\r\n      finalImpulse.x = 0;\r\n    }\r\n    if (this.limitDegreeOfFreedom.includes(DegreeOfFreedom.Y)) {\r\n      finalImpulse.y = 0;\r\n    }\r\n\r\n    this.vel = this.vel.add(finalImpulse);\r\n  }\r\n\r\n  /**\r\n   * Apply only angular impulse to the body\r\n   * @param point\r\n   * @param impulse\r\n   */\r\n  public applyAngularImpulse(point: Vector, impulse: Vector) {\r\n    if (this.collisionType !== CollisionType.Active) {\r\n      return; // only active objects participate in the simulation\r\n    }\r\n\r\n    if (!this.limitDegreeOfFreedom.includes(DegreeOfFreedom.Rotation)) {\r\n      const distanceFromCenter = point.sub(this.pos);\r\n      this.angularVelocity += this.inverseInertia * distanceFromCenter.cross(impulse);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Sets the old versions of pos, vel, acc, and scale.\r\n   */\r\n  public captureOldTransform() {\r\n    // Capture old values before integration step updates them\r\n    this.oldVel.setTo(this.vel.x, this.vel.y);\r\n    this.oldPos.setTo(this.pos.x, this.pos.y);\r\n    this.oldAcc.setTo(this.acc.x, this.acc.y);\r\n    this.oldScale.setTo(this.scale.x, this.scale.y);\r\n    this.oldRotation = this.rotation;\r\n  }\r\n\r\n  /**\r\n   * @deprecated signature will change in v0.26.0\r\n   * @param _ctx\r\n   */\r\n  debugDraw(_ctx: CanvasRenderingContext2D) {\r\n    // pass\r\n  }\r\n}\r\n","import { Vector, vec } from '../Math/vector';\r\nimport { Actor } from '../Actor';\r\nimport { Engine } from '../Engine';\r\nimport { Color } from '../Color';\r\n\r\n/**\r\n * @deprecated Will be removed in 0.26.0\r\n */\r\nexport class CullingBox {\r\n  private _topLeft: Vector = new Vector(0, 0);\r\n  private _topRight: Vector = new Vector(0, 0);\r\n  private _bottomLeft: Vector = new Vector(0, 0);\r\n  private _bottomRight: Vector = new Vector(0, 0);\r\n\r\n  private _xCoords: Array<number>;\r\n  private _yCoords: Array<number>;\r\n  private _xMin: number;\r\n  private _yMin: number;\r\n  private _xMax: number;\r\n  private _yMax: number;\r\n\r\n  private _xMinWorld: number;\r\n  private _yMinWorld: number;\r\n  private _xMaxWorld: number;\r\n  private _yMaxWorld: number;\r\n\r\n  public isSpriteOffScreen(actor: Actor, engine: Engine): boolean {\r\n    const drawingWidth = actor.currentDrawing.drawWidth;\r\n    const drawingHeight = actor.currentDrawing.drawHeight;\r\n    const rotation = actor.rotation;\r\n    const anchor = actor.center;\r\n    const worldPos = actor.getGlobalPos();\r\n\r\n    this._topLeft = vec(worldPos.x - drawingWidth / 2, worldPos.y - drawingHeight / 2);\r\n    this._topLeft = this._topLeft.rotate(rotation, anchor);\r\n\r\n    this._topRight = vec(worldPos.x + drawingWidth / 2, worldPos.y - drawingHeight / 2);\r\n    this._topRight = this._topRight.rotate(rotation, anchor);\r\n\r\n    this._bottomLeft = vec(worldPos.x - drawingWidth / 2, worldPos.y + drawingHeight / 2);\r\n    this._bottomLeft = this._bottomLeft.rotate(rotation, anchor);\r\n\r\n    this._bottomRight = vec(worldPos.x + drawingWidth / 2, worldPos.y + drawingHeight / 2);\r\n    this._bottomRight = this._bottomRight.rotate(rotation, anchor);\r\n\r\n    const topLeftScreen = engine.worldToScreenCoordinates(this._topLeft);\r\n    const topRightScreen = engine.worldToScreenCoordinates(this._topRight);\r\n    const bottomLeftScreen = engine.worldToScreenCoordinates(this._bottomLeft);\r\n    const bottomRightScreen = engine.worldToScreenCoordinates(this._bottomRight);\r\n    this._xCoords = [];\r\n    this._yCoords = [];\r\n\r\n    this._xCoords.push(topLeftScreen.x, topRightScreen.x, bottomLeftScreen.x, bottomRightScreen.x);\r\n    this._yCoords.push(topLeftScreen.y, topRightScreen.y, bottomLeftScreen.y, bottomRightScreen.y);\r\n\r\n    this._xMin = Math.min.apply(null, this._xCoords);\r\n    this._yMin = Math.min.apply(null, this._yCoords);\r\n    this._xMax = Math.max.apply(null, this._xCoords);\r\n    this._yMax = Math.max.apply(null, this._yCoords);\r\n\r\n    const minWorld = engine.screenToWorldCoordinates(new Vector(this._xMin, this._yMin));\r\n    const maxWorld = engine.screenToWorldCoordinates(new Vector(this._xMax, this._yMax));\r\n    this._xMinWorld = minWorld.x;\r\n    this._yMinWorld = minWorld.y;\r\n    this._xMaxWorld = maxWorld.x;\r\n    this._yMaxWorld = maxWorld.y;\r\n\r\n    const boundingPoints = [\r\n      new Vector(this._xMin, this._yMin), // top left\r\n      new Vector(this._xMax, this._yMin), // top right\r\n      new Vector(this._xMin, this._yMax), // bottom left\r\n      new Vector(this._xMax, this._yMax) // bottom right\r\n    ];\r\n\r\n    // sprite can be wider than canvas screen (and still visible within canvas)\r\n    // top or bottom of sprite must be within canvas\r\n    if (\r\n      boundingPoints[0].x < 0 &&\r\n      boundingPoints[1].x > engine.canvas.clientWidth &&\r\n      (boundingPoints[0].y > 0 || boundingPoints[2].y < engine.canvas.clientHeight)\r\n    ) {\r\n      return false;\r\n    }\r\n\r\n    // sprite can be taller than canvas screen (and still visible within canvas)\r\n    // left or right of sprite must be within canvas\r\n    if (\r\n      boundingPoints[0].y < 0 &&\r\n      boundingPoints[2].y > engine.canvas.clientHeight &&\r\n      (boundingPoints[1].x > 0 || boundingPoints[0].x < engine.canvas.clientWidth)\r\n    ) {\r\n      return false;\r\n    }\r\n\r\n    // otherwise if any corner is visible, we're not offscreen\r\n    for (let i = 0; i < boundingPoints.length; i++) {\r\n      if (\r\n        boundingPoints[i].x > 0 &&\r\n        boundingPoints[i].y > 0 &&\r\n        boundingPoints[i].x < engine.canvas.clientWidth &&\r\n        boundingPoints[i].y < engine.canvas.clientHeight\r\n      ) {\r\n        return false;\r\n      }\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  public debugDraw(ctx: CanvasRenderingContext2D) {\r\n    // bounding rectangle\r\n    ctx.beginPath();\r\n    ctx.strokeStyle = Color.White.toString();\r\n    ctx.rect(this._xMinWorld, this._yMinWorld, this._xMaxWorld - this._xMinWorld, this._yMaxWorld - this._yMinWorld);\r\n    ctx.stroke();\r\n\r\n    ctx.fillStyle = Color.Red.toString();\r\n    ctx.beginPath();\r\n    ctx.arc(this._topLeft.x, this._topLeft.y, 5, 0, Math.PI * 2);\r\n    ctx.closePath();\r\n    ctx.fill();\r\n\r\n    ctx.fillStyle = Color.Green.toString();\r\n    ctx.beginPath();\r\n    ctx.arc(this._topRight.x, this._topRight.y, 5, 0, Math.PI * 2);\r\n    ctx.closePath();\r\n    ctx.fill();\r\n\r\n    ctx.fillStyle = Color.Blue.toString();\r\n    ctx.beginPath();\r\n    ctx.arc(this._bottomLeft.x, this._bottomLeft.y, 5, 0, Math.PI * 2);\r\n    ctx.closePath();\r\n    ctx.fill();\r\n\r\n    ctx.fillStyle = Color.Magenta.toString();\r\n    ctx.beginPath();\r\n    ctx.arc(this._bottomRight.x, this._bottomRight.y, 5, 0, Math.PI * 2);\r\n    ctx.closePath();\r\n    ctx.fill();\r\n  }\r\n}\r\n","import { CullingBox } from './../Util/CullingBox';\r\nimport { Trait } from '../Interfaces/Trait';\r\nimport { Actor } from '../Actor';\r\nimport { Engine } from '../Engine';\r\nimport { ExitViewPortEvent, EnterViewPortEvent } from '../Events';\r\nimport { TagComponent } from '../EntityComponentSystem';\r\n\r\n/**\r\n * @deprecated will be removed in 0.26.0\r\n */\r\nexport class OffscreenCulling implements Trait {\r\n  public cullingBox: CullingBox = new CullingBox();\r\n\r\n  public update(actor: Actor, engine: Engine) {\r\n    const events = actor.eventDispatcher;\r\n\r\n    let isSpriteOffScreen = true;\r\n    if (actor.currentDrawing != null) {\r\n      isSpriteOffScreen = this.cullingBox.isSpriteOffScreen(actor, engine);\r\n    }\r\n\r\n    let actorBoundsOffscreen = false;\r\n    if (engine && engine.currentScene && engine.currentScene.camera && engine.currentScene.camera.viewport && !actor.parent) {\r\n      actorBoundsOffscreen = !engine.currentScene.camera.viewport.intersect(actor.collider.bounds);\r\n    }\r\n\r\n    if (!actor.isOffScreen) {\r\n      if (actorBoundsOffscreen && isSpriteOffScreen) {\r\n        events.emit('exitviewport', new ExitViewPortEvent(actor));\r\n        actor.addComponent(new TagComponent('offscreen'));\r\n      }\r\n    } else {\r\n      if (!actorBoundsOffscreen || !isSpriteOffScreen) {\r\n        events.emit('enterviewport', new EnterViewPortEvent(actor));\r\n        actor.removeComponent('offscreen');\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { Component, ComponentCtor, TagComponent } from './Component';\r\n\r\nimport { Observable, Message } from '../Util/Observable';\r\nimport { Class } from '../Class';\r\nimport { OnInitialize, OnPreUpdate, OnPostUpdate } from '../Interfaces/LifecycleEvents';\r\nimport { Engine } from '../Engine';\r\nimport { InitializeEvent, PreUpdateEvent, PostUpdateEvent } from '../Events';\r\nimport { EventDispatcher } from '../EventDispatcher';\r\nimport { Util } from '..';\r\n\r\n/**\r\n * Interface holding an entity component pair\r\n */\r\nexport interface EntityComponent {\r\n  component: Component;\r\n  entity: Entity;\r\n}\r\n\r\n/**\r\n * AddedComponent message\r\n */\r\nexport class AddedComponent implements Message<EntityComponent> {\r\n  readonly type: 'Component Added' = 'Component Added';\r\n  constructor(public data: EntityComponent) {}\r\n}\r\n\r\n/**\r\n * Type guard to know if message is f an Added Component\r\n */\r\nexport function isAddedComponent(x: Message<EntityComponent>): x is AddedComponent {\r\n  return !!x && x.type === 'Component Added';\r\n}\r\n\r\n/**\r\n * RemovedComponent message\r\n */\r\nexport class RemovedComponent implements Message<EntityComponent> {\r\n  readonly type: 'Component Removed' = 'Component Removed';\r\n  constructor(public data: EntityComponent) {}\r\n}\r\n\r\n/**\r\n * Type guard to know if message is for a Removed Component\r\n */\r\nexport function isRemovedComponent(x: Message<EntityComponent>): x is RemovedComponent {\r\n  return !!x && x.type === 'Component Removed';\r\n}\r\n\r\n/**\r\n * An Entity is the base type of anything that can have behavior in Excalibur, they are part of the built in entity component system\r\n *\r\n * Entities can be strongly typed with the components they contain\r\n *\r\n * ```typescript\r\n * const entity = new Entity<ComponentA | ComponentB>();\r\n * entity.components.a; // Type ComponentA\r\n * entity.components.b; // Type ComponentB\r\n * ```\r\n */\r\nexport class Entity extends Class implements OnInitialize, OnPreUpdate, OnPostUpdate {\r\n  private static _ID = 0;\r\n\r\n  constructor(components?: Component[], name?: string) {\r\n    super();\r\n    this._setName(name);\r\n    if (components) {\r\n      for (const component of components) {\r\n        this.addComponent(component);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * The unique identifier for the entity\r\n   */\r\n  public id: number = Entity._ID++;\r\n\r\n  private _name: string = 'anonymous';\r\n  protected _setName(name: string) {\r\n    if (name) {\r\n      this._name = name;\r\n    }\r\n  }\r\n  public get name(): string {\r\n    return this._name;\r\n  }\r\n\r\n  public get events(): EventDispatcher {\r\n    return this.eventDispatcher;\r\n  }\r\n\r\n  /**\r\n   * Whether this entity is active, if set to false it will be reclaimed\r\n   */\r\n  public active: boolean = true;\r\n\r\n  /**\r\n   * Kill the entity, means it will no longer be updated. Kills are deferred to the end of the update.\r\n   */\r\n  public kill() {\r\n    this.active = false;\r\n  }\r\n\r\n  public isKilled() {\r\n    return !this.active;\r\n  }\r\n\r\n  /**\r\n   * Specifically get the tags on the entity from [[TagComponent]]\r\n   */\r\n  public get tags(): readonly string[] {\r\n    return this._tagsMemo;\r\n  }\r\n\r\n  /**\r\n   * Check if a tag exists on the entity\r\n   * @param tag name to check for\r\n   */\r\n  public hasTag(tag: string): boolean {\r\n    return this.tags.includes(tag);\r\n  }\r\n\r\n  /**\r\n   * Adds a tag to an entity\r\n   * @param tag\r\n   * @returns Entity\r\n   */\r\n  public addTag(tag: string) {\r\n    return this.addComponent(new TagComponent(tag));\r\n  }\r\n\r\n  /**\r\n   * Removes a tag on the entity\r\n   *\r\n   * Removals are deferred until the end of update\r\n   * @param tag\r\n   * @param force Remove component immediately, no deferred\r\n   */\r\n  public removeTag(tag: string, force = false) {\r\n    return this.removeComponent(tag, force);\r\n  }\r\n\r\n  /**\r\n   * The types of the components on the Entity\r\n   */\r\n  public get types(): string[] {\r\n    return this._typesMemo;\r\n  }\r\n\r\n  /**\r\n   * Bucket to hold on to deferred removals\r\n   */\r\n  private _componentsToRemove: (Component | string)[] = [];\r\n  private _componentTypeToInstance = new Map<ComponentCtor, Component>();\r\n  private _componentStringToInstance = new Map<string, Component>();\r\n\r\n  private _tagsMemo: string[] = [];\r\n  private _typesMemo: string[] = [];\r\n  private _rebuildMemos() {\r\n    this._tagsMemo = Array.from(this._componentStringToInstance.values())\r\n      .filter((c) => c instanceof TagComponent)\r\n      .map((c) => c.type);\r\n    this._typesMemo = Array.from(this._componentStringToInstance.keys());\r\n  }\r\n\r\n  public getComponents(): Component[] {\r\n    return Array.from(this._componentStringToInstance.values());\r\n  }\r\n\r\n  /**\r\n   * Observable that keeps track of component add or remove changes on the entity\r\n   */\r\n  public componentAdded$ = new Observable<AddedComponent>();\r\n  private _notifyAddComponent(component: Component) {\r\n    this._rebuildMemos();\r\n    const added = new AddedComponent({\r\n      component,\r\n      entity: this\r\n    });\r\n    this.componentAdded$.notifyAll(added);\r\n  }\r\n\r\n  public componentRemoved$ = new Observable<RemovedComponent>();\r\n  private _notifyRemoveComponent(component: Component) {\r\n    const removed = new RemovedComponent({\r\n      component,\r\n      entity: this\r\n    });\r\n    this.componentRemoved$.notifyAll(removed);\r\n    this._rebuildMemos();\r\n  }\r\n\r\n  private _parent: Entity = null;\r\n  public get parent(): Entity {\r\n    return this._parent;\r\n  }\r\n\r\n  public childrenAdded$ = new Observable<Entity>();\r\n  public childrenRemoved$ = new Observable<Entity>();\r\n\r\n  private _children: Entity[] = [];\r\n  /**\r\n   * Get the direct children of this entity\r\n   */\r\n  public get children(): readonly Entity[] {\r\n    return this._children;\r\n  }\r\n\r\n  /**\r\n   * Unparents this entity, if there is a parent. Otherwise it does nothing.\r\n   */\r\n  public unparent() {\r\n    if (this._parent) {\r\n      this._parent.removeChild(this);\r\n      this._parent = null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Adds an entity to be a child of this entity\r\n   * @param entity\r\n   */\r\n  public addChild(entity: Entity): Entity {\r\n    if (entity.parent === null) {\r\n      if (this.getAncestors().includes(entity)) {\r\n        throw new Error('Cycle detected, cannot add entity');\r\n      }\r\n      this._children.push(entity);\r\n      entity._parent = this;\r\n      this.childrenAdded$.notifyAll(entity);\r\n    } else {\r\n      throw new Error('Entity already has a parent, cannot add without unparenting');\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Remove an entity from children if it exists\r\n   * @param entity\r\n   */\r\n  public removeChild(entity: Entity): Entity {\r\n    if (entity.parent === this) {\r\n      Util.removeItemFromArray(entity, this._children);\r\n      entity._parent = null;\r\n      this.childrenRemoved$.notifyAll(entity);\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Removes all children from this entity\r\n   */\r\n  public removeAllChildren(): Entity {\r\n    this.children.forEach((c) => {\r\n      this.removeChild(c);\r\n    });\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Returns a list of parent entities starting with the topmost parent. Includes the current entity.\r\n   */\r\n  public getAncestors(): Entity[] {\r\n    const result: Entity[] = [this];\r\n    let current = this.parent;\r\n    while (current) {\r\n      result.push(current);\r\n      current = current.parent;\r\n    }\r\n    return result.reverse();\r\n  }\r\n\r\n  /**\r\n   * Returns a list of all the entities that descend from this entity. Includes the current entity.\r\n   */\r\n  public getDescendants(): Entity[] {\r\n    let result: Entity[] = [this];\r\n    let queue: Entity[] = [this];\r\n    while (queue.length > 0) {\r\n      const curr = queue.pop();\r\n      queue = queue.concat(curr.children);\r\n      result = result.concat(curr.children);\r\n    }\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Creates a deep copy of the entity and a copy of all its components\r\n   */\r\n  public clone(): Entity {\r\n    const newEntity = new Entity();\r\n    for (const c of this.types) {\r\n      newEntity.addComponent(this.get(c).clone());\r\n    }\r\n    for (const child of this.children) {\r\n      newEntity.addChild(child.clone());\r\n    }\r\n    return newEntity;\r\n  }\r\n\r\n  /**\r\n   * Adds a copy of all the components from another template entity as a \"prefab\"\r\n   * @param templateEntity Entity to use as a template\r\n   * @param force Force component replacement if it already exists on the target entity\r\n   */\r\n  public addTemplate(templateEntity: Entity, force: boolean = false): Entity {\r\n    for (const c of templateEntity.getComponents()) {\r\n      this.addComponent(c.clone(), force);\r\n    }\r\n    for (const child of templateEntity.children) {\r\n      this.addChild(child.clone().addTemplate(child));\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Adds a component to the entity\r\n   * @param component Component or Entity to add copy of components from\r\n   * @param force Optionally overwrite any existing components of the same type\r\n   */\r\n  public addComponent<T extends Component>(component: T, force: boolean = false): Entity {\r\n    // if component already exists, skip if not forced\r\n    if (this.has(component.type)) {\r\n      if (force) {\r\n        // Remove existing component type if exists when forced\r\n        this.removeComponent(component);\r\n      } else {\r\n        // early exit component exits\r\n        return this;\r\n      }\r\n    }\r\n\r\n    // TODO circular dependencies will be a problem\r\n    if (component.dependencies && component.dependencies.length) {\r\n      for (const ctor of component.dependencies) {\r\n        this.addComponent(new ctor());\r\n      }\r\n    }\r\n\r\n    component.owner = this;\r\n    const constuctorType = component.constructor as ComponentCtor<T>;\r\n    this._componentTypeToInstance.set(constuctorType, component);\r\n    this._componentStringToInstance.set(component.type, component);\r\n    if (component.onAdd) {\r\n      component.onAdd(this);\r\n    }\r\n    this._notifyAddComponent(component);\r\n\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Removes a component from the entity, by default removals are deferred to the end of entity update to avoid consistency issues\r\n   *\r\n   * Components can be force removed with the `force` flag, the removal is not deferred and happens immediately\r\n   * @param componentOrType\r\n   * @param force\r\n   */\r\n  public removeComponent<ComponentOrType extends string | Component>(componentOrType: ComponentOrType, force = false): Entity {\r\n    if (force) {\r\n      if (typeof componentOrType === 'string') {\r\n        this._removeComponentByType(componentOrType);\r\n      } else if (componentOrType instanceof Component) {\r\n        this._removeComponentByType(componentOrType.type);\r\n      }\r\n    } else {\r\n      this._componentsToRemove.push(componentOrType);\r\n    }\r\n\r\n    return this as any;\r\n  }\r\n\r\n  private _removeComponentByType(type: string) {\r\n    if (this.has(type)) {\r\n      const component = this.get(type);\r\n      component.owner = null;\r\n      if (component.onRemove) {\r\n        component.onRemove(this);\r\n      }\r\n      const ctor = component.constructor as ComponentCtor;\r\n      this._componentTypeToInstance.delete(ctor);\r\n      this._componentStringToInstance.delete(component.type);\r\n      this._notifyRemoveComponent(component);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @hidden\r\n   * @internal\r\n   */\r\n  public processComponentRemoval() {\r\n    for (const componentOrType of this._componentsToRemove) {\r\n      const type = typeof componentOrType === 'string' ? componentOrType : componentOrType.type;\r\n      this._removeComponentByType(type);\r\n    }\r\n    this._componentsToRemove.length = 0;\r\n  }\r\n\r\n  /**\r\n   * Check if a component type exists\r\n   * @param type\r\n   */\r\n  public has<T extends Component>(type: ComponentCtor<T>): boolean;\r\n  public has(type: string): boolean;\r\n  public has<T extends Component>(type: ComponentCtor<T> | string): boolean {\r\n    if (typeof type === 'string') {\r\n      return this._componentStringToInstance.has(type);\r\n    } else {\r\n      return this._componentTypeToInstance.has(type);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get a component by type with typecheck\r\n   *\r\n   * (Does not work on tag components, use .hasTag(\"mytag\") instead)\r\n   * @param type\r\n   */\r\n  public get<T extends Component>(type: ComponentCtor<T>): T | null;\r\n  public get<T extends Component>(type: string): T | null;\r\n  public get<T extends Component>(type: ComponentCtor<T> | string): T | null {\r\n    if (typeof type === 'string') {\r\n      return this._componentStringToInstance.get(type) as T;\r\n    } else {\r\n      return this._componentTypeToInstance.get(type) as T;\r\n    }\r\n  }\r\n\r\n  private _isInitialized = false;\r\n\r\n  /**\r\n   * Gets whether the actor is Initialized\r\n   */\r\n  public get isInitialized(): boolean {\r\n    return this._isInitialized;\r\n  }\r\n\r\n  /**\r\n   * Initializes this entity, meant to be called by the Scene before first update not by users of Excalibur.\r\n   *\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * @internal\r\n   */\r\n  public _initialize(engine: Engine) {\r\n    if (!this.isInitialized) {\r\n      this.onInitialize(engine);\r\n      super.emit('initialize', new InitializeEvent(engine, this));\r\n      this._isInitialized = true;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _preupdate handler for [[onPreUpdate]] lifecycle event\r\n   * @internal\r\n   */\r\n  public _preupdate(engine: Engine, delta: number): void {\r\n    this.emit('preupdate', new PreUpdateEvent(engine, delta, this));\r\n    this.onPreUpdate(engine, delta);\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _preupdate handler for [[onPostUpdate]] lifecycle event\r\n   * @internal\r\n   */\r\n  public _postupdate(engine: Engine, delta: number): void {\r\n    this.emit('postupdate', new PostUpdateEvent(engine, delta, this));\r\n    this.onPostUpdate(engine, delta);\r\n  }\r\n\r\n  /**\r\n   * `onInitialize` is called before the first update of the entity. This method is meant to be\r\n   * overridden.\r\n   *\r\n   * Synonymous with the event handler `.on('initialize', (evt) => {...})`\r\n   */\r\n  public onInitialize(_engine: Engine): void {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPreUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\r\n   *\r\n   * `onPreUpdate` is called directly before an entity is updated.\r\n   */\r\n  public onPreUpdate(_engine: Engine, _delta: number): void {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPostUpdate lifecycle event handler. Synonymous with `.on('postupdate', (evt) =>{...})`\r\n   *\r\n   * `onPostUpdate` is called directly after an entity is updated.\r\n   */\r\n  public onPostUpdate(_engine: Engine, _delta: number): void {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   *\r\n   * Entity update lifecycle, called internally\r\n   *\r\n   * @internal\r\n   * @param engine\r\n   * @param delta\r\n   */\r\n  public update(engine: Engine, delta: number): void {\r\n    this._initialize(engine);\r\n    this._preupdate(engine, delta);\r\n    for (const child of this.children) {\r\n      child.update(engine, delta);\r\n    }\r\n    this._postupdate(engine, delta);\r\n  }\r\n}\r\n","import { Component } from '../EntityComponentSystem';\r\n\r\n/**\r\n * Shim to draw to the canvas when in LegacyDrawing mode\r\n * @deprecated\r\n */\r\nexport class CanvasDrawComponent extends Component<'ex.canvas'> {\r\n  public readonly type = 'ex.canvas';\r\n\r\n  constructor(public draw?: (ctx: CanvasRenderingContext2D, delta: number) => void) {\r\n    super();\r\n    // eslint-disable-next-line @typescript-eslint/no-empty-function\r\n    this.draw = this.draw ?? (() => {});\r\n  }\r\n}\r\n","import { Vector, vec } from '../Math/vector';\r\nimport { Graphic } from './Graphic';\r\nimport { HasTick } from './Animation';\r\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\r\nimport { Logger } from '../Util/Log';\r\nimport { BoundingBox } from '../Collision/Index';\r\nimport { Component } from '../EntityComponentSystem/Component';\r\n\r\n/**\r\n * Type guard for checking if a Graphic HasTick (used for graphics that change over time like animations)\r\n * @param graphic\r\n */\r\nexport function hasGraphicsTick(graphic: Graphic): graphic is Graphic & HasTick {\r\n  return !!(graphic as unknown as HasTick).tick;\r\n}\r\nexport interface GraphicsShowOptions {\r\n  offset?: Vector;\r\n  anchor?: Vector;\r\n}\r\n\r\nexport interface GraphicsComponentOptions {\r\n  onPostDraw?: (ex: ExcaliburGraphicsContext, elapsed: number) => void;\r\n  onPreDraw?: (ex: ExcaliburGraphicsContext, elapsed: number) => void;\r\n\r\n  /**\r\n   * Name of current graphic to use\r\n   */\r\n  current?: string;\r\n\r\n  /**\r\n   * Optionally copy instances of graphics by calling .clone(), you may set this to false to avoid sharing graphics when added to the\r\n   * component for performance reasons. By default graphics are not copied and are shared when added to the component.\r\n   */\r\n  copyGraphics?: boolean;\r\n\r\n  /**\r\n   * Optional visible flag, if the graphics component is not visible it will not be displayed\r\n   */\r\n  visible?: boolean;\r\n\r\n  /**\r\n   * Optional opacity\r\n   */\r\n  opacity?: number;\r\n\r\n  /**\r\n   * List of graphics\r\n   */\r\n  graphics?: { [graphicName: string]: Graphic };\r\n\r\n  /**\r\n   * Optional offset in absolute pixels to shift all graphics in this component from each graphic's anchor (default is top left corner)\r\n   */\r\n  offset?: Vector;\r\n\r\n  /**\r\n   * Optional anchor\r\n   */\r\n  anchor?: Vector;\r\n}\r\n\r\nexport interface GraphicsLayerOptions {\r\n  /**\r\n   * Name of the layer required, for example 'background'\r\n   */\r\n  name: string;\r\n  /**\r\n   * Order of the layer, a layer with order -1 will be below a layer with order of 1\r\n   */\r\n  order: number;\r\n  /**\r\n   * Offset to shift the entire layer\r\n   */\r\n  offset?: Vector;\r\n}\r\nexport class GraphicsLayer {\r\n  public graphics: { graphic: Graphic; options: GraphicsShowOptions }[] = [];\r\n  constructor(private _options: GraphicsLayerOptions, private _graphics: GraphicsComponent) {}\r\n  public get name(): string {\r\n    return this._options.name;\r\n  }\r\n\r\n  /**\r\n   * Remove any instance(s) of a graphic currently being shown in this layer\r\n   */\r\n  public hide(nameOrGraphic: string | Graphic): void;\r\n  /**\r\n   * Remove all currently shown graphics in this layer\r\n   */\r\n  public hide(): void;\r\n  public hide(nameOrGraphic?: string | Graphic): void {\r\n    if (!nameOrGraphic) {\r\n      this.graphics.length = 0;\r\n    } else {\r\n      let gfx: Graphic = null;\r\n      if (nameOrGraphic instanceof Graphic) {\r\n        gfx = nameOrGraphic;\r\n      } else {\r\n        gfx = this._graphics.getGraphic(nameOrGraphic);\r\n      }\r\n      this.graphics = this.graphics.filter((g) => g.graphic !== gfx);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Show a graphic by name or instance at an offset, graphics are shown in the order in which `show()` is called.\r\n   *\r\n   * If `show()` is called multiple times for the same graphic it will be shown multiple times.\r\n   * @param nameOrGraphic\r\n   * @param options\r\n   */\r\n  public show<T extends Graphic = Graphic>(nameOrGraphic: string | T, options?: GraphicsShowOptions): T {\r\n    options = { ...options };\r\n    let gfx: Graphic;\r\n    if (nameOrGraphic instanceof Graphic) {\r\n      gfx = this._graphics.copyGraphics ? nameOrGraphic.clone() : nameOrGraphic;\r\n    } else {\r\n      gfx = this._graphics.getGraphic(nameOrGraphic);\r\n      if (!gfx) {\r\n        Logger.getInstance().error(\r\n          `No such graphic added to component named ${nameOrGraphic}. These named graphics are available: `,\r\n          this._graphics.getNames()\r\n        );\r\n      }\r\n    }\r\n    if (gfx) {\r\n      this.graphics.push({ graphic: gfx, options });\r\n      return gfx as T;\r\n    } else {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Use a specific graphic, swap out any current graphics being shown\r\n   * @param nameOrGraphic\r\n   * @param options\r\n   */\r\n  public use<T extends Graphic = Graphic>(nameOrGraphic: string | T, options?: GraphicsShowOptions): T {\r\n    options = { ...options };\r\n    this.hide();\r\n    return this.show<T>(nameOrGraphic, options);\r\n  }\r\n\r\n  /**\r\n   * Current order of the layer, higher numbers are on top, lower numbers are on the bottom.\r\n   *\r\n   * For example a layer with `order = -1` would be under a layer of `order = 1`\r\n   */\r\n  public get order(): number {\r\n    return this._options.order;\r\n  }\r\n\r\n  /**\r\n   * Set the order of the layer, higher numbers are on top, lower numbers are on the bottom.\r\n   *\r\n   * For example a layer with `order = -1` would be under a layer of `order = 1`\r\n   */\r\n  public set order(order: number) {\r\n    this._options.order = order;\r\n  }\r\n\r\n  /**\r\n   * Get or set the pixel offset from the layer anchor for all graphics in the layer\r\n   */\r\n  public get offset(): Vector {\r\n    return this._options.offset ?? Vector.Zero;\r\n  }\r\n\r\n  public set offset(value: Vector) {\r\n    this._options.offset = value;\r\n  }\r\n\r\n  public get currentKeys(): string {\r\n    return this.name ?? 'anonymous';\r\n  }\r\n}\r\n\r\nexport class GraphicsLayers {\r\n  private _layers: GraphicsLayer[] = [];\r\n  private _layerMap: { [layerName: string]: GraphicsLayer } = {};\r\n  public default: GraphicsLayer;\r\n  constructor(private _component: GraphicsComponent) {\r\n    this.default = new GraphicsLayer({ name: 'default', order: 0 }, _component);\r\n    this._maybeAddLayer(this.default);\r\n  }\r\n  public create(options: GraphicsLayerOptions): GraphicsLayer {\r\n    const layer = new GraphicsLayer(options, this._component);\r\n    return this._maybeAddLayer(layer);\r\n  }\r\n\r\n  /**\r\n   * Retrieve a single layer by name\r\n   * @param name\r\n   */\r\n  public get(name: string): GraphicsLayer;\r\n  /**\r\n   * Retrieve all layers\r\n   */\r\n  public get(): readonly GraphicsLayer[];\r\n  public get(name?: string): GraphicsLayer | readonly GraphicsLayer[] {\r\n    if (name) {\r\n      return this._getLayer(name);\r\n    }\r\n    return this._layers;\r\n  }\r\n\r\n  public currentKeys() {\r\n    const graphicsLayerKeys = [];\r\n    for (const layer of this._layers) {\r\n      graphicsLayerKeys.push(layer.currentKeys);\r\n    }\r\n    return graphicsLayerKeys;\r\n  }\r\n\r\n  public has(name: string): boolean {\r\n    return name in this._layerMap;\r\n  }\r\n\r\n  private _maybeAddLayer(layer: GraphicsLayer) {\r\n    if (this._layerMap[layer.name]) {\r\n      // todo log warning\r\n      return this._layerMap[layer.name];\r\n    }\r\n    this._layerMap[layer.name] = layer;\r\n    this._layers.push(layer);\r\n    this._layers.sort((a, b) => a.order - b.order);\r\n    return layer;\r\n  }\r\n\r\n  private _getLayer(name: string): GraphicsLayer | undefined {\r\n    return this._layerMap[name];\r\n  }\r\n}\r\n\r\n/**\r\n * Component to manage drawings, using with the position component\r\n */\r\nexport class GraphicsComponent extends Component<'ex.graphics'> {\r\n  readonly type = 'ex.graphics';\r\n\r\n  private _graphics: { [graphicName: string]: Graphic } = {};\r\n\r\n  public layers: GraphicsLayers;\r\n\r\n  public getGraphic(name: string): Graphic | undefined {\r\n    return this._graphics[name];\r\n  }\r\n\r\n  /**\r\n   * Get registered graphics names\r\n   */\r\n  public getNames(): string[] {\r\n    return Object.keys(this._graphics);\r\n  }\r\n\r\n  /**\r\n   * Draws after the entity transform has bene applied, but before graphics component graphics have been drawn\r\n   */\r\n  public onPreDraw: (ctx: ExcaliburGraphicsContext, elapsedMilliseconds: number) => void;\r\n\r\n  /**\r\n   * Draws after the entity transform has been applied, and after graphics component graphics has been drawn\r\n   */\r\n  public onPostDraw: (ctx: ExcaliburGraphicsContext, elapsedMilliseconds: number) => void;\r\n\r\n  /**\r\n   * Sets or gets wether any drawing should be visible in this component\r\n   */\r\n  public visible: boolean = true;\r\n\r\n  /**\r\n   * Sets or gets wither all drawings should have an opacity applied\r\n   */\r\n  public opacity: number = 1;\r\n\r\n  /**\r\n   * Offset to apply to graphics by default\r\n   */\r\n  public offset: Vector = Vector.Zero;\r\n\r\n  /**\r\n   * Anchor to apply to graphics by default\r\n   */\r\n  public anchor: Vector = Vector.Half;\r\n\r\n  /**\r\n   * If set to true graphics added to the component will be copied. This can affect performance\r\n   */\r\n  public copyGraphics: boolean = false;\r\n\r\n  constructor(options?: GraphicsComponentOptions) {\r\n    super();\r\n    // Defaults\r\n    options = {\r\n      visible: this.visible,\r\n      ...options\r\n    };\r\n\r\n    const { current, anchor, opacity, visible, graphics, offset, copyGraphics, onPreDraw, onPostDraw } = options;\r\n\r\n    this._graphics = graphics || {};\r\n    this.offset = offset ?? this.offset;\r\n    this.opacity = opacity ?? this.opacity;\r\n    this.anchor = anchor ?? this.anchor;\r\n    this.copyGraphics = copyGraphics ?? this.copyGraphics;\r\n    this.onPreDraw = onPreDraw ?? this.onPreDraw;\r\n    this.onPostDraw = onPostDraw ?? this.onPostDraw;\r\n    this.visible = !!visible;\r\n\r\n    this.layers = new GraphicsLayers(this);\r\n    if (current && this._graphics[current]) {\r\n      this.show(this._graphics[current]);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns the currently displayed graphics and their offsets, empty array if hidden\r\n   */\r\n  public get current(): { graphic: Graphic; options: GraphicsShowOptions }[] {\r\n    return this.layers.default.graphics;\r\n  }\r\n\r\n  /**\r\n   * Returns all graphics associated with this component\r\n   */\r\n  public get graphics(): { [graphicName: string]: Graphic } {\r\n    return this._graphics;\r\n  }\r\n\r\n  /**\r\n   * Adds a named graphic to this component, if the name is \"default\" or not specified, it will be shown by default without needing to call\r\n   * `show(\"default\")`\r\n   * @param graphic\r\n   */\r\n  public add(graphic: Graphic): Graphic;\r\n  public add(name: string, graphic: Graphic): Graphic;\r\n  public add(nameOrGraphic: string | Graphic, graphic?: Graphic): Graphic {\r\n    let name = 'default';\r\n    let graphicToSet: Graphic = null;\r\n    if (typeof nameOrGraphic === 'string') {\r\n      name = nameOrGraphic;\r\n      graphicToSet = graphic;\r\n    } else {\r\n      graphicToSet = nameOrGraphic;\r\n    }\r\n\r\n    this._graphics[name] = this.copyGraphics ? graphicToSet.clone() : graphicToSet;\r\n    if (name === 'default') {\r\n      this.show('default');\r\n    }\r\n    return graphicToSet;\r\n  }\r\n\r\n  /**\r\n   * Show a graphic by name on the **default** layer, returns the new [[Graphic]]\r\n   */\r\n  public show<T extends Graphic = Graphic>(nameOrGraphic: string | T, options?: GraphicsShowOptions): T {\r\n    return this.layers.default.show<T>(nameOrGraphic, options);\r\n  }\r\n\r\n  /**\r\n   * Use a graphic only, swap out any graphics on the **default** layer, returns the new [[Graphic]]\r\n   * @param nameOrGraphic\r\n   * @param options\r\n   */\r\n  public use<T extends Graphic = Graphic>(nameOrGraphic: string | T, options?: GraphicsShowOptions): T {\r\n    return this.layers.default.use<T>(nameOrGraphic, options);\r\n  }\r\n\r\n  /**\r\n   * Remove any instance(s) of a graphic currently being shown in the **default** layer\r\n   */\r\n  public hide(nameOrGraphic: string | Graphic): void;\r\n  /**\r\n   * Remove all currently shown graphics in the **default** layer\r\n   */\r\n  public hide(): void;\r\n  public hide(nameOrGraphic?: string | Graphic): void {\r\n    this.layers.default.hide(nameOrGraphic);\r\n  }\r\n\r\n  private _bounds: BoundingBox = null;\r\n  public set localBounds(bounds: BoundingBox) {\r\n    this._bounds = bounds;\r\n  }\r\n\r\n  public get localBounds(): BoundingBox {\r\n    if (this._bounds) {\r\n      return this._bounds;\r\n    }\r\n    let bb = new BoundingBox();\r\n    for (const layer of this.layers.get()) {\r\n      for (const { graphic, options } of layer.graphics) {\r\n        let anchor = this.anchor;\r\n        let offset = this.offset;\r\n        if (options?.anchor) {\r\n          anchor = options.anchor;\r\n        }\r\n        if (options?.offset) {\r\n          offset = options.offset;\r\n        }\r\n        const bounds = graphic.localBounds;\r\n        const offsetX = -bounds.width *  anchor.x + offset.x;\r\n        const offsetY = -bounds.height *  anchor.y + offset.y;\r\n        bb = graphic?.localBounds.translate(vec(offsetX + layer.offset.x, offsetY + layer.offset.y)).combine(bb);\r\n      }\r\n    }\r\n    return bb;\r\n  }\r\n\r\n  /**\r\n   * Update underlying graphics if necesary, called internally\r\n   * @param elapsed\r\n   * @internal\r\n   */\r\n  public update(elapsed: number, idempotencyToken: number = 0) {\r\n    for (const layer of this.layers.get()) {\r\n      for (const { graphic } of layer.graphics) {\r\n        if (hasGraphicsTick(graphic)) {\r\n          graphic?.tick(elapsed, idempotencyToken);\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { Raster, RasterOptions } from './Raster';\r\n\r\nexport interface RectangleOptions {\r\n  width: number;\r\n  height: number;\r\n}\r\n\r\n/**\r\n * A Rectangle [[Graphic]] for drawing rectangles to the [[ExcaliburGraphicsContext]]\r\n */\r\nexport class Rectangle extends Raster {\r\n  constructor(options: RasterOptions & RectangleOptions) {\r\n    super(options);\r\n    this.width = options.width;\r\n    this.height = options.height;\r\n    this.rasterize();\r\n  }\r\n\r\n  public clone(): Rectangle {\r\n    return new Rectangle({\r\n      width: this.width,\r\n      height: this.height,\r\n      ...this.cloneGraphicOptions(),\r\n      ...this.cloneRasterOptions()\r\n    });\r\n  }\r\n\r\n  execute(ctx: CanvasRenderingContext2D): void {\r\n    if (this.color) {\r\n      ctx.fillRect(0, 0, this.width, this.height);\r\n    }\r\n    if (this.strokeColor) {\r\n      ctx.strokeRect(0, 0, this.width, this.height);\r\n    }\r\n  }\r\n}\r\n","import { ImageFiltering } from '.';\r\nimport { Raster, RasterOptions } from './Raster';\r\n\r\nexport interface CircleOptions {\r\n  radius: number;\r\n}\r\n\r\n/**\r\n * A circle [[Graphic]] for drawing circles to the [[ExcaliburGraphicsContext]]\r\n *\r\n * Circles default to [[ImageFiltering.Blended]]\r\n */\r\nexport class Circle extends Raster {\r\n  private _radius: number = 0;\r\n  public get radius() {\r\n    return this._radius;\r\n  }\r\n  public set radius(value: number) {\r\n    this._radius = value;\r\n    this.width = this._radius * 2;\r\n    this.height = this._radius * 2;\r\n    this.flagDirty();\r\n  }\r\n  constructor(options: RasterOptions & CircleOptions) {\r\n    super(options);\r\n    this.padding = options.padding ?? 2; // default 2 padding for circles looks nice\r\n    this.radius = options.radius;\r\n    this.filtering = options.filtering ?? ImageFiltering.Blended;\r\n    this.rasterize();\r\n  }\r\n\r\n  public clone(): Circle {\r\n    return new Circle({\r\n      radius: this.radius,\r\n      ...this.cloneGraphicOptions(),\r\n      ...this.cloneRasterOptions()\r\n    });\r\n  }\r\n\r\n  execute(ctx: CanvasRenderingContext2D): void {\r\n    if (this.radius > 0) {\r\n      ctx.beginPath();\r\n      ctx.arc(this.radius, this.radius, this.radius, 0, Math.PI * 2);\r\n\r\n      if (this.color) {\r\n        ctx.fill();\r\n      }\r\n\r\n      if (this.strokeColor) {\r\n        ctx.stroke();\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { Component } from '../EntityComponentSystem/Component';\r\n\r\n/**\r\n * Add this component to optionally configure how the pointer\r\n * system detects pointer events.\r\n *\r\n * By default the collider shape is used and graphics bounds is not.\r\n *\r\n * If both collider shape and graphics bounds are enabled it will fire events if either or\r\n * are intersecting the pointer.\r\n */\r\nexport class PointerComponent extends Component<'ex.pointer'> {\r\n  public readonly type = 'ex.pointer';\r\n  /**\r\n   * Use any existing Collider component geometry for pointer events. This is useful if you want\r\n   * user pointer events only to trigger on the same collision geometry used in the collider component\r\n   * for collision resolution. Default is `true`.\r\n   */\r\n  public useColliderShape = true;\r\n  /**\r\n   * Use any existing Graphics component bounds for pointers. This is useful if you want the axis aligned\r\n   * bounds around the graphic to trigger pointer events. Default is `false`.\r\n   */\r\n  public useGraphicsBounds = false;\r\n}","import { Vector } from '../Math/vector';\r\nimport { obsolete } from '../Util/Decorators';\r\n\r\n/**\r\n * A definition of an EasingFunction. See [[EasingFunctions]].\r\n */\r\n// tslint:disable-next-line\r\nexport interface EasingFunction {\r\n  (currentTime: number, startValue: number, endValue: number, duration: number): number;\r\n}\r\n\r\n/**\r\n * Standard easing functions for motion in Excalibur, defined on a domain of [0, duration] and a range from [+startValue,+endValue]\r\n * Given a time, the function will return a value from positive startValue to positive endValue.\r\n *\r\n * ```js\r\n * function Linear (t) {\r\n *    return t * t;\r\n * }\r\n *\r\n * // accelerating from zero velocity\r\n * function EaseInQuad (t) {\r\n *    return t * t;\r\n * }\r\n *\r\n * // decelerating to zero velocity\r\n * function EaseOutQuad (t) {\r\n *    return t * (2 - t);\r\n * }\r\n *\r\n * // acceleration until halfway, then deceleration\r\n * function EaseInOutQuad (t) {\r\n *    return t < .5 ? 2 * t * t : -1 + (4 - 2 * t) * t;\r\n * }\r\n *\r\n * // accelerating from zero velocity\r\n * function EaseInCubic (t) {\r\n *    return t * t * t;\r\n * }\r\n *\r\n * // decelerating to zero velocity\r\n * function EaseOutCubic (t) {\r\n *    return (--t) * t * t + 1;\r\n * }\r\n *\r\n * // acceleration until halfway, then deceleration\r\n * function EaseInOutCubic (t) {\r\n *    return t < .5 ? 4 * t * t * t : (t - 1) * (2 * t - 2) * (2 * t - 2) + 1;\r\n * }\r\n * ```\r\n */\r\nexport class EasingFunctions {\r\n  public static CreateReversibleEasingFunction(easing: EasingFunction) {\r\n    return (time: number, start: number, end: number, duration: number) => {\r\n      if (end < start) {\r\n        return start - (easing(time, end, start, duration) - end);\r\n      } else {\r\n        return easing(time, start, end, duration);\r\n      }\r\n    };\r\n  }\r\n\r\n  @obsolete({\r\n    message: 'Alias for incorrect spelling used in older versions, will be removed in v0.25.0',\r\n    alternateMethod: 'CreateReversibleEasingFunction'\r\n  })\r\n  public static CreateReversableEasingFunction(easing: EasingFunction) {\r\n    return EasingFunctions.CreateReversibleEasingFunction(easing);\r\n  }\r\n\r\n  public static CreateVectorEasingFunction(easing: EasingFunction) {\r\n    return (time: number, start: Vector, end: Vector, duration: number) => {\r\n      return new Vector(easing(time, start.x, end.x, duration), easing(time, start.y, end.y, duration));\r\n    };\r\n  }\r\n\r\n  public static Linear: EasingFunction = EasingFunctions.CreateReversibleEasingFunction(\r\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\r\n      endValue = endValue - startValue;\r\n      return (endValue * currentTime) / duration + startValue;\r\n    }\r\n  );\r\n\r\n  public static EaseInQuad = EasingFunctions.CreateReversibleEasingFunction(\r\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\r\n      endValue = endValue - startValue;\r\n      currentTime /= duration;\r\n\r\n      return endValue * currentTime * currentTime + startValue;\r\n    }\r\n  );\r\n\r\n  public static EaseOutQuad: EasingFunction = EasingFunctions.CreateReversibleEasingFunction(\r\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\r\n      endValue = endValue - startValue;\r\n      currentTime /= duration;\r\n      return -endValue * currentTime * (currentTime - 2) + startValue;\r\n    }\r\n  );\r\n\r\n  public static EaseInOutQuad: EasingFunction = EasingFunctions.CreateReversibleEasingFunction(\r\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\r\n      endValue = endValue - startValue;\r\n      currentTime /= duration / 2;\r\n\r\n      if (currentTime < 1) {\r\n        return (endValue / 2) * currentTime * currentTime + startValue;\r\n      }\r\n      currentTime--;\r\n\r\n      return (-endValue / 2) * (currentTime * (currentTime - 2) - 1) + startValue;\r\n    }\r\n  );\r\n\r\n  public static EaseInCubic: EasingFunction = EasingFunctions.CreateReversibleEasingFunction(\r\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\r\n      endValue = endValue - startValue;\r\n      currentTime /= duration;\r\n      return endValue * currentTime * currentTime * currentTime + startValue;\r\n    }\r\n  );\r\n\r\n  public static EaseOutCubic: EasingFunction = EasingFunctions.CreateReversibleEasingFunction(\r\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\r\n      endValue = endValue - startValue;\r\n      currentTime /= duration;\r\n      currentTime--;\r\n      return endValue * (currentTime * currentTime * currentTime + 1) + startValue;\r\n    }\r\n  );\r\n\r\n  public static EaseInOutCubic: EasingFunction = EasingFunctions.CreateReversibleEasingFunction(\r\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\r\n      endValue = endValue - startValue;\r\n      currentTime /= duration / 2;\r\n      if (currentTime < 1) {\r\n        return (endValue / 2) * currentTime * currentTime * currentTime + startValue;\r\n      }\r\n      currentTime -= 2;\r\n      return (endValue / 2) * (currentTime * currentTime * currentTime + 2) + startValue;\r\n    }\r\n  );\r\n}\r\n","import { Entity } from '../EntityComponentSystem/Entity';\r\nimport { Action } from './Action';\r\n\r\n/**\r\n * Action Queues represent an ordered sequence of actions\r\n *\r\n * Action queues are part of the [[ActionContext|Action API]] and\r\n * store the list of actions to be executed for an [[Actor]].\r\n *\r\n * Actors implement [[Actor.actions]] which can be manipulated by\r\n * advanced users to adjust the actions currently being executed in the\r\n * queue.\r\n */\r\nexport class ActionQueue {\r\n  private _entity: Entity;\r\n  private _actions: Action[] = [];\r\n  private _currentAction: Action;\r\n  private _completedActions: Action[] = [];\r\n  constructor(entity: Entity) {\r\n    this._entity = entity;\r\n  }\r\n\r\n  /**\r\n   * Add an action to the sequence\r\n   * @param action\r\n   */\r\n  public add(action: Action) {\r\n    this._actions.push(action);\r\n  }\r\n\r\n  /**\r\n   * Remove an action by reference from the sequence\r\n   * @param action\r\n   */\r\n  public remove(action: Action) {\r\n    const index = this._actions.indexOf(action);\r\n    this._actions.splice(index, 1);\r\n  }\r\n\r\n  /**\r\n   * Removes all actions from this sequence\r\n   */\r\n  public clearActions(): void {\r\n    this._actions.length = 0;\r\n    this._completedActions.length = 0;\r\n    if (this._currentAction) {\r\n      this._currentAction.stop();\r\n    }\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @returns The total list of actions in this sequence complete or not\r\n   */\r\n  public getActions(): Action[] {\r\n    return this._actions.concat(this._completedActions);\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @returns `true` if there are more actions to process in the sequence\r\n   */\r\n  public hasNext(): boolean {\r\n    return this._actions.length > 0;\r\n  }\r\n\r\n  /**\r\n   * @returns `true` if the current sequence of actions is done\r\n   */\r\n  public isComplete(): boolean {\r\n    return this._actions.length === 0;\r\n  }\r\n\r\n  /**\r\n   * Resets the sequence of actions, this is used to restart a sequence from the beginning\r\n   */\r\n  public reset(): void {\r\n    this._actions = this.getActions();\r\n\r\n    const len = this._actions.length;\r\n    for (let i = 0; i < len; i++) {\r\n      this._actions[i].reset();\r\n    }\r\n    this._completedActions = [];\r\n  }\r\n\r\n  /**\r\n   * Update the queue which updates actions and handles completing actions\r\n   * @param elapsedMs\r\n   */\r\n  public update(elapsedMs: number) {\r\n    if (this._actions.length > 0) {\r\n      this._currentAction = this._actions[0];\r\n      this._currentAction.update(elapsedMs);\r\n\r\n      if (this._currentAction.isComplete(this._entity)) {\r\n        this._completedActions.push(this._actions.shift());\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { Action } from '../Action';\r\nimport { ActionContext } from '../ActionContext';\r\nimport { ActionQueue } from '../ActionQueue';\r\n\r\nexport class Repeat implements Action {\r\n  private _actionQueue: ActionQueue;\r\n  private _repeat: number;\r\n  private _originalRepeat: number;\r\n  private _stopped: boolean = false;\r\n  private _repeatContext: ActionContext;\r\n  private _repeatBuilder: (repeatContext: ActionContext) => any;\r\n  constructor(entity: Entity, repeatBuilder: (repeatContext: ActionContext) => any, repeat: number) {\r\n    this._repeatBuilder = repeatBuilder;\r\n    this._repeatContext = new ActionContext(entity);\r\n    this._actionQueue = this._repeatContext.getQueue();\r\n\r\n    this._repeat = repeat;\r\n    this._originalRepeat = repeat;\r\n\r\n    this._repeatBuilder(this._repeatContext);\r\n    this._repeat--; // current execution is the first repeat\r\n  }\r\n\r\n  public update(delta: number): void {\r\n    if (this._actionQueue.isComplete()) {\r\n      this._actionQueue.clearActions();\r\n      this._repeatBuilder(this._repeatContext);\r\n      this._repeat--;\r\n    }\r\n    this._actionQueue.update(delta);\r\n  }\r\n\r\n  public isComplete(): boolean {\r\n    return this._stopped || (this._repeat <= 0 && this._actionQueue.isComplete());\r\n  }\r\n\r\n  public stop(): void {\r\n    this._stopped = true;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._repeat = this._originalRepeat;\r\n  }\r\n}\r\n","import { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { Action } from '../Action';\r\nimport { ActionContext } from '../ActionContext';\r\nimport { ActionQueue } from '../ActionQueue';\r\n\r\n/**\r\n * RepeatForever Action implementation, it is recommended you use the fluent action\r\n * context API.\r\n *\r\n *\r\n */\r\nexport class RepeatForever implements Action {\r\n  private _actionQueue: ActionQueue;\r\n  private _stopped: boolean = false;\r\n  private _repeatContext: ActionContext;\r\n  private _repeatBuilder: (repeatContext: ActionContext) => any;\r\n  constructor(entity: Entity, repeatBuilder: (repeatContext: ActionContext) => any) {\r\n    this._repeatBuilder = repeatBuilder;\r\n    this._repeatContext = new ActionContext(entity);\r\n    this._actionQueue = this._repeatContext.getQueue();\r\n\r\n    this._repeatBuilder(this._repeatContext);\r\n  }\r\n\r\n  public update(delta: number): void {\r\n    if (this._stopped) {\r\n      return;\r\n    }\r\n\r\n    if (this._actionQueue.isComplete()) {\r\n      this._actionQueue.clearActions();\r\n      this._repeatBuilder(this._repeatContext);\r\n    }\r\n\r\n    this._actionQueue.update(delta);\r\n  }\r\n\r\n  public isComplete(): boolean {\r\n    return this._stopped;\r\n  }\r\n\r\n  public stop(): void {\r\n    this._stopped = true;\r\n    this._actionQueue.clearActions();\r\n  }\r\n\r\n  public reset(): void {\r\n    return;\r\n  }\r\n}\r\n","import { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\r\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\r\nimport { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { Vector, vec } from '../../Math/vector';\r\nimport { Logger } from '../../Util/Log';\r\nimport { Action } from '../Action';\r\n\r\nexport class MoveBy implements Action {\r\n  private _tx: TransformComponent;\r\n  private _motion: MotionComponent;\r\n  private _entity: Entity;\r\n  public x: number;\r\n  public y: number;\r\n  private _distance: number;\r\n  private _speed: number;\r\n\r\n  private _start: Vector;\r\n  private _offset: Vector;\r\n  private _end: Vector;\r\n  private _dir: Vector;\r\n  private _started = false;\r\n  private _stopped = false;\r\n\r\n  constructor(entity: Entity, offsetX: number, offsetY: number, speed: number) {\r\n    this._entity = entity;\r\n    this._tx = entity.get(TransformComponent);\r\n    this._motion = entity.get(MotionComponent);\r\n    this._speed = speed;\r\n    this._offset = new Vector(offsetX, offsetY);\r\n    if (speed <= 0) {\r\n      Logger.getInstance().error('Attempted to moveBy with speed less than or equal to zero : ' + speed);\r\n      throw new Error('Speed must be greater than 0 pixels per second');\r\n    }\r\n  }\r\n\r\n  public update(_delta: number) {\r\n    if (!this._started) {\r\n      this._started = true;\r\n      this._start = new Vector(this._tx.pos.x, this._tx.pos.y);\r\n      this._end = this._start.add(this._offset);\r\n      this._distance = this._offset.size;\r\n      this._dir = this._end.sub(this._start).normalize();\r\n    }\r\n\r\n    if (this.isComplete(this._entity)) {\r\n      this._tx.pos = vec(this._end.x, this._end.y);\r\n      this._motion.vel = vec(0, 0);\r\n    } else {\r\n      this._motion.vel = this._dir.scale(this._speed);\r\n    }\r\n  }\r\n\r\n  public isComplete(entity: Entity): boolean {\r\n    const tx = entity.get(TransformComponent);\r\n    return this._stopped || tx.pos.distance(this._start) >= this._distance;\r\n  }\r\n\r\n  public stop(): void {\r\n    this._motion.vel = vec(0, 0);\r\n    this._stopped = true;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._started = false;\r\n  }\r\n}\r\n","import { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\r\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\r\nimport { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { Vector, vec } from '../../Math/vector';\r\nimport { Action } from '../Action';\r\n\r\nexport class MoveTo implements Action {\r\n  private _tx: TransformComponent;\r\n  private _motion: MotionComponent;\r\n  public x: number;\r\n  public y: number;\r\n  private _start: Vector;\r\n  private _end: Vector;\r\n  private _dir: Vector;\r\n  private _speed: number;\r\n  private _distance: number;\r\n  private _started = false;\r\n  private _stopped = false;\r\n  constructor(public entity: Entity, destx: number, desty: number, speed: number) {\r\n    this._tx = entity.get(TransformComponent);\r\n    this._motion = entity.get(MotionComponent);\r\n    this._end = new Vector(destx, desty);\r\n    this._speed = speed;\r\n  }\r\n\r\n  public update(_delta: number): void {\r\n    if (!this._started) {\r\n      this._started = true;\r\n      this._start = new Vector(this._tx.pos.x, this._tx.pos.y);\r\n      this._distance = this._start.distance(this._end);\r\n      this._dir = this._end.sub(this._start).normalize();\r\n    }\r\n    const m = this._dir.scale(this._speed);\r\n    this._motion.vel = vec(m.x, m.y);\r\n\r\n    if (this.isComplete(this.entity)) {\r\n      this._tx.pos = vec(this._end.x, this._end.y);\r\n      this._motion.vel = vec(0, 0);\r\n    }\r\n  }\r\n\r\n  public isComplete(entity: Entity): boolean {\r\n    const tx = entity.get(TransformComponent);\r\n    return this._stopped || new Vector(tx.pos.x, tx.pos.y).distance(this._start) >= this._distance;\r\n  }\r\n\r\n  public stop(): void {\r\n    this._motion.vel = vec(0, 0);\r\n    this._stopped = true;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._started = false;\r\n  }\r\n}\r\n","/**\r\n * An enum that describes the strategies that rotation actions can use\r\n */\r\nexport enum RotationType {\r\n  /**\r\n   * Rotation via `ShortestPath` will use the smallest angle\r\n   * between the starting and ending points. This strategy is the default behavior.\r\n   */\r\n  ShortestPath = 0,\r\n  /**\r\n   * Rotation via `LongestPath` will use the largest angle\r\n   * between the starting and ending points.\r\n   */\r\n  LongestPath = 1,\r\n  /**\r\n   * Rotation via `Clockwise` will travel in a clockwise direction,\r\n   * regardless of the starting and ending points.\r\n   */\r\n  Clockwise = 2,\r\n  /**\r\n   * Rotation via `CounterClockwise` will travel in a counterclockwise direction,\r\n   * regardless of the starting and ending points.\r\n   */\r\n  CounterClockwise = 3\r\n}\r\n","import { Action } from '../Action';\r\nimport { RotationType } from '../RotationType';\r\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\r\nimport { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\r\nimport { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { TwoPI } from '../../Math/util';\r\n\r\nexport class RotateTo implements Action {\r\n  private _tx: TransformComponent;\r\n  private _motion: MotionComponent;\r\n  public x: number;\r\n  public y: number;\r\n  private _start: number;\r\n  private _end: number;\r\n  private _speed: number;\r\n  private _rotationType: RotationType;\r\n  private _direction: number;\r\n  private _distance: number;\r\n  private _shortDistance: number;\r\n  private _longDistance: number;\r\n  private _shortestPathIsPositive: boolean;\r\n  private _currentNonCannonAngle: number;\r\n  private _started = false;\r\n  private _stopped = false;\r\n  constructor(entity: Entity, angleRadians: number, speed: number, rotationType?: RotationType) {\r\n    this._tx = entity.get(TransformComponent);\r\n    this._motion = entity.get(MotionComponent);\r\n    this._end = angleRadians;\r\n    this._speed = speed;\r\n    this._rotationType = rotationType || RotationType.ShortestPath;\r\n  }\r\n\r\n  public update(_delta: number): void {\r\n    if (!this._started) {\r\n      this._started = true;\r\n      this._start = this._tx.rotation;\r\n      this._currentNonCannonAngle = this._tx.rotation;\r\n      const distance1 = Math.abs(this._end - this._start);\r\n      const distance2 = TwoPI - distance1;\r\n      if (distance1 > distance2) {\r\n        this._shortDistance = distance2;\r\n        this._longDistance = distance1;\r\n      } else {\r\n        this._shortDistance = distance1;\r\n        this._longDistance = distance2;\r\n      }\r\n\r\n      this._shortestPathIsPositive = (this._start - this._end + TwoPI) % TwoPI >= Math.PI;\r\n\r\n      switch (this._rotationType) {\r\n        case RotationType.ShortestPath:\r\n          this._distance = this._shortDistance;\r\n          if (this._shortestPathIsPositive) {\r\n            this._direction = 1;\r\n          } else {\r\n            this._direction = -1;\r\n          }\r\n          break;\r\n        case RotationType.LongestPath:\r\n          this._distance = this._longDistance;\r\n          if (this._shortestPathIsPositive) {\r\n            this._direction = -1;\r\n          } else {\r\n            this._direction = 1;\r\n          }\r\n          break;\r\n        case RotationType.Clockwise:\r\n          this._direction = 1;\r\n          if (this._shortestPathIsPositive) {\r\n            this._distance = this._shortDistance;\r\n          } else {\r\n            this._distance = this._longDistance;\r\n          }\r\n          break;\r\n        case RotationType.CounterClockwise:\r\n          this._direction = -1;\r\n          if (!this._shortestPathIsPositive) {\r\n            this._distance = this._shortDistance;\r\n          } else {\r\n            this._distance = this._longDistance;\r\n          }\r\n          break;\r\n      }\r\n    }\r\n\r\n    this._motion.angularVelocity = this._direction * this._speed;\r\n    this._currentNonCannonAngle += this._direction * this._speed * (_delta / 1000);\r\n\r\n    if (this.isComplete()) {\r\n      this._tx.rotation = this._end;\r\n      this._motion.angularVelocity = 0;\r\n      this._stopped = true;\r\n    }\r\n  }\r\n\r\n  public isComplete(): boolean {\r\n    const distanceTravelled = Math.abs(this._currentNonCannonAngle - this._start);\r\n    return this._stopped || distanceTravelled >= Math.abs(this._distance);\r\n  }\r\n\r\n  public stop(): void {\r\n    this._motion.angularVelocity = 0;\r\n    this._stopped = true;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._started = false;\r\n  }\r\n}\r\n","import { Action } from '../Action';\r\nimport { RotationType } from '../RotationType';\r\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\r\nimport { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\r\nimport { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { TwoPI } from '../../Math/util';\r\n\r\nexport class RotateBy implements Action {\r\n  private _tx: TransformComponent;\r\n  private _motion: MotionComponent;\r\n  public x: number;\r\n  public y: number;\r\n  private _start: number;\r\n  private _end: number;\r\n  private _speed: number;\r\n  private _offset: number;\r\n\r\n  private _rotationType: RotationType;\r\n  private _direction: number;\r\n  private _distance: number;\r\n  private _shortDistance: number;\r\n  private _longDistance: number;\r\n  private _shortestPathIsPositive: boolean;\r\n  private _currentNonCannonAngle: number;\r\n  private _started = false;\r\n  private _stopped = false;\r\n  constructor(entity: Entity, angleRadiansOffset: number, speed: number, rotationType?: RotationType) {\r\n    this._tx = entity.get(TransformComponent);\r\n    this._motion = entity.get(MotionComponent);\r\n    this._speed = speed;\r\n    this._offset = angleRadiansOffset;\r\n    this._rotationType = rotationType || RotationType.ShortestPath;\r\n  }\r\n\r\n  public update(_delta: number): void {\r\n    if (!this._started) {\r\n      this._started = true;\r\n      this._start = this._tx.rotation;\r\n      this._currentNonCannonAngle = this._tx.rotation;\r\n      this._end = this._start + this._offset;\r\n\r\n      const distance1 = Math.abs(this._end - this._start);\r\n      const distance2 = TwoPI - distance1;\r\n      if (distance1 > distance2) {\r\n        this._shortDistance = distance2;\r\n        this._longDistance = distance1;\r\n      } else {\r\n        this._shortDistance = distance1;\r\n        this._longDistance = distance2;\r\n      }\r\n\r\n      this._shortestPathIsPositive = (this._start - this._end + TwoPI) % TwoPI >= Math.PI;\r\n\r\n      switch (this._rotationType) {\r\n        case RotationType.ShortestPath:\r\n          this._distance = this._shortDistance;\r\n          if (this._shortestPathIsPositive) {\r\n            this._direction = 1;\r\n          } else {\r\n            this._direction = -1;\r\n          }\r\n          break;\r\n        case RotationType.LongestPath:\r\n          this._distance = this._longDistance;\r\n          if (this._shortestPathIsPositive) {\r\n            this._direction = -1;\r\n          } else {\r\n            this._direction = 1;\r\n          }\r\n          break;\r\n        case RotationType.Clockwise:\r\n          this._direction = 1;\r\n          if (this._shortDistance >= 0) {\r\n            this._distance = this._shortDistance;\r\n          } else {\r\n            this._distance = this._longDistance;\r\n          }\r\n          break;\r\n        case RotationType.CounterClockwise:\r\n          this._direction = -1;\r\n          if (this._shortDistance <= 0) {\r\n            this._distance = this._shortDistance;\r\n          } else {\r\n            this._distance = this._longDistance;\r\n          }\r\n          break;\r\n      }\r\n    }\r\n\r\n    this._motion.angularVelocity = this._direction * this._speed;\r\n    this._currentNonCannonAngle += this._direction * this._speed * (_delta / 1000);\r\n\r\n    if (this.isComplete()) {\r\n      this._tx.rotation = this._end;\r\n      this._motion.angularVelocity = 0;\r\n      this._stopped = true;\r\n    }\r\n  }\r\n\r\n  public isComplete(): boolean {\r\n    const distanceTravelled = Math.abs(this._currentNonCannonAngle - this._start);\r\n    return this._stopped || distanceTravelled >= Math.abs(this._distance);\r\n  }\r\n\r\n  public stop(): void {\r\n    this._motion.angularVelocity = 0;\r\n    this._stopped = true;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._started = false;\r\n  }\r\n}\r\n","import { vec } from '../../Math/vector';\r\nimport { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\r\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\r\nimport { Action } from '../Action';\r\nimport { Entity } from '../../EntityComponentSystem/Entity';\r\n\r\nexport class ScaleTo implements Action {\r\n  private _tx: TransformComponent;\r\n  private _motion: MotionComponent;\r\n  public x: number;\r\n  public y: number;\r\n  private _startX: number;\r\n  private _startY: number;\r\n  private _endX: number;\r\n  private _endY: number;\r\n  private _speedX: number;\r\n  private _speedY: number;\r\n  private _distanceX: number;\r\n  private _distanceY: number;\r\n  private _started = false;\r\n  private _stopped = false;\r\n  constructor(entity: Entity, scaleX: number, scaleY: number, speedX: number, speedY: number) {\r\n    this._tx = entity.get(TransformComponent);\r\n    this._motion = entity.get(MotionComponent);\r\n    this._endX = scaleX;\r\n    this._endY = scaleY;\r\n    this._speedX = speedX;\r\n    this._speedY = speedY;\r\n  }\r\n\r\n  public update(_delta: number): void {\r\n    if (!this._started) {\r\n      this._started = true;\r\n      this._startX = this._tx.scale.x;\r\n      this._startY = this._tx.scale.y;\r\n      this._distanceX = Math.abs(this._endX - this._startX);\r\n      this._distanceY = Math.abs(this._endY - this._startY);\r\n    }\r\n\r\n    if (!(Math.abs(this._tx.scale.x - this._startX) >= this._distanceX)) {\r\n      const directionX = this._endY < this._startY ? -1 : 1;\r\n      this._motion.scaleFactor.x = this._speedX * directionX;\r\n    } else {\r\n      this._motion.scaleFactor.x = 0;\r\n    }\r\n\r\n    if (!(Math.abs(this._tx.scale.y - this._startY) >= this._distanceY)) {\r\n      const directionY = this._endY < this._startY ? -1 : 1;\r\n      this._motion.scaleFactor.y = this._speedY * directionY;\r\n    } else {\r\n      this._motion.scaleFactor.y = 0;\r\n    }\r\n\r\n    if (this.isComplete()) {\r\n      this._tx.scale = vec(this._endX, this._endY);\r\n      this._motion.scaleFactor.x = 0;\r\n      this._motion.scaleFactor.y = 0;\r\n    }\r\n  }\r\n\r\n  public isComplete(): boolean {\r\n    return (\r\n      this._stopped ||\r\n      (Math.abs(this._tx.scale.y - this._startX) >= this._distanceX && Math.abs(this._tx.scale.y - this._startY) >= this._distanceY)\r\n    );\r\n  }\r\n\r\n  public stop(): void {\r\n    this._motion.scaleFactor.x = 0;\r\n    this._motion.scaleFactor.y = 0;\r\n    this._stopped = true;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._started = false;\r\n  }\r\n}\r\n","import { Vector } from '../../Math/vector';\r\nimport { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\r\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\r\nimport { Action } from '../Action';\r\n\r\nexport class ScaleBy implements Action {\r\n  private _tx: TransformComponent;\r\n  private _motion: MotionComponent;\r\n  public x: number;\r\n  public y: number;\r\n  private _startScale: Vector;\r\n  private _endScale: Vector;\r\n  private _offset: Vector;\r\n  private _distanceX: number;\r\n  private _distanceY: number;\r\n  private _directionX: number;\r\n  private _directionY: number;\r\n  private _started = false;\r\n  private _stopped = false;\r\n  private _speedX: number;\r\n  private _speedY: number;\r\n  constructor(entity: Entity, scaleOffsetX: number, scaleOffsetY: number, speed: number) {\r\n    this._tx = entity.get(TransformComponent);\r\n    this._motion = entity.get(MotionComponent);\r\n    this._offset = new Vector(scaleOffsetX, scaleOffsetY);\r\n    this._speedX = this._speedY = speed;\r\n  }\r\n\r\n  public update(_delta: number): void {\r\n    if (!this._started) {\r\n      this._started = true;\r\n      this._startScale = this._tx.scale.clone();\r\n      this._endScale = this._startScale.add(this._offset);\r\n      this._distanceX = Math.abs(this._endScale.x - this._startScale.x);\r\n      this._distanceY = Math.abs(this._endScale.y - this._startScale.y);\r\n      this._directionX = this._endScale.x < this._startScale.x ? -1 : 1;\r\n      this._directionY = this._endScale.y < this._startScale.y ? -1 : 1;\r\n    }\r\n\r\n    this._motion.scaleFactor.x = this._speedX * this._directionX;\r\n    this._motion.scaleFactor.y = this._speedY * this._directionY;\r\n\r\n    if (this.isComplete()) {\r\n      this._tx.scale = this._endScale;\r\n      this._motion.scaleFactor.x = 0;\r\n      this._motion.scaleFactor.y = 0;\r\n    }\r\n  }\r\n\r\n  public isComplete(): boolean {\r\n    return (\r\n      this._stopped ||\r\n      (Math.abs(this._tx.scale.x - this._startScale.x) >= this._distanceX &&\r\n        Math.abs(this._tx.scale.y - this._startScale.y) >= this._distanceY)\r\n    );\r\n  }\r\n\r\n  public stop(): void {\r\n    this._motion.scaleFactor.x = 0;\r\n    this._motion.scaleFactor.y = 0;\r\n    this._stopped = true;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._started = false;\r\n  }\r\n}\r\n","import { Action } from '../Action';\r\n\r\nexport class CallMethod implements Action {\r\n  private _method: () => any = null;\r\n  private _hasBeenCalled: boolean = false;\r\n  constructor(method: () => any) {\r\n    this._method = method;\r\n  }\r\n\r\n  public update(_delta: number) {\r\n    this._method();\r\n    this._hasBeenCalled = true;\r\n  }\r\n  public isComplete() {\r\n    return this._hasBeenCalled;\r\n  }\r\n  public reset() {\r\n    this._hasBeenCalled = false;\r\n  }\r\n  public stop() {\r\n    this._hasBeenCalled = true;\r\n  }\r\n}\r\n","import { Entity} from '../../EntityComponentSystem/Entity';\r\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\r\nimport { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\r\nimport { Actor } from '../../Actor';\r\nimport { vec, Vector } from '../../Math/vector';\r\nimport { Action } from '../Action';\r\n\r\nexport class EaseTo implements Action {\r\n  private _tx: TransformComponent;\r\n  private _motion: MotionComponent;\r\n  private _currentLerpTime: number = 0;\r\n  private _lerpDuration: number = 1 * 1000; // 1 second\r\n  private _lerpStart: Vector = new Vector(0, 0);\r\n  private _lerpEnd: Vector = new Vector(0, 0);\r\n  private _initialized: boolean = false;\r\n  private _stopped: boolean = false;\r\n  private _distance: number = 0;\r\n  constructor(\r\n    entity: Entity,\r\n    x: number,\r\n    y: number,\r\n    duration: number,\r\n    public easingFcn: (currentTime: number, startValue: number, endValue: number, duration: number) => number\r\n  ) {\r\n    this._tx = entity.get(TransformComponent);\r\n    this._motion = entity.get(MotionComponent);\r\n    this._lerpDuration = duration;\r\n    this._lerpEnd = new Vector(x, y);\r\n  }\r\n  private _initialize() {\r\n    this._lerpStart = new Vector(this._tx.pos.x, this._tx.pos.y);\r\n    this._currentLerpTime = 0;\r\n    this._distance = this._lerpStart.distance(this._lerpEnd);\r\n  }\r\n\r\n  public update(delta: number): void {\r\n    if (!this._initialized) {\r\n      this._initialize();\r\n      this._initialized = true;\r\n    }\r\n\r\n    // Need to update lerp time first, otherwise the first update will always be zero\r\n    this._currentLerpTime += delta;\r\n    let newX = this._tx.pos.x;\r\n    let newY = this._tx.pos.y;\r\n    if (this._currentLerpTime < this._lerpDuration) {\r\n      if (this._lerpEnd.x < this._lerpStart.x) {\r\n        newX =\r\n          this._lerpStart.x -\r\n          (this.easingFcn(this._currentLerpTime, this._lerpEnd.x, this._lerpStart.x, this._lerpDuration) - this._lerpEnd.x);\r\n      } else {\r\n        newX = this.easingFcn(this._currentLerpTime, this._lerpStart.x, this._lerpEnd.x, this._lerpDuration);\r\n      }\r\n\r\n      if (this._lerpEnd.y < this._lerpStart.y) {\r\n        newY =\r\n          this._lerpStart.y -\r\n          (this.easingFcn(this._currentLerpTime, this._lerpEnd.y, this._lerpStart.y, this._lerpDuration) - this._lerpEnd.y);\r\n      } else {\r\n        newY = this.easingFcn(this._currentLerpTime, this._lerpStart.y, this._lerpEnd.y, this._lerpDuration);\r\n      }\r\n      // Given the lerp position figure out the velocity in pixels per second\r\n      this._motion.vel = vec((newX - this._tx.pos.x) / (delta / 1000), (newY - this._tx.pos.y) / (delta / 1000));\r\n    } else {\r\n      this._tx.pos = vec(this._lerpEnd.x, this._lerpEnd.y);\r\n      this._motion.vel = Vector.Zero;\r\n    }\r\n  }\r\n  public isComplete(actor: Actor): boolean {\r\n    return this._stopped || new Vector(actor.pos.x, actor.pos.y).distance(this._lerpStart) >= this._distance;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._initialized = false;\r\n  }\r\n  public stop(): void {\r\n    this._motion.vel = vec(0, 0);\r\n    this._stopped = true;\r\n  }\r\n}\r\n","import { GraphicsComponent } from '../../Graphics/GraphicsComponent';\r\nimport { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { Action } from '../Action';\r\n\r\nexport class Blink implements Action {\r\n  private _graphics: GraphicsComponent;\r\n  private _timeVisible: number = 0;\r\n  private _timeNotVisible: number = 0;\r\n  private _elapsedTime: number = 0;\r\n  private _totalTime: number = 0;\r\n  private _duration: number;\r\n  private _stopped: boolean = false;\r\n  private _started: boolean = false;\r\n  constructor(entity: Entity, timeVisible: number, timeNotVisible: number, numBlinks: number = 1) {\r\n    this._graphics = entity.get(GraphicsComponent);\r\n    this._timeVisible = timeVisible;\r\n    this._timeNotVisible = timeNotVisible;\r\n    this._duration = (timeVisible + timeNotVisible) * numBlinks;\r\n  }\r\n\r\n  public update(delta: number): void {\r\n    if (!this._started) {\r\n      this._started = true;\r\n    }\r\n    if (!this._graphics) {\r\n      return;\r\n    }\r\n\r\n    this._elapsedTime += delta;\r\n    this._totalTime += delta;\r\n    if (this._graphics.visible && this._elapsedTime >= this._timeVisible) {\r\n      this._graphics.visible = false;\r\n      this._elapsedTime = 0;\r\n    }\r\n\r\n    if (!this._graphics.visible && this._elapsedTime >= this._timeNotVisible) {\r\n      this._graphics.visible = true;\r\n      this._elapsedTime = 0;\r\n    }\r\n\r\n    if (this.isComplete()) {\r\n      this._graphics.visible = true;\r\n    }\r\n  }\r\n\r\n  public isComplete(): boolean {\r\n    return this._stopped || this._totalTime >= this._duration;\r\n  }\r\n\r\n  public stop(): void {\r\n    if (this._graphics) {\r\n      this._graphics.visible = true;\r\n    }\r\n    this._stopped = true;\r\n  }\r\n\r\n  public reset() {\r\n    this._started = false;\r\n    this._elapsedTime = 0;\r\n    this._totalTime = 0;\r\n  }\r\n}\r\n","import { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { GraphicsComponent } from '../../Graphics/GraphicsComponent';\r\nimport { Logger } from '../../Util/Log';\r\nimport { Action } from '../Action';\r\n\r\nexport class Fade implements Action {\r\n  private _graphics: GraphicsComponent;\r\n  public x: number;\r\n  public y: number;\r\n\r\n  private _endOpacity: number;\r\n  private _speed: number;\r\n  private _multiplier: number = 1;\r\n  private _started = false;\r\n  private _stopped = false;\r\n\r\n  constructor(entity: Entity, endOpacity: number, speed: number) {\r\n    this._graphics = entity.get(GraphicsComponent);\r\n    this._endOpacity = endOpacity;\r\n    this._speed = speed;\r\n  }\r\n\r\n  public update(delta: number): void {\r\n    if (!this._graphics) {\r\n      return;\r\n    }\r\n\r\n    if (!this._started) {\r\n      this._started = true;\r\n\r\n      // determine direction when we start\r\n      if (this._endOpacity < this._graphics.opacity) {\r\n        this._multiplier = -1;\r\n      } else {\r\n        this._multiplier = 1;\r\n      }\r\n    }\r\n\r\n    if (this._speed > 0) {\r\n      this._graphics.opacity += (this._multiplier *\r\n        (Math.abs(this._graphics.opacity - this._endOpacity) * delta)) / this._speed;\r\n    }\r\n\r\n    this._speed -= delta;\r\n\r\n    if (this.isComplete()) {\r\n      this._graphics.opacity = this._endOpacity;\r\n    }\r\n\r\n    Logger.getInstance().debug('[Action fade] Actor opacity:', this._graphics.opacity);\r\n  }\r\n\r\n  public isComplete(): boolean {\r\n    return this._stopped || Math.abs(this._graphics.opacity - this._endOpacity) < 0.05;\r\n  }\r\n\r\n  public stop(): void {\r\n    this._stopped = true;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._started = false;\r\n  }\r\n}\r\n","import { Action } from '../Action';\r\n\r\nexport class Delay implements Action {\r\n  private _elapsedTime: number = 0;\r\n  private _delay: number;\r\n  private _started: boolean = false;\r\n  private _stopped = false;\r\n  constructor(delay: number) {\r\n    this._delay = delay;\r\n  }\r\n\r\n  public update(delta: number): void {\r\n    if (!this._started) {\r\n      this._started = true;\r\n    }\r\n\r\n    this._elapsedTime += delta;\r\n  }\r\n\r\n  isComplete(): boolean {\r\n    return this._stopped || this._elapsedTime >= this._delay;\r\n  }\r\n\r\n  public stop(): void {\r\n    this._stopped = true;\r\n  }\r\n\r\n  reset(): void {\r\n    this._elapsedTime = 0;\r\n    this._started = false;\r\n  }\r\n}\r\n","import { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { Action } from '../Action';\r\nimport { ActionsComponent } from '../ActionsComponent';\r\n\r\nexport class Die implements Action {\r\n  private _entity: Entity;\r\n  private _stopped = false;\r\n\r\n  constructor(entity: Entity) {\r\n    this._entity = entity;\r\n  }\r\n\r\n  public update(_delta: number): void {\r\n    this._entity.get(ActionsComponent).clearActions();\r\n    this._entity.kill();\r\n    this._stopped = true;\r\n  }\r\n\r\n  public isComplete(): boolean {\r\n    return this._stopped;\r\n  }\r\n\r\n  public stop(): void {\r\n    return;\r\n  }\r\n\r\n  public reset(): void {\r\n    return;\r\n  }\r\n}\r\n","import { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\r\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\r\nimport { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { vec, Vector } from '../../Math/vector';\r\nimport { Action } from '../Action';\r\n\r\nexport class Follow implements Action {\r\n  private _tx: TransformComponent;\r\n  private _motion: MotionComponent;\r\n  private _followTx: TransformComponent;\r\n  private _followMotion: MotionComponent;\r\n\r\n  public x: number;\r\n  public y: number;\r\n  private _current: Vector;\r\n  private _end: Vector;\r\n  private _dir: Vector;\r\n  private _speed: number;\r\n  private _maximumDistance: number;\r\n  private _distanceBetween: number;\r\n  private _started = false;\r\n  private _stopped = false;\r\n\r\n  constructor(entity: Entity, entityToFollow: Entity, followDistance?: number) {\r\n    this._tx = entity.get(TransformComponent);\r\n    this._motion = entity.get(MotionComponent);\r\n    this._followTx = entityToFollow.get(TransformComponent);\r\n    this._followMotion = entityToFollow.get(MotionComponent);\r\n    this._current = new Vector(this._tx.pos.x, this._tx.pos.y);\r\n    this._end = new Vector(this._followTx.pos.x, this._followTx.pos.y);\r\n    this._maximumDistance = followDistance !== undefined ? followDistance : this._current.distance(this._end);\r\n    this._speed = 0;\r\n  }\r\n\r\n  public update(_delta: number): void {\r\n    if (!this._started) {\r\n      this._started = true;\r\n      this._distanceBetween = this._current.distance(this._end);\r\n      this._dir = this._end.sub(this._current).normalize();\r\n    }\r\n\r\n    const actorToFollowSpeed = Math.sqrt(Math.pow(this._followMotion.vel.x, 2) + Math.pow(this._followMotion.vel.y, 2));\r\n    if (actorToFollowSpeed !== 0) {\r\n      this._speed = actorToFollowSpeed;\r\n    }\r\n    this._current = vec(this._tx.pos.x, this._tx.pos.y);\r\n\r\n    this._end = vec(this._followTx.pos.x, this._followTx.pos.y);\r\n    this._distanceBetween = this._current.distance(this._end);\r\n    this._dir = this._end.sub(this._current).normalize();\r\n\r\n    if (this._distanceBetween >= this._maximumDistance) {\r\n      const m = this._dir.scale(this._speed);\r\n      this._motion.vel = vec(m.x, m.y);\r\n    } else {\r\n      this._motion.vel = vec(0, 0);\r\n    }\r\n\r\n    if (this.isComplete()) {\r\n      this._tx.pos = vec(this._end.x, this._end.y);\r\n      this._motion.vel = vec(0, 0);\r\n    }\r\n  }\r\n\r\n  public stop(): void {\r\n    this._motion.vel = vec(0, 0);\r\n    this._stopped = true;\r\n  }\r\n\r\n  public isComplete(): boolean {\r\n    // the actor following should never stop unless specified to do so\r\n    return this._stopped;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._started = false;\r\n  }\r\n}\r\n","import { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\r\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\r\nimport { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { Vector, vec } from '../../Math/vector';\r\nimport { Action } from '../Action';\r\n\r\nexport class Meet implements Action {\r\n  private _tx: TransformComponent;\r\n  private _motion: MotionComponent;\r\n  private _meetTx: TransformComponent;\r\n  private _meetMotion: MotionComponent;\r\n  public x: number;\r\n  public y: number;\r\n  private _current: Vector;\r\n  private _end: Vector;\r\n  private _dir: Vector;\r\n  private _speed: number;\r\n  private _distanceBetween: number;\r\n  private _started = false;\r\n  private _stopped = false;\r\n  private _speedWasSpecified = false;\r\n\r\n  constructor(actor: Entity, actorToMeet: Entity, speed?: number) {\r\n    this._tx = actor.get(TransformComponent);\r\n    this._motion = actor.get(MotionComponent);\r\n    this._meetTx = actorToMeet.get(TransformComponent);\r\n    this._meetMotion = actorToMeet.get(MotionComponent);\r\n    this._current = new Vector(this._tx.pos.x, this._tx.pos.y);\r\n    this._end = new Vector(this._meetTx.pos.x, this._meetTx.pos.y);\r\n    this._speed = speed || 0;\r\n\r\n    if (speed !== undefined) {\r\n      this._speedWasSpecified = true;\r\n    }\r\n  }\r\n\r\n  public update(_delta: number): void {\r\n    if (!this._started) {\r\n      this._started = true;\r\n      this._distanceBetween = this._current.distance(this._end);\r\n      this._dir = this._end.sub(this._current).normalize();\r\n    }\r\n\r\n    const actorToMeetSpeed = Math.sqrt(Math.pow(this._meetMotion.vel.x, 2) + Math.pow(this._meetMotion.vel.y, 2));\r\n    if (actorToMeetSpeed !== 0 && !this._speedWasSpecified) {\r\n      this._speed = actorToMeetSpeed;\r\n    }\r\n    this._current = vec(this._tx.pos.x, this._tx.pos.y);\r\n\r\n    this._end = vec(this._meetTx.pos.x, this._meetTx.pos.y);\r\n    this._distanceBetween = this._current.distance(this._end);\r\n    this._dir = this._end.sub(this._current).normalize();\r\n\r\n    const m = this._dir.scale(this._speed);\r\n    this._motion.vel = vec(m.x, m.y);\r\n\r\n    if (this.isComplete()) {\r\n      this._tx.pos = vec(this._end.x, this._end.y);\r\n      this._motion.vel = vec(0, 0);\r\n    }\r\n  }\r\n\r\n  public isComplete(): boolean {\r\n    return this._stopped || this._distanceBetween <= 1;\r\n  }\r\n\r\n  public stop(): void {\r\n    this._motion.vel = vec(0, 0);\r\n    this._stopped = true;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._started = false;\r\n  }\r\n}\r\n","import { RotationType } from './RotationType';\r\n\r\nimport { EasingFunction, EasingFunctions } from '../Util/EasingFunctions';\r\nimport { ActionQueue } from './ActionQueue';\r\nimport { Repeat } from './Action/Repeat';\r\nimport { RepeatForever } from './Action/RepeatForever';\r\nimport { MoveBy } from './Action/MoveBy';\r\nimport { MoveTo } from './Action/MoveTo';\r\nimport { RotateTo } from './Action/RotateTo';\r\nimport { RotateBy } from './Action/RotateBy';\r\nimport { ScaleTo } from './Action/ScaleTo';\r\nimport { ScaleBy } from './Action/ScaleBy';\r\nimport { CallMethod } from './Action/CallMethod';\r\nimport { EaseTo } from './Action/EaseTo';\r\nimport { Blink } from './Action/Blink';\r\nimport { Fade } from './Action/Fade';\r\nimport { Delay } from './Action/Delay';\r\nimport { Die } from './Action/Die';\r\nimport { Follow } from './Action/Follow';\r\nimport { Meet } from './Action/Meet';\r\nimport { Vector } from '../Math/vector';\r\nimport { Entity } from '../EntityComponentSystem/Entity';\r\n\r\n/**\r\n * The fluent Action API allows you to perform \"actions\" on\r\n * [[Actor|Actors]] such as following, moving, rotating, and\r\n * more. You can implement your own actions by implementing\r\n * the [[Action]] interface.\r\n */\r\nexport class ActionContext {\r\n  private _entity: Entity;\r\n  private _queue: ActionQueue;\r\n\r\n  constructor(entity: Entity) {\r\n    this._entity = entity;\r\n    this._queue = new ActionQueue(entity);\r\n  }\r\n\r\n  public getQueue(): ActionQueue {\r\n    return this._queue;\r\n  }\r\n\r\n  public update(elapsedMs: number) {\r\n    this._queue.update(elapsedMs);\r\n  }\r\n\r\n  /**\r\n   * Clears all queued actions from the Actor\r\n   */\r\n  public clearActions(): void {\r\n    this._queue.clearActions();\r\n  }\r\n\r\n  /**\r\n   * This method will move an actor to the specified `x` and `y` position over the\r\n   * specified duration using a given [[EasingFunctions]] and return back the actor. This\r\n   * method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param pos       The x,y vector location to move the actor to\r\n   * @param duration  The time it should take the actor to move to the new location in milliseconds\r\n   * @param easingFcn Use [[EasingFunctions]] or a custom function to use to calculate position, Default is [[EasingFunctions.Linear]]\r\n   */\r\n  public easeTo(pos: Vector, duration: number, easingFcn?: EasingFunction): ActionContext\r\n  /**\r\n   * This method will move an actor to the specified `x` and `y` position over the\r\n   * specified duration using a given [[EasingFunctions]] and return back the actor. This\r\n   * method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param x         The x location to move the actor to\r\n   * @param y         The y location to move the actor to\r\n   * @param duration  The time it should take the actor to move to the new location in milliseconds\r\n   * @param easingFcn Use [[EasingFunctions]] or a custom function to use to calculate position, Default is [[EasingFunctions.Linear]]\r\n   */\r\n  public easeTo(x: number, y: number, duration: number, easingFcn?: EasingFunction): ActionContext\r\n  public easeTo(...args: any[]): ActionContext {\r\n    let x = 0;\r\n    let y = 0;\r\n    let duration = 0;\r\n    let easingFcn = EasingFunctions.Linear;\r\n    if (args[0] instanceof Vector) {\r\n      x = args[0].x;\r\n      y = args[0].y;\r\n      duration = args[1];\r\n      easingFcn = args[2] ?? easingFcn;\r\n    } else {\r\n      x = args[0];\r\n      y = args[1];\r\n      duration = args[2];\r\n      easingFcn = args[3] ?? easingFcn;\r\n    }\r\n\r\n    this._queue.add(new EaseTo(this._entity, x, y, duration, easingFcn));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will move an actor to the specified x and y position at the\r\n   * speed specified (in pixels per second) and return back the actor. This\r\n   * method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param pos    The x,y vector location to move the actor to\r\n   * @param speed  The speed in pixels per second to move\r\n   */\r\n  public moveTo(pos: Vector, speed: number): ActionContext;\r\n  /**\r\n   * This method will move an actor to the specified x and y position at the\r\n   * speed specified (in pixels per second) and return back the actor. This\r\n   * method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param x      The x location to move the actor to\r\n   * @param y      The y location to move the actor to\r\n   * @param speed  The speed in pixels per second to move\r\n   */\r\n  public moveTo(x: number, y: number, speed: number): ActionContext;\r\n  public moveTo(xOrPos: number | Vector, yOrSpeed: number, speedOrUndefined?: number | undefined): ActionContext {\r\n    let x = 0;\r\n    let y = 0;\r\n    let speed = 0;\r\n    if (xOrPos instanceof Vector) {\r\n      x = xOrPos.x;\r\n      y = xOrPos.y;\r\n      speed = yOrSpeed;\r\n    } else {\r\n      x = xOrPos;\r\n      y = yOrSpeed;\r\n      speed = speedOrUndefined;\r\n    }\r\n    this._queue.add(new MoveTo(this._entity, x, y, speed));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will move an actor by the specified x offset and y offset from its current position, at a certain speed.\r\n   * This method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param xOffset     The x offset to apply to this actor\r\n   * @param yOffset     The y location to move the actor to\r\n   * @param speed  The speed in pixels per second the actor should move\r\n   */\r\n  public moveBy(offset: Vector, speed: number): ActionContext;\r\n  public moveBy(xOffset: number, yOffset: number, speed: number): ActionContext;\r\n  public moveBy(xOffsetOrVector: number | Vector, yOffsetOrSpeed: number, speedOrUndefined?: number | undefined): ActionContext {\r\n    let xOffset = 0;\r\n    let yOffset = 0;\r\n    let speed = 0;\r\n    if (xOffsetOrVector instanceof Vector) {\r\n      xOffset = xOffsetOrVector.x;\r\n      yOffset = xOffsetOrVector.y;\r\n      speed = yOffsetOrSpeed;\r\n    } else {\r\n      xOffset = xOffsetOrVector;\r\n      yOffset = yOffsetOrSpeed;\r\n      speed = speedOrUndefined;\r\n    }\r\n    this._queue.add(new MoveBy(this._entity, xOffset, yOffset, speed));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will rotate an actor to the specified angle at the speed\r\n   * specified (in radians per second) and return back the actor. This\r\n   * method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param angleRadians  The angle to rotate to in radians\r\n   * @param speed         The angular velocity of the rotation specified in radians per second\r\n   * @param rotationType  The [[RotationType]] to use for this rotation\r\n   */\r\n  public rotateTo(angleRadians: number, speed: number, rotationType?: RotationType): ActionContext {\r\n    this._queue.add(new RotateTo(this._entity, angleRadians, speed, rotationType));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will rotate an actor by the specified angle offset, from it's current rotation given a certain speed\r\n   * in radians/sec and return back the actor. This method is part\r\n   * of the actor 'Action' fluent API allowing action chaining.\r\n   * @param angleRadiansOffset  The angle to rotate to in radians relative to the current rotation\r\n   * @param speed          The speed in radians/sec the actor should rotate at\r\n   * @param rotationType  The [[RotationType]] to use for this rotation, default is shortest path\r\n   */\r\n  public rotateBy(angleRadiansOffset: number, speed: number, rotationType?: RotationType): ActionContext {\r\n    this._queue.add(new RotateBy(this._entity, angleRadiansOffset, speed, rotationType));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will scale an actor to the specified size at the speed\r\n   * specified (in magnitude increase per second) and return back the\r\n   * actor. This method is part of the actor 'Action' fluent API allowing\r\n   * action chaining.\r\n   * @param size    The scale to adjust the actor to over time\r\n   * @param speed   The speed of scaling specified in magnitude increase per second\r\n   */\r\n  public scaleTo(size: Vector, speed: Vector): ActionContext;\r\n  /**\r\n   * This method will scale an actor to the specified size at the speed\r\n   * specified (in magnitude increase per second) and return back the\r\n   * actor. This method is part of the actor 'Action' fluent API allowing\r\n   * action chaining.\r\n   * @param sizeX   The scaling factor to apply on X axis\r\n   * @param sizeY   The scaling factor to apply on Y axis\r\n   * @param speedX  The speed of scaling specified in magnitude increase per second on X axis\r\n   * @param speedY  The speed of scaling specified in magnitude increase per second on Y axis\r\n   */\r\n  public scaleTo(sizeX: number, sizeY: number, speedX: number, speedY: number): ActionContext;\r\n  public scaleTo(sizeXOrVector: number | Vector,\r\n    sizeYOrSpeed: number | Vector,\r\n    speedXOrUndefined?: number | undefined,\r\n    speedYOrUndefined?: number | undefined): ActionContext {\r\n\r\n    let sizeX = 1;\r\n    let sizeY = 1;\r\n    let speedX = 0;\r\n    let speedY = 0;\r\n\r\n    if (sizeXOrVector instanceof Vector && sizeYOrSpeed instanceof Vector) {\r\n      sizeX = sizeXOrVector.x;\r\n      sizeY = sizeXOrVector.y;\r\n\r\n      speedX = sizeYOrSpeed.x;\r\n      speedY = sizeYOrSpeed.y;\r\n    }\r\n    if (typeof sizeXOrVector === 'number' && typeof sizeYOrSpeed === 'number') {\r\n      sizeX = sizeXOrVector;\r\n      sizeY = sizeYOrSpeed;\r\n\r\n      speedX = speedXOrUndefined;\r\n      speedY = speedYOrUndefined;\r\n    }\r\n\r\n    this._queue.add(new ScaleTo(this._entity, sizeX, sizeY, speedX, speedY));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will scale an actor by an amount relative to the current scale at a certain speed in scale units/sec\r\n   * and return back the actor. This method is part of the\r\n   * actor 'Action' fluent API allowing action chaining.\r\n   * @param offset   The scaling factor to apply to the actor\r\n   * @param speed    The speed to scale at in scale units/sec\r\n   */\r\n  public scaleBy(offset: Vector, speed: number): ActionContext;\r\n  /**\r\n   * This method will scale an actor by an amount relative to the current scale at a certain speed in scale units/sec\r\n   * and return back the actor. This method is part of the\r\n   * actor 'Action' fluent API allowing action chaining.\r\n   * @param sizeOffsetX   The scaling factor to apply on X axis\r\n   * @param sizeOffsetY   The scaling factor to apply on Y axis\r\n   * @param speed    The speed to scale at in scale units/sec\r\n   */\r\n  public scaleBy(sizeOffsetX: number, sizeOffsetY: number, speed: number): ActionContext;\r\n  public scaleBy(sizeOffsetXOrVector: number | Vector, sizeOffsetYOrSpeed: number, speed?: number | undefined): ActionContext {\r\n    let sizeOffsetX = 1;\r\n    let sizeOffsetY = 1;\r\n\r\n    if (sizeOffsetXOrVector instanceof Vector) {\r\n      sizeOffsetX = sizeOffsetXOrVector.x;\r\n      sizeOffsetY = sizeOffsetXOrVector.y;\r\n\r\n      speed = sizeOffsetYOrSpeed;\r\n    }\r\n    if (typeof sizeOffsetXOrVector === 'number' && typeof sizeOffsetYOrSpeed === 'number') {\r\n      sizeOffsetX = sizeOffsetXOrVector;\r\n      sizeOffsetY = sizeOffsetYOrSpeed;\r\n    }\r\n\r\n    this._queue.add(new ScaleBy(this._entity, sizeOffsetX, sizeOffsetY, speed));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will cause an actor to blink (become visible and not\r\n   * visible). Optionally, you may specify the number of blinks. Specify the amount of time\r\n   * the actor should be visible per blink, and the amount of time not visible.\r\n   * This method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param timeVisible     The amount of time to stay visible per blink in milliseconds\r\n   * @param timeNotVisible  The amount of time to stay not visible per blink in milliseconds\r\n   * @param numBlinks       The number of times to blink\r\n   */\r\n  public blink(timeVisible: number, timeNotVisible: number, numBlinks: number = 1): ActionContext {\r\n    this._queue.add(new Blink(this._entity, timeVisible, timeNotVisible, numBlinks));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will cause an actor's opacity to change from its current value\r\n   * to the provided value by a specified time (in milliseconds). This method is\r\n   * part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param opacity  The ending opacity\r\n   * @param time     The time it should take to fade the actor (in milliseconds)\r\n   */\r\n  public fade(opacity: number, time: number): ActionContext {\r\n    this._queue.add(new Fade(this._entity, opacity, time));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will delay the next action from executing for a certain\r\n   * amount of time (in milliseconds). This method is part of the actor\r\n   * 'Action' fluent API allowing action chaining.\r\n   * @param time  The amount of time to delay the next action in the queue from executing in milliseconds\r\n   */\r\n  public delay(time: number): ActionContext {\r\n    this._queue.add(new Delay(time));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will add an action to the queue that will remove the actor from the\r\n   * scene once it has completed its previous  Any actions on the\r\n   * action queue after this action will not be executed.\r\n   */\r\n  public die(): ActionContext {\r\n    this._queue.add(new Die(this._entity));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method allows you to call an arbitrary method as the next action in the\r\n   * action queue. This is useful if you want to execute code in after a specific\r\n   * action, i.e An actor arrives at a destination after traversing a path\r\n   */\r\n  public callMethod(method: () => any): ActionContext {\r\n    this._queue.add(new CallMethod(method));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will cause the actor to repeat all of the actions built in\r\n   * the `repeatBuilder` callback. If the number of repeats\r\n   * is not specified it will repeat forever. This method is part of\r\n   * the actor 'Action' fluent API allowing action chaining\r\n   *\r\n   * ```typescript\r\n   * // Move up in a zig-zag by repeated moveBy's\r\n   * actor.actions.repeat(repeatCtx => {\r\n   *  repeatCtx.moveBy(10, 0, 10);\r\n   *  repeatCtx.moveBy(0, 10, 10);\r\n   * }, 5);\r\n   * ```\r\n   *\r\n   * @param repeatBuilder The builder to specify the repeatable list of actions\r\n   * @param times  The number of times to repeat all the previous actions in the action queue. If nothing is specified the actions\r\n   * will repeat forever\r\n   */\r\n  public repeat(repeatBuilder: (repeatContext: ActionContext) => any, times?: number): ActionContext {\r\n    if (!times) {\r\n      this.repeatForever(repeatBuilder);\r\n      return this;\r\n    }\r\n    this._queue.add(new Repeat(this._entity, repeatBuilder, times));\r\n\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will cause the actor to repeat all of the actions built in\r\n   * the `repeatBuilder` callback. If the number of repeats\r\n   * is not specified it will repeat forever. This method is part of\r\n   * the actor 'Action' fluent API allowing action chaining\r\n   *\r\n   * ```typescript\r\n   * // Move up in a zig-zag by repeated moveBy's\r\n   * actor.actions.repeat(repeatCtx => {\r\n   *  repeatCtx.moveBy(10, 0, 10);\r\n   *  repeatCtx.moveBy(0, 10, 10);\r\n   * }, 5);\r\n   * ```\r\n   *\r\n   * @param repeatBuilder The builder to specify the repeatable list of actions\r\n   */\r\n  public repeatForever(repeatBuilder: (repeatContext: ActionContext) => any): ActionContext {\r\n    this._queue.add(new RepeatForever(this._entity, repeatBuilder));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will cause the entity to follow another at a specified distance\r\n   * @param entity           The entity to follow\r\n   * @param followDistance  The distance to maintain when following, if not specified the actor will follow at the current distance.\r\n   */\r\n  public follow(entity: Entity, followDistance?: number): ActionContext {\r\n    if (followDistance === undefined) {\r\n      this._queue.add(new Follow(this._entity, entity));\r\n    } else {\r\n      this._queue.add(new Follow(this._entity, entity, followDistance));\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will cause the entity to move towards another until they\r\n   * collide \"meet\" at a specified speed.\r\n   * @param entity  The entity to meet\r\n   * @param speed  The speed in pixels per second to move, if not specified it will match the speed of the other actor\r\n   */\r\n  public meet(entity: Entity, speed?: number): ActionContext {\r\n    if (speed === undefined) {\r\n      this._queue.add(new Meet(this._entity, entity));\r\n    } else {\r\n      this._queue.add(new Meet(this._entity, entity, speed));\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Returns a promise that resolves when the current action queue up to now\r\n   * is finished.\r\n   * @deprecated Use `toPromise()` will be removed in v0.26.0\r\n   */\r\n  public asPromise(): Promise<void> {\r\n    return this.toPromise();\r\n  }\r\n\r\n  /**\r\n   * Returns a promise that resolves when the current action queue up to now\r\n   * is finished.\r\n   */\r\n  public toPromise(): Promise<void> {\r\n    const temp = new Promise<void>((resolve) => {\r\n      this._queue.add(\r\n        new CallMethod(() => {\r\n          resolve();\r\n        })\r\n      );\r\n    });\r\n    return temp;\r\n  }\r\n}\r\n","import { ActionContext } from './ActionContext';\r\nimport { Component } from '../EntityComponentSystem/Component';\r\nimport { Entity } from '../EntityComponentSystem/Entity';\r\nimport { Actor } from '../Actor';\r\nimport { MotionComponent } from '../EntityComponentSystem/Components/MotionComponent';\r\nimport { TransformComponent } from '../EntityComponentSystem/Components/TransformComponent';\r\nimport { Vector } from '../Math/vector';\r\nimport { EasingFunction } from '../Util/EasingFunctions';\r\nimport { ActionQueue } from './ActionQueue';\r\nimport { RotationType } from './RotationType';\r\n\r\nexport interface ActionContextMethods extends Pick<ActionContext, keyof ActionContext> { };\r\n\r\nexport class ActionsComponent extends Component<'ex.actions'> implements ActionContextMethods {\r\n  public readonly type = 'ex.actions';\r\n  dependencies = [TransformComponent, MotionComponent];\r\n  private _ctx: ActionContext;\r\n\r\n  onAdd(entity: Entity) {\r\n    this._ctx = new ActionContext(entity);\r\n  }\r\n\r\n  onRemove() {\r\n    this._ctx = null;\r\n  }\r\n\r\n  /**\r\n   * Returns the internal action queue\r\n   * @returns action queue\r\n   */\r\n  public getQueue(): ActionQueue {\r\n    return this._ctx?.getQueue();\r\n  }\r\n\r\n  /**\r\n   * Updates the internal action context, performing action and moving through the internal queue\r\n   * @param elapsedMs\r\n   */\r\n  public update(elapsedMs: number): void {\r\n    return this._ctx?.update(elapsedMs);\r\n  }\r\n\r\n  /**\r\n   * Clears all queued actions from the Actor\r\n   */\r\n  public clearActions(): void {\r\n    this._ctx?.clearActions();\r\n  }\r\n\r\n  /**\r\n   * This method will move an actor to the specified `x` and `y` position over the\r\n   * specified duration using a given [[EasingFunctions]] and return back the actor. This\r\n   * method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param pos       The x,y vector location to move the actor to\r\n   * @param duration  The time it should take the actor to move to the new location in milliseconds\r\n   * @param easingFcn Use [[EasingFunctions]] or a custom function to use to calculate position, Default is [[EasingFunctions.Linear]]\r\n   */\r\n  public easeTo(pos: Vector, duration: number, easingFcn?: EasingFunction): ActionContext;\r\n  /**\r\n   * This method will move an actor to the specified `x` and `y` position over the\r\n   * specified duration using a given [[EasingFunctions]] and return back the actor. This\r\n   * method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param x         The x location to move the actor to\r\n   * @param y         The y location to move the actor to\r\n   * @param duration  The time it should take the actor to move to the new location in milliseconds\r\n   * @param easingFcn Use [[EasingFunctions]] or a custom function to use to calculate position, Default is [[EasingFunctions.Linear]]\r\n   */\r\n  public easeTo(x: number, y: number, duration: number, easingFcn?: EasingFunction): ActionContext;\r\n  public easeTo(...args: any[]): ActionContext {\r\n    return this._ctx.easeTo.apply(this._ctx, args);\r\n  }\r\n\r\n  /**\r\n   * This method will move an actor to the specified x and y position at the\r\n   * speed specified (in pixels per second) and return back the actor. This\r\n   * method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param pos    The x,y vector location to move the actor to\r\n   * @param speed  The speed in pixels per second to move\r\n   */\r\n  public moveTo(pos: Vector, speed: number): ActionContext;\r\n  /**\r\n   * This method will move an actor to the specified x and y position at the\r\n   * speed specified (in pixels per second) and return back the actor. This\r\n   * method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param x      The x location to move the actor to\r\n   * @param y      The y location to move the actor to\r\n   * @param speed  The speed in pixels per second to move\r\n   */\r\n  public moveTo(x: number, y: number, speed: number): ActionContext;\r\n  public moveTo(xOrPos: number | Vector, yOrSpeed: number, speedOrUndefined?: number): ActionContext {\r\n    return this._ctx.moveTo.apply(this._ctx, [xOrPos, yOrSpeed, speedOrUndefined]);\r\n  }\r\n\r\n  /**\r\n   * This method will move an actor by the specified x offset and y offset from its current position, at a certain speed.\r\n   * This method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param offset The (x, y) offset to apply to this actor\r\n   * @param speed  The speed in pixels per second the actor should move\r\n   */\r\n  public moveBy(offset: Vector, speed: number): ActionContext;\r\n  /**\r\n   * This method will move an actor by the specified x offset and y offset from its current position, at a certain speed.\r\n   * This method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param xOffset     The x offset to apply to this actor\r\n   * @param yOffset     The y location to move the actor to\r\n   * @param speed  The speed in pixels per second the actor should move\r\n   */\r\n  public moveBy(xOffset: number, yOffset: number, speed: number): ActionContext;\r\n  public moveBy(xOffsetOrVector: number | Vector, yOffsetOrSpeed: number, speedOrUndefined?: number): ActionContext {\r\n    return this._ctx.moveBy.apply(this._ctx, [xOffsetOrVector, yOffsetOrSpeed, speedOrUndefined]);\r\n  }\r\n\r\n  /**\r\n   * This method will rotate an actor to the specified angle at the speed\r\n   * specified (in radians per second) and return back the actor. This\r\n   * method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param angleRadians  The angle to rotate to in radians\r\n   * @param speed         The angular velocity of the rotation specified in radians per second\r\n   * @param rotationType  The [[RotationType]] to use for this rotation\r\n   */\r\n  public rotateTo(angleRadians: number, speed: number, rotationType?: RotationType): ActionContext {\r\n    return this._ctx.rotateTo(angleRadians, speed, rotationType);\r\n  }\r\n\r\n  /**\r\n   * This method will rotate an actor by the specified angle offset, from it's current rotation given a certain speed\r\n   * in radians/sec and return back the actor. This method is part\r\n   * of the actor 'Action' fluent API allowing action chaining.\r\n   * @param angleRadiansOffset  The angle to rotate to in radians relative to the current rotation\r\n   * @param speed          The speed in radians/sec the actor should rotate at\r\n   * @param rotationType  The [[RotationType]] to use for this rotation, default is shortest path\r\n   */\r\n  public rotateBy(angleRadiansOffset: number, speed: number, rotationType?: RotationType): ActionContext {\r\n    return this._ctx.rotateBy(angleRadiansOffset, speed, rotationType);\r\n  }\r\n\r\n  /**\r\n   * This method will scale an actor to the specified size at the speed\r\n   * specified (in magnitude increase per second) and return back the\r\n   * actor. This method is part of the actor 'Action' fluent API allowing\r\n   * action chaining.\r\n   * @param size    The scale to adjust the actor to over time\r\n   * @param speed   The speed of scaling specified in magnitude increase per second\r\n   */\r\n  public scaleTo(size: Vector, speed: Vector): ActionContext;\r\n  /**\r\n   * This method will scale an actor to the specified size at the speed\r\n   * specified (in magnitude increase per second) and return back the\r\n   * actor. This method is part of the actor 'Action' fluent API allowing\r\n   * action chaining.\r\n   * @param sizeX   The scaling factor to apply on X axis\r\n   * @param sizeY   The scaling factor to apply on Y axis\r\n   * @param speedX  The speed of scaling specified in magnitude increase per second on X axis\r\n   * @param speedY  The speed of scaling specified in magnitude increase per second on Y axis\r\n   */\r\n  public scaleTo(sizeX: number, sizeY: number, speedX: number, speedY: number): ActionContext;\r\n  public scaleTo(\r\n    sizeXOrVector: number | Vector,\r\n    sizeYOrSpeed: number | Vector,\r\n    speedXOrUndefined?: number,\r\n    speedYOrUndefined?: number): ActionContext {\r\n    return this._ctx.scaleTo.apply(this._ctx, [sizeXOrVector, sizeYOrSpeed, speedXOrUndefined, speedYOrUndefined]);\r\n  }\r\n\r\n  /**\r\n   * This method will scale an actor by an amount relative to the current scale at a certain speed in scale units/sec\r\n   * and return back the actor. This method is part of the\r\n   * actor 'Action' fluent API allowing action chaining.\r\n   * @param offset   The scaling factor to apply to the actor\r\n   * @param speed    The speed to scale at in scale units/sec\r\n   */\r\n  public scaleBy(offset: Vector, speed: number): ActionContext;\r\n  /**\r\n   * This method will scale an actor by an amount relative to the current scale at a certain speed in scale units/sec\r\n   * and return back the actor. This method is part of the\r\n   * actor 'Action' fluent API allowing action chaining.\r\n   * @param sizeOffsetX   The scaling factor to apply on X axis\r\n   * @param sizeOffsetY   The scaling factor to apply on Y axis\r\n   * @param speed    The speed to scale at in scale units/sec\r\n   */\r\n  public scaleBy(sizeOffsetX: number, sizeOffsetY: number, speed: number): ActionContext;\r\n  public scaleBy(sizeOffsetXOrVector: number | Vector, sizeOffsetYOrSpeed: number, speed?: number): ActionContext {\r\n    return this._ctx.scaleBy.apply(this._ctx, [sizeOffsetXOrVector, sizeOffsetYOrSpeed, speed]);\r\n  }\r\n\r\n  /**\r\n   * This method will cause an actor to blink (become visible and not\r\n   * visible). Optionally, you may specify the number of blinks. Specify the amount of time\r\n   * the actor should be visible per blink, and the amount of time not visible.\r\n   * This method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param timeVisible     The amount of time to stay visible per blink in milliseconds\r\n   * @param timeNotVisible  The amount of time to stay not visible per blink in milliseconds\r\n   * @param numBlinks       The number of times to blink\r\n   */\r\n  public blink(timeVisible: number, timeNotVisible: number, numBlinks?: number): ActionContext {\r\n    return this._ctx.blink(timeVisible, timeNotVisible, numBlinks);\r\n  }\r\n\r\n  /**\r\n   * This method will cause an actor's opacity to change from its current value\r\n   * to the provided value by a specified time (in milliseconds). This method is\r\n   * part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param opacity  The ending opacity\r\n   * @param time     The time it should take to fade the actor (in milliseconds)\r\n   */\r\n  public fade(opacity: number, time: number): ActionContext {\r\n    return this._ctx.fade(opacity, time);\r\n  }\r\n\r\n  /**\r\n   * This method will delay the next action from executing for a certain\r\n   * amount of time (in milliseconds). This method is part of the actor\r\n   * 'Action' fluent API allowing action chaining.\r\n   * @param time  The amount of time to delay the next action in the queue from executing in milliseconds\r\n   */\r\n  public delay(time: number): ActionContext {\r\n    return this._ctx.delay(time);\r\n  }\r\n\r\n  /**\r\n   * This method will add an action to the queue that will remove the actor from the\r\n   * scene once it has completed its previous  Any actions on the\r\n   * action queue after this action will not be executed.\r\n   */\r\n  public die(): ActionContext {\r\n    return this._ctx.die();\r\n  }\r\n\r\n  /**\r\n   * This method allows you to call an arbitrary method as the next action in the\r\n   * action queue. This is useful if you want to execute code in after a specific\r\n   * action, i.e An actor arrives at a destination after traversing a path\r\n   */\r\n  public callMethod(method: () => any): ActionContext {\r\n    return this._ctx.callMethod(method);\r\n  }\r\n\r\n  /**\r\n   * This method will cause the actor to repeat all of the actions built in\r\n   * the `repeatBuilder` callback. If the number of repeats\r\n   * is not specified it will repeat forever. This method is part of\r\n   * the actor 'Action' fluent API allowing action chaining\r\n   *\r\n   * ```typescript\r\n   * // Move up in a zig-zag by repeated moveBy's\r\n   * actor.actions.repeat(repeatCtx => {\r\n   *  repeatCtx.moveBy(10, 0, 10);\r\n   *  repeatCtx.moveBy(0, 10, 10);\r\n   * }, 5);\r\n   * ```\r\n   *\r\n   * @param repeatBuilder The builder to specify the repeatable list of actions\r\n   * @param times  The number of times to repeat all the previous actions in the action queue. If nothing is specified the actions\r\n   * will repeat forever\r\n   */\r\n  public repeat(repeatBuilder: (repeatContext: ActionContext) => any, times?: number): ActionContext {\r\n    return this._ctx.repeat(repeatBuilder, times);\r\n  }\r\n\r\n  /**\r\n   * This method will cause the actor to repeat all of the actions built in\r\n   * the `repeatBuilder` callback. If the number of repeats\r\n   * is not specified it will repeat forever. This method is part of\r\n   * the actor 'Action' fluent API allowing action chaining\r\n   *\r\n   * ```typescript\r\n   * // Move up in a zig-zag by repeated moveBy's\r\n   * actor.actions.repeat(repeatCtx => {\r\n   *  repeatCtx.moveBy(10, 0, 10);\r\n   *  repeatCtx.moveBy(0, 10, 10);\r\n   * }, 5);\r\n   * ```\r\n   *\r\n   * @param repeatBuilder The builder to specify the repeatable list of actions\r\n   */\r\n  public repeatForever(repeatBuilder: (repeatContext: ActionContext) => any): ActionContext {\r\n    return this._ctx.repeatForever(repeatBuilder);\r\n  }\r\n\r\n  /**\r\n   * This method will cause the entity to follow another at a specified distance\r\n   * @param entity           The entity to follow\r\n   * @param followDistance  The distance to maintain when following, if not specified the actor will follow at the current distance.\r\n   */\r\n  public follow(entity: Actor, followDistance?: number): ActionContext {\r\n    return this._ctx.follow(entity, followDistance);\r\n  }\r\n\r\n  /**\r\n   * This method will cause the entity to move towards another until they\r\n   * collide \"meet\" at a specified speed.\r\n   * @param entity  The entity to meet\r\n   * @param speed  The speed in pixels per second to move, if not specified it will match the speed of the other actor\r\n   */\r\n  public meet(entity: Actor, speed?: number): ActionContext {\r\n    return this._ctx.meet(entity, speed);\r\n  }\r\n\r\n  /**\r\n   * Returns a promise that resolves when the current action queue up to now\r\n   * is finished.\r\n   * @deprecated Use `toPromise()` will be removed in v0.26.0\r\n   */\r\n  public asPromise(): Promise<void> {\r\n    return this.toPromise();\r\n  }\r\n\r\n  /**\r\n   * Returns a promise that resolves when the current action queue up to now\r\n   * is finished.\r\n   */\r\n  public toPromise(): Promise<void> {\r\n    return this._ctx.toPromise();\r\n  }\r\n}","import { Vector } from '../Math/vector';\r\nimport { BoundingBox } from '../Collision/Index';\r\nimport { Color } from '../Color';\r\nimport { line } from '../Util/DrawUtil';\r\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\r\nimport { BaseAlign, Direction, FontOptions, FontStyle, FontUnit, TextAlign, FontRenderer } from './FontCommon';\r\nimport { Graphic, GraphicOptions } from './Graphic';\r\nimport { RasterOptions } from './Raster';\r\nimport { TextureLoader } from '.';\r\nimport { ImageFiltering } from './Filtering';\r\n\r\n/**\r\n * Represents a system or web font in Excalibur\r\n *\r\n * If no options specified, the system sans-serif 10 pixel is used\r\n *\r\n * If loading a custom web font be sure to have the font loaded before you use it https://erikonarheim.com/posts/dont-test-fonts/\r\n */\r\nexport class Font extends Graphic implements FontRenderer {\r\n  /**\r\n   * Set the font filtering mode, by default set to [[ImageFiltering.Blended]] regardless of the engine default smoothing\r\n   *\r\n   * If you have a pixel style font that may be a reason to switch this to [[ImageFiltering.Pixel]]\r\n   */\r\n  public filtering: ImageFiltering = ImageFiltering.Blended;\r\n  constructor(options: FontOptions & GraphicOptions & RasterOptions = {}) {\r\n    super(options); // <- Graphics properties\r\n\r\n    // Raster properties\r\n    this.smoothing = options?.smoothing ?? this.smoothing;\r\n    this.padding = options?.padding ?? this.padding;\r\n    this.color = options?.color ?? this.color;\r\n    this.strokeColor = options?.strokeColor ?? this.strokeColor;\r\n    this.lineDash = options?.lineDash ?? this.lineDash;\r\n    this.lineWidth = options?.lineWidth ?? this.lineWidth;\r\n    this.filtering = options?.filtering ?? this.filtering;\r\n\r\n    // Font specific properties\r\n    this.family = options?.family ?? this.family;\r\n    this.style = options?.style ?? this.style;\r\n    this.bold = options?.bold ?? this.bold;\r\n    this.size = options?.size ?? this.size;\r\n    this.unit = options?.unit ?? this.unit;\r\n    this.textAlign = options?.textAlign ?? this.textAlign;\r\n    this.baseAlign = options?.baseAlign ?? this.baseAlign;\r\n    this.direction = options?.direction ?? this.direction;\r\n    this.quality = options?.quality ?? this.quality;\r\n    if (options?.shadow) {\r\n      this.shadow = {};\r\n      this.shadow.blur = options.shadow.blur ?? this.shadow.blur;\r\n      this.shadow.offset = options.shadow.offset ?? this.shadow.offset;\r\n      this.shadow.color = options.shadow.color ?? this.shadow.color;\r\n    }\r\n  }\r\n\r\n  public clone() {\r\n    return new Font({\r\n      ...this.cloneGraphicOptions(),\r\n      size: this.size,\r\n      unit: this.unit,\r\n      family: this.family,\r\n      style: this.style,\r\n      bold: this.bold,\r\n      textAlign: this.textAlign,\r\n      baseAlign: this.baseAlign,\r\n      direction: this.direction,\r\n      shadow: this.shadow\r\n        ? {\r\n          blur: this.shadow.blur,\r\n          offset: this.shadow.offset,\r\n          color: this.shadow.color\r\n        }\r\n        : null\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Font quality determines the size of the underlying raster text, higher quality means less jagged edges.\r\n   * If quality is set to 1, then just enough raster bitmap is generated to render the text.\r\n   *\r\n   * You can think of quality as how zoomed in to the text you can get before seeing jagged edges.\r\n   *\r\n   * (Default 2)\r\n   */\r\n  public quality = 2;\r\n\r\n  // Raster properties for fonts\r\n  public padding = 2;\r\n  public smoothing = false;\r\n  public lineWidth = 1;\r\n  public lineDash: number[] = [];\r\n  public color: Color = Color.Black;\r\n  public strokeColor: Color;\r\n\r\n  public family: string = 'sans-serif';\r\n  public style: FontStyle = FontStyle.Normal;\r\n  public bold: boolean = false;\r\n  public unit: FontUnit = FontUnit.Px;\r\n  public textAlign: TextAlign = TextAlign.Left;\r\n  public baseAlign: BaseAlign = BaseAlign.Alphabetic;\r\n  public direction: Direction = Direction.LeftToRight;\r\n  public size: number = 10;\r\n  public shadow: { blur?: number; offset?: Vector; color?: Color } = null;\r\n\r\n  public get fontString() {\r\n    return `${this.style} ${this.bold ? 'bold' : ''} ${this.size}${this.unit} ${this.family}`;\r\n  }\r\n\r\n  private _textBounds: BoundingBox = new BoundingBox();\r\n\r\n  public get localBounds(): BoundingBox {\r\n    return this._textBounds;\r\n  }\r\n\r\n\r\n  protected _drawImage(_ex: ExcaliburGraphicsContext, _x: number, _y: number) {\r\n    // TODO weird vestigial drawimage\r\n  }\r\n\r\n\r\n  protected _rotate(ex: ExcaliburGraphicsContext) {\r\n    // TODO this needs to change depending on the bounding box...\r\n    const origin = this.origin ?? this._textBounds.center;\r\n    ex.translate(origin.x, origin.y);\r\n    ex.rotate(this.rotation);\r\n    ex.translate(-origin.x, -origin.y);\r\n  }\r\n\r\n  protected _flip(ex: ExcaliburGraphicsContext) {\r\n    if (this.flipHorizontal) {\r\n      ex.translate(this._textBounds.width / this.scale.x, 0);\r\n      ex.scale(-1, 1);\r\n    }\r\n\r\n    if (this.flipVertical) {\r\n      ex.translate(0, -this._textBounds.height / 2 / this.scale.y);\r\n      ex.scale(1, -1);\r\n    }\r\n  }\r\n\r\n\r\n  /**\r\n   * Returns a BoundingBox that is the total size of the text including multiple lines\r\n   *\r\n   * Does not include any padding or adjustment\r\n   * @param text\r\n   * @returns BoundingBox\r\n   */\r\n  public measureText(text: string): BoundingBox {\r\n    const lines = text.split('\\n');\r\n    const maxWidthLine = lines.reduce((a, b) => {\r\n      return a.length > b.length ? a : b;\r\n    });\r\n    const ctx = this._getTextBitmap(text);\r\n\r\n    this._applyFont(ctx); // font must be applied to the context to measure it\r\n    const metrics = ctx.measureText(maxWidthLine);\r\n    let textHeight = Math.abs(metrics.actualBoundingBoxAscent) + Math.abs(metrics.actualBoundingBoxDescent);\r\n\r\n    // TODO lineheight makes the text bounds wonky\r\n    const lineAdjustedHeight = textHeight * lines.length;\r\n    textHeight = lineAdjustedHeight;\r\n    const bottomBounds = lineAdjustedHeight - Math.abs(metrics.actualBoundingBoxAscent);\r\n    const x = 0;\r\n    const y = 0;\r\n    return new BoundingBox({\r\n      left: x - Math.abs(metrics.actualBoundingBoxLeft) - this.padding,\r\n      top: y - Math.abs(metrics.actualBoundingBoxAscent) - this.padding,\r\n      bottom: y + bottomBounds + this.padding,\r\n      right: x + Math.abs(metrics.actualBoundingBoxRight) + this.padding\r\n    });\r\n  }\r\n\r\n  private _setDimension(textBounds: BoundingBox, bitmap: CanvasRenderingContext2D) {\r\n\r\n    // Changing the width and height clears the context properties\r\n    // We double the bitmap width to account for all possible alignment\r\n    // We scale by \"quality\" so we render text without jaggies\r\n    bitmap.canvas.width = (textBounds.width + this.padding * 2) * 2 * this.quality;\r\n    bitmap.canvas.height = (textBounds.height + this.padding * 2) * 2 * this.quality;\r\n  }\r\n\r\n  protected _postDraw(ex: ExcaliburGraphicsContext): void {\r\n    ex.restore();\r\n  }\r\n\r\n  /**\r\n   * We need to identify bitmaps with more than just the text content\r\n   *\r\n   * Any properties that can change the rendering of the text\r\n   */\r\n  private _getRasterPropertiesHash(color?: Color): string {\r\n    const hash = '__hashcode__' +\r\n    this.fontString +\r\n    this.showDebug +\r\n    this.textAlign +\r\n    this.baseAlign +\r\n    this.direction +\r\n    JSON.stringify(this.shadow) +\r\n    (this.padding.toString() +\r\n    this.smoothing.toString() +\r\n    this.lineWidth.toString() +\r\n    this.lineDash.toString() +\r\n    this.strokeColor?.toString() +\r\n    ( color ? color.toString() : this.color?.toString()).toString());\r\n    return hash;\r\n  }\r\n\r\n  protected _applyRasterProperties(ctx: CanvasRenderingContext2D, color: Color) {\r\n    ctx.translate(this.padding, this.padding);\r\n    ctx.imageSmoothingEnabled = this.smoothing;\r\n    ctx.lineWidth = this.lineWidth;\r\n    ctx.setLineDash(this.lineDash ?? ctx.getLineDash());\r\n    ctx.strokeStyle = this.strokeColor?.toString();\r\n    ctx.fillStyle = color ? color.toString() : this.color?.toString();\r\n  }\r\n\r\n  private _applyFont(ctx: CanvasRenderingContext2D) {\r\n    ctx.translate(this.padding + ctx.canvas.width / 2, this.padding + ctx.canvas.height / 2);\r\n    ctx.scale(this.quality, this.quality);\r\n    ctx.textAlign = this.textAlign;\r\n    ctx.textBaseline = this.baseAlign;\r\n    ctx.font = this.fontString;\r\n    ctx.direction = this.direction;\r\n\r\n    if (this.shadow) {\r\n      ctx.shadowColor = this.shadow.color.toString();\r\n      ctx.shadowBlur = this.shadow.blur;\r\n      ctx.shadowOffsetX = this.shadow.offset.x;\r\n      ctx.shadowOffsetY = this.shadow.offset.y;\r\n    }\r\n  }\r\n\r\n  private _drawText(ctx: CanvasRenderingContext2D, text: string, colorOverride: Color, lineHeight: number): void {\r\n    const lines = text.split('\\n');\r\n    this._applyRasterProperties(ctx, colorOverride);\r\n    this._applyFont(ctx);\r\n\r\n    for (let i = 0; i < lines.length; i++) {\r\n      const line = lines[i];\r\n      if (this.color) {\r\n        ctx.fillText(line, 0, i * lineHeight);\r\n      }\r\n\r\n      if (this.strokeColor) {\r\n        ctx.strokeText(line, 0, i * lineHeight);\r\n      }\r\n    }\r\n\r\n    if (this.showDebug) {\r\n      // Horizontal line\r\n      /* istanbul ignore next */\r\n      line(ctx, Color.Red, -ctx.canvas.width / 2, 0, ctx.canvas.width / 2, 0, 2);\r\n      // Vertical line\r\n      /* istanbul ignore next */\r\n      line(ctx, Color.Red, 0, -ctx.canvas.height / 2, 0, ctx.canvas.height / 2, 2);\r\n    }\r\n  }\r\n\r\n  private _textToBitmap = new Map<string, CanvasRenderingContext2D>();\r\n  private _bitmapUsage = new Map<CanvasRenderingContext2D, number>();\r\n  private _getTextBitmap(text: string, color?: Color): CanvasRenderingContext2D {\r\n    const textAndHash = text + this._getRasterPropertiesHash(color);\r\n    const bitmap = this._textToBitmap.get(textAndHash);\r\n    if (bitmap) {\r\n      return bitmap;\r\n    }\r\n\r\n    const canvas = document.createElement('canvas');\r\n    const ctx = canvas.getContext('2d');\r\n    this._textToBitmap.set(textAndHash, ctx);\r\n    return ctx;\r\n  }\r\n\r\n  public render(ex: ExcaliburGraphicsContext, text: string, colorOverride: Color, x: number, y: number) {\r\n    if (this.showDebug) {\r\n      this.clearCache();\r\n    }\r\n    this.checkAndClearCache();\r\n    const bitmap = this._getTextBitmap(text, colorOverride);\r\n    const isNewBitmap = !this._bitmapUsage.get(bitmap);\r\n    this._textBounds = this.measureText(text);\r\n\r\n    if (isNewBitmap) {\r\n      this._setDimension(this._textBounds, bitmap);\r\n    }\r\n\r\n    this._preDraw(ex, x, y);\r\n\r\n    const lines = text.split('\\n');\r\n    const lineHeight = this._textBounds.height / lines.length;\r\n\r\n\r\n    const rasterWidth = bitmap.canvas.width;\r\n    const rasterHeight = bitmap.canvas.height;\r\n\r\n    if (isNewBitmap) {\r\n      // draws the text to the bitmap\r\n      this._drawText(bitmap, text, colorOverride, lineHeight);\r\n      // draws the bitmap to excalibur graphics context\r\n      TextureLoader.load(bitmap.canvas, this.filtering, true);\r\n    }\r\n\r\n    ex.drawImage(\r\n      bitmap.canvas,\r\n      0,\r\n      0,\r\n      rasterWidth,\r\n      rasterHeight,\r\n      x - rasterWidth / this.quality / 2,\r\n      y - rasterHeight / this.quality / 2,\r\n      rasterWidth / this.quality,\r\n      rasterHeight / this.quality\r\n    );\r\n\r\n    this._postDraw(ex);\r\n\r\n    // Cache the bitmap for certain amount of time\r\n    this._bitmapUsage.set(bitmap, performance.now());\r\n  }\r\n\r\n  /**\r\n   * Get the internal cache size of the font\r\n   * This is useful when debugging memory usage, these numbers indicate the number of cached in memory text bitmaps\r\n   */\r\n  public get cacheSize() {\r\n    return this._bitmapUsage.size;\r\n  }\r\n\r\n  /**\r\n   * Force clear all cached text bitmaps\r\n   */\r\n  public clearCache() {\r\n    this._bitmapUsage.clear();\r\n  }\r\n\r\n  /**\r\n   * Remove any expired cached text bitmaps\r\n   */\r\n  public checkAndClearCache() {\r\n    for (const [bitmap, time] of this._bitmapUsage.entries()) {\r\n      // if bitmap hasn't been used in 1 second clear it\r\n      if (time + 1000 < performance.now()) {\r\n        this._bitmapUsage.delete(bitmap);\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\r\nimport { BoundingBox } from '../Collision/BoundingBox';\r\nimport { SpriteFont } from './SpriteFont';\r\nimport { Graphic, GraphicOptions } from './Graphic';\r\nimport { Color } from '../Color';\r\nimport { Font } from './Font';\r\n\r\nexport interface TextOptions {\r\n  /**\r\n   * Text to draw\r\n   */\r\n  text: string;\r\n\r\n  /**\r\n   * Optionally override the font color, currently unsupported by SpriteFont\r\n   */\r\n  color?: Color;\r\n\r\n  /**\r\n   * Optionally specify a font, if none specified a default font is used (System sans-serif 10 pixel)\r\n   */\r\n  font?: Font | SpriteFont;\r\n}\r\n\r\n/**\r\n * Represent Text graphics in excalibur\r\n *\r\n * Useful for in game labels, ui, or overlays\r\n */\r\nexport class Text extends Graphic {\r\n  public color?: Color;\r\n  constructor(options: TextOptions & GraphicOptions) {\r\n    super(options);\r\n    // This order is important font, color, then text\r\n    this.font = options.font ?? new Font();\r\n    this.color = options.color ?? this.color;\r\n    this.text = options.text;\r\n  }\r\n\r\n  public clone(): Text {\r\n    return new Text({\r\n      text: this.text.slice(),\r\n      color: this.color?.clone() ?? Color.Black,\r\n      font: this.font.clone()\r\n    });\r\n  }\r\n\r\n  private _text: string = '';\r\n  public get text() {\r\n    return this._text;\r\n  }\r\n\r\n  public set text(value: string) {\r\n    this._text = value;\r\n    const bounds = this.font.measureText(this._text);\r\n    this._textWidth = bounds.width;\r\n    this._textHeight = bounds.height;\r\n  }\r\n\r\n  private _font: Font | SpriteFont;\r\n  public get font(): Font | SpriteFont {\r\n    return this._font;\r\n  }\r\n  public set font(font: Font | SpriteFont) {\r\n    this._font = font;\r\n  }\r\n\r\n  private _textWidth: number = 0;\r\n\r\n  public get width() {\r\n    if (this._textWidth === 0) {\r\n      this._calculateDimension();\r\n    }\r\n    return this._textWidth * this.scale.x;\r\n  }\r\n\r\n  private _textHeight: number = 0;\r\n  public get height() {\r\n    if (this._textHeight === 0) {\r\n      this._calculateDimension();\r\n    }\r\n    return this._textHeight * this.scale.y;\r\n  }\r\n\r\n  private _calculateDimension() {\r\n    const { width, height } = this.font.measureText(this._text);\r\n    this._textWidth = width;\r\n    this._textHeight = height;\r\n  }\r\n\r\n  public get localBounds(): BoundingBox {\r\n    return this.font.measureText(this._text).scale(this.scale);\r\n  }\r\n\r\n  protected override _rotate(_ex: ExcaliburGraphicsContext) {\r\n    // None this is delegated to font\r\n    // This override erases the default behavior\r\n  }\r\n\r\n  protected override _flip(_ex: ExcaliburGraphicsContext) {\r\n    // None this is delegated to font\r\n    // This override erases the default behavior\r\n  }\r\n\r\n  protected override _drawImage(ex: ExcaliburGraphicsContext, x: number, y: number) {\r\n    let color = Color.Black;\r\n    if (this.font instanceof Font) {\r\n      color = this.color ?? this.font.color;\r\n    }\r\n\r\n    if (this.isStale() || this.font.isStale()) {\r\n      this.font.flipHorizontal = this.flipHorizontal;\r\n      this.font.flipVertical = this.flipVertical;\r\n      this.font.rotation = this.rotation;\r\n      this.font.origin = this.origin;\r\n      this.font.opacity = this.opacity;\r\n    }\r\n\r\n    const { width, height } = this.font.measureText(this._text);\r\n    this._textWidth = width;\r\n    this._textHeight = height;\r\n\r\n    this.font.render(ex, this._text, color, x, y);\r\n    if (this.font.showDebug) {\r\n      ex.debug.drawRect(x - width, y - height, width * 2, height * 2);\r\n    }\r\n  }\r\n}\r\n","import { Texture } from './Drawing/Texture';\r\nimport {\r\n  InitializeEvent,\r\n  KillEvent,\r\n  PreUpdateEvent,\r\n  PostUpdateEvent,\r\n  PreDrawEvent,\r\n  PostDrawEvent,\r\n  PreDebugDrawEvent,\r\n  PostDebugDrawEvent,\r\n  PostCollisionEvent,\r\n  PreCollisionEvent,\r\n  CollisionStartEvent,\r\n  CollisionEndEvent,\r\n  PostKillEvent,\r\n  PreKillEvent,\r\n  GameEvent,\r\n  ExitTriggerEvent,\r\n  EnterTriggerEvent,\r\n  EnterViewPortEvent,\r\n  ExitViewPortEvent\r\n} from './Events';\r\nimport { Engine } from './Engine';\r\nimport { Color } from './Color';\r\nimport { Sprite } from './Drawing/Sprite';\r\nimport { Animation } from './Drawing/Animation';\r\nimport { Trait } from './Interfaces/Trait';\r\nimport { Drawable } from './Interfaces/Drawable';\r\nimport { CanInitialize, CanUpdate, CanDraw, CanBeKilled } from './Interfaces/LifecycleEvents';\r\nimport { Scene } from './Scene';\r\nimport { Logger } from './Util/Log';\r\nimport { Vector, vec } from './Math/vector';\r\nimport { BodyComponent } from './Collision/BodyComponent';\r\nimport { Eventable } from './Interfaces/Evented';\r\nimport * as Traits from './Traits/Index';\r\nimport * as Events from './Events';\r\nimport { PointerEvents } from './Interfaces/PointerEventHandlers';\r\nimport { CollisionType } from './Collision/CollisionType';\r\n\r\nimport { Entity } from './EntityComponentSystem/Entity';\r\nimport { CanvasDrawComponent } from './Drawing/CanvasDrawComponent';\r\nimport { CoordPlane, TransformComponent } from './EntityComponentSystem/Components/TransformComponent';\r\nimport { MotionComponent } from './EntityComponentSystem/Components/MotionComponent';\r\nimport { GraphicsComponent } from './Graphics/GraphicsComponent';\r\nimport { Rectangle } from './Graphics/Rectangle';\r\nimport { Flags, Legacy } from './Flags';\r\nimport { obsolete } from './Util/Decorators';\r\nimport { ColliderComponent } from './Collision/ColliderComponent';\r\nimport { Shape } from './Collision/Colliders/Shape';\r\nimport { watch } from './Util/Watch';\r\nimport { Collider, CollisionGroup } from './Collision/Index';\r\nimport { Circle } from './Graphics/Circle';\r\nimport { PointerEvent } from './Input/PointerEvent';\r\nimport { WheelEvent } from './Input/WheelEvent';\r\nimport { PointerComponent } from './Input/PointerComponent';\r\nimport { ActionsComponent } from './Actions/ActionsComponent';\r\nimport { Raster } from './Graphics/Raster';\r\nimport { Text } from './Graphics/Text';\r\n\r\n/**\r\n * Type guard for checking if something is an Actor\r\n * @param x\r\n */\r\nexport function isActor(x: any): x is Actor {\r\n  return x instanceof Actor;\r\n}\r\n\r\n/**\r\n * Actor contructor options\r\n */\r\nexport interface ActorArgs {\r\n  /**\r\n   * Optionally set the name of the actor, default is 'anonymous'\r\n   */\r\n  name?: string;\r\n  /**\r\n   * Optionally set the x position of the actor, default is 0\r\n   */\r\n  x?: number;\r\n  /**\r\n   * Optionally set the y position of the actor, default is 0\r\n   */\r\n  y?: number;\r\n  /**\r\n   * Optionally set the (x, y) position of the actor as a vector, default is (0, 0)\r\n   */\r\n  pos?: Vector;\r\n  /**\r\n   * Optionally set the coordinate plane of the actor, default is [[CoordPlane.World]] meaning actor is subject to camera positioning\r\n   */\r\n  coordPlane?: CoordPlane;\r\n  /**\r\n   * Optionally set the width of a box collider for the actor\r\n   */\r\n  width?: number;\r\n  /**\r\n   * Optionally set the height of a box collider for the actor\r\n   */\r\n  height?: number;\r\n  /**\r\n   * Optionally set the radius of the circle collider for the actor\r\n   */\r\n  radius?: number;\r\n  /**\r\n   * Optionally set the velocity of the actor in pixels/sec\r\n   */\r\n  vel?: Vector;\r\n  /**\r\n   * Optionally set the acceleration of the actor in pixels/sec^2\r\n   */\r\n  acc?: Vector;\r\n  /**\r\n   * Optionally se the rotation in radians (180 degrees = Math.PI radians)\r\n   */\r\n  rotation?: number;\r\n  /**\r\n   * Optionally set the angular velocity of the actor in radians/sec (180 degrees = Math.PI radians)\r\n   */\r\n  angularVelocity?: number;\r\n  /**\r\n   * Optionally set the scale of the actor's transform\r\n   */\r\n  scale?: Vector;\r\n  /**\r\n   * Optionally set the z index of the actor, default is 0\r\n   */\r\n  z?: number;\r\n  /**\r\n   * Optionally set the color of an actor, only used if no graphics are present\r\n   * If a width/height or a radius was set a default graphic will be added\r\n   */\r\n  color?: Color;\r\n  /**\r\n   * Optionally set the visibility of the actor\r\n   */\r\n  visible?: boolean;\r\n  /**\r\n   * Optionally set the anchor for graphics in the actor\r\n   */\r\n  anchor?: Vector;\r\n  /**\r\n   * Optionally set the collision type\r\n   */\r\n  collisionType?: CollisionType;\r\n  /**\r\n   * Optionally supply a collider for an actor, if supplied ignores any supplied width/height\r\n   */\r\n  collider?: Collider;\r\n  /**\r\n   * Optionally suppy a [[CollisionGroup]]\r\n   */\r\n  collisionGroup?: CollisionGroup;\r\n}\r\n\r\n/**\r\n * The most important primitive in Excalibur is an `Actor`. Anything that\r\n * can move on the screen, collide with another `Actor`, respond to events,\r\n * or interact with the current scene, must be an actor. An `Actor` **must**\r\n * be part of a [[Scene]] for it to be drawn to the screen.\r\n */\r\nexport class Actor extends Entity implements Eventable, PointerEvents, CanInitialize, CanUpdate, CanDraw, CanBeKilled {\r\n  // #region Properties\r\n\r\n  /**\r\n   * Set defaults for all Actors\r\n   */\r\n  public static defaults = {\r\n    anchor: Vector.Half\r\n  };\r\n\r\n  /**\r\n   * The physics body the is associated with this actor. The body is the container for all physical properties, like position, velocity,\r\n   * acceleration, mass, inertia, etc.\r\n   */\r\n  public get body(): BodyComponent {\r\n    return this.get(BodyComponent);\r\n  }\r\n\r\n  /**\r\n   * Access the Actor's built in [[TransformComponent]]\r\n   */\r\n  public get transform(): TransformComponent {\r\n    return this.get(TransformComponent);\r\n  }\r\n\r\n  /**\r\n   * Access the Actor's built in [[MotionComponent]]\r\n   */\r\n  public get motion(): MotionComponent {\r\n    return this.get(MotionComponent);\r\n  }\r\n\r\n  /**\r\n   * Access to the Actor's built in [[GraphicsComponent]]\r\n   */\r\n  public get graphics(): GraphicsComponent {\r\n    return this.get(GraphicsComponent);\r\n  }\r\n\r\n  /**\r\n   * Access to the Actor's built in [[ColliderComponent]]\r\n   */\r\n  public get collider(): ColliderComponent {\r\n    return this.get(ColliderComponent);\r\n  }\r\n\r\n  /**\r\n   * Access to the Actor's built in [[PointerComponent]] config\r\n   */\r\n  public get pointer(): PointerComponent {\r\n    return this.get(PointerComponent);\r\n  }\r\n\r\n  /**\r\n   * Useful for quickly scripting actor behavior, like moving to a place, patrolling back and forth, blinking, etc.\r\n   *\r\n   *  Access to the Actor's built in [[ActionsComponent]] which forwards to the\r\n   * [[ActionContext|Action context]] of the actor.\r\n   */\r\n  public get actions(): ActionsComponent {\r\n    return this.get(ActionsComponent);\r\n  }\r\n\r\n  /**\r\n   * Gets the position vector of the actor in pixels\r\n   */\r\n  public get pos(): Vector {\r\n    return this.transform.pos;\r\n  }\r\n\r\n  /**\r\n   * Sets the position vector of the actor in pixels\r\n   */\r\n  public set pos(thePos: Vector) {\r\n    this.transform.pos = thePos.clone();\r\n  }\r\n\r\n  /**\r\n   * Gets the position vector of the actor from the last frame\r\n   */\r\n  public get oldPos(): Vector {\r\n    return this.body.oldPos;\r\n  }\r\n\r\n  /**\r\n   * Sets the position vector of the actor in the last frame\r\n   */\r\n  public set oldPos(thePos: Vector) {\r\n    this.body.oldPos.setTo(thePos.x, thePos.y);\r\n  }\r\n\r\n  /**\r\n   * Gets the velocity vector of the actor in pixels/sec\r\n   */\r\n  public get vel(): Vector {\r\n    return this.motion.vel;\r\n  }\r\n\r\n  /**\r\n   * Sets the velocity vector of the actor in pixels/sec\r\n   */\r\n  public set vel(theVel: Vector) {\r\n    this.motion.vel = theVel.clone();\r\n  }\r\n\r\n  /**\r\n   * Gets the velocity vector of the actor from the last frame\r\n   */\r\n  public get oldVel(): Vector {\r\n    return this.body.oldVel;\r\n  }\r\n\r\n  /**\r\n   * Sets the velocity vector of the actor from the last frame\r\n   */\r\n  public set oldVel(theVel: Vector) {\r\n    this.body.oldVel.setTo(theVel.x, theVel.y);\r\n  }\r\n\r\n  /**\r\n   * Gets the acceleration vector of the actor in pixels/second/second. An acceleration pointing down such as (0, 100) may be\r\n   * useful to simulate a gravitational effect.\r\n   */\r\n  public get acc(): Vector {\r\n    return this.motion.acc;\r\n  }\r\n\r\n  /**\r\n   * Sets the acceleration vector of teh actor in pixels/second/second\r\n   */\r\n  public set acc(theAcc: Vector) {\r\n    this.motion.acc = theAcc.clone();\r\n  }\r\n\r\n  /**\r\n   * Sets the acceleration of the actor from the last frame. This does not include the global acc [[Physics.acc]].\r\n   */\r\n  public set oldAcc(theAcc: Vector) {\r\n    this.body.oldAcc.setTo(theAcc.x, theAcc.y);\r\n  }\r\n\r\n  /**\r\n   * Gets the acceleration of the actor from the last frame. This does not include the global acc [[Physics.acc]].\r\n   */\r\n  public get oldAcc(): Vector {\r\n    return this.body.oldAcc;\r\n  }\r\n\r\n  /**\r\n   * Gets the rotation of the actor in radians. 1 radian = 180/PI Degrees.\r\n   */\r\n  public get rotation(): number {\r\n    return this.transform.rotation;\r\n  }\r\n\r\n  /**\r\n   * Sets the rotation of the actor in radians. 1 radian = 180/PI Degrees.\r\n   */\r\n  public set rotation(theAngle: number) {\r\n    this.transform.rotation = theAngle;\r\n  }\r\n\r\n  /**\r\n   * Gets the rotational velocity of the actor in radians/second\r\n   */\r\n  public get angularVelocity(): number {\r\n    return this.motion.angularVelocity;\r\n  }\r\n\r\n  /**\r\n   * Sets the rotational velocity of the actor in radians/sec\r\n   */\r\n  public set angularVelocity(angularVelocity: number) {\r\n    this.motion.angularVelocity = angularVelocity;\r\n  }\r\n\r\n  public get scale(): Vector {\r\n    return this.get(TransformComponent).scale;\r\n  }\r\n\r\n  public set scale(scale: Vector) {\r\n    this.get(TransformComponent).scale = scale;\r\n  }\r\n\r\n  /**\r\n   * The anchor to apply all actor related transformations like rotation,\r\n   * translation, and scaling. By default the anchor is in the center of\r\n   * the actor. By default it is set to the center of the actor (.5, .5)\r\n   *\r\n   * An anchor of (.5, .5) will ensure that drawings are centered.\r\n   *\r\n   * Use `anchor.setTo` to set the anchor to a different point using\r\n   * values between 0 and 1. For example, anchoring to the top-left would be\r\n   * `Actor.anchor.setTo(0, 0)` and top-right would be `Actor.anchor.setTo(0, 1)`.\r\n   */\r\n  private _anchor: Vector = watch(Vector.Half, (v) => this._handleAnchorChange(v));\r\n  public get anchor(): Vector {\r\n    return this._anchor;\r\n  }\r\n\r\n  public set anchor(vec: Vector) {\r\n    this._anchor = watch(vec, (v) => this._handleAnchorChange(v));\r\n    this._handleAnchorChange(vec);\r\n  }\r\n\r\n  private _handleAnchorChange(v: Vector) {\r\n    if (this.graphics) {\r\n      this.graphics.anchor = v;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Indicates whether the actor is physically in the viewport\r\n   */\r\n  public get isOffScreen(): boolean {\r\n    return this.hasTag('offscreen');\r\n  }\r\n  /**\r\n   * The visibility of an actor\r\n   * @deprecated Use [[GraphicsComponent.visible|Actor.graphics.visible]], will be removed in v0.26.0\r\n   */\r\n  @obsolete({ message: 'Actor.visible will be removed in v0.26.0', alternateMethod: 'Use Actor.graphics.visible' })\r\n  public get visible(): boolean {\r\n    return this.graphics.visible;\r\n  }\r\n\r\n  public set visible(isVisible: boolean) {\r\n    this.graphics.visible = isVisible;\r\n  }\r\n\r\n  /**\r\n   * The opacity of an actor.\r\n   *\r\n   * @deprecated Actor.opacity will be removed in v0.26.0, use [[GraphicsComponent.opacity|Actor.graphics.opacity]].\r\n   */\r\n  @obsolete({\r\n    message: 'Actor.opacity will be removed in v0.26.0',\r\n    alternateMethod: 'Use Actor.graphics.opacity'\r\n  })\r\n  public get opacity(): number {\r\n    return this.graphics.opacity;\r\n  }\r\n\r\n  public set opacity(opacity: number) {\r\n    this.graphics.opacity = opacity;\r\n  }\r\n\r\n  /**\r\n   * Convenience reference to the global logger\r\n   */\r\n  public logger: Logger = Logger.getInstance();\r\n\r\n  /**\r\n   * The scene that the actor is in\r\n   */\r\n  public scene: Scene = null;\r\n\r\n  /**\r\n   * @deprecated will be removed in v0.26.0\r\n   */\r\n  public frames: { [key: string]: Drawable } = {};\r\n\r\n  /**\r\n   * Access to the current drawing for the actor, this can be\r\n   * an [[Animation]], [[Sprite]], or [[Polygon]].\r\n   * Set drawings with [[setDrawing]].\r\n   * @deprecated will be removed in v0.26.0\r\n   */\r\n  public currentDrawing: Drawable = null;\r\n\r\n  /**\r\n   * Draggable helper\r\n   */\r\n  private _draggable: boolean = false;\r\n  private _dragging: boolean = false;\r\n\r\n  private _pointerDragStartHandler = () => {\r\n    this._dragging = true;\r\n  };\r\n\r\n  private _pointerDragEndHandler = () => {\r\n    this._dragging = false;\r\n  };\r\n\r\n  private _pointerDragMoveHandler = (pe: PointerEvent) => {\r\n    if (this._dragging) {\r\n      this.pos = pe.worldPos;\r\n    }\r\n  };\r\n\r\n  private _pointerDragLeaveHandler = (pe: PointerEvent) => {\r\n    if (this._dragging) {\r\n      this.pos = pe.worldPos;\r\n    }\r\n  };\r\n\r\n  public get draggable(): boolean {\r\n    return this._draggable;\r\n  }\r\n\r\n  public set draggable(isDraggable: boolean) {\r\n    if (isDraggable) {\r\n      if (isDraggable && !this._draggable) {\r\n        this.on('pointerdragstart', this._pointerDragStartHandler);\r\n        this.on('pointerdragend', this._pointerDragEndHandler);\r\n        this.on('pointerdragmove', this._pointerDragMoveHandler);\r\n        this.on('pointerdragleave', this._pointerDragLeaveHandler);\r\n      } else if (!isDraggable && this._draggable) {\r\n        this.off('pointerdragstart', this._pointerDragStartHandler);\r\n        this.off('pointerdragend', this._pointerDragEndHandler);\r\n        this.off('pointerdragmove', this._pointerDragMoveHandler);\r\n        this.off('pointerdragleave', this._pointerDragLeaveHandler);\r\n      }\r\n\r\n      this._draggable = isDraggable;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Modify the current actor update pipeline.\r\n   * @deprecated will be removed in v0.26.0\r\n   */\r\n  public traits: Trait[] = [];\r\n\r\n  /**\r\n   * Sets the color of the actor's current graphic\r\n   */\r\n  public get color(): Color {\r\n    return this._color;\r\n  }\r\n  public set color(v: Color) {\r\n    this._color = v.clone();\r\n    const defaultLayer = this.graphics.layers.default;\r\n    const currentGraphic = defaultLayer.graphics[0]?.graphic;\r\n    if (currentGraphic instanceof Raster || currentGraphic instanceof Text) {\r\n      currentGraphic.color = this._color;\r\n    }\r\n  }\r\n  private _color: Color;\r\n\r\n  // #endregion\r\n\r\n  /**\r\n   *\r\n   * @param config\r\n   */\r\n  constructor(config?: ActorArgs) {\r\n    super();\r\n\r\n    const {\r\n      name,\r\n      x,\r\n      y,\r\n      pos,\r\n      coordPlane,\r\n      scale,\r\n      width,\r\n      height,\r\n      radius,\r\n      collider,\r\n      vel,\r\n      acc,\r\n      rotation,\r\n      angularVelocity,\r\n      z,\r\n      color,\r\n      visible,\r\n      anchor,\r\n      collisionType,\r\n      collisionGroup\r\n    } = {\r\n      ...config\r\n    };\r\n\r\n    this._setName(name);\r\n    this.anchor = anchor ?? Actor.defaults.anchor.clone();\r\n    const tx = new TransformComponent();\r\n    this.addComponent(tx);\r\n    this.pos = pos ?? vec(x ?? 0, y ?? 0);\r\n    this.rotation = rotation ?? 0;\r\n    this.scale = scale ?? vec(1, 1);\r\n    this.z = z ?? 0;\r\n    tx.coordPlane = coordPlane ?? CoordPlane.World;\r\n\r\n    this.addComponent(new PointerComponent);\r\n\r\n    this.addComponent(new GraphicsComponent({\r\n      anchor: this.anchor\r\n    }));\r\n    this.addComponent(new CanvasDrawComponent((ctx, delta) => this.draw(ctx, delta)));\r\n    this.addComponent(new MotionComponent());\r\n    this.vel = vel ?? Vector.Zero;\r\n    this.acc = acc ?? Vector.Zero;\r\n    this.angularVelocity = angularVelocity ?? 0;\r\n\r\n    this.addComponent(new ActionsComponent());\r\n\r\n    this.addComponent(new BodyComponent());\r\n    this.body.collisionType = collisionType ?? CollisionType.Passive;\r\n    if (collisionGroup) {\r\n      this.body.group = collisionGroup;\r\n    }\r\n\r\n    if (collider) {\r\n      this.addComponent(new ColliderComponent(collider));\r\n    } else if (radius) {\r\n      this.addComponent(new ColliderComponent(Shape.Circle(radius, this.anchor)));\r\n    } else {\r\n      if (width > 0 && height > 0) {\r\n        this.addComponent(new ColliderComponent(Shape.Box(width, height, this.anchor)));\r\n      } else {\r\n        this.addComponent(new ColliderComponent()); // no collider\r\n      }\r\n    }\r\n\r\n    this.graphics.visible = visible ?? true;\r\n\r\n    if (color) {\r\n      this.color = color;\r\n      if (width && height) {\r\n        this.graphics.add(\r\n          new Rectangle({\r\n            color: color,\r\n            width,\r\n            height\r\n          })\r\n        );\r\n      } else if (radius) {\r\n        this.graphics.add(\r\n          new Circle({\r\n            color: color,\r\n            radius\r\n          })\r\n        );\r\n      }\r\n    }\r\n\r\n    // Build default pipeline\r\n    if (Flags.isEnabled(Legacy.LegacyDrawing)) {\r\n      // TODO remove offscreen trait after legacy drawing removed\r\n      this.traits.push(new Traits.OffscreenCulling());\r\n    }\r\n\r\n  }\r\n\r\n  /**\r\n   * `onInitialize` is called before the first update of the actor. This method is meant to be\r\n   * overridden. This is where initialization of child actors should take place.\r\n   *\r\n   * Synonymous with the event handler `.on('initialize', (evt) => {...})`\r\n   */\r\n  public onInitialize(_engine: Engine): void {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * Initializes this actor and all it's child actors, meant to be called by the Scene before first update not by users of Excalibur.\r\n   *\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * @internal\r\n   */\r\n  public _initialize(engine: Engine) {\r\n    super._initialize(engine);\r\n    for (const child of this.children) {\r\n      child._initialize(engine);\r\n    }\r\n  }\r\n\r\n  // #region Events\r\n\r\n  public on(eventName: Events.exittrigger, handler: (event: ExitTriggerEvent) => void): void;\r\n  public on(eventName: Events.entertrigger, handler: (event: EnterTriggerEvent) => void): void;\r\n  /**\r\n   * The **collisionstart** event is fired when a [[BodyComponent|physics body]], usually attached to an actor,\r\n   *  first starts colliding with another [[BodyComponent|body]], and will not fire again while in contact until\r\n   *  the the pair separates and collides again.\r\n   * Use cases for the **collisionstart** event may be detecting when an actor has touched a surface\r\n   * (like landing) or if a item has been touched and needs to be picked up.\r\n   */\r\n  public on(eventName: Events.collisionstart, handler: (event: CollisionStartEvent) => void): void;\r\n  /**\r\n   * The **collisionend** event is fired when two [[BodyComponent|physics bodies]] are no longer in contact.\r\n   * This event will not fire again until another collision and separation.\r\n   *\r\n   * Use cases for the **collisionend** event might be to detect when an actor has left a surface\r\n   * (like jumping) or has left an area.\r\n   */\r\n  public on(eventName: Events.collisionend, handler: (event: CollisionEndEvent) => void): void;\r\n  /**\r\n   * The **precollision** event is fired **every frame** where a collision pair is found and two\r\n   * bodies are intersecting.\r\n   *\r\n   * This event is useful for building in custom collision resolution logic in Passive-Passive or\r\n   * Active-Passive scenarios. For example in a breakout game you may want to tweak the angle of\r\n   * ricochet of the ball depending on which side of the paddle you hit.\r\n   */\r\n  public on(eventName: Events.precollision, handler: (event: PreCollisionEvent) => void): void;\r\n  /**\r\n   * The **postcollision** event is fired for **every frame** where collision resolution was performed.\r\n   * Collision resolution is when two bodies influence each other and cause a response like bouncing\r\n   * off one another. It is only possible to have *postcollision* event in Active-Active and Active-Fixed\r\n   * type collision pairs.\r\n   *\r\n   * Post collision would be useful if you need to know that collision resolution is happening or need to\r\n   * tweak the default resolution.\r\n   */\r\n  public on(eventName: Events.postcollision, handler: (event: PostCollisionEvent) => void): void;\r\n  public on(eventName: Events.kill, handler: (event: KillEvent) => void): void;\r\n  public on(eventName: Events.prekill, handler: (event: PreKillEvent) => void): void;\r\n  public on(eventName: Events.postkill, handler: (event: PostKillEvent) => void): void;\r\n  public on(eventName: Events.initialize, handler: (event: InitializeEvent<Actor>) => void): void;\r\n  public on(eventName: Events.preupdate, handler: (event: PreUpdateEvent<Actor>) => void): void;\r\n  public on(eventName: Events.postupdate, handler: (event: PostUpdateEvent<Actor>) => void): void;\r\n  public on(eventName: Events.predraw, handler: (event: PreDrawEvent) => void): void;\r\n  public on(eventName: Events.postdraw, handler: (event: PostDrawEvent) => void): void;\r\n  public on(eventName: Events.predebugdraw, handler: (event: PreDebugDrawEvent) => void): void;\r\n  public on(eventName: Events.postdebugdraw, handler: (event: PostDebugDrawEvent) => void): void;\r\n  public on(eventName: Events.pointerup, handler: (event: PointerEvent) => void): void;\r\n  public on(eventName: Events.pointerdown, handler: (event: PointerEvent) => void): void;\r\n  public on(eventName: Events.pointerenter, handler: (event: PointerEvent) => void): void;\r\n  public on(eventName: Events.pointerleave, handler: (event: PointerEvent) => void): void;\r\n  public on(eventName: Events.pointermove, handler: (event: PointerEvent) => void): void;\r\n  public on(eventName: Events.pointercancel, handler: (event: PointerEvent) => void): void;\r\n  public on(eventName: Events.pointerwheel, handler: (event: WheelEvent) => void): void;\r\n  public on(eventName: Events.pointerdragstart, handler: (event: PointerEvent) => void): void;\r\n  public on(eventName: Events.pointerdragend, handler: (event: PointerEvent) => void): void;\r\n  public on(eventName: Events.pointerdragenter, handler: (event: PointerEvent) => void): void;\r\n  public on(eventName: Events.pointerdragleave, handler: (event: PointerEvent) => void): void;\r\n  public on(eventName: Events.pointerdragmove, handler: (event: PointerEvent) => void): void;\r\n  public on(eventName: Events.enterviewport, handler: (event: EnterViewPortEvent) => void): void;\r\n  public on(eventName: Events.exitviewport, handler: (event: ExitViewPortEvent) => void): void;\r\n  public on(eventName: string, handler: (event: GameEvent<Actor>) => void): void;\r\n  public on(eventName: string, handler: (event: any) => void): void {\r\n    super.on(eventName, handler);\r\n  }\r\n\r\n  public once(eventName: Events.exittrigger, handler: (event: ExitTriggerEvent) => void): void;\r\n  public once(eventName: Events.entertrigger, handler: (event: EnterTriggerEvent) => void): void;\r\n  /**\r\n   * The **collisionstart** event is fired when a [[BodyComponent|physics body]], usually attached to an actor,\r\n   *  first starts colliding with another [[BodyComponent|body]], and will not fire again while in contact until\r\n   *  the the pair separates and collides again.\r\n   * Use cases for the **collisionstart** event may be detecting when an actor has touch a surface\r\n   * (like landing) or if a item has been touched and needs to be picked up.\r\n   */\r\n  public once(eventName: Events.collisionstart, handler: (event: CollisionStartEvent) => void): void;\r\n  /**\r\n   * The **collisionend** event is fired when two [[BodyComponent|physics bodies]] are no longer in contact.\r\n   * This event will not fire again until another collision and separation.\r\n   *\r\n   * Use cases for the **collisionend** event might be to detect when an actor has left a surface\r\n   * (like jumping) or has left an area.\r\n   */\r\n  public once(eventName: Events.collisionend, handler: (event: CollisionEndEvent) => void): void;\r\n  /**\r\n   * The **precollision** event is fired **every frame** where a collision pair is found and two\r\n   * bodies are intersecting.\r\n   *\r\n   * This event is useful for building in custom collision resolution logic in Passive-Passive or\r\n   * Active-Passive scenarios. For example in a breakout game you may want to tweak the angle of\r\n   * ricochet of the ball depending on which side of the paddle you hit.\r\n   */\r\n  public once(eventName: Events.precollision, handler: (event: PreCollisionEvent) => void): void;\r\n  /**\r\n   * The **postcollision** event is fired for **every frame** where collision resolution was performed.\r\n   * Collision resolution is when two bodies influence each other and cause a response like bouncing\r\n   * off one another. It is only possible to have *postcollision* event in Active-Active and Active-Fixed\r\n   * type collision pairs.\r\n   *\r\n   * Post collision would be useful if you need to know that collision resolution is happening or need to\r\n   * tweak the default resolution.\r\n   */\r\n  public once(eventName: Events.postcollision, handler: (event: PostCollisionEvent) => void): void;\r\n  public once(eventName: Events.kill, handler: (event: KillEvent) => void): void;\r\n  public once(eventName: Events.postkill, handler: (event: PostKillEvent) => void): void;\r\n  public once(eventName: Events.prekill, handler: (event: PreKillEvent) => void): void;\r\n  public once(eventName: Events.initialize, handler: (event: InitializeEvent<Actor>) => void): void;\r\n  public once(eventName: Events.preupdate, handler: (event: PreUpdateEvent<Actor>) => void): void;\r\n  public once(eventName: Events.postupdate, handler: (event: PostUpdateEvent<Actor>) => void): void;\r\n  public once(eventName: Events.predraw, handler: (event: PreDrawEvent) => void): void;\r\n  public once(eventName: Events.postdraw, handler: (event: PostDrawEvent) => void): void;\r\n  public once(eventName: Events.predebugdraw, handler: (event: PreDebugDrawEvent) => void): void;\r\n  public once(eventName: Events.postdebugdraw, handler: (event: PostDebugDrawEvent) => void): void;\r\n  public once(eventName: Events.pointerup, handler: (event: PointerEvent) => void): void;\r\n  public once(eventName: Events.pointerdown, handler: (event: PointerEvent) => void): void;\r\n  public once(eventName: Events.pointerenter, handler: (event: PointerEvent) => void): void;\r\n  public once(eventName: Events.pointerleave, handler: (event: PointerEvent) => void): void;\r\n  public once(eventName: Events.pointermove, handler: (event: PointerEvent) => void): void;\r\n  public once(eventName: Events.pointercancel, handler: (event: PointerEvent) => void): void;\r\n  public once(eventName: Events.pointerwheel, handler: (event: WheelEvent) => void): void;\r\n  public once(eventName: Events.pointerdragstart, handler: (event: PointerEvent) => void): void;\r\n  public once(eventName: Events.pointerdragend, handler: (event: PointerEvent) => void): void;\r\n  public once(eventName: Events.pointerdragenter, handler: (event: PointerEvent) => void): void;\r\n  public once(eventName: Events.pointerdragleave, handler: (event: PointerEvent) => void): void;\r\n  public once(eventName: Events.pointerdragmove, handler: (event: PointerEvent) => void): void;\r\n  public once(eventName: Events.enterviewport, handler: (event: EnterViewPortEvent) => void): void;\r\n  public once(eventName: Events.exitviewport, handler: (event: ExitViewPortEvent) => void): void;\r\n  public once(eventName: string, handler: (event: GameEvent<Actor>) => void): void;\r\n  public once(eventName: string, handler: (event: any) => void): void {\r\n    super.once(eventName, handler);\r\n  }\r\n\r\n  public off(eventName: Events.exittrigger, handler?: (event: ExitTriggerEvent) => void): void;\r\n  public off(eventName: Events.entertrigger, handler?: (event: EnterTriggerEvent) => void): void;\r\n  /**\r\n   * The **collisionstart** event is fired when a [[BodyComponent|physics body]], usually attached to an actor,\r\n   *  first starts colliding with another [[BodyComponent|body]], and will not fire again while in contact until\r\n   *  the the pair separates and collides again.\r\n   * Use cases for the **collisionstart** event may be detecting when an actor has touch a surface\r\n   * (like landing) or if a item has been touched and needs to be picked up.\r\n   */\r\n  public off(eventName: Events.collisionstart, handler?: (event: CollisionStartEvent) => void): void;\r\n  /**\r\n   * The **collisionend** event is fired when two [[BodyComponent|physics bodies]] are no longer in contact.\r\n   * This event will not fire again until another collision and separation.\r\n   *\r\n   * Use cases for the **collisionend** event might be to detect when an actor has left a surface\r\n   * (like jumping) or has left an area.\r\n   */\r\n  public off(eventName: Events.collisionend, handler?: (event: CollisionEndEvent) => void): void;\r\n  /**\r\n   * The **precollision** event is fired **every frame** where a collision pair is found and two\r\n   * bodies are intersecting.\r\n   *\r\n   * This event is useful for building in custom collision resolution logic in Passive-Passive or\r\n   * Active-Passive scenarios. For example in a breakout game you may want to tweak the angle of\r\n   * ricochet of the ball depending on which side of the paddle you hit.\r\n   */\r\n  public off(eventName: Events.precollision, handler?: (event: PreCollisionEvent) => void): void;\r\n  /**\r\n   * The **postcollision** event is fired for **every frame** where collision resolution was performed.\r\n   * Collision resolution is when two bodies influence each other and cause a response like bouncing\r\n   * off one another. It is only possible to have *postcollision* event in Active-Active and Active-Fixed\r\n   * type collision pairs.\r\n   *\r\n   * Post collision would be useful if you need to know that collision resolution is happening or need to\r\n   * tweak the default resolution.\r\n   */\r\n  public off(eventName: Events.postcollision, handler: (event: PostCollisionEvent) => void): void;\r\n  public off(eventName: Events.pointerup, handler?: (event: PointerEvent) => void): void;\r\n  public off(eventName: Events.pointerdown, handler?: (event: PointerEvent) => void): void;\r\n  public off(eventName: Events.pointerenter, handler?: (event: PointerEvent) => void): void;\r\n  public off(eventName: Events.pointerleave, handler?: (event: PointerEvent) => void): void;\r\n  public off(eventName: Events.pointermove, handler?: (event: PointerEvent) => void): void;\r\n  public off(eventName: Events.pointercancel, handler?: (event: PointerEvent) => void): void;\r\n  public off(eventName: Events.pointerwheel, handler?: (event: WheelEvent) => void): void;\r\n  public off(eventName: Events.pointerdragstart, handler?: (event: PointerEvent) => void): void;\r\n  public off(eventName: Events.pointerdragend, handler?: (event: PointerEvent) => void): void;\r\n  public off(eventName: Events.pointerdragenter, handler?: (event: PointerEvent) => void): void;\r\n  public off(eventName: Events.pointerdragleave, handler?: (event: PointerEvent) => void): void;\r\n  public off(eventName: Events.pointerdragmove, handler?: (event: PointerEvent) => void): void;\r\n  public off(eventName: Events.prekill, handler?: (event: PreKillEvent) => void): void;\r\n  public off(eventName: Events.postkill, handler?: (event: PostKillEvent) => void): void;\r\n  public off(eventName: Events.initialize, handler?: (event: Events.InitializeEvent<Actor>) => void): void;\r\n  public off(eventName: Events.postupdate, handler?: (event: Events.PostUpdateEvent<Actor>) => void): void;\r\n  public off(eventName: Events.preupdate, handler?: (event: Events.PreUpdateEvent<Actor>) => void): void;\r\n  public off(eventName: Events.postdraw, handler?: (event: Events.PostDrawEvent) => void): void;\r\n  public off(eventName: Events.predraw, handler?: (event: Events.PreDrawEvent) => void): void;\r\n  public off(eventName: Events.enterviewport, handler?: (event: EnterViewPortEvent) => void): void;\r\n  public off(eventName: Events.exitviewport, handler?: (event: ExitViewPortEvent) => void): void;\r\n  public off(eventName: string, handler?: (event: GameEvent<Actor>) => void): void;\r\n  public off(eventName: string, handler?: (event: any) => void): void {\r\n    super.off(eventName, handler);\r\n  }\r\n\r\n  // #endregion\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _prekill handler for [[onPreKill]] lifecycle event\r\n   * @internal\r\n   */\r\n  public _prekill(_scene: Scene) {\r\n    super.emit('prekill', new PreKillEvent(this));\r\n    this.onPreKill(_scene);\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPreKill lifecycle event handler. Synonymous with `.on('prekill', (evt) =>{...})`\r\n   *\r\n   * `onPreKill` is called directly before an actor is killed and removed from its current [[Scene]].\r\n   */\r\n  public onPreKill(_scene: Scene) {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _prekill handler for [[onPostKill]] lifecycle event\r\n   * @internal\r\n   */\r\n  public _postkill(_scene: Scene) {\r\n    super.emit('postkill', new PostKillEvent(this));\r\n    this.onPostKill(_scene);\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPostKill lifecycle event handler. Synonymous with `.on('postkill', (evt) => {...})`\r\n   *\r\n   * `onPostKill` is called directly after an actor is killed and remove from its current [[Scene]].\r\n   */\r\n  public onPostKill(_scene: Scene) {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * If the current actor is a member of the scene, this will remove\r\n   * it from the scene graph. It will no longer be drawn or updated.\r\n   */\r\n  public kill() {\r\n    if (this.scene) {\r\n      this._prekill(this.scene);\r\n      this.emit('kill', new KillEvent(this));\r\n      super.kill();\r\n      this._postkill(this.scene);\r\n    } else {\r\n      this.logger.warn('Cannot kill actor, it was never added to the Scene');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * If the current actor is killed, it will now not be killed.\r\n   */\r\n  public unkill() {\r\n    this.active = true;\r\n  }\r\n\r\n  /**\r\n   * Indicates wether the actor has been killed.\r\n   */\r\n  public isKilled(): boolean {\r\n    return !this.active;\r\n  }\r\n\r\n  /**\r\n   * Sets the current drawing of the actor to the drawing corresponding to\r\n   * the key.\r\n   * @param key The key of the drawing\r\n   * @deprecated Use [[GraphicsComponent.show|Actor.graphics.show]] or [[GraphicsComponent.use|Actor.graphics.use]]\r\n   */\r\n  public setDrawing(key: string): void;\r\n  /**\r\n   * Sets the current drawing of the actor to the drawing corresponding to\r\n   * an `enum` key (e.g. `Animations.Left`)\r\n   * @param key The `enum` key of the drawing\r\n   * @deprecated Use [[GraphicsComponent.show|Actor.graphics.show]] or [[GraphicsComponent.use|Actor.graphics.use]]\r\n   */\r\n  public setDrawing(key: number): void;\r\n  @obsolete({\r\n    message: 'Actor.setDrawing will be removed in v0.26.0',\r\n    alternateMethod: 'Use Actor.graphics.show() or Actor.graphics.use()'\r\n  })\r\n  public setDrawing(key: any): void {\r\n    key = key.toString();\r\n    if (this.currentDrawing !== this.frames[<string>key]) {\r\n      if (this.frames[key] != null) {\r\n        this.frames[key].reset();\r\n        this.currentDrawing = this.frames[key];\r\n      } else {\r\n        Logger.getInstance().error(`the specified drawing key ${key} does not exist`);\r\n      }\r\n    }\r\n    if (this.currentDrawing && this.currentDrawing instanceof Animation) {\r\n      this.currentDrawing.tick(0);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Adds a whole texture as the \"default\" drawing. Set a drawing using [[setDrawing]].\r\n   * @deprecated Use [[GraphicsComponent.add|Actor.graphics.add]], will be removed in v0.26.0\r\n   */\r\n  public addDrawing(texture: Texture): void;\r\n  /**\r\n   * Adds a whole sprite as the \"default\" drawing. Set a drawing using [[setDrawing]].\r\n   * @deprecated Use [[GraphicsComponent.add|Actor.graphics.add]], will be removed in v0.26.0\r\n   */\r\n  public addDrawing(sprite: Sprite): void;\r\n  /**\r\n   * Adds a drawing to the list of available drawings for an actor. Set a drawing using [[setDrawing]].\r\n   * @param key     The key to associate with a drawing for this actor\r\n   * @param drawing This can be an [[Animation]], [[Sprite]], or [[Polygon]].\r\n   * @deprecated Use [[GraphicsComponent.add|Actor.graphics.add]], will be removed in v0.26.0\r\n   */\r\n  public addDrawing(key: any, drawing: Drawable): void;\r\n  @obsolete({\r\n    message: 'Actor.addDrawing will be removed in v0.26.0',\r\n    alternateMethod: 'Use Actor.graphics.add()'\r\n  })\r\n  public addDrawing(): void {\r\n    if (arguments.length === 2) {\r\n      this.frames[<string>arguments[0]] = arguments[1];\r\n      if (!this.currentDrawing) {\r\n        this.currentDrawing = arguments[1];\r\n      }\r\n    } else {\r\n      if (arguments[0] instanceof Sprite) {\r\n        this.addDrawing('default', arguments[0]);\r\n      }\r\n      if (arguments[0] instanceof Texture) {\r\n        this.addDrawing('default', arguments[0].asSprite());\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Gets the z-index of an actor. The z-index determines the relative order an actor is drawn in.\r\n   * Actors with a higher z-index are drawn on top of actors with a lower z-index\r\n   */\r\n  public get z(): number {\r\n    return this.get(TransformComponent).z;\r\n  }\r\n\r\n  /**\r\n   * @deprecated Use [[Actor.z]], will be removed in v0.26.0\r\n   */\r\n  @obsolete({\r\n    message: 'Actor.getZIndex will be removed in v0.26.0',\r\n    alternateMethod: 'Use Actor.transform.z or Actor.z'\r\n  })\r\n  public getZIndex(): number {\r\n    return this.get(TransformComponent).z;\r\n  }\r\n\r\n  /**\r\n   * Sets the z-index of an actor and updates it in the drawing list for the scene.\r\n   * The z-index determines the relative order an actor is drawn in.\r\n   * Actors with a higher z-index are drawn on top of actors with a lower z-index\r\n   * @param newZ new z-index to assign\r\n   */\r\n  public set z(newZ: number) {\r\n    this.get(TransformComponent).z = newZ;\r\n  }\r\n\r\n  /**\r\n   * @param newIndex new z-index to assign\r\n   * @deprecated Use [[Actor.z]], will be removed in v0.26.0\r\n   */\r\n  @obsolete({\r\n    message: 'Actor.setZIndex will be removed in v0.26.0',\r\n    alternateMethod: 'Use Actor.transform.z or Actor.z'\r\n  })\r\n  public setZIndex(newIndex: number) {\r\n    this.get(TransformComponent).z = newIndex;\r\n  }\r\n\r\n  /**\r\n   * Get the center point of an actor (global position)\r\n   */\r\n  public get center(): Vector {\r\n    const globalPos = this.getGlobalPos();\r\n    return new Vector(\r\n      globalPos.x + this.width / 2 - this.anchor.x * this.width,\r\n      globalPos.y + this.height / 2 - this.anchor.y * this.height);\r\n  }\r\n\r\n  /**\r\n   * Get the local center point of an actor\r\n   */\r\n  public get localCenter(): Vector {\r\n    return new Vector(\r\n      this.pos.x + this.width / 2 - this.anchor.x * this.width,\r\n      this.pos.y + this.height / 2 - this.anchor.y * this.height);\r\n  }\r\n\r\n  public get width() {\r\n    return this.collider.localBounds.width * this.getGlobalScale().x;\r\n  }\r\n\r\n  public get height() {\r\n    return this.collider.localBounds.height * this.getGlobalScale().y;\r\n  }\r\n\r\n  /**\r\n   * Gets this actor's rotation taking into account any parent relationships\r\n   *\r\n   * @returns Rotation angle in radians\r\n   */\r\n  public getGlobalRotation(): number {\r\n    return this.get(TransformComponent).globalRotation;\r\n  }\r\n\r\n  /**\r\n   * Gets an actor's world position taking into account parent relationships, scaling, rotation, and translation\r\n   *\r\n   * @returns Position in world coordinates\r\n   */\r\n  public getGlobalPos(): Vector {\r\n    return this.get(TransformComponent).globalPos;\r\n  }\r\n\r\n  /**\r\n   * Gets the global scale of the Actor\r\n   */\r\n  public getGlobalScale(): Vector {\r\n    return this.get(TransformComponent).globalScale;\r\n  }\r\n\r\n  // #region Collision\r\n\r\n  /**\r\n   * Tests whether the x/y specified are contained in the actor\r\n   * @param x  X coordinate to test (in world coordinates)\r\n   * @param y  Y coordinate to test (in world coordinates)\r\n   * @param recurse checks whether the x/y are contained in any child actors (if they exist).\r\n   */\r\n  public contains(x: number, y: number, recurse: boolean = false): boolean {\r\n    const point = vec(x, y);\r\n    const collider = this.get(ColliderComponent);\r\n    collider.update();\r\n    const geom = collider.get();\r\n    if (!geom) {\r\n      return false;\r\n    }\r\n    const containment = geom.contains(point);\r\n\r\n    if (recurse) {\r\n      return (\r\n        containment ||\r\n        this.children.some((child: Actor) => {\r\n          return child.contains(x, y, true);\r\n        })\r\n      );\r\n    }\r\n\r\n    return containment;\r\n  }\r\n\r\n  /**\r\n   * Returns true if the two actor.collider's surfaces are less than or equal to the distance specified from each other\r\n   * @param actor     Actor to test\r\n   * @param distance  Distance in pixels to test\r\n   */\r\n  public within(actor: Actor, distance: number): boolean {\r\n    const collider = this.get(ColliderComponent);\r\n    const otherCollider = actor.get(ColliderComponent);\r\n    const me = collider.get();\r\n    const other = otherCollider.get();\r\n    if (me && other) {\r\n      return me.getClosestLineBetween(other).getLength() <= distance;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  // #endregion\r\n\r\n  // #region Update\r\n\r\n  /**\r\n   * Called by the Engine, updates the state of the actor\r\n   * @internal\r\n   * @param engine The reference to the current game engine\r\n   * @param delta  The time elapsed since the last update in milliseconds\r\n   */\r\n  public update(engine: Engine, delta: number) {\r\n    this._initialize(engine);\r\n    this._preupdate(engine, delta);\r\n\r\n    // Tick animations\r\n    const drawing = this.currentDrawing;\r\n    if (drawing && drawing instanceof Animation) {\r\n      drawing.tick(delta, engine.stats.currFrame.id);\r\n    }\r\n\r\n    // Update actor pipeline (movement, collision detection, event propagation, offscreen culling)\r\n    for (const trait of this.traits) {\r\n      trait.update(this, engine, delta);\r\n    }\r\n\r\n    this._postupdate(engine, delta);\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPreUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\r\n   *\r\n   * `onPreUpdate` is called directly before an actor is updated.\r\n   */\r\n  public onPreUpdate(_engine: Engine, _delta: number): void {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPostUpdate lifecycle event handler. Synonymous with `.on('postupdate', (evt) =>{...})`\r\n   *\r\n   * `onPostUpdate` is called directly after an actor is updated.\r\n   */\r\n  public onPostUpdate(_engine: Engine, _delta: number): void {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _preupdate handler for [[onPreUpdate]] lifecycle event\r\n   * @internal\r\n   */\r\n  public _preupdate(engine: Engine, delta: number): void {\r\n    this.emit('preupdate', new PreUpdateEvent(engine, delta, this));\r\n    this.onPreUpdate(engine, delta);\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _preupdate handler for [[onPostUpdate]] lifecycle event\r\n   * @internal\r\n   */\r\n  public _postupdate(engine: Engine, delta: number): void {\r\n    this.emit('postupdate', new PreUpdateEvent(engine, delta, this));\r\n    this.onPostUpdate(engine, delta);\r\n  }\r\n\r\n  // endregion\r\n\r\n  // #region Drawing\r\n  /**\r\n   * Called by the Engine, draws the actor to the screen\r\n   * @param ctx   The rendering context\r\n   * @param delta The time since the last draw in milliseconds\r\n   *\r\n   * **Warning** only works with Flags.useLegacyDrawing() enabled\r\n   * @deprecated Use Actor.graphics, will be removed in v0.26.0\r\n   */\r\n  public draw(ctx: CanvasRenderingContext2D, delta: number) {\r\n    // translate canvas by anchor offset\r\n    ctx.save();\r\n\r\n    if (this.currentDrawing) {\r\n      ctx.translate(-(this.width * this.anchor.x), -(this.height * this.anchor.y));\r\n\r\n      this._predraw(ctx, delta);\r\n      const drawing = this.currentDrawing;\r\n      // See https://github.com/excaliburjs/Excalibur/pull/619 for discussion on this formula\r\n      const offsetX = (this.width - drawing.width * drawing.scale.x) * this.anchor.x;\r\n      const offsetY = (this.height - drawing.height * drawing.scale.y) * this.anchor.y;\r\n\r\n      this.currentDrawing.draw({ ctx, x: offsetX, y: offsetY, opacity: this.graphics.opacity });\r\n    } else {\r\n      this._predraw(ctx, delta);\r\n      if (this.color && this.collider) {\r\n        // update collider geometry based on transform\r\n        const collider = this.get(ColliderComponent);\r\n        collider.update();\r\n        if (collider && !collider.bounds.hasZeroDimensions()) {\r\n          // Colliders are already shifted by anchor, unshift\r\n          ctx.globalAlpha = this.graphics.opacity;\r\n          collider.get()?.draw(ctx, this.color, vec(0, 0));\r\n        }\r\n      }\r\n    }\r\n    ctx.restore();\r\n    this._postdraw(ctx, delta);\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPreDraw lifecycle event handler. Synonymous with `.on('predraw', (evt) =>{...})`\r\n   *\r\n   * `onPreDraw` is called directly before an actor is drawn, but after local transforms are made.\r\n   *\r\n   * **Warning** only works with Flags.useLegacyDrawing() enabled\r\n   * @deprecated Use Actor.graphics.onPostDraw, will be removed in v0.26.0\r\n   */\r\n  public onPreDraw(_ctx: CanvasRenderingContext2D, _delta: number): void {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPostDraw lifecycle event handler. Synonymous with `.on('postdraw', (evt) =>{...})`\r\n   *\r\n   * `onPostDraw` is called directly after an actor is drawn, and before local transforms are removed.\r\n   *\r\n   * **Warning** only works with Flags.useLegacyDrawing() enabled\r\n   * @deprecated Use Actor.graphics.onPostDraw, will be removed in v0.26.0\r\n   */\r\n  public onPostDraw(_ctx: CanvasRenderingContext2D, _delta: number): void {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _predraw handler for [[onPreDraw]] lifecycle event\r\n   *\r\n   * **Warning** only works with Flags.useLegacyDrawing() enabled\r\n   * @deprecated Use Actor.graphics.onPreDraw, will be removed in v0.26.0\r\n   * @internal\r\n   */\r\n  public _predraw(ctx: CanvasRenderingContext2D, delta: number): void {\r\n    this.emit('predraw', new PreDrawEvent(ctx, delta, this));\r\n    this.onPreDraw(ctx, delta);\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _postdraw handler for [[onPostDraw]] lifecycle event\r\n   *\r\n   * **Warning** only works with Flags.useLegacyDrawing() enabled\r\n   * @deprecated Use Actor.graphics.onPostDraw, will be removed in v0.26.0\r\n   * @internal\r\n   */\r\n  public _postdraw(ctx: CanvasRenderingContext2D, delta: number): void {\r\n    this.emit('postdraw', new PreDrawEvent(ctx, delta, this));\r\n    this.onPostDraw(ctx, delta);\r\n  }\r\n\r\n  /**\r\n   * Called by the Engine, draws the actors debugging to the screen\r\n   * @param ctx The rendering context\r\n   *\r\n   *\r\n   * **Warning** only works with Flags.useLegacyDrawing() enabled\r\n   * @deprecated will be removed in v0.26.0\r\n   * @internal\r\n   */\r\n  /* istanbul ignore next */\r\n  public debugDraw(_ctx: CanvasRenderingContext2D) {\r\n    // pass\r\n  }\r\n  // #endregion\r\n}\r\n","import { Vector, vec } from './Math/vector';\r\nimport { Engine } from './Engine';\r\nimport { Actor, ActorArgs } from './Actor';\r\nimport { CoordPlane, TransformComponent } from './EntityComponentSystem/Components/TransformComponent';\r\nimport { CollisionType } from './Collision/CollisionType';\r\n\r\n/**\r\n * Helper [[Actor]] primitive for drawing UI's, optimized for UI drawing. Does\r\n * not participate in collisions. Drawn on top of all other actors.\r\n */\r\nexport class ScreenElement extends Actor {\r\n  protected _engine: Engine;\r\n\r\n  constructor();\r\n  constructor(config?: ActorArgs);\r\n\r\n  constructor(config?: ActorArgs) {\r\n    super({ ...config });\r\n    this.get(TransformComponent).coordPlane = CoordPlane.Screen;\r\n    this.anchor = vec(0, 0);\r\n    this.body.collisionType = CollisionType.PreventCollision;\r\n    this.collider.useBoxCollider(this.width, this.height, this.anchor);\r\n  }\r\n\r\n  public _initialize(engine: Engine) {\r\n    this._engine = engine;\r\n    super._initialize(engine);\r\n  }\r\n\r\n  public contains(x: number, y: number, useWorld: boolean = true) {\r\n    if (useWorld) {\r\n      return super.contains(x, y);\r\n    }\r\n\r\n    const coords = this._engine.worldToScreenCoordinates(new Vector(x, y));\r\n    return super.contains(coords.x, coords.y);\r\n  }\r\n}\r\n","import { Scene } from './Scene';\r\nimport { obsolete } from './Util/Decorators';\r\nimport { Logger } from './Util/Log';\r\n\r\nexport interface TimerOptions {\r\n  repeats?: boolean;\r\n  numberOfRepeats?: number;\r\n  fcn?: () => void;\r\n  interval: number;\r\n}\r\n\r\n/**\r\n * The Excalibur timer hooks into the internal timer and fires callbacks,\r\n * after a certain interval, optionally repeating.\r\n */\r\nexport class Timer {\r\n  private _logger = Logger.getInstance();\r\n  private static _MAX_ID: number = 0;\r\n  public id: number = 0;\r\n\r\n  private _elapsedTime: number = 0;\r\n  private _totalTimeAlive: number = 0;\r\n\r\n  private _running = false;\r\n\r\n  private _numberOfTicks: number = 0;\r\n  private _callbacks: Array<() => void>;\r\n\r\n  public interval: number = 10;\r\n  public repeats: boolean = false;\r\n  public maxNumberOfRepeats: number = -1;\r\n\r\n  private _complete = false;\r\n  public get complete() {\r\n    return this._complete;\r\n  }\r\n  public scene: Scene = null;\r\n\r\n  /**\r\n   * @param options    Options - repeats, numberOfRepeats, fcn, interval\r\n   * @param repeats    Indicates whether this call back should be fired only once, or repeat after every interval as completed.\r\n   * @param numberOfRepeats Specifies a maximum number of times that this timer will execute.\r\n   * @param fcn        The callback to be fired after the interval is complete.\r\n   */\r\n  constructor(options: TimerOptions);\r\n  constructor(fcn: TimerOptions | (() => void), interval?: number, repeats?: boolean, numberOfRepeats?: number) {\r\n    if (typeof fcn !== 'function') {\r\n      const options = fcn;\r\n      fcn = options.fcn;\r\n      interval = options.interval;\r\n      repeats = options.repeats;\r\n      numberOfRepeats = options.numberOfRepeats;\r\n    }\r\n\r\n    if (!!numberOfRepeats && numberOfRepeats >= 0) {\r\n      this.maxNumberOfRepeats = numberOfRepeats;\r\n      if (!repeats) {\r\n        throw new Error('repeats must be set to true if numberOfRepeats is set');\r\n      }\r\n    }\r\n\r\n    this.id = Timer._MAX_ID++;\r\n    this.interval = interval || this.interval;\r\n    this.repeats = repeats || this.repeats;\r\n\r\n    this._callbacks = [];\r\n\r\n    if (fcn) {\r\n      this.on(fcn);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Adds a new callback to be fired after the interval is complete\r\n   * @param fcn The callback to be added to the callback list, to be fired after the interval is complete.\r\n   */\r\n  public on(fcn: () => void) {\r\n    this._callbacks.push(fcn);\r\n  }\r\n\r\n  /**\r\n   * Removes a callback from the callback list to be fired after the interval is complete.\r\n   * @param fcn The callback to be removed from the callback list, to be fired after the interval is complete.\r\n   */\r\n  public off(fcn: () => void) {\r\n    const index = this._callbacks.indexOf(fcn);\r\n    this._callbacks.splice(index, 1);\r\n  }\r\n\r\n  /**\r\n   * Updates the timer after a certain number of milliseconds have elapsed. This is used internally by the engine.\r\n   * @param delta  Number of elapsed milliseconds since the last update.\r\n   */\r\n  public update(delta: number) {\r\n    if (this._running) {\r\n      this._totalTimeAlive += delta;\r\n      this._elapsedTime += delta;\r\n\r\n      if (this.maxNumberOfRepeats > -1 && this._numberOfTicks >= this.maxNumberOfRepeats) {\r\n        this._complete = true;\r\n        this._running = false;\r\n        this._elapsedTime = 0;\r\n      }\r\n\r\n      if (!this.complete && this._elapsedTime >= this.interval) {\r\n        this._callbacks.forEach((c) => {\r\n          c.call(this);\r\n        });\r\n\r\n        this._numberOfTicks++;\r\n        if (this.repeats) {\r\n          this._elapsedTime = 0;\r\n        } else {\r\n          this._complete = true;\r\n          this._running = false;\r\n          this._elapsedTime = 0;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Resets the timer so that it can be reused, and optionally reconfigure the timers interval.\r\n   *\r\n   * Warning** you may need to call `timer.start()` again if the timer had completed\r\n   * @param newInterval If specified, sets a new non-negative interval in milliseconds to refire the callback\r\n   * @param newNumberOfRepeats If specified, sets a new non-negative upper limit to the number of time this timer executes\r\n   */\r\n  public reset(newInterval?: number, newNumberOfRepeats?: number) {\r\n    if (!!newInterval && newInterval >= 0) {\r\n      this.interval = newInterval;\r\n    }\r\n\r\n    if (!!this.maxNumberOfRepeats && this.maxNumberOfRepeats >= 0) {\r\n      this.maxNumberOfRepeats = newNumberOfRepeats;\r\n      if (!this.repeats) {\r\n        throw new Error('repeats must be set to true if numberOfRepeats is set');\r\n      }\r\n    }\r\n\r\n    this._complete = false;\r\n    this._elapsedTime = 0;\r\n    this._numberOfTicks = 0;\r\n  }\r\n\r\n  public get timesRepeated(): number {\r\n    return this._numberOfTicks;\r\n  }\r\n\r\n  public getTimeRunning(): number {\r\n    return this._totalTimeAlive;\r\n  }\r\n\r\n  /**\r\n   * @returns milliseconds until the next action callback, if complete will return 0\r\n   */\r\n  public get timeToNextAction() {\r\n    if (this.complete) {\r\n      return 0;\r\n    }\r\n    return this.interval - this._elapsedTime;\r\n  }\r\n\r\n  /**\r\n   * @returns milliseconds elapsed toward the next action\r\n   */\r\n  public get timeElapsedTowardNextAction() {\r\n    return this._elapsedTime;\r\n  }\r\n\r\n  public get isRunning() {\r\n    return this._running;\r\n  }\r\n\r\n  /**\r\n   * Pauses the timer, time will no longer increment towards the next call\r\n   */\r\n  public pause(): Timer {\r\n    this._running = false;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Unpauses the timer. Time will now increment towards the next call\r\n   * @deprecated Will be removed in v0.26.0\r\n   */\r\n  @obsolete({ message: 'Will be removed in v0.26.0', alternateMethod: 'Use Timer.resume()' })\r\n  public unpause() {\r\n    this._running = true;\r\n  }\r\n\r\n  /**\r\n   * Resumes the timer, time will now increment towards the next call.\r\n   */\r\n  public resume(): Timer {\r\n    this._running = true;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Starts the timer, if the timer was complete it will restart the timer and reset the elapsed time counter\r\n   */\r\n  public start(): Timer {\r\n    if (!this.scene) {\r\n      this._logger.warn('Cannot start a timer not part of a scene, timer wont start until added');\r\n    }\r\n\r\n    this._running = true;\r\n    if (this.complete) {\r\n      this._complete = false;\r\n      this._elapsedTime = 0;\r\n      this._numberOfTicks = 0;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Stops the timer and resets the elapsed time counter towards the next action invocation\r\n   */\r\n  public stop(): Timer {\r\n    this._running = false;\r\n    this._elapsedTime = 0;\r\n    this._numberOfTicks = 0;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Cancels the timer, preventing any further executions.\r\n   */\r\n  public cancel() {\r\n    this.pause();\r\n    if (this.scene) {\r\n      this.scene.cancelTimer(this);\r\n    }\r\n  }\r\n}\r\n","import { ExcaliburGraphicsContext } from '.';\r\nimport { Component } from '../EntityComponentSystem/Component';\r\n\r\n\r\n/**\r\n * Provide arbitrary drawing for the purposes of debugging your game\r\n *\r\n * Will only show when the Engine is set to debug mode [[Engine.showDebug]] or [[Engine.toggleDebug]]\r\n *\r\n */\r\nexport class DebugGraphicsComponent extends Component<'ex.debuggraphics'> {\r\n  readonly type = 'ex.debuggraphics';\r\n  constructor(public draw: (ctx: ExcaliburGraphicsContext) => void) {\r\n    super();\r\n  }\r\n}","import { BoundingBox } from './Collision/BoundingBox';\r\nimport { Engine } from './Engine';\r\nimport { Vector, vec } from './Math/vector';\r\nimport { Logger } from './Util/Log';\r\nimport { SpriteSheet } from './Drawing/SpriteSheet';\r\nimport * as Events from './Events';\r\nimport { Configurable } from './Configurable';\r\nimport { Entity } from './EntityComponentSystem/Entity';\r\nimport { TransformComponent } from './EntityComponentSystem/Components/TransformComponent';\r\nimport { BodyComponent } from './Collision/BodyComponent';\r\nimport { CollisionType } from './Collision/CollisionType';\r\nimport { Shape } from './Collision/Colliders/Shape';\r\nimport { ExcaliburGraphicsContext, GraphicsComponent, hasGraphicsTick } from './Graphics';\r\nimport * as Graphics from './Graphics';\r\nimport { CanvasDrawComponent, Sprite } from './Drawing/Index';\r\nimport { Sprite as LegacySprite } from './Drawing/Index';\r\nimport { removeItemFromArray } from './Util/Util';\r\nimport { obsolete } from './Util/Decorators';\r\nimport { MotionComponent } from './EntityComponentSystem/Components/MotionComponent';\r\nimport { ColliderComponent } from './Collision/ColliderComponent';\r\nimport { CompositeCollider } from './Collision/Colliders/CompositeCollider';\r\nimport { Color } from './Color';\r\nimport { DebugGraphicsComponent } from './Graphics/DebugGraphicsComponent';\r\n\r\n/**\r\n * @hidden\r\n */\r\nexport class TileMapImpl extends Entity {\r\n  private _token = 0;\r\n  private _onScreenXStart: number = 0;\r\n  private _onScreenXEnd: number = 9999;\r\n  private _onScreenYStart: number = 0;\r\n  private _onScreenYEnd: number = 9999;\r\n  private _spriteSheets: { [key: string]: Graphics.SpriteSheet } = {};\r\n\r\n  private _legacySpriteMap = new Map<Graphics.Sprite, Sprite>();\r\n  public logger: Logger = Logger.getInstance();\r\n  public readonly data: Cell[] = [];\r\n  private _rows: Cell[][] = [];\r\n  private _cols: Cell[][] = [];\r\n  public visible = true;\r\n  public isOffscreen = false;\r\n  public readonly cellWidth: number;\r\n  public readonly cellHeight: number;\r\n  public readonly rows: number;\r\n  public readonly cols: number;\r\n\r\n  private _dirty = true;\r\n  public flagDirty() {\r\n    this._dirty = true;\r\n  }\r\n  private _transform: TransformComponent;\r\n  private _motion: MotionComponent;\r\n  private _collider: ColliderComponent;\r\n  private _composite: CompositeCollider;\r\n\r\n  public get x(): number {\r\n    return this._transform.pos.x ?? 0;\r\n  }\r\n\r\n  public set x(val: number) {\r\n    if (this._transform?.pos) {\r\n      this.get(TransformComponent).pos = vec(val, this.y);\r\n    }\r\n  }\r\n\r\n  public get y(): number {\r\n    return this._transform?.pos.y ?? 0;\r\n  }\r\n\r\n  public set y(val: number) {\r\n    if (this._transform?.pos) {\r\n      this._transform.pos = vec(this.x, val);\r\n    }\r\n  }\r\n\r\n  public get z(): number {\r\n    return this._transform.z ?? 0;\r\n  }\r\n\r\n  public set z(val: number) {\r\n    if (this._transform) {\r\n      this._transform.z = val;\r\n    }\r\n  }\r\n\r\n  public get rotation(): number {\r\n    return this._transform?.rotation ?? 0;\r\n  }\r\n\r\n  public set rotation(val: number) {\r\n    if (this._transform?.rotation) {\r\n      this._transform.rotation = val;\r\n    }\r\n  }\r\n\r\n  public get scale(): Vector {\r\n    return this._transform?.scale ?? Vector.One;\r\n  }\r\n  public set scale(val: Vector) {\r\n    if (this._transform?.scale) {\r\n      this._transform.scale = val;\r\n    }\r\n  }\r\n\r\n  public get pos(): Vector {\r\n    return this._transform.pos;\r\n  }\r\n\r\n  public set pos(val: Vector) {\r\n    this._transform.pos = val;\r\n  }\r\n\r\n  public get vel(): Vector {\r\n    return this._motion.vel;\r\n  }\r\n\r\n  public set vel(val: Vector) {\r\n    this._motion.vel = val;\r\n  }\r\n\r\n  public on(eventName: Events.preupdate, handler: (event: Events.PreUpdateEvent<TileMap>) => void): void;\r\n  public on(eventName: Events.postupdate, handler: (event: Events.PostUpdateEvent<TileMap>) => void): void;\r\n  public on(eventName: Events.predraw, handler: (event: Events.PreDrawEvent) => void): void;\r\n  public on(eventName: Events.postdraw, handler: (event: Events.PostDrawEvent) => void): void;\r\n  public on(eventName: string, handler: (event: Events.GameEvent<any>) => void): void;\r\n  public on(eventName: string, handler: (event: any) => void): void {\r\n    super.on(eventName, handler);\r\n  }\r\n\r\n  /**\r\n   * @param xOrConfig     The x coordinate to anchor the TileMap's upper left corner (should not be changed once set) or TileMap option bag\r\n   * @param y             The y coordinate to anchor the TileMap's upper left corner (should not be changed once set)\r\n   * @param cellWidth     The individual width of each cell (in pixels) (should not be changed once set)\r\n   * @param cellHeight    The individual height of each cell (in pixels) (should not be changed once set)\r\n   * @param rows          The number of rows in the TileMap (should not be changed once set)\r\n   * @param cols          The number of cols in the TileMap (should not be changed once set)\r\n   */\r\n  constructor(xOrConfig: number | TileMapArgs, y: number, cellWidth: number, cellHeight: number, rows: number, cols: number) {\r\n    super();\r\n    if (xOrConfig && typeof xOrConfig === 'object') {\r\n      const config = xOrConfig;\r\n      xOrConfig = config.x;\r\n      y = config.y;\r\n      cellWidth = config.cellWidth;\r\n      cellHeight = config.cellHeight;\r\n      rows = config.rows;\r\n      cols = config.cols;\r\n    }\r\n    this.addComponent(new TransformComponent());\r\n    this.addComponent(new MotionComponent());\r\n    this.addComponent(\r\n      new BodyComponent({\r\n        type: CollisionType.Fixed\r\n      })\r\n    );\r\n    this.addComponent(new CanvasDrawComponent((ctx, delta) => this.draw(ctx, delta)));\r\n    this.addComponent(\r\n      new GraphicsComponent({\r\n        onPostDraw: (ctx, delta) => this.draw(ctx, delta)\r\n      })\r\n    );\r\n    this.addComponent(new DebugGraphicsComponent((ctx) => this.debug(ctx)));\r\n    this.addComponent(new ColliderComponent());\r\n    this._transform = this.get(TransformComponent);\r\n    this._motion = this.get(MotionComponent);\r\n    this._collider = this.get(ColliderComponent);\r\n    this._composite = this._collider.useCompositeCollider([]);\r\n\r\n    this.x = <number>xOrConfig;\r\n    this.y = y;\r\n    this.cellWidth = cellWidth;\r\n    this.cellHeight = cellHeight;\r\n    this.rows = rows;\r\n    this.cols = cols;\r\n    this.data = new Array<Cell>(rows * cols);\r\n    this._rows = new Array(rows);\r\n    this._cols = new Array(cols);\r\n    let currentCol: Cell[] = [];\r\n    for (let i = 0; i < cols; i++) {\r\n      for (let j = 0; j < rows; j++) {\r\n        const cd = new Cell(i * cellWidth + <number>xOrConfig, j * cellHeight + y, cellWidth, cellHeight, i + j * cols);\r\n        cd.map = this;\r\n        this.data[i + j * cols] = cd;\r\n        currentCol.push(cd);\r\n        if (!this._rows[j]) {\r\n          this._rows[j] = [];\r\n        }\r\n        this._rows[j].push(cd);\r\n      }\r\n      this._cols[i] = currentCol;\r\n      currentCol = [];\r\n    }\r\n\r\n    this.get(GraphicsComponent).localBounds = new BoundingBox({\r\n      left: 0,\r\n      top: 0,\r\n      right: this.cols * this.cellWidth,\r\n      bottom: this.rows * this.cellHeight\r\n    });\r\n  }\r\n\r\n  public _initialize(engine: Engine) {\r\n    super._initialize(engine);\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param key\r\n   * @param spriteSheet\r\n   * @deprecated No longer used, will be removed in v0.26.0\r\n   */\r\n  public registerSpriteSheet(key: string, spriteSheet: SpriteSheet): void;\r\n  public registerSpriteSheet(key: string, spriteSheet: Graphics.SpriteSheet): void;\r\n  @obsolete({ message: 'No longer used, will be removed in v0.26.0' })\r\n  public registerSpriteSheet(key: string, spriteSheet: SpriteSheet | Graphics.SpriteSheet): void {\r\n    if (spriteSheet instanceof Graphics.SpriteSheet) {\r\n      this._spriteSheets[key] = spriteSheet;\r\n    } else {\r\n      this._spriteSheets[key] = Graphics.SpriteSheet.fromLegacySpriteSheet(spriteSheet);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Tiles colliders based on the solid tiles in the tilemap.\r\n   */\r\n  private _updateColliders(): void {\r\n    this._composite.clearColliders();\r\n    const colliders: BoundingBox[] = [];\r\n    let current: BoundingBox;\r\n    // Bad square tesselation algo\r\n    for (let i = 0; i < this.cols; i++) {\r\n      // Scan column for colliders\r\n      for (let j = 0; j < this.rows; j++) {\r\n        // Columns start with a new collider\r\n        if (j === 0) {\r\n          current = null;\r\n        }\r\n        const tile = this.data[i + j * this.cols];\r\n        // Current tile in column is solid build up current collider\r\n        if (tile.solid) {\r\n          if (!current) {\r\n            current = tile.bounds;\r\n          } else {\r\n            current = current.combine(tile.bounds);\r\n          }\r\n        } else {\r\n          // Not solid skip and cut off the current collider\r\n          if (current) {\r\n            colliders.push(current);\r\n          }\r\n          current = null;\r\n        }\r\n      }\r\n      // After a column is complete check to see if it can be merged into the last one\r\n      if (current) {\r\n        // if previous is the same combine it\r\n        const prev = colliders[colliders.length - 1];\r\n        if (prev && prev.top === current.top && prev.bottom === current.bottom) {\r\n          colliders[colliders.length - 1] = prev.combine(current);\r\n        } else {\r\n          // else new collider\r\n          colliders.push(current);\r\n        }\r\n      }\r\n    }\r\n    this._composite = this._collider.useCompositeCollider([]);\r\n    for (const c of colliders) {\r\n      const collider = Shape.Box(c.width, c.height, Vector.Zero, vec(c.left - this.pos.x, c.top - this.pos.y));\r\n      collider.owner = this;\r\n      this._composite.addCollider(collider);\r\n    }\r\n    this._collider.update();\r\n  }\r\n\r\n  /**\r\n   * Returns the [[Cell]] by index (row major order)\r\n   */\r\n  public getCellByIndex(index: number): Cell {\r\n    return this.data[index];\r\n  }\r\n  /**\r\n   * Returns the [[Cell]] by its x and y coordinates\r\n   */\r\n  public getCell(x: number, y: number): Cell {\r\n    if (x < 0 || y < 0 || x >= this.cols || y >= this.rows) {\r\n      return null;\r\n    }\r\n    return this.data[x + y * this.cols];\r\n  }\r\n  /**\r\n   * Returns the [[Cell]] by testing a point in global coordinates,\r\n   * returns `null` if no cell was found.\r\n   */\r\n  public getCellByPoint(x: number, y: number): Cell {\r\n    x = Math.floor((x - this.pos.x) / this.cellWidth);\r\n    y = Math.floor((y - this.pos.y) / this.cellHeight);\r\n    const cell = this.getCell(x, y);\r\n    if (x >= 0 && y >= 0 && x < this.cols && y < this.rows && cell) {\r\n      return cell;\r\n    }\r\n    return null;\r\n  }\r\n\r\n  public getRows(): readonly Cell[][] {\r\n    return this._rows;\r\n  }\r\n\r\n  public getColumns(): readonly Cell[][] {\r\n    return this._cols;\r\n  }\r\n\r\n  public onPreUpdate(_engine: Engine, _delta: number) {\r\n    // Override me\r\n  }\r\n\r\n  public onPostUpdate(_engine: Engine, _delta: number) {\r\n    // Override me\r\n  }\r\n\r\n  public update(engine: Engine, delta: number) {\r\n    this.onPreUpdate(engine, delta);\r\n    this.emit('preupdate', new Events.PreUpdateEvent(engine, delta, this));\r\n    if (this._dirty) {\r\n      this._dirty = false;\r\n      this._updateColliders();\r\n    }\r\n\r\n    this._token++;\r\n    const worldBounds = engine.getWorldBounds();\r\n    const worldCoordsUpperLeft = vec(worldBounds.left, worldBounds.top);\r\n    const worldCoordsLowerRight = vec(worldBounds.right, worldBounds.bottom);\r\n\r\n    this._onScreenXStart = Math.max(Math.floor((worldCoordsUpperLeft.x - this.x) / this.cellWidth) - 2, 0);\r\n    this._onScreenYStart = Math.max(Math.floor((worldCoordsUpperLeft.y - this.y) / this.cellHeight) - 2, 0);\r\n    this._onScreenXEnd = Math.max(Math.floor((worldCoordsLowerRight.x - this.x) / this.cellWidth) + 2, 0);\r\n    this._onScreenYEnd = Math.max(Math.floor((worldCoordsLowerRight.y - this.y) / this.cellHeight) + 2, 0);\r\n    this._transform.pos = vec(this.x, this.y);\r\n\r\n    this.onPostUpdate(engine, delta);\r\n    this.emit('postupdate', new Events.PostUpdateEvent(engine, delta, this));\r\n  }\r\n\r\n  /**\r\n   * Draws the tile map to the screen. Called by the [[Scene]].\r\n   * @param ctx CanvasRenderingContext2D or ExcaliburGraphicsContext\r\n   * @param delta  The number of milliseconds since the last draw\r\n   */\r\n  public draw(ctx: CanvasRenderingContext2D | ExcaliburGraphicsContext, delta: number): void {\r\n    this.emit('predraw', new Events.PreDrawEvent(ctx as any, delta, this)); // TODO fix event\r\n\r\n    let x = this._onScreenXStart;\r\n    const xEnd = Math.min(this._onScreenXEnd, this.cols);\r\n    let y = this._onScreenYStart;\r\n    const yEnd = Math.min(this._onScreenYEnd, this.rows);\r\n\r\n    let graphics: Graphics.Graphic[], graphicsIndex: number, graphicsLen: number;\r\n\r\n    for (x; x < xEnd; x++) {\r\n      for (y; y < yEnd; y++) {\r\n        // get non-negative tile sprites\r\n        graphics = this.getCell(x, y).graphics;\r\n\r\n        for (graphicsIndex = 0, graphicsLen = graphics.length; graphicsIndex < graphicsLen; graphicsIndex++) {\r\n          // draw sprite, warning if sprite doesn't exist\r\n          const graphic = graphics[graphicsIndex];\r\n          if (graphic) {\r\n            if (!(ctx instanceof CanvasRenderingContext2D)) {\r\n              if (hasGraphicsTick(graphic)) {\r\n                graphic?.tick(delta, this._token);\r\n              }\r\n              graphic.draw(ctx, x * this.cellWidth, y * this.cellHeight);\r\n            } else if (graphic instanceof Graphics.Sprite) {\r\n              // TODO legacy drawing mode\r\n              if (!this._legacySpriteMap.has(graphic)) {\r\n                this._legacySpriteMap.set(graphic, Graphics.Sprite.toLegacySprite(graphic));\r\n              }\r\n              this._legacySpriteMap.get(graphic).draw(ctx, x * this.cellWidth, y * this.cellHeight);\r\n            }\r\n          }\r\n        }\r\n      }\r\n      y = this._onScreenYStart;\r\n    }\r\n\r\n    this.emit('postdraw', new Events.PostDrawEvent(ctx as any, delta, this));\r\n  }\r\n\r\n  public debug(gfx: ExcaliburGraphicsContext) {\r\n    const width = this.cellWidth * this.cols;\r\n    const height = this.cellHeight * this.rows;\r\n    const pos = Vector.Zero;\r\n    for (let r = 0; r < this.rows + 1; r++) {\r\n      const yOffset = vec(0, r * this.cellHeight);\r\n      gfx.drawLine(pos.add(yOffset), pos.add(vec(width, yOffset.y)), Color.Red, 2);\r\n    }\r\n\r\n    for (let c = 0; c < this.cols +1; c++) {\r\n      const xOffset = vec(c * this.cellWidth, 0);\r\n      gfx.drawLine(pos.add(xOffset), pos.add(vec(xOffset.x, height)), Color.Red, 2);\r\n    }\r\n\r\n    const colliders = this._composite.getColliders();\r\n    for (const collider of colliders) {\r\n      const grayish = Color.Gray;\r\n      grayish.a = 0.5;\r\n      const bounds = collider.localBounds;\r\n      const pos = collider.worldPos.sub(this.pos);\r\n      gfx.drawRectangle(pos, bounds.width, bounds.height, grayish);\r\n    }\r\n  }\r\n}\r\n\r\nexport interface TileMapArgs extends Partial<TileMapImpl> {\r\n  x: number;\r\n  y: number;\r\n  cellWidth: number;\r\n  cellHeight: number;\r\n  rows: number;\r\n  cols: number;\r\n}\r\n\r\n/**\r\n * The [[TileMap]] class provides a lightweight way to do large complex scenes with collision\r\n * without the overhead of actors.\r\n */\r\nexport class TileMap extends Configurable(TileMapImpl) {\r\n  constructor(config: TileMapArgs);\r\n  constructor(x: number, y: number, cellWidth: number, cellHeight: number, rows: number, cols: number);\r\n  constructor(xOrConfig: number | TileMapArgs, y?: number, cellWidth?: number, cellHeight?: number, rows?: number, cols?: number) {\r\n    super(xOrConfig, y, cellWidth, cellHeight, rows, cols);\r\n  }\r\n}\r\n\r\n/**\r\n * @hidden\r\n */\r\nexport class CellImpl extends Entity {\r\n  private _bounds: BoundingBox;\r\n  /**\r\n   * World space x coordinate of the left of the cell\r\n   */\r\n  public readonly x: number;\r\n  /**\r\n   * World space y coordinate of the top of the cell\r\n   */\r\n  public readonly y: number;\r\n  /**\r\n   * Width of the cell in pixels\r\n   */\r\n  public readonly width: number;\r\n  /**\r\n   * Height of the cell in pixels\r\n   */\r\n  public readonly height: number;\r\n  /**\r\n   * Current index in the tilemap\r\n   */\r\n  public readonly index: number;\r\n\r\n  /**\r\n   * Reference to the TileMap this Cell is associated with\r\n   */\r\n  public map: TileMap;\r\n\r\n  private _solid = false;\r\n  /**\r\n   * Wether this cell should be treated as solid by the tilemap\r\n   */\r\n  public get solid(): boolean {\r\n    return this._solid;\r\n  }\r\n  /**\r\n   * Wether this cell should be treated as solid by the tilemap\r\n   */\r\n  public set solid(val: boolean) {\r\n    this.map?.flagDirty();\r\n    this._solid = val;\r\n  }\r\n  /**\r\n   * Current list of graphics for this cell\r\n   */\r\n  public readonly graphics: Graphics.Graphic[] = [];\r\n  /**\r\n   * Arbitrary data storage per cell, useful for any game specific data\r\n   */\r\n  public data = new Map<string, any>();\r\n\r\n  /**\r\n   * @param xOrConfig Gets or sets x coordinate of the cell in world coordinates or cell option bag\r\n   * @param y       Gets or sets y coordinate of the cell in world coordinates\r\n   * @param width   Gets or sets the width of the cell\r\n   * @param height  Gets or sets the height of the cell\r\n   * @param index   The index of the cell in row major order\r\n   * @param solid   Gets or sets whether this cell is solid\r\n   * @param graphics The list of tile graphics to use to draw in this cell (in order)\r\n   */\r\n  constructor(\r\n    xOrConfig: number | CellArgs,\r\n    y: number,\r\n    width: number,\r\n    height: number,\r\n    index: number,\r\n    solid: boolean = false,\r\n    graphics: Graphics.Graphic[] = []\r\n  ) {\r\n    super();\r\n    if (xOrConfig && typeof xOrConfig === 'object') {\r\n      const config = xOrConfig;\r\n      xOrConfig = config.x;\r\n      y = config.y;\r\n      width = config.width;\r\n      height = config.height;\r\n      index = config.index;\r\n      solid = config.solid;\r\n      graphics = config.sprites;\r\n    }\r\n    this.x = <number>xOrConfig;\r\n    this.y = y;\r\n    this.width = width;\r\n    this.height = height;\r\n    this.index = index;\r\n    this.solid = solid;\r\n    this.graphics = graphics;\r\n    this._bounds = new BoundingBox(this.x, this.y, this.x + this.width, this.y + this.height);\r\n  }\r\n\r\n  public get bounds() {\r\n    return this._bounds;\r\n  }\r\n\r\n  public get center(): Vector {\r\n    return new Vector(this.x + this.width / 2, this.y + this.height / 2);\r\n  }\r\n\r\n  /**\r\n   * Add another [[Sprite]] to this cell\r\n   * @deprecated Use addSprite, will be removed in v0.26.0\r\n   */\r\n  @obsolete({ message: 'Will be removed in v0.26.0', alternateMethod: 'addSprite' })\r\n  public pushSprite(sprite: Graphics.Sprite | LegacySprite) {\r\n    this.addGraphic(sprite);\r\n  }\r\n\r\n  /**\r\n   * Add another [[Graphic]] to this TileMap cell\r\n   * @param graphic\r\n   */\r\n  public addGraphic(graphic: Graphics.Graphic | LegacySprite) {\r\n    if (graphic instanceof LegacySprite) {\r\n      this.graphics.push(Graphics.Sprite.fromLegacySprite(graphic));\r\n    } else {\r\n      this.graphics.push(graphic);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Remove an instance of a [[Graphic]] from this cell\r\n   */\r\n  public removeGraphic(graphic: Graphics.Graphic | LegacySprite) {\r\n    removeItemFromArray(graphic, this.graphics);\r\n  }\r\n\r\n  /**\r\n   * Clear all graphics from this cell\r\n   */\r\n  public clearGraphics() {\r\n    this.graphics.length = 0;\r\n  }\r\n}\r\n\r\nexport interface CellArgs extends Partial<CellImpl> {\r\n  x: number;\r\n  y: number;\r\n  width: number;\r\n  height: number;\r\n  index: number;\r\n  solid?: boolean;\r\n  sprites?: Graphics.Sprite[];\r\n}\r\n\r\n/**\r\n * TileMap Cell\r\n *\r\n * A light-weight object that occupies a space in a collision map. Generally\r\n * created by a [[TileMap]].\r\n *\r\n * Cells can draw multiple sprites. Note that the order of drawing is the order\r\n * of the sprites in the array so the last one will be drawn on top. You can\r\n * use transparency to create layers this way.\r\n */\r\nexport class Cell extends Configurable(CellImpl) {\r\n  constructor(config: CellArgs);\r\n  constructor(x: number, y: number, width: number, height: number, index: number, solid?: boolean, sprites?: Graphics.Sprite[]);\r\n  constructor(\r\n    xOrConfig: number | CellArgs,\r\n    y?: number,\r\n    width?: number,\r\n    height?: number,\r\n    index?: number,\r\n    solid?: boolean,\r\n    sprites?: Graphics.Sprite[]\r\n  ) {\r\n    super(xOrConfig, y, width, height, index, solid, sprites);\r\n  }\r\n}\r\n","import { Engine } from './Engine';\r\nimport { Screen } from './Screen';\r\nimport { EasingFunction, EasingFunctions } from './Util/EasingFunctions';\r\nimport { Vector, vec } from './Math/vector';\r\nimport { Actor } from './Actor';\r\nimport { removeItemFromArray } from './Util/Util';\r\nimport { CanUpdate, CanInitialize } from './Interfaces/LifecycleEvents';\r\nimport { PreUpdateEvent, PostUpdateEvent, GameEvent, InitializeEvent } from './Events';\r\nimport { Class } from './Class';\r\nimport { BoundingBox } from './Collision/BoundingBox';\r\nimport { Logger } from './Util/Log';\r\nimport { ExcaliburGraphicsContext } from './Graphics/Context/ExcaliburGraphicsContext';\r\nimport { watchAny } from './Util/Watch';\r\nimport { Matrix } from './Math/matrix';\r\n\r\n/**\r\n * Interface that describes a custom camera strategy for tracking targets\r\n */\r\nexport interface CameraStrategy<T> {\r\n  /**\r\n   * Target of the camera strategy that will be passed to the action\r\n   */\r\n  target: T;\r\n\r\n  /**\r\n   * Camera strategies perform an action to calculate a new focus returned out of the strategy\r\n   * @param target The target object to apply this camera strategy (if any)\r\n   * @param camera The current camera implementation in excalibur running the game\r\n   * @param engine The current engine running the game\r\n   * @param delta The elapsed time in milliseconds since the last frame\r\n   */\r\n  action: (target: T, camera: Camera, engine: Engine, delta: number) => Vector;\r\n}\r\n\r\n/**\r\n * Container to house convenience strategy methods\r\n * @internal\r\n */\r\nexport class StrategyContainer {\r\n  constructor(public camera: Camera) {}\r\n\r\n  /**\r\n   * Creates and adds the [[LockCameraToActorStrategy]] on the current camera.\r\n   * @param actor The actor to lock the camera to\r\n   */\r\n  public lockToActor(actor: Actor) {\r\n    this.camera.addStrategy(new LockCameraToActorStrategy(actor));\r\n  }\r\n\r\n  /**\r\n   * Creates and adds the [[LockCameraToActorAxisStrategy]] on the current camera\r\n   * @param actor The actor to lock the camera to\r\n   * @param axis The axis to follow the actor on\r\n   */\r\n  public lockToActorAxis(actor: Actor, axis: Axis) {\r\n    this.camera.addStrategy(new LockCameraToActorAxisStrategy(actor, axis));\r\n  }\r\n\r\n  /**\r\n   * Creates and adds the [[ElasticToActorStrategy]] on the current camera\r\n   * If cameraElasticity < cameraFriction < 1.0, the behavior will be a dampened spring that will slowly end at the target without bouncing\r\n   * If cameraFriction < cameraElasticity < 1.0, the behavior will be an oscillating spring that will over\r\n   * correct and bounce around the target\r\n   *\r\n   * @param actor Target actor to elastically follow\r\n   * @param cameraElasticity [0 - 1.0] The higher the elasticity the more force that will drive the camera towards the target\r\n   * @param cameraFriction [0 - 1.0] The higher the friction the more that the camera will resist motion towards the target\r\n   */\r\n  public elasticToActor(actor: Actor, cameraElasticity: number, cameraFriction: number) {\r\n    this.camera.addStrategy(new ElasticToActorStrategy(actor, cameraElasticity, cameraFriction));\r\n  }\r\n\r\n  /**\r\n   * Creates and adds the [[RadiusAroundActorStrategy]] on the current camera\r\n   * @param actor Target actor to follow when it is \"radius\" pixels away\r\n   * @param radius Number of pixels away before the camera will follow\r\n   */\r\n  public radiusAroundActor(actor: Actor, radius: number) {\r\n    this.camera.addStrategy(new RadiusAroundActorStrategy(actor, radius));\r\n  }\r\n\r\n  /**\r\n   * Creates and adds the [[LimitCameraBoundsStrategy]] on the current camera\r\n   * @param box The bounding box to limit the camera to.\r\n   */\r\n  public limitCameraBounds(box: BoundingBox) {\r\n    this.camera.addStrategy(new LimitCameraBoundsStrategy(box));\r\n  }\r\n}\r\n\r\n/**\r\n * Camera axis enum\r\n */\r\nexport enum Axis {\r\n  X,\r\n  Y\r\n}\r\n\r\n/**\r\n * Lock a camera to the exact x/y position of an actor.\r\n */\r\nexport class LockCameraToActorStrategy implements CameraStrategy<Actor> {\r\n  constructor(public target: Actor) {}\r\n  public action = (target: Actor, _cam: Camera, _eng: Engine, _delta: number) => {\r\n    const center = target.center;\r\n    return center;\r\n  };\r\n}\r\n\r\n/**\r\n * Lock a camera to a specific axis around an actor.\r\n */\r\nexport class LockCameraToActorAxisStrategy implements CameraStrategy<Actor> {\r\n  constructor(public target: Actor, public axis: Axis) {}\r\n  public action = (target: Actor, cam: Camera, _eng: Engine, _delta: number) => {\r\n    const center = target.center;\r\n    const currentFocus = cam.getFocus();\r\n    if (this.axis === Axis.X) {\r\n      return new Vector(center.x, currentFocus.y);\r\n    } else {\r\n      return new Vector(currentFocus.x, center.y);\r\n    }\r\n  };\r\n}\r\n\r\n/**\r\n * Using [Hook's law](https://en.wikipedia.org/wiki/Hooke's_law), elastically move the camera towards the target actor.\r\n */\r\nexport class ElasticToActorStrategy implements CameraStrategy<Actor> {\r\n  /**\r\n   * If cameraElasticity < cameraFriction < 1.0, the behavior will be a dampened spring that will slowly end at the target without bouncing\r\n   * If cameraFriction < cameraElasticity < 1.0, the behavior will be an oscillating spring that will over\r\n   * correct and bounce around the target\r\n   *\r\n   * @param target Target actor to elastically follow\r\n   * @param cameraElasticity [0 - 1.0] The higher the elasticity the more force that will drive the camera towards the target\r\n   * @param cameraFriction [0 - 1.0] The higher the friction the more that the camera will resist motion towards the target\r\n   */\r\n  constructor(public target: Actor, public cameraElasticity: number, public cameraFriction: number) {}\r\n  public action = (target: Actor, cam: Camera, _eng: Engine, _delta: number) => {\r\n    const position = target.center;\r\n    let focus = cam.getFocus();\r\n    let cameraVel = cam.vel.clone();\r\n\r\n    // Calculate the stretch vector, using the spring equation\r\n    // F = kX\r\n    // https://en.wikipedia.org/wiki/Hooke's_law\r\n    // Apply to the current camera velocity\r\n    const stretch = position.sub(focus).scale(this.cameraElasticity); // stretch is X\r\n    cameraVel = cameraVel.add(stretch);\r\n\r\n    // Calculate the friction (-1 to apply a force in the opposition of motion)\r\n    // Apply to the current camera velocity\r\n    const friction = cameraVel.scale(-1).scale(this.cameraFriction);\r\n    cameraVel = cameraVel.add(friction);\r\n\r\n    // Update position by velocity deltas\r\n    focus = focus.add(cameraVel);\r\n\r\n    return focus;\r\n  };\r\n}\r\n\r\nexport class RadiusAroundActorStrategy implements CameraStrategy<Actor> {\r\n  /**\r\n   *\r\n   * @param target Target actor to follow when it is \"radius\" pixels away\r\n   * @param radius Number of pixels away before the camera will follow\r\n   */\r\n  constructor(public target: Actor, public radius: number) {}\r\n  public action = (target: Actor, cam: Camera, _eng: Engine, _delta: number) => {\r\n    const position = target.center;\r\n    const focus = cam.getFocus();\r\n\r\n    const direction = position.sub(focus);\r\n    const distance = direction.size;\r\n    if (distance >= this.radius) {\r\n      const offset = distance - this.radius;\r\n      return focus.add(direction.normalize().scale(offset));\r\n    }\r\n    return focus;\r\n  };\r\n}\r\n\r\n/**\r\n * Prevent a camera from going beyond the given camera dimensions.\r\n */\r\nexport class LimitCameraBoundsStrategy implements CameraStrategy<BoundingBox> {\r\n  /**\r\n   * Useful for limiting the camera to a [[TileMap]]'s dimensions, or a specific area inside the map.\r\n   *\r\n   * Note that this strategy does not perform any movement by itself.\r\n   * It only sets the camera position to within the given bounds when the camera has gone beyond them.\r\n   * Thus, it is a good idea to combine it with other camera strategies and set this strategy as the last one.\r\n   *\r\n   * Make sure that the camera bounds are at least as large as the viewport size.\r\n   *\r\n   * @param target The bounding box to limit the camera to\r\n   */\r\n\r\n  boundSizeChecked: boolean = false; // Check and warn only once\r\n\r\n  constructor(public target: BoundingBox) {}\r\n\r\n  public action = (target: BoundingBox, cam: Camera, _eng: Engine, _delta: number) => {\r\n    const focus = cam.getFocus();\r\n\r\n    if (!this.boundSizeChecked) {\r\n      if (target.bottom - target.top < _eng.drawHeight || target.right - target.left < _eng.drawWidth) {\r\n        Logger.getInstance().warn('Camera bounds should not be smaller than the engine viewport');\r\n      }\r\n      this.boundSizeChecked = true;\r\n    }\r\n\r\n    let focusX = focus.x;\r\n    let focusY = focus.y;\r\n    if (focus.x < target.left + _eng.halfDrawWidth) {\r\n      focusX = target.left + _eng.halfDrawWidth;\r\n    } else if (focus.x > target.right - _eng.halfDrawWidth) {\r\n      focusX = target.right - _eng.halfDrawWidth;\r\n    }\r\n\r\n    if (focus.y < target.top + _eng.halfDrawHeight) {\r\n      focusY = target.top + _eng.halfDrawHeight;\r\n    } else if (focus.y > target.bottom - _eng.halfDrawHeight) {\r\n      focusY = target.bottom - _eng.halfDrawHeight;\r\n    }\r\n\r\n    return vec(focusX, focusY);\r\n  };\r\n}\r\n\r\n/**\r\n * Cameras\r\n *\r\n * [[Camera]] is the base class for all Excalibur cameras. Cameras are used\r\n * to move around your game and set focus. They are used to determine\r\n * what is \"off screen\" and can be used to scale the game.\r\n *\r\n */\r\nexport class Camera extends Class implements CanUpdate, CanInitialize {\r\n  public transform: Matrix = Matrix.identity();\r\n  public inverse: Matrix = Matrix.identity();\r\n\r\n\r\n  protected _follow: Actor;\r\n\r\n  private _cameraStrategies: CameraStrategy<any>[] = [];\r\n\r\n  public strategy: StrategyContainer = new StrategyContainer(this);\r\n\r\n  /**\r\n   * Get or set current zoom of the camera, defaults to 1\r\n   */\r\n  private _z = 1;\r\n  public get zoom(): number {\r\n    return this._z;\r\n  }\r\n\r\n  public set zoom(val: number) {\r\n    this._z = val;\r\n    if (this._engine) {\r\n      this._halfWidth = this._engine.halfDrawWidth;\r\n      this._halfHeight = this._engine.halfDrawHeight;\r\n    }\r\n  }\r\n  /**\r\n   * Get or set rate of change in zoom, defaults to 0\r\n   */\r\n  public dz: number = 0;\r\n  /**\r\n   * Get or set zoom acceleration\r\n   */\r\n  public az: number = 0;\r\n\r\n  /**\r\n   * Current rotation of the camera\r\n   */\r\n  public rotation: number = 0;\r\n\r\n  /**\r\n   * Current angular velocity\r\n   * @deprecated will be removed in v0.26.0, use angularVelocity\r\n   */\r\n  public rx: number = 0;\r\n\r\n  /**\r\n   * Get or set the camera's angular velocity\r\n   */\r\n  public get angularVelocity(): number {\r\n    return this.rx;\r\n  }\r\n\r\n  public set angularVelocity(value: number) {\r\n    this.rx = value;\r\n  }\r\n\r\n  /**\r\n   * Get or set the camera's position\r\n   */\r\n  private _posChanged = false;\r\n  private _pos: Vector = watchAny(Vector.Zero, () => (this._posChanged = true));\r\n  public get pos(): Vector {\r\n    return this._pos;\r\n  }\r\n  public set pos(vec: Vector) {\r\n    this._pos = watchAny(vec, () => (this._posChanged = true));\r\n    this._posChanged = true;\r\n  }\r\n\r\n  /**\r\n   * Get or set the camera's velocity\r\n   */\r\n  public vel: Vector = Vector.Zero;\r\n\r\n  /**\r\n   * Get or set the camera's acceleration\r\n   */\r\n  public acc: Vector = Vector.Zero;\r\n\r\n  private _cameraMoving: boolean = false;\r\n  private _currentLerpTime: number = 0;\r\n  private _lerpDuration: number = 1000; // 1 second\r\n  private _lerpStart: Vector = null;\r\n  private _lerpEnd: Vector = null;\r\n  private _lerpResolve: (value: Vector) => void;\r\n  private _lerpPromise: Promise<Vector>;\r\n\r\n  //camera effects\r\n  protected _isShaking: boolean = false;\r\n  private _shakeMagnitudeX: number = 0;\r\n  private _shakeMagnitudeY: number = 0;\r\n  private _shakeDuration: number = 0;\r\n  private _elapsedShakeTime: number = 0;\r\n  private _xShake: number = 0;\r\n  private _yShake: number = 0;\r\n\r\n  protected _isZooming: boolean = false;\r\n  private _zoomStart: number = 1;\r\n  private _zoomEnd: number = 1;\r\n  private _currentZoomTime: number = 0;\r\n  private _zoomDuration: number = 0;\r\n\r\n  private _zoomResolve: (val: boolean) => void;\r\n  private _zoomPromise: Promise<boolean>;\r\n  private _zoomEasing: EasingFunction = EasingFunctions.EaseInOutCubic;\r\n  private _easing: EasingFunction = EasingFunctions.EaseInOutCubic;\r\n\r\n  private _halfWidth: number = 0;\r\n  private _halfHeight: number = 0;\r\n\r\n  /**\r\n   * Get the camera's x position\r\n   */\r\n  public get x() {\r\n    return this.pos.x;\r\n  }\r\n\r\n  /**\r\n   * Set the camera's x position (cannot be set when following an [[Actor]] or when moving)\r\n   */\r\n  public set x(value: number) {\r\n    if (!this._follow && !this._cameraMoving) {\r\n      this.pos = vec(value, this.pos.y);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get the camera's y position\r\n   */\r\n  public get y() {\r\n    return this.pos.y;\r\n  }\r\n\r\n  /**\r\n   * Set the camera's y position (cannot be set when following an [[Actor]] or when moving)\r\n   */\r\n  public set y(value: number) {\r\n    if (!this._follow && !this._cameraMoving) {\r\n      this.pos = vec(this.pos.x, value);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get or set the camera's x velocity\r\n   */\r\n  public get dx() {\r\n    return this.vel.x;\r\n  }\r\n\r\n  public set dx(value: number) {\r\n    this.vel = vec(value, this.vel.y);\r\n  }\r\n\r\n  /**\r\n   * Get or set the camera's y velocity\r\n   */\r\n  public get dy() {\r\n    return this.vel.y;\r\n  }\r\n\r\n  public set dy(value: number) {\r\n    this.vel = vec(this.vel.x, value);\r\n  }\r\n\r\n  /**\r\n   * Get or set the camera's x acceleration\r\n   */\r\n  public get ax() {\r\n    return this.acc.x;\r\n  }\r\n\r\n  public set ax(value: number) {\r\n    this.acc = vec(value, this.acc.y);\r\n  }\r\n\r\n  /**\r\n   * Get or set the camera's y acceleration\r\n   */\r\n  public get ay() {\r\n    return this.acc.y;\r\n  }\r\n\r\n  public set ay(value: number) {\r\n    this.acc = vec(this.acc.x, value);\r\n  }\r\n\r\n  /**\r\n   * Returns the focal point of the camera, a new point giving the x and y position of the camera\r\n   */\r\n  public getFocus() {\r\n    return this.pos;\r\n  }\r\n\r\n  /**\r\n   * This moves the camera focal point to the specified position using specified easing function. Cannot move when following an Actor.\r\n   *\r\n   * @param pos The target position to move to\r\n   * @param duration The duration in milliseconds the move should last\r\n   * @param [easingFn] An optional easing function ([[ex.EasingFunctions.EaseInOutCubic]] by default)\r\n   * @returns A [[Promise]] that resolves when movement is finished, including if it's interrupted.\r\n   *          The [[Promise]] value is the [[Vector]] of the target position. It will be rejected if a move cannot be made.\r\n   */\r\n  public move(pos: Vector, duration: number, easingFn: EasingFunction = EasingFunctions.EaseInOutCubic): Promise<Vector> {\r\n    if (typeof easingFn !== 'function') {\r\n      throw 'Please specify an EasingFunction';\r\n    }\r\n\r\n    // cannot move when following an actor\r\n    if (this._follow) {\r\n      return Promise.reject(pos);\r\n    }\r\n\r\n    // resolve existing promise, if any\r\n    if (this._lerpPromise && this._lerpResolve) {\r\n      this._lerpResolve(pos);\r\n    }\r\n\r\n    this._lerpPromise = new Promise<Vector>((resolve) => {\r\n      this._lerpResolve = resolve;\r\n    });\r\n    this._lerpStart = this.getFocus().clone();\r\n    this._lerpDuration = duration;\r\n    this._lerpEnd = pos;\r\n    this._currentLerpTime = 0;\r\n    this._cameraMoving = true;\r\n    this._easing = easingFn;\r\n\r\n    return this._lerpPromise;\r\n  }\r\n\r\n  /**\r\n   * Sets the camera to shake at the specified magnitudes for the specified duration\r\n   * @param magnitudeX  The x magnitude of the shake\r\n   * @param magnitudeY  The y magnitude of the shake\r\n   * @param duration    The duration of the shake in milliseconds\r\n   */\r\n  public shake(magnitudeX: number, magnitudeY: number, duration: number) {\r\n    this._isShaking = true;\r\n    this._shakeMagnitudeX = magnitudeX;\r\n    this._shakeMagnitudeY = magnitudeY;\r\n    this._shakeDuration = duration;\r\n  }\r\n\r\n  /**\r\n   * Zooms the camera in or out by the specified scale over the specified duration.\r\n   * If no duration is specified, it take effect immediately.\r\n   * @param scale    The scale of the zoom\r\n   * @param duration The duration of the zoom in milliseconds\r\n   */\r\n  public zoomOverTime(scale: number, duration: number = 0, easingFn: EasingFunction = EasingFunctions.EaseInOutCubic): Promise<boolean> {\r\n    this._zoomPromise = new Promise<boolean>((resolve) => {\r\n      this._zoomResolve = resolve;\r\n    });\r\n\r\n    if (duration) {\r\n      this._isZooming = true;\r\n      this._zoomEasing = easingFn;\r\n      this._currentZoomTime = 0;\r\n      this._zoomDuration = duration;\r\n      this._zoomStart = this.zoom;\r\n      this._zoomEnd = scale;\r\n    } else {\r\n      this._isZooming = false;\r\n      this.zoom = scale;\r\n      return Promise.resolve(true);\r\n    }\r\n\r\n    return this._zoomPromise;\r\n  }\r\n\r\n  private _viewport: BoundingBox = null;\r\n  /**\r\n   * Gets the bounding box of the viewport of this camera in world coordinates\r\n   */\r\n  public get viewport(): BoundingBox {\r\n    if (this._viewport) {\r\n      return this._viewport;\r\n    }\r\n\r\n    return new BoundingBox(0, 0, 0, 0);\r\n  }\r\n\r\n  /**\r\n   * Adds a new camera strategy to this camera\r\n   * @param cameraStrategy Instance of an [[CameraStrategy]]\r\n   */\r\n  public addStrategy<T>(cameraStrategy: CameraStrategy<T>) {\r\n    this._cameraStrategies.push(cameraStrategy);\r\n  }\r\n\r\n  /**\r\n   * Removes a camera strategy by reference\r\n   * @param cameraStrategy Instance of an [[CameraStrategy]]\r\n   */\r\n  public removeStrategy<T>(cameraStrategy: CameraStrategy<T>) {\r\n    removeItemFromArray(cameraStrategy, this._cameraStrategies);\r\n  }\r\n\r\n  /**\r\n   * Clears all camera strategies from the camera\r\n   */\r\n  public clearAllStrategies() {\r\n    this._cameraStrategies.length = 0;\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _preupdate handler for [[onPreUpdate]] lifecycle event\r\n   * @internal\r\n   */\r\n  public _preupdate(engine: Engine, delta: number): void {\r\n    this.emit('preupdate', new PreUpdateEvent(engine, delta, this));\r\n    this.onPreUpdate(engine, delta);\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPreUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\r\n   *\r\n   * `onPreUpdate` is called directly before a scene is updated.\r\n   */\r\n  public onPreUpdate(_engine: Engine, _delta: number): void {\r\n    // Overridable\r\n  }\r\n\r\n  /**\r\n   *  It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _preupdate handler for [[onPostUpdate]] lifecycle event\r\n   * @internal\r\n   */\r\n  public _postupdate(engine: Engine, delta: number): void {\r\n    this.emit('postupdate', new PostUpdateEvent(engine, delta, this));\r\n    this.onPostUpdate(engine, delta);\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPostUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\r\n   *\r\n   * `onPostUpdate` is called directly after a scene is updated.\r\n   */\r\n  public onPostUpdate(_engine: Engine, _delta: number): void {\r\n    // Overridable\r\n  }\r\n\r\n  private _engine: Engine;\r\n  private _screen: Screen;\r\n  private _isInitialized = false;\r\n  public get isInitialized() {\r\n    return this._isInitialized;\r\n  }\r\n\r\n  public _initialize(_engine: Engine) {\r\n    if (!this.isInitialized) {\r\n      this._engine = _engine;\r\n      this._screen = _engine.screen;\r\n\r\n      const currentRes = this._screen.resolution;\r\n      let center = vec(currentRes.width / 2, currentRes.height / 2);\r\n      if (!this._engine.loadingComplete) {\r\n        // If there was a loading screen, we peek the configured resolution\r\n        const res = this._screen.peekResolution();\r\n        if (res) {\r\n          center = vec(res.width / 2, res.height / 2);\r\n        }\r\n      }\r\n      this._halfWidth = center.x;\r\n      this._halfHeight = center.y;\r\n\r\n      // If the user has not set the camera pos, apply default center screen position\r\n      if (!this._posChanged) {\r\n        this.pos = center;\r\n      }\r\n      // First frame bootstrap\r\n\r\n      // Ensure camera tx is correct\r\n      this.updateTransform();\r\n\r\n      // Run strategies for first frame\r\n      this.runStrategies(_engine, _engine.clock.elapsed());\r\n\r\n      // Setup the first frame viewport\r\n      this.updateViewport();\r\n\r\n      this.onInitialize(_engine);\r\n      super.emit('initialize', new InitializeEvent(_engine, this));\r\n      this._isInitialized = true;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPostUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\r\n   *\r\n   * `onPostUpdate` is called directly after a scene is updated.\r\n   */\r\n  public onInitialize(_engine: Engine) {\r\n    // Overridable\r\n  }\r\n\r\n  public on(eventName: 'initialize', handler: (event: InitializeEvent) => void): void;\r\n  public on(eventName: 'preupdate', handler: (event: PreUpdateEvent) => void): void;\r\n  public on(eventName: 'postupdate', handler: (event: PostUpdateEvent) => void): void;\r\n  public on(eventName: any, handler: any) {\r\n    super.on(eventName, handler);\r\n  }\r\n\r\n  public off(eventName: 'initialize', handler?: (event: InitializeEvent) => void): void;\r\n  public off(eventName: 'preupdate', handler?: (event: PreUpdateEvent) => void): void;\r\n  public off(eventName: 'postupdate', handler?: (event: PostUpdateEvent) => void): void;\r\n  public off(eventName: string, handler: (event: GameEvent<Camera>) => void): void;\r\n  public off(eventName: string, handler: (event: any) => void): void {\r\n    super.off(eventName, handler);\r\n  }\r\n\r\n  public once(eventName: 'initialize', handler: (event: InitializeEvent) => void): void;\r\n  public once(eventName: 'preupdate', handler: (event: PreUpdateEvent) => void): void;\r\n  public once(eventName: 'postupdate', handler: (event: PostUpdateEvent) => void): void;\r\n  public once(eventName: string, handler: (event: GameEvent<Camera>) => void): void;\r\n  public once(eventName: string, handler: (event: any) => void): void {\r\n    super.once(eventName, handler);\r\n  }\r\n\r\n  public runStrategies(engine: Engine, delta: number) {\r\n    for (const s of this._cameraStrategies) {\r\n      this.pos = s.action.call(s, s.target, this, engine, delta);\r\n    }\r\n  }\r\n\r\n  public updateViewport() {\r\n    // recalc viewport\r\n    this._viewport = new BoundingBox(\r\n      this.x - this._halfWidth,\r\n      this.y - this._halfHeight,\r\n      this.x + this._halfWidth,\r\n      this.y + this._halfHeight\r\n    );\r\n  }\r\n\r\n  public update(_engine: Engine, delta: number) {\r\n    this._initialize(_engine);\r\n    this._preupdate(_engine, delta);\r\n\r\n    // Update placements based on linear algebra\r\n    this.pos = this.pos.add(this.vel.scale(delta / 1000));\r\n    this.zoom += (this.dz * delta) / 1000;\r\n\r\n    this.vel = this.vel.add(this.acc.scale(delta / 1000));\r\n    this.dz += (this.az * delta) / 1000;\r\n\r\n    this.rotation += (this.angularVelocity * delta) / 1000;\r\n\r\n    if (this._isZooming) {\r\n      if (this._currentZoomTime < this._zoomDuration) {\r\n        const zoomEasing = this._zoomEasing;\r\n        const newZoom = zoomEasing(this._currentZoomTime, this._zoomStart, this._zoomEnd, this._zoomDuration);\r\n\r\n        this.zoom = newZoom;\r\n        this._currentZoomTime += delta;\r\n      } else {\r\n        this._isZooming = false;\r\n        this.zoom = this._zoomEnd;\r\n        this._currentZoomTime = 0;\r\n        this._zoomResolve(true);\r\n      }\r\n    }\r\n\r\n    if (this._cameraMoving) {\r\n      if (this._currentLerpTime < this._lerpDuration) {\r\n        const moveEasing = EasingFunctions.CreateVectorEasingFunction(this._easing);\r\n\r\n        const lerpPoint = moveEasing(this._currentLerpTime, this._lerpStart, this._lerpEnd, this._lerpDuration);\r\n\r\n        this.pos = lerpPoint;\r\n\r\n        this._currentLerpTime += delta;\r\n      } else {\r\n        this.pos = this._lerpEnd;\r\n        const end = this._lerpEnd.clone();\r\n\r\n        this._lerpStart = null;\r\n        this._lerpEnd = null;\r\n        this._currentLerpTime = 0;\r\n        this._cameraMoving = false;\r\n        // Order matters here, resolve should be last so any chain promises have a clean slate\r\n        this._lerpResolve(end);\r\n      }\r\n    }\r\n\r\n    if (this._isDoneShaking()) {\r\n      this._isShaking = false;\r\n      this._elapsedShakeTime = 0;\r\n      this._shakeMagnitudeX = 0;\r\n      this._shakeMagnitudeY = 0;\r\n      this._shakeDuration = 0;\r\n      this._xShake = 0;\r\n      this._yShake = 0;\r\n    } else {\r\n      this._elapsedShakeTime += delta;\r\n      this._xShake = ((Math.random() * this._shakeMagnitudeX) | 0) + 1;\r\n      this._yShake = ((Math.random() * this._shakeMagnitudeY) | 0) + 1;\r\n    }\r\n\r\n    this.updateTransform();\r\n\r\n    this.runStrategies(_engine, delta);\r\n\r\n    this.updateViewport();\r\n\r\n    this._postupdate(_engine, delta);\r\n  }\r\n\r\n  /**\r\n   * Applies the relevant transformations to the game canvas to \"move\" or apply effects to the Camera\r\n   * @param ctx Canvas context to apply transformations\r\n   */\r\n  public draw(ctx: CanvasRenderingContext2D): void;\r\n  public draw(ctx: ExcaliburGraphicsContext): void;\r\n  public draw(ctx: CanvasRenderingContext2D | ExcaliburGraphicsContext): void {\r\n    // Apply transform\r\n    if (ctx instanceof CanvasRenderingContext2D) {\r\n      // TODO This will be removed in v0.26.0\r\n      const focus = this.getFocus();\r\n\r\n      // center the camera\r\n      const newCanvasWidth = this._screen.resolution.width / this.zoom;\r\n      const newCanvasHeight = this._screen.resolution.height / this.zoom;\r\n      const cameraPos = vec(-focus.x + newCanvasWidth / 2 + this._xShake, -focus.y + newCanvasHeight / 2 + this._yShake);\r\n      ctx.scale(this.zoom, this.zoom);\r\n      ctx.translate(cameraPos.x, cameraPos.y);\r\n    } else {\r\n      ctx.multiply(this.transform);\r\n    }\r\n  }\r\n\r\n  public updateTransform() {\r\n    // center the camera\r\n    const newCanvasWidth = this._screen.resolution.width / this.zoom;\r\n    const newCanvasHeight = this._screen.resolution.height / this.zoom;\r\n    const cameraPos = vec(-this.x + newCanvasWidth / 2 + this._xShake, -this.y + newCanvasHeight / 2 + this._yShake);\r\n\r\n    // Calculate camera transform\r\n    this.transform.reset();\r\n    this.transform.scale(this.zoom, this.zoom);\r\n    this.transform.translate(cameraPos.x, cameraPos.y);\r\n    this.transform.getAffineInverse(this.inverse);\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  public debugDraw(_ctx: CanvasRenderingContext2D) {\r\n    // pass\r\n  }\r\n\r\n  private _isDoneShaking(): boolean {\r\n    return !this._isShaking || this._elapsedShakeTime >= this._shakeDuration;\r\n  }\r\n}\r\n","import { Entity } from './Entity';\r\nimport { buildTypeKey } from './Util';\r\nimport { Query } from './Query';\r\nimport { Component } from './Component';\r\nimport { World } from './World';\r\n\r\n/**\r\n * The query manager is responsible for updating all queries when entities/components change\r\n */\r\nexport class QueryManager {\r\n  private _queries: { [entityComponentKey: string]: Query<any> } = {};\r\n\r\n  constructor(private _world: World<any>) {}\r\n\r\n  /**\r\n   * Adds a query to the manager and populates with any entities that match\r\n   * @param query\r\n   */\r\n  private _addQuery(query: Query<any>) {\r\n    this._queries[buildTypeKey(query.types)] = query;\r\n    for (const entity of this._world.entityManager.entities) {\r\n      query.addEntity(entity);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Removes the query if there are no observers left\r\n   * @param query\r\n   */\r\n  public maybeRemoveQuery(query: Query): void {\r\n    if (query.observers.length === 0) {\r\n      query.clear();\r\n      delete this._queries[buildTypeKey(query.types)];\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Adds the entity to any matching query in the query manage\r\n   * @param entity\r\n   */\r\n  public addEntity(entity: Entity) {\r\n    for (const queryType in this._queries) {\r\n      if (this._queries[queryType]) {\r\n        this._queries[queryType].addEntity(entity);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Removes an entity from queries if the removed component disqualifies it\r\n   * @param entity\r\n   * @param component\r\n   */\r\n  public removeComponent(entity: Entity, component: Component) {\r\n    for (const queryType in this._queries) {\r\n      // If the component being removed from an entity is a part of a query,\r\n      // it is now disqualified from that query, remove it\r\n      if (this._queries[queryType].contain(component.type)) {\r\n        this._queries[queryType].removeEntity(entity);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Removes an entity from all queries it is currently a part of\r\n   * @param entity\r\n   */\r\n  public removeEntity(entity: Entity) {\r\n    for (const queryType in this._queries) {\r\n      this._queries[queryType].removeEntity(entity);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Creates a populated query and returns, if the query already exists that will be returned instead of a new instance\r\n   * @param types\r\n   */\r\n  public createQuery<T extends Component = Component>(types: readonly string[]): Query<T> {\r\n    const maybeExistingQuery = this.getQuery<T>(types);\r\n    if (maybeExistingQuery) {\r\n      return maybeExistingQuery;\r\n    }\r\n    const query = new Query<T>(types);\r\n    this._addQuery(query);\r\n    return query;\r\n  }\r\n\r\n  /**\r\n   * Retrieves an existing query by types if it exists otherwise returns null\r\n   * @param types\r\n   */\r\n  public getQuery<T extends Component = Component>(types: readonly string[]): Query<T> {\r\n    const key = buildTypeKey(types);\r\n    if (this._queries[key]) {\r\n      return this._queries[key] as Query<T>;\r\n    }\r\n    return null;\r\n  }\r\n}\r\n","import { Color } from './Color';\r\nimport { Engine } from './Engine';\r\nimport { EventDispatcher } from './EventDispatcher';\r\nimport { Vector } from './Math/vector';\r\nimport { ExitTriggerEvent, EnterTriggerEvent, CollisionEndEvent, CollisionStartEvent } from './Events';\r\nimport { CollisionType } from './Collision/CollisionType';\r\nimport { Entity } from './EntityComponentSystem';\r\nimport { Actor } from './Actor';\r\n\r\n/**\r\n * ITriggerOptions\r\n */\r\nexport interface TriggerOptions {\r\n  // position of the trigger\r\n  pos: Vector;\r\n  // width of the trigger\r\n  width: number;\r\n  // height of the trigger\r\n  height: number;\r\n  // whether the trigger is visible or not\r\n  visible: boolean;\r\n  // action to take when triggered\r\n  action: () => void;\r\n  // if specified the trigger will only fire on a specific actor and overrides any filter\r\n  target: Entity;\r\n  // Returns true if the triggers should fire on the collided actor\r\n  filter: (actor: Entity) => boolean;\r\n  // -1 if it should repeat forever\r\n  repeat: number;\r\n}\r\n\r\nconst triggerDefaults: Partial<TriggerOptions> = {\r\n  pos: Vector.Zero,\r\n  width: 10,\r\n  height: 10,\r\n  visible: false,\r\n  action: () => {\r\n    return;\r\n  },\r\n  filter: () => true,\r\n  repeat: -1\r\n};\r\n\r\n/**\r\n * Triggers are a method of firing arbitrary code on collision. These are useful\r\n * as 'buttons', 'switches', or to trigger effects in a game. By default triggers\r\n * are invisible, and can only be seen when [[Trigger.visible]] is set to `true`.\r\n */\r\nexport class Trigger extends Actor {\r\n  private _target: Entity;\r\n  /**\r\n   * Action to fire when triggered by collision\r\n   */\r\n  public action: () => void = () => {\r\n    return;\r\n  };\r\n  /**\r\n   * Filter to add additional granularity to action dispatch, if a filter is specified the action will only fire when\r\n   * filter return true for the collided actor.\r\n   */\r\n  public filter: (actor: Entity) => boolean = () => true;\r\n  /**\r\n   * Number of times to repeat before killing the trigger,\r\n   */\r\n  public repeat: number = -1;\r\n\r\n  /**\r\n   *\r\n   * @param opts Trigger options\r\n   */\r\n  constructor(opts: Partial<TriggerOptions>) {\r\n    super({ x: opts.pos.x, y: opts.pos.y, width: opts.width, height: opts.height });\r\n    opts = {\r\n      ...triggerDefaults,\r\n      ...opts\r\n    };\r\n\r\n    this.filter = opts.filter || this.filter;\r\n    this.repeat = opts.repeat || this.repeat;\r\n    this.action = opts.action || this.action;\r\n    if (opts.target) {\r\n      this.target = opts.target;\r\n    }\r\n\r\n    this.graphics.visible = opts.visible;\r\n    this.body.collisionType = CollisionType.Passive;\r\n    this.eventDispatcher = new EventDispatcher();\r\n\r\n    this.events.on('collisionstart', (evt: CollisionStartEvent<Actor>) => {\r\n      if (this.filter(evt.other)) {\r\n        this.emit('enter', new EnterTriggerEvent(this, evt.other));\r\n        this._dispatchAction();\r\n        // remove trigger if its done, -1 repeat forever\r\n        if (this.repeat === 0) {\r\n          this.kill();\r\n        }\r\n      }\r\n    });\r\n\r\n    this.events.on('collisionend', (evt: CollisionEndEvent<Actor>) => {\r\n      if (this.filter(evt.other)) {\r\n        this.emit('exit', new ExitTriggerEvent(this, evt.other));\r\n      }\r\n    });\r\n  }\r\n\r\n  public set target(target: Entity) {\r\n    this._target = target;\r\n    this.filter = (actor: Entity) => actor === target;\r\n  }\r\n\r\n  public get target() {\r\n    return this._target;\r\n  }\r\n\r\n  public _initialize(engine: Engine) {\r\n    super._initialize(engine);\r\n  }\r\n\r\n  private _dispatchAction() {\r\n    if (this.repeat !== 0) {\r\n      this.action.call(this);\r\n      this.repeat--;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @deprecated signature will change in v0.26.0\r\n   * @param ctx\r\n   */\r\n  /* istanbul ignore next */\r\n  public debugDraw(ctx: CanvasRenderingContext2D) {\r\n    super.debugDraw(ctx);\r\n    // Meant to draw debug information about actors\r\n    ctx.save();\r\n    ctx.translate(this.pos.x, this.pos.y);\r\n\r\n    const bb = this.collider.bounds;\r\n    const wp = this.getGlobalPos();\r\n    bb.left = bb.left - wp.x;\r\n    bb.right = bb.right - wp.x;\r\n    bb.top = bb.top - wp.y;\r\n    bb.bottom = bb.bottom - wp.y;\r\n\r\n    ctx.fillStyle = Color.Violet.toString();\r\n    ctx.strokeStyle = Color.Violet.toString();\r\n    ctx.fillText('Trigger', 10, 10);\r\n    bb.debugDraw(ctx);\r\n\r\n    ctx.restore();\r\n  }\r\n}\r\n","import { Entity } from './Entity';\r\nimport { Message, Observer } from '../Util/Observable';\r\nimport { Component } from './Component';\r\nimport { Scene } from '../Scene';\r\n\r\n/**\r\n * Enum that determines whether to run the system in the update or draw phase\r\n */\r\nexport enum SystemType {\r\n  Update = 'update',\r\n  Draw = 'draw'\r\n}\r\n\r\nexport type SystemTypes<ComponentTypes> = ComponentTypes extends Component<infer TypeName> ? TypeName : never;\r\n\r\n/**\r\n * An Excalibur [[System]] that updates entities of certain types.\r\n * Systems are scene specific\r\n *\r\n * Excalibur Systems currently require at least 1 Component type to operated\r\n *\r\n * Multiple types are declared as a type union\r\n * For example:\r\n *\r\n * ```typescript\r\n * class MySystem extends System<ComponentA | ComponentB> {\r\n *   public readonly types = ['a', 'b'] as const;\r\n *   public readonly systemType = SystemType.Update;\r\n *   public update(entities: Entity<ComponentA | ComponentB>) {\r\n *      ...\r\n *   }\r\n * }\r\n * ```\r\n */\r\nexport abstract class System<ComponentTypeUnion extends Component = Component, ContextType = Scene>\r\nimplements Observer<AddedEntity | RemovedEntity> {\r\n  /**\r\n   * The types of entities that this system operates on\r\n   * For example ['transform', 'motion']\r\n   */\r\n  abstract readonly types: readonly SystemTypes<ComponentTypeUnion>[];\r\n\r\n  /**\r\n   * Determine whether the system is called in the [[SystemType.Update]] or the [[SystemType.Draw]] phase. Update is first, then Draw.\r\n   */\r\n  abstract readonly systemType: SystemType;\r\n\r\n  /**\r\n   * System can execute in priority order, by default all systems are priority 0. Lower values indicated higher priority.\r\n   * For a system to execute before all other a lower priority value (-1 for example) must be set.\r\n   * For a system to execute after all other a higher priority value (10 for example) must be set.\r\n   */\r\n  public priority: number = 0;\r\n\r\n  /**\r\n   * Optionally specify a sort order for entities passed to the your system\r\n   * @param a The left entity\r\n   * @param b The right entity\r\n   */\r\n  sort?(a: Entity, b: Entity): number;\r\n\r\n  /**\r\n   * Optionally specify an initialize handler\r\n   * @param scene\r\n   */\r\n  initialize?(engine: ContextType): void;\r\n\r\n  /**\r\n   * Update all entities that match this system's types\r\n   * @param entities Entities to update that match this system's types\r\n   * @param delta Time in milliseconds\r\n   */\r\n  abstract update(entities: Entity[], delta: number): void;\r\n\r\n  /**\r\n   * Optionally run a preupdate before the system processes matching entities\r\n   * @param engine\r\n   * @param elapsedMs Time in milliseconds since the last frame\r\n   */\r\n  preupdate?(engine: ContextType, elapsedMs: number): void;\r\n\r\n  /**\r\n   * Optionally run a postupdate after the system processes matching entities\r\n   * @param engine\r\n   * @param elapsedMs Time in milliseconds since the last frame\r\n   */\r\n  postupdate?(engine: ContextType, elapsedMs: number): void;\r\n\r\n  /**\r\n   * Systems observe when entities match their types or no longer match their types, override\r\n   * @param _entityAddedOrRemoved\r\n   */\r\n  public notify(_entityAddedOrRemoved: AddedEntity | RemovedEntity) {\r\n    // Override me\r\n  }\r\n}\r\n\r\n/**\r\n * An [[Entity]] with [[Component]] types that matches a [[System]] types exists in the current scene.\r\n */\r\nexport class AddedEntity implements Message<Entity> {\r\n  readonly type: 'Entity Added' = 'Entity Added';\r\n  constructor(public data: Entity) {}\r\n}\r\n\r\n/**\r\n * Type guard to check for AddedEntity messages\r\n * @param x\r\n */\r\nexport function isAddedSystemEntity(x: Message<Entity>): x is AddedEntity {\r\n  return !!x && x.type === 'Entity Added';\r\n}\r\n\r\n/**\r\n * An [[Entity]] with [[Component]] types that no longer matches a [[System]] types exists in the current scene.\r\n */\r\nexport class RemovedEntity implements Message<Entity> {\r\n  readonly type: 'Entity Removed' = 'Entity Removed';\r\n  constructor(public data: Entity) {}\r\n}\r\n\r\n/**\r\n * type guard to check for the RemovedEntity message\r\n */\r\nexport function isRemoveSystemEntity(x: Message<Entity>): x is RemovedEntity {\r\n  return !!x && x.type === 'Entity Removed';\r\n}\r\n","import { Entity, RemovedComponent, AddedComponent, isAddedComponent, isRemovedComponent } from './Entity';\r\nimport { Observer } from '../Util/Observable';\r\nimport { World } from './World';\r\nimport { Util } from '..';\r\n\r\n// Add/Remove entities and components\r\n\r\nexport class EntityManager<ContextType = any> implements Observer<RemovedComponent | AddedComponent> {\r\n  public entities: Entity[] = [];\r\n  public _entityIndex: { [entityId: string]: Entity } = {};\r\n\r\n  constructor(private _world: World<ContextType>) {}\r\n\r\n  /**\r\n   * Runs the entity lifecycle\r\n   * @param _context\r\n   */\r\n  public updateEntities(_context: ContextType, elapsed: number) {\r\n    for (const entity of this.entities) {\r\n      // TODO is this right?\r\n      entity.update((_context as any).engine, elapsed);\r\n      if (!entity.active) {\r\n        this.removeEntity(entity);\r\n      }\r\n    }\r\n  }\r\n\r\n  public findEntitiesForRemoval() {\r\n    for (const entity of this.entities) {\r\n      if (!entity.active) {\r\n        this.removeEntity(entity);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * EntityManager observes changes on entities\r\n   * @param message\r\n   */\r\n  public notify(message: RemovedComponent | AddedComponent): void {\r\n    if (isAddedComponent(message)) {\r\n      // we don't need the component, it's already on the entity\r\n      this._world.queryManager.addEntity(message.data.entity);\r\n    }\r\n\r\n    if (isRemovedComponent(message)) {\r\n      this._world.queryManager.removeComponent(message.data.entity, message.data.component);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Adds an entity to be tracked by the EntityManager\r\n   * @param entity\r\n   */\r\n  public addEntity(entity: Entity): void {\r\n    entity.active = true;\r\n    if (entity && !this._entityIndex[entity.id]) {\r\n      this._entityIndex[entity.id] = entity;\r\n      this.entities.push(entity);\r\n      this._world.queryManager.addEntity(entity);\r\n      entity.componentAdded$.register(this);\r\n      entity.componentRemoved$.register(this);\r\n\r\n      // if entity has children\r\n      entity.children.forEach((c) => this.addEntity(c));\r\n      entity.childrenAdded$.register({\r\n        notify: (e) => {\r\n          this.addEntity(e);\r\n        }\r\n      });\r\n      entity.childrenRemoved$.register({\r\n        notify: (e) => {\r\n          this.removeEntity(e, false);\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  public removeEntity(entity: Entity, deferred?: boolean): void;\r\n  public removeEntity(id: number, deferred?: boolean): void;\r\n  public removeEntity(idOrEntity: number | Entity, deferred = true): void {\r\n    let id = 0;\r\n    if (idOrEntity instanceof Entity) {\r\n      id = idOrEntity.id;\r\n    } else {\r\n      id = idOrEntity;\r\n    }\r\n    const entity = this._entityIndex[id];\r\n    if (entity && entity.active) {\r\n      entity.kill();\r\n    }\r\n\r\n    if (entity && deferred) {\r\n      this._entitiesToRemove.push(entity);\r\n      return;\r\n    }\r\n\r\n    delete this._entityIndex[id];\r\n    if (entity) {\r\n      Util.removeItemFromArray(entity, this.entities);\r\n      this._world.queryManager.removeEntity(entity);\r\n      entity.componentAdded$.unregister(this);\r\n      entity.componentRemoved$.unregister(this);\r\n\r\n      // if entity has children\r\n      entity.children.forEach((c) => this.removeEntity(c, deferred));\r\n      entity.childrenAdded$.clear();\r\n      entity.childrenRemoved$.clear();\r\n\r\n      // stats\r\n      if ((this._world.context as any)?.engine) {\r\n        (this._world.context as any).engine.stats.currFrame.actors.killed++;\r\n      }\r\n    }\r\n  }\r\n\r\n  private _entitiesToRemove: Entity[] = [];\r\n  public processEntityRemovals(): void {\r\n    for (const entity of this._entitiesToRemove) {\r\n      if (entity.active) {\r\n        continue;\r\n      }\r\n      this.removeEntity(entity, false);\r\n    }\r\n  }\r\n\r\n  public processComponentRemovals(): void {\r\n    for (const entity of this.entities) {\r\n      entity.processComponentRemoval();\r\n    }\r\n  }\r\n\r\n  public getById(id: number): Entity {\r\n    return this._entityIndex[id];\r\n  }\r\n\r\n  public getByName(name: string): Entity[]{\r\n    return this.entities.filter(e => e.name === name);\r\n  }\r\n\r\n  public clear(): void {\r\n    for (const entity of this.entities) {\r\n      this.removeEntity(entity);\r\n    }\r\n  }\r\n}\r\n","import { Entity } from './Entity';\r\nimport { buildTypeKey } from './Util';\r\nimport { Observable } from '../Util/Observable';\r\nimport { Util, Component, ComponentCtor } from '..';\r\nimport { AddedEntity, RemovedEntity } from './System';\r\n\r\n/**\r\n * Represents query for entities that match a list of types that is cached and observable\r\n *\r\n * Queries can be strongly typed by supplying a type union in the optional type parameter\r\n * ```typescript\r\n * const queryAB = new ex.Query<ComponentTypeA | ComponentTypeB>(['A', 'B']);\r\n * ```\r\n */\r\nexport class Query<T extends Component = Component> extends Observable<AddedEntity | RemovedEntity> {\r\n  public types: readonly string[];\r\n  private _entities: Entity[] = [];\r\n  private _key: string;\r\n  public get key(): string {\r\n    if (this._key) {\r\n      return this._key;\r\n    }\r\n    return (this._key = buildTypeKey(this.types));\r\n  }\r\n\r\n  constructor(types: readonly string[]);\r\n  constructor(types: readonly ComponentCtor<T>[]);\r\n  constructor(types: readonly string[] | readonly ComponentCtor<T>[]) {\r\n    super();\r\n    if (types[0] instanceof Function) {\r\n      this.types = (types as ComponentCtor<T>[]).map(T =>  (new T).type);\r\n    } else {\r\n      this.types = types as string[];\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns a list of entities that match the query\r\n   *\r\n   * @param sort Optional sorting function to sort entities returned from the query\r\n   */\r\n  public getEntities(sort?: (a: Entity, b: Entity) => number): Entity[] {\r\n    if (sort) {\r\n      this._entities.sort(sort);\r\n    }\r\n    return this._entities;\r\n  }\r\n\r\n  /**\r\n   * Add an entity to the query, will only be added if the entity matches the query types\r\n   * @param entity\r\n   */\r\n  public addEntity(entity: Entity): void {\r\n    if (!Util.contains(this._entities, entity) && this.matches(entity)) {\r\n      this._entities.push(entity);\r\n      this.notifyAll(new AddedEntity(entity));\r\n    }\r\n  }\r\n\r\n  /**\r\n   * If the entity is part of the query it will be removed regardless of types\r\n   * @param entity\r\n   */\r\n  public removeEntity(entity: Entity): void {\r\n    if (Util.removeItemFromArray(entity, this._entities)) {\r\n      this.notifyAll(new RemovedEntity(entity));\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Removes all entities and observers from the query\r\n   */\r\n  public clear(): void {\r\n    this._entities.length = 0;\r\n    for (const observer of this.observers) {\r\n      this.unregister(observer);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns whether the entity's types match query\r\n   * @param entity\r\n   */\r\n  public matches(entity: Entity): boolean;\r\n\r\n  /**\r\n   * Returns whether the list of ComponentTypes have at least the same types as the query\r\n   * @param types\r\n   */\r\n  public matches(types: string[]): boolean;\r\n  public matches(typesOrEntity: string[] | Entity): boolean {\r\n    let types: string[] = [];\r\n    if (typesOrEntity instanceof Entity) {\r\n      types = typesOrEntity.types;\r\n    } else {\r\n      types = typesOrEntity;\r\n    }\r\n\r\n    let matches = true;\r\n    for (const type of this.types) {\r\n      matches = matches && types.indexOf(type) > -1;\r\n      if (!matches) {\r\n        return false;\r\n      }\r\n    }\r\n    return matches;\r\n  }\r\n\r\n  public contain(type: string) {\r\n    return this.types.indexOf(type) > -1;\r\n  }\r\n}\r\n","export const buildTypeKey = (types: readonly string[]) => {\r\n  const key = [...types].sort((a, b) => a.localeCompare(b)).join('+');\r\n  return key;\r\n};\r\n","import { System, SystemType } from './System';\r\nimport { Scene, Util } from '..';\r\nimport { World } from './World';\r\n\r\nexport interface SystemCtor<T extends System> {\r\n  new (): T;\r\n}\r\n\r\n/**\r\n * The SystemManager is responsible for keeping track of all systems in a scene.\r\n * Systems are scene specific\r\n */\r\nexport class SystemManager<ContextType> {\r\n  /**\r\n   * List of systems, to add a new system call [[SystemManager.addSystem]]\r\n   */\r\n  public systems: System<any, ContextType>[] = [];\r\n  public _keyToSystem: { [key: string]: System<any, ContextType> };\r\n  public initialized = false;\r\n  constructor(private _world: World<ContextType>) {}\r\n\r\n  /**\r\n   * Get a system registered in the manager by type\r\n   * @param systemType\r\n   */\r\n  public get<T extends System>(systemType: SystemCtor<T>): T | null {\r\n    return this.systems.find((s) => s instanceof systemType) as unknown as T;\r\n  }\r\n\r\n  /**\r\n   * Adds a system to the manager, it will now be updated every frame\r\n   * @param system\r\n   */\r\n  public addSystem(system: System<any, ContextType>): void {\r\n    // validate system has types\r\n    if (!system.types || system.types.length === 0) {\r\n      throw new Error(`Attempted to add a System without any types`);\r\n    }\r\n\r\n    const query = this._world.queryManager.createQuery(system.types);\r\n    this.systems.push(system);\r\n    this.systems.sort((a, b) => a.priority - b.priority);\r\n    query.register(system);\r\n    if (this.initialized && system.initialize) {\r\n      system.initialize(this._world.context);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Removes a system from the manager, it will no longer be updated\r\n   * @param system\r\n   */\r\n  public removeSystem(system: System<any, ContextType>) {\r\n    Util.removeItemFromArray(system, this.systems);\r\n    const query = this._world.queryManager.getQuery(system.types);\r\n    if (query) {\r\n      query.unregister(system);\r\n      this._world.queryManager.maybeRemoveQuery(query);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Initialize all systems in the manager\r\n   *\r\n   * Systems added after initialize() will be initialized on add\r\n   */\r\n  public initialize() {\r\n    if (!this.initialized) {\r\n      this.initialized = true;\r\n      for (const s of this.systems) {\r\n        if (s.initialize) {\r\n          s.initialize(this._world.context);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Updates all systems\r\n   * @param type whether this is an update or draw system\r\n   * @param context context reference\r\n   * @param delta time in milliseconds\r\n   */\r\n  public updateSystems(type: SystemType, context: ContextType, delta: number) {\r\n    const systems = this.systems.filter((s) => s.systemType === type);\r\n    for (const s of systems) {\r\n      if (s.preupdate) {\r\n        s.preupdate(context, delta);\r\n      }\r\n    }\r\n\r\n    for (const s of systems) {\r\n      // Get entities that match the system types, pre-sort\r\n      const entities = this._world.queryManager.getQuery(s.types).getEntities(s.sort);\r\n      // Initialize entities if needed\r\n      if (context instanceof Scene) {\r\n        for (const entity of entities) {\r\n          entity._initialize(context?.engine);\r\n        }\r\n      }\r\n      s.update(entities, delta);\r\n    }\r\n\r\n    for (const s of systems) {\r\n      if (s.postupdate) {\r\n        s.postupdate(context, delta);\r\n      }\r\n    }\r\n  }\r\n\r\n  public clear(): void {\r\n    for (const system of this.systems) {\r\n      this.removeSystem(system);\r\n    }\r\n  }\r\n}\r\n","import { Entity } from './Entity';\r\nimport { EntityManager } from './EntityManager';\r\nimport { QueryManager } from './QueryManager';\r\nimport { System, SystemType } from './System';\r\nimport { SystemManager } from './SystemManager';\r\n\r\n/**\r\n * The World is a self-contained entity component system for a particular context.\r\n */\r\nexport class World<ContextType> {\r\n  public queryManager: QueryManager = new QueryManager(this);\r\n  public entityManager: EntityManager<ContextType> = new EntityManager<ContextType>(this);\r\n  public systemManager: SystemManager<ContextType> = new SystemManager<ContextType>(this);\r\n\r\n  /**\r\n   * The context type is passed to the system updates\r\n   * @param context\r\n   */\r\n  constructor(public context: ContextType) {}\r\n\r\n  /**\r\n   * Update systems by type and time elapsed in milliseconds\r\n   */\r\n  update(type: SystemType, delta: number) {\r\n    if (type === SystemType.Update) {\r\n      this.entityManager.updateEntities(this.context, delta);\r\n    }\r\n    this.systemManager.updateSystems(type, this.context, delta);\r\n    this.entityManager.findEntitiesForRemoval();\r\n    this.entityManager.processComponentRemovals();\r\n    this.entityManager.processEntityRemovals();\r\n  }\r\n\r\n  /**\r\n   * Add an entity to the ECS world\r\n   * @param entity\r\n   */\r\n  add(entity: Entity): void;\r\n  /**\r\n   * Add a system to the ECS world\r\n   * @param system\r\n   */\r\n  add(system: System<any, ContextType>): void;\r\n  add(entityOrSystem: Entity | System<any, ContextType>): void {\r\n    if (entityOrSystem instanceof Entity) {\r\n      this.entityManager.addEntity(entityOrSystem);\r\n    }\r\n\r\n    if (entityOrSystem instanceof System) {\r\n      this.systemManager.addSystem(entityOrSystem);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Remove an entity from the ECS world\r\n   * @param entity\r\n   */\r\n  remove(entity: Entity, deferred?: boolean): void;\r\n  /**\r\n   * Remove a system from the ECS world\r\n   * @param system\r\n   */\r\n  remove(system: System<any, ContextType>): void;\r\n  remove(entityOrSystem: Entity | System<any, ContextType>, deferred = true): void {\r\n    if (entityOrSystem instanceof Entity) {\r\n      this.entityManager.removeEntity(entityOrSystem, deferred);\r\n    }\r\n\r\n    if (entityOrSystem instanceof System) {\r\n      this.systemManager.removeSystem(entityOrSystem);\r\n    }\r\n  }\r\n\r\n  clearEntities(): void {\r\n    this.entityManager.clear();\r\n  }\r\n\r\n  clearSystems(): void {\r\n    this.systemManager.clear();\r\n  }\r\n}\r\n","import { Vector } from '../Math/vector';\r\nimport { TransformComponent } from '../EntityComponentSystem';\r\nimport { MotionComponent } from '../EntityComponentSystem/Components/MotionComponent';\r\n\r\nexport class EulerIntegrator {\r\n  static integrate(transform: TransformComponent, motion: MotionComponent, totalAcc: Vector, elapsedMs: number): void {\r\n    const seconds = elapsedMs / 1000;\r\n    motion.vel.addEqual(totalAcc.scale(seconds));\r\n    transform.pos.addEqual(motion.vel.scale(seconds)).addEqual(totalAcc.scale(0.5 * seconds * seconds));\r\n\r\n    motion.angularVelocity += motion.torque * (1.0 / motion.inertia) * seconds;\r\n    transform.rotation += motion.angularVelocity * seconds;\r\n\r\n    transform.scale.addEqual(motion.scaleFactor.scale(seconds));\r\n  }\r\n}\r\n","import { Entity } from '../EntityComponentSystem';\r\nimport { MotionComponent } from '../EntityComponentSystem/Components/MotionComponent';\r\nimport { TransformComponent } from '../EntityComponentSystem/Components/TransformComponent';\r\nimport { System, SystemType } from '../EntityComponentSystem/System';\r\nimport { Physics } from './Physics';\r\nimport { BodyComponent } from './BodyComponent';\r\nimport { CollisionType } from './CollisionType';\r\nimport { EulerIntegrator } from './Integrator';\r\n\r\nexport class MotionSystem extends System<TransformComponent | MotionComponent> {\r\n  public readonly types = ['ex.transform', 'ex.motion'] as const;\r\n  public systemType = SystemType.Update;\r\n  public priority = -1;\r\n\r\n  update(_entities: Entity[], elapsedMs: number): void {\r\n    let transform: TransformComponent;\r\n    let motion: MotionComponent;\r\n    for (const entity of _entities) {\r\n      transform = entity.get(TransformComponent);\r\n      motion = entity.get(MotionComponent);\r\n\r\n      const optionalBody = entity.get(BodyComponent);\r\n      if (optionalBody?.sleeping) {\r\n        continue;\r\n      }\r\n\r\n      const totalAcc = motion.acc.clone();\r\n      if (optionalBody?.collisionType === CollisionType.Active && optionalBody?.useGravity) {\r\n        totalAcc.addEqual(Physics.gravity);\r\n      }\r\n      optionalBody?.captureOldTransform();\r\n\r\n      // Update transform and motion based on Euler linear algebra\r\n      EulerIntegrator.integrate(transform, motion, totalAcc, elapsedMs);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @deprecated signature will change in v0.26.0\r\n   * @param _ctx\r\n   */\r\n  debugDraw(_ctx: CanvasRenderingContext2D) {\r\n    // pass\r\n  }\r\n}\r\n","import { CollisionContact } from '../Detection/CollisionContact';\r\n\r\n/**\r\n * A collision solver figures out how to position colliders such that they are no longer overlapping\r\n *\r\n * Solvers are executed in the order\r\n *\r\n * 1. preSolve\r\n * 2. solveVelocity\r\n * 3. solvePosition\r\n * 4. postSolve\r\n * @inheritdoc\r\n */\r\nexport abstract class CollisionSolver {\r\n  /**\r\n   * Pre-solve is fired on contacts before any resolution is started. It is used for any setup work before collision resolution\r\n   * can proceed. Optionally contacts can be \"opted out\" of any collision processing by calling `contact.cancel()`\r\n   * @param contacts\r\n   * @inheritdoc\r\n   */\r\n  abstract preSolve(contacts: CollisionContact[]): void;\r\n\r\n  /**\r\n   * Post-solve is fired after all resolution is complete\r\n   * @param contacts\r\n   * @inheritdoc\r\n   */\r\n  abstract postSolve(contacts: CollisionContact[]): void;\r\n\r\n  /**\r\n   * Solve velocity adjusts the velocity of colliders so that they are not overlapping or will not be overlapping from velocity\r\n   * @param contacts\r\n   * @inheritdoc\r\n   */\r\n  abstract solveVelocity(contacts: CollisionContact[]): void;\r\n\r\n  /**\r\n   * Solve position adjust the position of colliders so that they are not overlapping\r\n   * @param contacts\r\n   * @inheritdoc\r\n   */\r\n  abstract solvePosition(contacts: CollisionContact[]): void;\r\n\r\n  /**\r\n   * Solves overlapping contact in\r\n   *\r\n   * Solvers are executed in the order\r\n   * 1. preSolve\r\n   * 2. solveVelocity\r\n   * 3. solvePosition\r\n   * 4. postSolve\r\n   * @param contacts\r\n   */\r\n  public solve(contacts: CollisionContact[]): CollisionContact[] {\r\n    // Events and init\r\n    this.preSolve(contacts);\r\n\r\n    // Remove any canceled contacts\r\n    contacts = contacts.filter(c => !c.isCanceled());\r\n\r\n    // Solve velocity first\r\n    this.solveVelocity(contacts);\r\n\r\n    // Solve position last because non-overlap is the most important\r\n    this.solvePosition(contacts);\r\n\r\n    // Events and any contact house-keeping the solver needs\r\n    this.postSolve(contacts);\r\n\r\n    return contacts;\r\n  }\r\n}","import { PostCollisionEvent, PreCollisionEvent } from '../../Events';\r\nimport { CollisionContact } from '../Detection/CollisionContact';\r\nimport { CollisionType } from '../CollisionType';\r\nimport { Side } from '../Side';\r\nimport { CollisionSolver } from './Solver';\r\nimport { BodyComponent } from '../BodyComponent';\r\n\r\n/**\r\n * ArcadeSolver is the default in Excalibur. It solves collisions so that there is no overlap between contacts,\r\n * and negates velocity along the collision normal.\r\n *\r\n * This is usually the type of collisions used for 2D games that don't need a more realistic collision simulation.\r\n *\r\n */\r\nexport class ArcadeSolver extends CollisionSolver {\r\n  public preSolve(contacts: CollisionContact[]) {\r\n    for (const contact of contacts) {\r\n      const side = Side.fromDirection(contact.mtv);\r\n      const mtv = contact.mtv.negate();\r\n      // Publish collision events on both participants\r\n      contact.colliderA.events.emit('precollision', new PreCollisionEvent(contact.colliderA, contact.colliderB, side, mtv));\r\n      contact.colliderB.events.emit(\r\n        'precollision',\r\n        new PreCollisionEvent(contact.colliderB, contact.colliderA, Side.getOpposite(side), mtv.negate())\r\n      );\r\n    }\r\n  }\r\n\r\n  public postSolve(contacts: CollisionContact[]) {\r\n    for (const contact of contacts) {\r\n      const colliderA = contact.colliderA;\r\n      const colliderB = contact.colliderB;\r\n      const bodyA = colliderA.owner?.get(BodyComponent);\r\n      const bodyB = colliderB.owner?.get(BodyComponent);\r\n      if (bodyA && bodyB) {\r\n        if (bodyA.collisionType === CollisionType.Passive || bodyB.collisionType === CollisionType.Passive) {\r\n          continue;\r\n        }\r\n      }\r\n      const side = Side.fromDirection(contact.mtv);\r\n      const mtv = contact.mtv.negate();\r\n      // Publish collision events on both participants\r\n      contact.colliderA.events.emit('postcollision', new PostCollisionEvent(contact.colliderA, contact.colliderB, side, mtv));\r\n      contact.colliderB.events.emit(\r\n        'postcollision',\r\n        new PostCollisionEvent(contact.colliderB, contact.colliderA, Side.getOpposite(side), mtv.negate())\r\n      );\r\n    }\r\n  }\r\n\r\n  public solvePosition(contacts: CollisionContact[]) {\r\n    for (const contact of contacts) {\r\n      // if bounds no longer interesect skip to the next\r\n      // this removes jitter from overlapping/stacked solid tiles or a wall of solid tiles\r\n      if (!contact.colliderA.bounds.intersect(contact.colliderB.bounds)) {\r\n        continue;\r\n      }\r\n      let mtv = contact.mtv;\r\n      const colliderA = contact.colliderA;\r\n      const colliderB = contact.colliderB;\r\n      const bodyA = colliderA.owner?.get(BodyComponent);\r\n      const bodyB = colliderB.owner?.get(BodyComponent);\r\n      if (bodyA && bodyB) {\r\n        if (bodyA.collisionType === CollisionType.Passive || bodyB.collisionType === CollisionType.Passive) {\r\n          continue;\r\n        }\r\n\r\n        if (bodyA.collisionType === CollisionType.Active && bodyB.collisionType === CollisionType.Active) {\r\n          // split overlaps if both are Active\r\n          mtv = mtv.scale(0.5);\r\n        }\r\n\r\n        // Resolve overlaps\r\n        if (bodyA.collisionType === CollisionType.Active) {\r\n          bodyA.pos.x -= mtv.x;\r\n          bodyA.pos.y -= mtv.y;\r\n        }\r\n\r\n        if (bodyB.collisionType === CollisionType.Active) {\r\n          bodyB.pos.x += mtv.x;\r\n          bodyB.pos.y += mtv.y;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  public solveVelocity(contacts: CollisionContact[]) {\r\n    for (const contact of contacts) {\r\n      const colliderA = contact.colliderA;\r\n      const colliderB = contact.colliderB;\r\n      const bodyA = colliderA.owner?.get(BodyComponent);\r\n      const bodyB = colliderB.owner?.get(BodyComponent);\r\n\r\n      if (bodyA && bodyB) {\r\n\r\n        if (bodyA.collisionType === CollisionType.Passive || bodyB.collisionType === CollisionType.Passive) {\r\n          continue;\r\n        }\r\n\r\n        const normal = contact.normal;\r\n        const opposite = normal.negate();\r\n\r\n        // Cancel out velocity opposite direction of collision normal\r\n        if (bodyA.collisionType === CollisionType.Active) {\r\n          const velAdj = normal.scale(normal.dot(bodyA.vel.negate()));\r\n          bodyA.vel = bodyA.vel.add(velAdj);\r\n        }\r\n\r\n        if (bodyB.collisionType === CollisionType.Active) {\r\n          const velAdj = opposite.scale(opposite.dot(bodyB.vel.negate()));\r\n          bodyB.vel = bodyB.vel.add(velAdj);\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { Vector } from '../../Math/vector';\r\nimport { BodyComponent } from '../BodyComponent';\r\nimport { CollisionContact } from '../Detection/CollisionContact';\r\n\r\n/**\r\n * Holds information about contact points, meant to be reused over multiple frames of contact\r\n */\r\nexport class ContactConstraintPoint {\r\n  constructor(public point: Vector, public local: Vector, public contact: CollisionContact) {\r\n    this.update();\r\n  }\r\n\r\n  /**\r\n   * Updates the contact information\r\n   */\r\n  update() {\r\n    const bodyA = this.contact.colliderA.owner?.get(BodyComponent);\r\n    const bodyB = this.contact.colliderB.owner?.get(BodyComponent);\r\n\r\n    if (bodyA && bodyB) {\r\n      const normal = this.contact.normal;\r\n      const tangent = this.contact.tangent;\r\n\r\n      this.aToContact = this.point.sub(bodyA.pos);\r\n      this.bToContact = this.point.sub(bodyB.pos);\r\n\r\n      const aToContactNormal = this.aToContact.cross(normal);\r\n      const bToContactNormal = this.bToContact.cross(normal);\r\n\r\n      this.normalMass =\r\n        bodyA.inverseMass +\r\n        bodyB.inverseMass +\r\n        bodyA.inverseInertia * aToContactNormal * aToContactNormal +\r\n        bodyB.inverseInertia * bToContactNormal * bToContactNormal;\r\n\r\n      const aToContactTangent = this.aToContact.cross(tangent);\r\n      const bToContactTangent = this.bToContact.cross(tangent);\r\n\r\n      this.tangentMass =\r\n        bodyA.inverseMass +\r\n        bodyB.inverseMass +\r\n        bodyA.inverseInertia * aToContactTangent * aToContactTangent +\r\n        bodyB.inverseInertia * bToContactTangent * bToContactTangent;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Returns the relative velocity between bodyA and bodyB\r\n   */\r\n  public getRelativeVelocity() {\r\n    const bodyA = this.contact.colliderA.owner?.get(BodyComponent);\r\n    const bodyB = this.contact.colliderB.owner?.get(BodyComponent);\r\n    if (bodyA && bodyB) {\r\n      // Relative velocity in linear terms\r\n      // Angular to linear velocity formula -> omega = velocity/radius so omega x radius = velocity\r\n      const velA = bodyA.vel.add(Vector.cross(bodyA.angularVelocity, this.aToContact));\r\n      const velB = bodyB.vel.add(Vector.cross(bodyB.angularVelocity, this.bToContact));\r\n      return velB.sub(velA);\r\n    }\r\n    return Vector.Zero;\r\n  }\r\n\r\n  /**\r\n   * Impulse accumulated over time in normal direction\r\n   */\r\n  public normalImpulse: number = 0;\r\n\r\n  /**\r\n   * Impulse accumulated over time in the tangent direction\r\n   */\r\n  public tangentImpulse: number = 0;\r\n\r\n  /**\r\n   * Effective mass seen in the normal direction\r\n   */\r\n  public normalMass: number = 0;\r\n\r\n  /**\r\n   * Effective mass seen in the tangent direction\r\n   */\r\n  public tangentMass: number = 0;\r\n\r\n  /**\r\n   * Direction from center of mass of bodyA to contact point\r\n   */\r\n  public aToContact: Vector = new Vector(0, 0);\r\n\r\n  /**\r\n   * Direction from center of mass of bodyB to contact point\r\n   */\r\n  public bToContact: Vector = new Vector(0, 0);\r\n}\r\n","import { CollisionPostSolveEvent, CollisionPreSolveEvent, PostCollisionEvent, PreCollisionEvent } from '../../Events';\r\nimport { clamp } from '../../Math/util';\r\nimport { CollisionContact } from '../Detection/CollisionContact';\r\nimport { CollisionType } from '../CollisionType';\r\nimport { ContactConstraintPoint } from './ContactConstraintPoint';\r\nimport { Side } from '../Side';\r\nimport { Physics } from '../Physics';\r\nimport { CollisionSolver } from './Solver';\r\nimport { BodyComponent } from '../BodyComponent';\r\nimport { CollisionJumpTable } from '../Colliders/CollisionJumpTable';\r\n\r\nexport class RealisticSolver extends CollisionSolver {\r\n  lastFrameContacts: Map<string, CollisionContact> = new Map();\r\n\r\n  // map contact id to contact points\r\n  idToContactConstraint: Map<string, ContactConstraintPoint[]> = new Map();\r\n\r\n  getContactConstraints(id: string) {\r\n    return this.idToContactConstraint.get(id) ?? [];\r\n  }\r\n\r\n  preSolve(contacts: CollisionContact[]) {\r\n    for (const contact of contacts) {\r\n      // Publish collision events on both participants\r\n      const side = Side.fromDirection(contact.mtv);\r\n      contact.colliderA.events.emit('precollision', new PreCollisionEvent(contact.colliderA, contact.colliderB, side, contact.mtv));\r\n      contact.colliderA.events.emit(\r\n        'beforecollisionresolve',\r\n        new CollisionPreSolveEvent(contact.colliderA, contact.colliderB, side, contact.mtv, contact) as any\r\n      );\r\n      contact.colliderB.events.emit(\r\n        'precollision',\r\n        new PreCollisionEvent(contact.colliderB, contact.colliderA, Side.getOpposite(side), contact.mtv.negate())\r\n      );\r\n      contact.colliderB.events.emit(\r\n        'beforecollisionresolve',\r\n        new CollisionPreSolveEvent(contact.colliderB, contact.colliderA, Side.getOpposite(side), contact.mtv.negate(), contact) as any\r\n      );\r\n\r\n      // Match awake state for sleeping\r\n      contact.matchAwake();\r\n    }\r\n\r\n    // Keep track of contacts that done\r\n    const finishedContactIds = Array.from(this.idToContactConstraint.keys());\r\n    for (const contact of contacts) {\r\n      // Remove all current contacts that are not done\r\n      const index = finishedContactIds.indexOf(contact.id);\r\n      if (index > -1) {\r\n        finishedContactIds.splice(index, 1);\r\n      }\r\n      const contactPoints = this.idToContactConstraint.get(contact.id) ?? [];\r\n\r\n      let pointIndex = 0;\r\n      const bodyA = contact.colliderA.owner.get(BodyComponent);\r\n      const bodyB = contact.colliderB.owner.get(BodyComponent);\r\n      if (bodyA && bodyB) {\r\n        for (const point of contact.points) {\r\n          const normal = contact.normal;\r\n          const tangent = contact.tangent;\r\n\r\n          const aToContact = point.sub(bodyA.pos);\r\n          const bToContact = point.sub(bodyB.pos);\r\n\r\n          const aToContactNormal = aToContact.cross(normal);\r\n          const bToContactNormal = bToContact.cross(normal);\r\n\r\n          const normalMass =\r\n            bodyA.inverseMass +\r\n            bodyB.inverseMass +\r\n            bodyA.inverseInertia * aToContactNormal * aToContactNormal +\r\n            bodyB.inverseInertia * bToContactNormal * bToContactNormal;\r\n\r\n          const aToContactTangent = aToContact.cross(tangent);\r\n          const bToContactTangent = bToContact.cross(tangent);\r\n\r\n          const tangentMass =\r\n            bodyA.inverseMass +\r\n            bodyB.inverseMass +\r\n            bodyA.inverseInertia * aToContactTangent * aToContactTangent +\r\n            bodyB.inverseInertia * bToContactTangent * bToContactTangent;\r\n\r\n          // Preserve normal/tangent impulse by re-using the contact point if it's close\r\n          if (contactPoints[pointIndex] && contactPoints[pointIndex]?.point?.squareDistance(point) < 4) {\r\n            contactPoints[pointIndex].point = point;\r\n            contactPoints[pointIndex].local = contact.localPoints[pointIndex];\r\n          } else {\r\n            // new contact if it's not close or doesn't exist\r\n            contactPoints[pointIndex] = new ContactConstraintPoint(point, contact.localPoints[pointIndex], contact);\r\n          }\r\n\r\n          // Update contact point calculations\r\n          contactPoints[pointIndex].aToContact = aToContact;\r\n          contactPoints[pointIndex].bToContact = bToContact;\r\n          contactPoints[pointIndex].normalMass = normalMass;\r\n          contactPoints[pointIndex].tangentMass = tangentMass;\r\n\r\n          pointIndex++;\r\n        }\r\n      }\r\n      this.idToContactConstraint.set(contact.id, contactPoints);\r\n    }\r\n\r\n    // Clean up any contacts that did not occur last frame\r\n    for (const id of finishedContactIds) {\r\n      this.idToContactConstraint.delete(id);\r\n    }\r\n\r\n    // Warm contacts with accumulated impulse\r\n    // Useful for tall stacks\r\n    if (Physics.warmStart) {\r\n      this.warmStart(contacts);\r\n    } else {\r\n      for (const contact of contacts) {\r\n        const contactPoints = this.getContactConstraints(contact.id);\r\n        for (const point of contactPoints) {\r\n          point.normalImpulse = 0;\r\n          point.tangentImpulse = 0;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  postSolve(contacts: CollisionContact[]) {\r\n    for (const contact of contacts) {\r\n      const bodyA = contact.colliderA.owner.get(BodyComponent);\r\n      const bodyB = contact.colliderB.owner.get(BodyComponent);\r\n\r\n      if (bodyA && bodyB) {\r\n        // Skip post solve for active+passive collisions\r\n        if (bodyA.collisionType === CollisionType.Passive || bodyB.collisionType === CollisionType.Passive) {\r\n          continue;\r\n        }\r\n\r\n        // Update motion values for sleeping\r\n        bodyA.updateMotion();\r\n        bodyB.updateMotion();\r\n      }\r\n\r\n      // Publish collision events on both participants\r\n      const side = Side.fromDirection(contact.mtv);\r\n      contact.colliderA.events.emit('postcollision', new PostCollisionEvent(contact.colliderA, contact.colliderB, side, contact.mtv));\r\n      contact.colliderA.events.emit(\r\n        'aftercollisionresolve',\r\n        new CollisionPostSolveEvent(contact.colliderA, contact.colliderB, side, contact.mtv, contact) as any\r\n      );\r\n      contact.colliderB.events.emit(\r\n        'postcollision',\r\n        new PostCollisionEvent(contact.colliderB, contact.colliderA, Side.getOpposite(side), contact.mtv.negate())\r\n      );\r\n      contact.colliderB.events.emit(\r\n        'aftercollisionresolve',\r\n        new CollisionPostSolveEvent(contact.colliderB, contact.colliderA, Side.getOpposite(side), contact.mtv.negate(), contact) as any\r\n      );\r\n    }\r\n\r\n    // Store contacts\r\n    this.lastFrameContacts.clear();\r\n    for (const c of contacts) {\r\n      this.lastFrameContacts.set(c.id, c);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Warm up body's based on previous frame contact points\r\n   * @param contacts\r\n   */\r\n  warmStart(contacts: CollisionContact[]) {\r\n    for (const contact of contacts) {\r\n      const bodyA = contact.colliderA.owner?.get(BodyComponent);\r\n      const bodyB = contact.colliderB.owner?.get(BodyComponent);\r\n      if (bodyA && bodyB) {\r\n        const contactPoints = this.idToContactConstraint.get(contact.id) ?? [];\r\n        for (const point of contactPoints) {\r\n          if (Physics.warmStart) {\r\n            const normalImpulse = contact.normal.scale(point.normalImpulse);\r\n            const tangentImpulse = contact.tangent.scale(point.tangentImpulse);\r\n            const impulse = normalImpulse.add(tangentImpulse);\r\n\r\n            bodyA.applyImpulse(point.point, impulse.negate());\r\n            bodyB.applyImpulse(point.point, impulse);\r\n          } else {\r\n            point.normalImpulse = 0;\r\n            point.tangentImpulse = 0;\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Iteratively solve the position overlap constraint\r\n   * @param contacts\r\n   */\r\n  solvePosition(contacts: CollisionContact[]) {\r\n    for (let i = 0; i < Physics.positionIterations; i++) {\r\n      for (const contact of contacts) {\r\n        const bodyA = contact.colliderA.owner?.get(BodyComponent);\r\n        const bodyB = contact.colliderB.owner?.get(BodyComponent);\r\n\r\n        if (bodyA && bodyB) {\r\n          // Skip solving active+passive\r\n          if (bodyA.collisionType === CollisionType.Passive || bodyB.collisionType === CollisionType.Passive) {\r\n            continue;\r\n          }\r\n\r\n          const constraints = this.idToContactConstraint.get(contact.id) ?? [];\r\n          for (const point of constraints) {\r\n            const normal = contact.normal;\r\n            const separation = CollisionJumpTable.FindContactSeparation(contact, point.local);\r\n\r\n            const steeringConstant = Physics.steeringFactor; //0.2;\r\n            const maxCorrection = -5;\r\n            const slop = Physics.slop; //1;\r\n\r\n            // Clamp to avoid over-correction\r\n            // Remember that we are shooting for 0 overlap in the end\r\n            const steeringForce = clamp(steeringConstant * (separation + slop), maxCorrection, 0);\r\n            const impulse = normal.scale(-steeringForce / point.normalMass);\r\n\r\n            // This is a pseudo impulse, meaning we aren't doing a real impulse calculation\r\n            // We adjust position and rotation instead of doing the velocity\r\n            if (bodyA.collisionType === CollisionType.Active) {\r\n              bodyA.pos = bodyA.pos.add(impulse.negate().scale(bodyA.inverseMass));\r\n              bodyA.rotation -= point.aToContact.cross(impulse) * bodyA.inverseInertia;\r\n            }\r\n\r\n            if (bodyB.collisionType === CollisionType.Active) {\r\n              bodyB.pos = bodyB.pos.add(impulse.scale(bodyB.inverseMass));\r\n              bodyB.rotation += point.bToContact.cross(impulse) * bodyB.inverseInertia;\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  solveVelocity(contacts: CollisionContact[]) {\r\n    for (let i = 0; i < Physics.velocityIterations; i++) {\r\n      for (const contact of contacts) {\r\n        const bodyA = contact.colliderA.owner?.get(BodyComponent);\r\n        const bodyB = contact.colliderB.owner?.get(BodyComponent);\r\n\r\n        if (bodyA && bodyB) {\r\n          // Skip solving active+passive\r\n          if (bodyA.collisionType === CollisionType.Passive || bodyB.collisionType === CollisionType.Passive) {\r\n            continue;\r\n          }\r\n\r\n          const restitution = bodyA.bounciness * bodyB.bounciness;\r\n          const friction = Math.min(bodyA.friction, bodyB.friction);\r\n\r\n          const constraints = this.idToContactConstraint.get(contact.id) ?? [];\r\n\r\n          for (const point of constraints) {\r\n            const relativeVelocity = point.getRelativeVelocity();\r\n\r\n            // Negate velocity in tangent direction to simulate friction\r\n            const tangentVelocity = -relativeVelocity.dot(contact.tangent);\r\n            let impulseDelta = tangentVelocity / point.tangentMass;\r\n\r\n            // Clamping based in Erin Catto's GDC 2006 talk\r\n            // Correct clamping https://github.com/erincatto/box2d-lite/blob/master/docs/GDC2006_Catto_Erin_PhysicsTutorial.pdf\r\n            // Accumulated fiction impulse is always between -uMaxFriction < dT < uMaxFriction\r\n            // But deltas can vary\r\n            const maxFriction = friction * point.normalImpulse;\r\n            const newImpulse = clamp(point.tangentImpulse + impulseDelta, -maxFriction, maxFriction);\r\n            impulseDelta = newImpulse - point.tangentImpulse;\r\n            point.tangentImpulse = newImpulse;\r\n\r\n            const impulse = contact.tangent.scale(impulseDelta);\r\n            bodyA.applyImpulse(point.point, impulse.negate());\r\n            bodyB.applyImpulse(point.point, impulse);\r\n          }\r\n\r\n          for (const point of constraints) {\r\n            // Need to recalc relative velocity because the previous step could have changed vel\r\n            const relativeVelocity = point.getRelativeVelocity();\r\n\r\n            // Compute impulse in normal direction\r\n            const normalVelocity = relativeVelocity.dot(contact.normal);\r\n            // See https://en.wikipedia.org/wiki/Collision_response\r\n            let impulseDelta = (-(1 + restitution) * normalVelocity) / point.normalMass;\r\n\r\n            // Clamping based in Erin Catto's GDC 2014 talk\r\n            // Accumulated impulse stored in the contact is always positive (dV > 0)\r\n            // But deltas can be negative\r\n            const newImpulse = Math.max(point.normalImpulse + impulseDelta, 0);\r\n            impulseDelta = newImpulse - point.normalImpulse;\r\n            point.normalImpulse = newImpulse;\r\n\r\n            const impulse = contact.normal.scale(impulseDelta);\r\n            bodyA.applyImpulse(point.point, impulse.negate());\r\n            bodyB.applyImpulse(point.point, impulse);\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { Entity } from '../EntityComponentSystem';\r\nimport { MotionComponent } from '../EntityComponentSystem/Components/MotionComponent';\r\nimport { TransformComponent } from '../EntityComponentSystem/Components/TransformComponent';\r\nimport { AddedEntity, isAddedSystemEntity, RemovedEntity, System, SystemType } from '../EntityComponentSystem/System';\r\nimport { CollisionEndEvent, CollisionStartEvent, ContactEndEvent, ContactStartEvent } from '../Events';\r\nimport { CollisionResolutionStrategy, Physics } from './Physics';\r\nimport { ArcadeSolver } from './Solver/ArcadeSolver';\r\nimport { Collider } from './Colliders/Collider';\r\nimport { CollisionContact } from './Detection/CollisionContact';\r\nimport { DynamicTreeCollisionProcessor } from './Detection/DynamicTreeCollisionProcessor';\r\nimport { RealisticSolver } from './Solver/RealisticSolver';\r\nimport { CollisionSolver } from './Solver/Solver';\r\nimport { ColliderComponent } from './ColliderComponent';\r\nimport { CompositeCollider } from './Colliders/CompositeCollider';\r\nimport { Engine, ExcaliburGraphicsContext, Scene } from '..';\r\n\r\nexport class CollisionSystem extends System<TransformComponent | MotionComponent | ColliderComponent> {\r\n  public readonly types = ['ex.transform', 'ex.motion', 'ex.collider'] as const;\r\n  public systemType = SystemType.Update;\r\n  public priority = -1;\r\n\r\n  private _engine: Engine;\r\n  private _realisticSolver = new RealisticSolver();\r\n  private _arcadeSolver = new ArcadeSolver();\r\n  private _processor = new DynamicTreeCollisionProcessor();\r\n  private _lastFrameContacts = new Map<string, CollisionContact>();\r\n  private _currentFrameContacts = new Map<string, CollisionContact>();\r\n\r\n  private _trackCollider = (c: Collider) => this._processor.track(c);\r\n  private _untrackCollider = (c: Collider) => this._processor.untrack(c);\r\n\r\n  notify(message: AddedEntity | RemovedEntity) {\r\n    if (isAddedSystemEntity(message)) {\r\n      const colliderComponent = message.data.get(ColliderComponent);\r\n      colliderComponent.$colliderAdded.subscribe(this._trackCollider);\r\n      colliderComponent.$colliderRemoved.subscribe(this._untrackCollider);\r\n      const collider = colliderComponent.get();\r\n      if (collider) {\r\n        this._processor.track(collider);\r\n      }\r\n    } else {\r\n      const colliderComponent = message.data.get(ColliderComponent);\r\n      const collider = colliderComponent.get();\r\n      if (colliderComponent && collider) {\r\n        this._processor.untrack(collider);\r\n      }\r\n    }\r\n  }\r\n\r\n  initialize(scene: Scene) {\r\n    this._engine = scene.engine;\r\n  }\r\n\r\n  update(_entities: Entity[], elapsedMs: number): void {\r\n    if (!Physics.enabled) {\r\n      return;\r\n    }\r\n\r\n    // Collect up all the colliders\r\n    let colliders: Collider[] = [];\r\n    for (const entity of _entities) {\r\n      const colliderComp = entity.get(ColliderComponent);\r\n      const collider = colliderComp?.get();\r\n      if (colliderComp && colliderComp.owner?.active && collider) {\r\n        colliderComp.update();\r\n        if (collider instanceof CompositeCollider) {\r\n          colliders = colliders.concat(collider.getColliders());\r\n        } else {\r\n          colliders.push(collider);\r\n        }\r\n      }\r\n    }\r\n\r\n    // Update the spatial partitioning data structures\r\n    // TODO if collider invalid it will break the processor\r\n    // TODO rename \"update\" to something more specific\r\n    this._processor.update(colliders);\r\n\r\n    // Run broadphase on all colliders and locates potential collisions\r\n    const pairs = this._processor.broadphase(colliders, elapsedMs);\r\n\r\n    this._currentFrameContacts.clear();\r\n\r\n    // Given possible pairs find actual contacts\r\n    let contacts = this._processor.narrowphase(pairs, this._engine.debug.stats.currFrame);\r\n\r\n    const solver: CollisionSolver = this.getSolver();\r\n\r\n    // Solve, this resolves the position/velocity so entities aren't overlapping\r\n    contacts = solver.solve(contacts);\r\n\r\n    // Record contacts\r\n    contacts.forEach((c) => this._currentFrameContacts.set(c.id, c));\r\n\r\n    // Emit contact start/end events\r\n    this.runContactStartEnd();\r\n\r\n    // reset the last frame cache\r\n    this._lastFrameContacts.clear();\r\n\r\n    // Keep track of collisions contacts that have started or ended\r\n    this._lastFrameContacts = new Map(this._currentFrameContacts);\r\n  }\r\n\r\n  getSolver(): CollisionSolver {\r\n    return Physics.collisionResolutionStrategy === CollisionResolutionStrategy.Realistic ? this._realisticSolver : this._arcadeSolver;\r\n  }\r\n\r\n  debug(ex: ExcaliburGraphicsContext) {\r\n    this._processor.debug(ex);\r\n  }\r\n\r\n  public runContactStartEnd() {\r\n    for (const [id, c] of this._currentFrameContacts) {\r\n      // find all new contacts\r\n      if (!this._lastFrameContacts.has(id)) {\r\n        const colliderA = c.colliderA;\r\n        const colliderB = c.colliderB;\r\n        colliderA.events.emit('collisionstart', new CollisionStartEvent(colliderA, colliderB, c));\r\n        colliderA.events.emit('contactstart', new ContactStartEvent(colliderA, colliderB, c) as any);\r\n        colliderB.events.emit('collisionstart', new CollisionStartEvent(colliderB, colliderA, c));\r\n        colliderB.events.emit('contactstart', new ContactStartEvent(colliderB, colliderA, c) as any);\r\n      }\r\n    }\r\n\r\n    // find all contacts taht have ceased\r\n    for (const [id, c] of this._lastFrameContacts) {\r\n      if (!this._currentFrameContacts.has(id)) {\r\n        const colliderA = c.colliderA;\r\n        const colliderB = c.colliderB;\r\n        colliderA.events.emit('collisionend', new CollisionEndEvent(colliderA, colliderB));\r\n        colliderA.events.emit('contactend', new ContactEndEvent(colliderA, colliderB) as any);\r\n        colliderB.events.emit('collisionend', new CollisionEndEvent(colliderB, colliderA));\r\n        colliderB.events.emit('contactend', new ContactEndEvent(colliderB, colliderA) as any);\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { Graphic, GraphicOptions } from './Graphic';\r\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\r\nimport { EventDispatcher } from '../EventDispatcher';\r\nimport { SpriteSheet } from './SpriteSheet';\r\nimport { Logger } from '../Util/Log';\r\nimport { Engine, LegacyDrawing } from '..';\r\nimport { Sprite } from '.';\r\nimport { clamp } from '../Math/util';\r\n\r\nexport interface HasTick {\r\n  /**\r\n   *\r\n   * @param elapsedMilliseconds The amount of real world time in milliseconds that has elapsed that must be updated in the animation\r\n   * @param idempotencyToken Optional idempotencyToken prevents a ticking animation from updating twice per frame\r\n   */\r\n  tick(elapsedMilliseconds: number, idempotencyToken?: number): void;\r\n}\r\n\r\nexport enum AnimationDirection {\r\n  /**\r\n   * Animation is playing forwards\r\n   */\r\n  Forward = 'forward',\r\n  /**\r\n   * Animation is play backwards\r\n   */\r\n  Backward = 'backward'\r\n}\r\n\r\nexport enum AnimationStrategy {\r\n  /**\r\n   * Animation ends without displaying anything\r\n   */\r\n  End = 'end',\r\n  /**\r\n   * Animation loops to the first frame after the last frame\r\n   */\r\n  Loop = 'loop',\r\n  /**\r\n   * Animation plays to the last frame, then backwards to the first frame, then repeats\r\n   */\r\n  PingPong = 'pingpong',\r\n  /**\r\n   * Animation ends stopping on the last frame\r\n   */\r\n  Freeze = 'freeze'\r\n}\r\n\r\n/**\r\n * Frame of animation\r\n */\r\nexport interface Frame {\r\n  /**\r\n   * Optionally specify a graphic to show, no graphic shows an empty frame\r\n   */\r\n  graphic?: Graphic;\r\n  /**\r\n   * Optionally specify the number of ms the frame should be visible, overrides the animation duration (default 100 ms)\r\n   */\r\n  duration?: number;\r\n}\r\n\r\n/**\r\n * Animation options for building an animation via constructor.\r\n */\r\nexport interface AnimationOptions {\r\n  /**\r\n   * List of frames in the order you wish to play them\r\n   */\r\n  frames: Frame[];\r\n  /**\r\n   * Optionally reverse the direction of play\r\n   */\r\n  reverse?: boolean;\r\n  /**\r\n   * Optionally specify a default frame duration in ms (Default is 1000)\r\n   */\r\n  frameDuration?: number;\r\n  /**\r\n   * Optionally specify a total duration of the animation in ms to calculate each frame's duration\r\n   */\r\n  totalDuration?: number;\r\n  /**\r\n   * Optionally specify the [[AnimationStrategy]] for the Animation\r\n   */\r\n  strategy?: AnimationStrategy;\r\n}\r\n\r\n// TODO wire up to new Emitter\r\nexport type AnimationEvents = {\r\n  frame: Frame;\r\n  loop: Animation;\r\n  ended: Animation;\r\n};\r\n\r\n/**\r\n * Create an Animation given a list of [[Frame|frames]] in [[AnimationOptions]]\r\n *\r\n * To create an Animation from a [[SpriteSheet]], use [[Animation.fromSpriteSheet]]\r\n */\r\nexport class Animation extends Graphic implements HasTick {\r\n  private static _LOGGER = Logger.getInstance();\r\n  public events = new EventDispatcher<any>(); // TODO replace with new Emitter\r\n  public frames: Frame[] = [];\r\n  public strategy: AnimationStrategy = AnimationStrategy.Loop;\r\n  public frameDuration: number = 100;\r\n  public timeScale: number = 1;\r\n\r\n  private _idempotencyToken = -1;\r\n\r\n  private _firstTick = true;\r\n  private _currentFrame = 0;\r\n  private _timeLeftInFrame = 0;\r\n  private _direction = 1; // TODO only used in ping-pong\r\n  private _done = false;\r\n  private _playing = true;\r\n\r\n  constructor(options: GraphicOptions & AnimationOptions) {\r\n    super(options);\r\n    this.frames = options.frames;\r\n    this.strategy = options.strategy ?? this.strategy;\r\n    this.frameDuration = options.totalDuration ? options.totalDuration / this.frames.length : options.frameDuration ?? this.frameDuration;\r\n    if (options.reverse) {\r\n      this.reverse();\r\n    }\r\n    this.goToFrame(0);\r\n  }\r\n\r\n  public clone(): Animation {\r\n    return new Animation({\r\n      frames: this.frames.map((f) => ({ ...f })),\r\n      frameDuration: this.frameDuration,\r\n      reverse: this._reversed,\r\n      strategy: this.strategy,\r\n      ...this.cloneGraphicOptions()\r\n    });\r\n  }\r\n\r\n  public override get width(): number {\r\n    const maybeFrame = this.currentFrame;\r\n    if (maybeFrame) {\r\n      return Math.abs(maybeFrame.graphic.width * this.scale.x);\r\n    }\r\n    return 0;\r\n  }\r\n\r\n  public override get height(): number {\r\n    const maybeFrame = this.currentFrame;\r\n    if (maybeFrame) {\r\n      return Math.abs(maybeFrame.graphic.height * this.scale.y);\r\n    }\r\n    return 0;\r\n  }\r\n\r\n\r\n  /**\r\n   * Create an Animation from a [[SpriteSheet]], a list of indices into the sprite sheet, a duration per frame\r\n   * and optional [[AnimationStrategy]]\r\n   *\r\n   * Example:\r\n   * ```typescript\r\n   * const spriteSheet = SpriteSheet.fromImageSource({...});\r\n   *\r\n   * const anim = Animation.fromSpriteSheet(spriteSheet, range(0, 5), 200, AnimationStrategy.Loop);\r\n   * ```\r\n   *\r\n   * @param spriteSheet\r\n   * @param frameIndices\r\n   * @param durationPerFrameMs\r\n   * @param strategy\r\n   */\r\n  public static fromSpriteSheet(\r\n    spriteSheet: SpriteSheet,\r\n    frameIndices: number[],\r\n    durationPerFrameMs: number,\r\n    strategy: AnimationStrategy = AnimationStrategy.Loop\r\n  ): Animation {\r\n    const maxIndex = spriteSheet.sprites.length - 1;\r\n    const invalidIndices = frameIndices.filter((index) => index < 0 || index > maxIndex);\r\n    if (invalidIndices.length) {\r\n      Animation._LOGGER.warn(\r\n        `Indices into SpriteSheet were provided that don\\'t exist: ${invalidIndices.join(',')} no frame will be shown`\r\n      );\r\n    }\r\n    return new Animation({\r\n      frames: spriteSheet.sprites\r\n        .filter((_, index) => frameIndices.indexOf(index) > -1)\r\n        .map((f) => ({\r\n          graphic: f,\r\n          duration: durationPerFrameMs\r\n        })),\r\n      strategy: strategy\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Converts an animation to a legacy animation\r\n   * @deprecated\r\n   * @param engine\r\n   * @param animation\r\n   * @returns LegacyDrawing.Animation\r\n   */\r\n  public static toLegacyAnimation(engine: Engine, animation: Animation): LegacyDrawing.Animation {\r\n    const legacySprites = animation.frames.map(f => Sprite.toLegacySprite(f.graphic as Sprite));\r\n    return new LegacyDrawing.Animation({\r\n      sprites: legacySprites,\r\n      loop: animation.strategy === AnimationStrategy.Loop,\r\n      freezeFrame: animation.strategy === AnimationStrategy.Freeze ? legacySprites.length - 1 : undefined,\r\n      speed: animation.frameDuration,\r\n      engine: engine\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Returns the current Frame of the animation\r\n   */\r\n  public get currentFrame(): Frame | null {\r\n    if (this._currentFrame >= 0 && this._currentFrame < this.frames.length) {\r\n      return this.frames[this._currentFrame];\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Returns the current frame index of the animation\r\n   */\r\n  public get currentFrameIndex(): number {\r\n    return this._currentFrame;\r\n  }\r\n\r\n  /**\r\n   * Returns `true` if the animation is playing\r\n   */\r\n  public get isPlaying(): boolean {\r\n    return this._playing;\r\n  }\r\n\r\n  private _reversed = false;\r\n  /**\r\n   * Reverses the play direction of the Animation, this preserves the current frame\r\n   */\r\n  public reverse(): void {\r\n    // Don't mutate with the original frame list, create a copy\r\n    this.frames = this.frames.slice().reverse();\r\n    this._reversed = !this._reversed;\r\n  }\r\n\r\n  /**\r\n   * Returns the current play direction of the animation\r\n   */\r\n  public get direction(): AnimationDirection {\r\n    // Keep logically consistent with ping-pong direction\r\n    // If ping-pong is forward = 1 and reversed is true then we are logically reversed\r\n    const reversed = (this._reversed && this._direction === 1) ? true : false;\r\n    return reversed ? AnimationDirection.Backward : AnimationDirection.Forward;\r\n  }\r\n\r\n  /**\r\n   * Plays or resumes the animation from the current frame\r\n   */\r\n  public play(): void {\r\n    this._playing = true;\r\n  }\r\n\r\n  /**\r\n   * Pauses the animation on the current frame\r\n   */\r\n  public pause(): void {\r\n    this._playing = false;\r\n    this._firstTick = true; // firstTick must be set to emit the proper frame event\r\n  }\r\n\r\n  /**\r\n   * Reset the animation back to the beginning, including if the animation were done\r\n   */\r\n  public reset(): void {\r\n    this._done = false;\r\n    this._firstTick = true;\r\n    this._currentFrame = 0;\r\n  }\r\n\r\n  /**\r\n   * Returns `true` if the animation can end\r\n   */\r\n  public get canFinish(): boolean {\r\n    switch (this.strategy) {\r\n      case AnimationStrategy.End:\r\n      case AnimationStrategy.Freeze: {\r\n        return true;\r\n      }\r\n      default: {\r\n        return false;\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns `true` if the animation is done, for looping type animations\r\n   * `ex.AnimationStrategy.PingPong` and `ex.AnimationStrategy.Loop` this will always return `false`\r\n   *\r\n   * See the `ex.Animation.canFinish()` method to know if an animation type can end\r\n   */\r\n  public get done(): boolean {\r\n    return this._done;\r\n  }\r\n\r\n  /**\r\n   * Jump the animation immediately to a specific frame if it exists\r\n   * @param frameNumber\r\n   */\r\n  public goToFrame(frameNumber: number) {\r\n    this._currentFrame = frameNumber;\r\n    this._timeLeftInFrame = this.frameDuration;\r\n    const maybeFrame = this.frames[this._currentFrame];\r\n    if (maybeFrame && !this._done) {\r\n      this._timeLeftInFrame = maybeFrame?.duration || this.frameDuration;\r\n      this.events.emit('frame', maybeFrame as any);\r\n    }\r\n  }\r\n\r\n  private _nextFrame(): number {\r\n    const currentFrame = this._currentFrame;\r\n    if (this._done) {\r\n      return currentFrame;\r\n    }\r\n    let next = -1;\r\n\r\n    switch (this.strategy) {\r\n      case AnimationStrategy.Loop: {\r\n        next = (currentFrame + 1) % this.frames.length;\r\n        if (next === 0) {\r\n          this.events.emit('loop', this as any);\r\n        }\r\n        break;\r\n      }\r\n      case AnimationStrategy.End: {\r\n        next = currentFrame + 1;\r\n        if (next >= this.frames.length) {\r\n          this._done = true;\r\n          this._currentFrame = this.frames.length;\r\n          this.events.emit('end', this as any);\r\n        }\r\n        break;\r\n      }\r\n      case AnimationStrategy.Freeze: {\r\n        next = clamp(currentFrame + 1, 0, this.frames.length - 1);\r\n        if (next >= this.frames.length - 1) {\r\n          this._done = true;\r\n          this.events.emit('end', this as any);\r\n        }\r\n        break;\r\n      }\r\n      case AnimationStrategy.PingPong: {\r\n        if (currentFrame + this._direction >= this.frames.length) {\r\n          this._direction = -1;\r\n          this.events.emit('loop', this as any);\r\n        }\r\n\r\n        if (currentFrame + this._direction < 0) {\r\n          this._direction = 1;\r\n          this.events.emit('loop', this as any);\r\n        }\r\n\r\n        next = currentFrame + (this._direction % this.frames.length);\r\n        break;\r\n      }\r\n    }\r\n    return next;\r\n  }\r\n\r\n  /**\r\n   * Called internally by Excalibur to update the state of the animation potential update the current frame\r\n   * @param elapsedMilliseconds Milliseconds elapsed\r\n   * @param idempotencyToken Prevents double ticking in a frame by passing a unique token to the frame\r\n   */\r\n  public tick(elapsedMilliseconds: number, idempotencyToken: number = 0): void {\r\n    if (this._idempotencyToken === idempotencyToken) {\r\n      return;\r\n    }\r\n    this._idempotencyToken = idempotencyToken;\r\n    if (!this._playing) {\r\n      return;\r\n    }\r\n\r\n    // if it's the first frame emit frame event\r\n    if (this._firstTick) {\r\n      this._firstTick = false;\r\n      this.events.emit('frame', this.currentFrame as any);\r\n    }\r\n\r\n    this._timeLeftInFrame -= elapsedMilliseconds * this.timeScale;\r\n    if (this._timeLeftInFrame <= 0) {\r\n      this.goToFrame(this._nextFrame());\r\n    }\r\n  }\r\n\r\n  protected _drawImage(ctx: ExcaliburGraphicsContext, x: number, y: number) {\r\n    if (this.currentFrame) {\r\n      this.currentFrame.graphic.draw(ctx, x, y);\r\n    }\r\n  }\r\n}\r\n","import { Vector } from '../Math/vector';\r\nimport { Graphic, GraphicOptions } from './Graphic';\r\nimport { Animation, HasTick } from './Animation';\r\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\r\nimport { BoundingBox } from '../Collision/Index';\r\n\r\nexport interface GraphicsGroupingOptions {\r\n  members: GraphicsGrouping[];\r\n}\r\n\r\nexport interface GraphicsGrouping {\r\n  pos: Vector;\r\n  graphic: Graphic;\r\n}\r\n\r\nexport class GraphicsGroup extends Graphic implements HasTick {\r\n  public members: GraphicsGrouping[] = [];\r\n\r\n  constructor(options: GraphicsGroupingOptions & GraphicOptions) {\r\n    super(options);\r\n    this.members = options.members;\r\n    this._updateDimensions();\r\n  }\r\n\r\n  public clone(): GraphicsGroup {\r\n    return new GraphicsGroup({\r\n      members: [...this.members],\r\n      ...this.cloneGraphicOptions()\r\n    });\r\n  }\r\n\r\n  private _updateDimensions(): BoundingBox {\r\n    let bb = new BoundingBox();\r\n    for (const { graphic, pos } of this.members) {\r\n      bb = graphic.localBounds.translate(pos).combine(bb);\r\n    }\r\n\r\n    this.width = bb.width;\r\n    this.height = bb.height;\r\n\r\n    return bb;\r\n  }\r\n\r\n  public get localBounds(): BoundingBox {\r\n    let bb = new BoundingBox();\r\n    for (const { graphic, pos } of this.members) {\r\n      bb = graphic.localBounds.translate(pos).combine(bb);\r\n    }\r\n    return bb;\r\n  }\r\n\r\n  private _isAnimationOrGroup(graphic: Graphic): graphic is Animation | GraphicsGroup {\r\n    return graphic instanceof Animation || graphic instanceof GraphicsGroup;\r\n  }\r\n\r\n  public tick(elapsedMilliseconds: number, idempotencyToken?: number) {\r\n    for (const member of this.members) {\r\n      const maybeAnimation = member.graphic;\r\n      if (this._isAnimationOrGroup(maybeAnimation)) {\r\n        maybeAnimation.tick(elapsedMilliseconds, idempotencyToken);\r\n      }\r\n    }\r\n  }\r\n\r\n  public reset() {\r\n    for (const member of this.members) {\r\n      const maybeAnimation = member.graphic;\r\n      if (this._isAnimationOrGroup(maybeAnimation)) {\r\n        maybeAnimation.reset();\r\n      }\r\n    }\r\n  }\r\n\r\n  protected _preDraw(ex: ExcaliburGraphicsContext, x: number, y: number) {\r\n    this._updateDimensions();\r\n    super._preDraw(ex, x, y);\r\n  }\r\n\r\n  protected _drawImage(ex: ExcaliburGraphicsContext, x: number, y: number) {\r\n    for (const member of this.members) {\r\n      ex.save();\r\n      ex.translate(x, y);\r\n      member.graphic.draw(ex, member.pos.x, member.pos.y);\r\n      if (this.showDebug) {\r\n        /* istanbul ignore next */\r\n        ex.debug.drawRect(0, 0, this.width, this.height);\r\n      }\r\n      ex.restore();\r\n    }\r\n  }\r\n}\r\n","import { Engine } from './Engine';\r\nimport { Actor } from './Actor';\r\nimport { Color } from './Color';\r\nimport { Vector, vec } from './Math/vector';\r\nimport * as Util from './Util/Util';\r\nimport * as DrawUtil from './Util/DrawUtil';\r\nimport * as Traits from './Traits/Index';\r\nimport { Configurable } from './Configurable';\r\nimport { Random } from './Math/Random';\r\nimport { CollisionType } from './Collision/CollisionType';\r\nimport { TransformComponent } from './EntityComponentSystem/Components/TransformComponent';\r\nimport { GraphicsComponent } from './Graphics/GraphicsComponent';\r\nimport { Entity } from './EntityComponentSystem/Entity';\r\nimport { CanvasDrawComponent } from './Drawing/Index';\r\nimport { Sprite } from './Graphics/Sprite';\r\nimport { LegacyDrawing } from '.';\r\nimport { clamp, randomInRange } from './Math/util';\r\n\r\n/**\r\n * An enum that represents the types of emitter nozzles\r\n */\r\nexport enum EmitterType {\r\n  /**\r\n   * Constant for the circular emitter type\r\n   */\r\n  Circle,\r\n  /**\r\n   * Constant for the rectangular emitter type\r\n   */\r\n  Rectangle\r\n}\r\n\r\n/**\r\n * @hidden\r\n */\r\nexport class ParticleImpl extends Entity {\r\n  public position: Vector = new Vector(0, 0);\r\n  public velocity: Vector = new Vector(0, 0);\r\n  public acceleration: Vector = new Vector(0, 0);\r\n  public particleRotationalVelocity: number = 0;\r\n  public currentRotation: number = 0;\r\n\r\n  public focus: Vector = null;\r\n  public focusAccel: number = 0;\r\n  public opacity: number = 1;\r\n  public beginColor: Color = Color.White;\r\n  public endColor: Color = Color.White;\r\n\r\n  // Life is counted in ms\r\n  public life: number = 300;\r\n  public fadeFlag: boolean = false;\r\n\r\n  // Color transitions\r\n  private _rRate: number = 1;\r\n  private _gRate: number = 1;\r\n  private _bRate: number = 1;\r\n  private _aRate: number = 0;\r\n  private _currentColor: Color = Color.White;\r\n\r\n  public emitter: ParticleEmitter = null;\r\n  public particleSize: number = 5;\r\n  public particleSprite: LegacyDrawing.Sprite = null;\r\n\r\n  public startSize: number;\r\n  public endSize: number;\r\n  public sizeRate: number = 0;\r\n  public elapsedMultiplier: number = 0;\r\n\r\n  public visible = true;\r\n  public isOffscreen = false;\r\n\r\n  public transform: TransformComponent;\r\n  public graphics: GraphicsComponent;\r\n\r\n  constructor(\r\n    emitterOrConfig: ParticleEmitter | ParticleArgs,\r\n    life?: number,\r\n    opacity?: number,\r\n    beginColor?: Color,\r\n    endColor?: Color,\r\n    position?: Vector,\r\n    velocity?: Vector,\r\n    acceleration?: Vector,\r\n    startSize?: number,\r\n    endSize?: number\r\n  ) {\r\n    super();\r\n    let emitter = emitterOrConfig;\r\n    if (emitter && !(emitterOrConfig instanceof ParticleEmitter)) {\r\n      const config = emitterOrConfig;\r\n      emitter = config.emitter;\r\n      life = config.life;\r\n      opacity = config.opacity;\r\n      endColor = config.endColor;\r\n      beginColor = config.beginColor;\r\n      position = config.position;\r\n      velocity = config.velocity;\r\n      acceleration = config.acceleration;\r\n      startSize = config.startSize;\r\n      endSize = config.endSize;\r\n    }\r\n    this.emitter = <ParticleEmitter>emitter;\r\n    this.life = life || this.life;\r\n    this.opacity = opacity || this.opacity;\r\n    this.endColor = endColor || this.endColor.clone();\r\n    this.beginColor = beginColor || this.beginColor.clone();\r\n    this._currentColor = this.beginColor.clone();\r\n    this.position = (position || this.position).add(this.emitter.pos);\r\n    this.velocity = velocity || this.velocity;\r\n    this.acceleration = acceleration || this.acceleration;\r\n    this._rRate = (this.endColor.r - this.beginColor.r) / this.life;\r\n    this._gRate = (this.endColor.g - this.beginColor.g) / this.life;\r\n    this._bRate = (this.endColor.b - this.beginColor.b) / this.life;\r\n    this._aRate = this.opacity / this.life;\r\n\r\n    this.startSize = startSize || 0;\r\n    this.endSize = endSize || 0;\r\n\r\n    if (this.endSize > 0 && this.startSize > 0) {\r\n      this.sizeRate = (this.endSize - this.startSize) / this.life;\r\n      this.particleSize = this.startSize;\r\n    }\r\n\r\n    this.addComponent((this.transform = new TransformComponent()));\r\n    this.addComponent(new CanvasDrawComponent((ctx) => this.draw(ctx)));\r\n    this.addComponent((this.graphics = new GraphicsComponent()));\r\n\r\n    this.transform.pos = this.position;\r\n    this.transform.rotation = this.currentRotation;\r\n    this.transform.scale = vec(1, 1); // TODO wut\r\n    if (this.particleSprite) {\r\n      this.graphics.opacity = this.opacity;\r\n      this.graphics.use(Sprite.fromLegacySprite(this.particleSprite));\r\n    } else {\r\n      this.graphics.onPostDraw = (ctx) => {\r\n        ctx.save();\r\n        this.graphics.opacity = this.opacity;\r\n        const tmpColor = this._currentColor.clone();\r\n        tmpColor.a = 1;\r\n        ctx.debug.drawPoint(vec(0, 0), { color: tmpColor, size: this.particleSize });\r\n        ctx.restore();\r\n      };\r\n    }\r\n  }\r\n\r\n  public kill() {\r\n    this.emitter.removeParticle(this);\r\n  }\r\n\r\n  public update(_engine: Engine, delta: number) {\r\n    this.life = this.life - delta;\r\n    this.elapsedMultiplier = this.elapsedMultiplier + delta;\r\n\r\n    if (this.life < 0) {\r\n      this.kill();\r\n    }\r\n\r\n    if (this.fadeFlag) {\r\n      this.opacity = clamp(this._aRate * this.life, 0.0001, 1);\r\n    }\r\n\r\n    if (this.startSize > 0 && this.endSize > 0) {\r\n      this.particleSize = clamp(\r\n        this.sizeRate * delta + this.particleSize,\r\n        Math.min(this.startSize, this.endSize),\r\n        Math.max(this.startSize, this.endSize)\r\n      );\r\n    }\r\n\r\n    this._currentColor.r = clamp(this._currentColor.r + this._rRate * delta, 0, 255);\r\n    this._currentColor.g = clamp(this._currentColor.g + this._gRate * delta, 0, 255);\r\n    this._currentColor.b = clamp(this._currentColor.b + this._bRate * delta, 0, 255);\r\n    this._currentColor.a = clamp(this.opacity, 0.0001, 1);\r\n\r\n    if (this.focus) {\r\n      const accel = this.focus\r\n        .sub(this.position)\r\n        .normalize()\r\n        .scale(this.focusAccel)\r\n        .scale(delta / 1000);\r\n      this.velocity = this.velocity.add(accel);\r\n    } else {\r\n      this.velocity = this.velocity.add(this.acceleration.scale(delta / 1000));\r\n    }\r\n    this.position = this.position.add(this.velocity.scale(delta / 1000));\r\n\r\n    if (this.particleRotationalVelocity) {\r\n      this.currentRotation = (this.currentRotation + (this.particleRotationalVelocity * delta) / 1000) % (2 * Math.PI);\r\n    }\r\n\r\n    this.transform.pos = this.position;\r\n    this.transform.rotation = this.currentRotation;\r\n    this.transform.scale = vec(1, 1); // todo wut\r\n    this.graphics.opacity = this.opacity;\r\n  }\r\n\r\n  /**\r\n   * @deprecated signature will change in v0.26.0\r\n   * @param ctx\r\n   */\r\n  public draw(ctx: CanvasRenderingContext2D) {\r\n    if (this.particleSprite) {\r\n      this.particleSprite.opacity(this.opacity);\r\n      this.particleSprite.draw(ctx, 0, 0);\r\n      return;\r\n    }\r\n\r\n    ctx.save();\r\n    this._currentColor.a = clamp(this.opacity, 0.0001, 1);\r\n    ctx.fillStyle = this._currentColor.toString();\r\n    ctx.beginPath();\r\n    ctx.arc(0, 0, this.particleSize, 0, Math.PI * 2);\r\n    ctx.fill();\r\n    ctx.closePath();\r\n    ctx.restore();\r\n  }\r\n}\r\n\r\nexport interface ParticleArgs extends Partial<ParticleImpl> {\r\n  emitter: ParticleEmitter;\r\n  position?: Vector;\r\n  velocity?: Vector;\r\n  acceleration?: Vector;\r\n  particleRotationalVelocity?: number;\r\n  currentRotation?: number;\r\n  particleSize?: number;\r\n  particleSprite?: LegacyDrawing.Sprite;\r\n}\r\n\r\n/**\r\n * Particle is used in a [[ParticleEmitter]]\r\n */\r\nexport class Particle extends Configurable(ParticleImpl) {\r\n  constructor(config: ParticleArgs);\r\n  constructor(\r\n    emitter: ParticleEmitter,\r\n    life?: number,\r\n    opacity?: number,\r\n    beginColor?: Color,\r\n    endColor?: Color,\r\n    position?: Vector,\r\n    velocity?: Vector,\r\n    acceleration?: Vector,\r\n    startSize?: number,\r\n    endSize?: number\r\n  );\r\n  constructor(\r\n    emitterOrConfig: ParticleEmitter | ParticleArgs,\r\n    life?: number,\r\n    opacity?: number,\r\n    beginColor?: Color,\r\n    endColor?: Color,\r\n    position?: Vector,\r\n    velocity?: Vector,\r\n    acceleration?: Vector,\r\n    startSize?: number,\r\n    endSize?: number\r\n  ) {\r\n    super(emitterOrConfig, life, opacity, beginColor, endColor, position, velocity, acceleration, startSize, endSize);\r\n  }\r\n}\r\n\r\nexport interface ParticleEmitterArgs {\r\n  x?: number;\r\n  y?: number;\r\n  pos?: Vector;\r\n  width?: number;\r\n  height?: number;\r\n  isEmitting?: boolean;\r\n  minVel?: number;\r\n  maxVel?: number;\r\n  acceleration?: Vector;\r\n  minAngle?: number;\r\n  maxAngle?: number;\r\n  emitRate?: number;\r\n  particleLife?: number;\r\n  opacity?: number;\r\n  fadeFlag?: boolean;\r\n  focus?: Vector;\r\n  focusAccel?: number;\r\n  startSize?: number;\r\n  endSize?: number;\r\n  minSize?: number;\r\n  maxSize?: number;\r\n  beginColor?: Color;\r\n  endColor?: Color;\r\n  particleSprite?: LegacyDrawing.Sprite;\r\n  emitterType?: EmitterType;\r\n  radius?: number;\r\n  particleRotationalVelocity?: number;\r\n  randomRotation?: boolean;\r\n  random?: Random;\r\n}\r\n\r\n/**\r\n * Using a particle emitter is a great way to create interesting effects\r\n * in your game, like smoke, fire, water, explosions, etc. `ParticleEmitter`\r\n * extend [[Actor]] allowing you to use all of the features that come with.\r\n */\r\nexport class ParticleEmitter extends Actor {\r\n  private _particlesToEmit: number = 0;\r\n\r\n  public numParticles: number = 0;\r\n\r\n  /**\r\n   * Random number generator\r\n   */\r\n  public random: Random;\r\n\r\n  /**\r\n   * Gets or sets the isEmitting flag\r\n   */\r\n  public isEmitting: boolean = true;\r\n  /**\r\n   * Gets or sets the backing particle collection\r\n   */\r\n  public particles: Particle[] = [];\r\n\r\n  /**\r\n   * Gets or sets the backing deadParticle collection\r\n   */\r\n  public deadParticles: Particle[] = [];\r\n\r\n  /**\r\n   * Gets or sets the minimum particle velocity\r\n   */\r\n  public minVel: number = 0;\r\n  /**\r\n   * Gets or sets the maximum particle velocity\r\n   */\r\n  public maxVel: number = 0;\r\n\r\n  /**\r\n   * Gets or sets the acceleration vector for all particles\r\n   */\r\n  public acceleration: Vector = new Vector(0, 0);\r\n\r\n  /**\r\n   * Gets or sets the minimum angle in radians\r\n   */\r\n  public minAngle: number = 0;\r\n  /**\r\n   * Gets or sets the maximum angle in radians\r\n   */\r\n  public maxAngle: number = 0;\r\n\r\n  /**\r\n   * Gets or sets the emission rate for particles (particles/sec)\r\n   */\r\n  public emitRate: number = 1; //particles/sec\r\n  /**\r\n   * Gets or sets the life of each particle in milliseconds\r\n   */\r\n  public particleLife: number = 2000;\r\n  /**\r\n   * Gets the opacity of each particle from 0 to 1.0\r\n   */\r\n  public get opacity(): number {\r\n    return super.graphics.opacity;\r\n  }\r\n  /**\r\n   * Gets the opacity of each particle from 0 to 1.0\r\n   */\r\n  public set opacity(opacity: number) {\r\n    super.graphics.opacity = opacity;\r\n  }\r\n  /**\r\n   * Gets or sets the fade flag which causes particles to gradually fade out over the course of their life.\r\n   */\r\n  public fadeFlag: boolean = false;\r\n\r\n  /**\r\n   * Gets or sets the optional focus where all particles should accelerate towards\r\n   */\r\n  public focus: Vector = null;\r\n  /**\r\n   * Gets or sets the acceleration for focusing particles if a focus has been specified\r\n   */\r\n  public focusAccel: number = null;\r\n  /**\r\n   * Gets or sets the optional starting size for the particles\r\n   */\r\n  public startSize: number = null;\r\n  /**\r\n   * Gets or sets the optional ending size for the particles\r\n   */\r\n  public endSize: number = null;\r\n\r\n  /**\r\n   * Gets or sets the minimum size of all particles\r\n   */\r\n  public minSize: number = 5;\r\n  /**\r\n   * Gets or sets the maximum size of all particles\r\n   */\r\n  public maxSize: number = 5;\r\n\r\n  /**\r\n   * Gets or sets the beginning color of all particles\r\n   */\r\n  public beginColor: Color = Color.White;\r\n  /**\r\n   * Gets or sets the ending color of all particles\r\n   */\r\n  public endColor: Color = Color.White;\r\n\r\n  private _og: LegacyDrawing.Sprite = null;\r\n  private _sprite: Sprite = null;\r\n  /**\r\n   * Gets or sets the sprite that a particle should use\r\n   */\r\n  public get particleSprite(): LegacyDrawing.Sprite {\r\n    return this._og;\r\n  }\r\n\r\n  public set particleSprite(val: LegacyDrawing.Sprite) {\r\n    this._og = val;\r\n    if (val) {\r\n      this._sprite = Sprite.fromLegacySprite(val);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Gets or sets the emitter type for the particle emitter\r\n   */\r\n  public emitterType: EmitterType = EmitterType.Rectangle;\r\n\r\n  /**\r\n   * Gets or sets the emitter radius, only takes effect when the [[emitterType]] is [[EmitterType.Circle]]\r\n   */\r\n  public radius: number = 0;\r\n\r\n  /**\r\n   * Gets or sets the particle rotational speed velocity\r\n   */\r\n  public particleRotationalVelocity: number = 0;\r\n\r\n  /**\r\n   * Indicates whether particles should start with a random rotation\r\n   */\r\n  public randomRotation: boolean = false;\r\n\r\n  /**\r\n   * @param config particle emitter options bag\r\n   */\r\n  constructor(config: ParticleEmitterArgs) {\r\n    super({ width: config.width ?? 0, height: config.height ?? 0 });\r\n\r\n    const {\r\n      x,\r\n      y,\r\n      pos,\r\n      isEmitting,\r\n      minVel,\r\n      maxVel,\r\n      acceleration,\r\n      minAngle,\r\n      maxAngle,\r\n      emitRate,\r\n      particleLife,\r\n      opacity,\r\n      fadeFlag,\r\n      focus,\r\n      focusAccel,\r\n      startSize,\r\n      endSize,\r\n      minSize,\r\n      maxSize,\r\n      beginColor,\r\n      endColor,\r\n      particleSprite,\r\n      emitterType,\r\n      radius,\r\n      particleRotationalVelocity,\r\n      randomRotation,\r\n      random\r\n    } = { ...config };\r\n\r\n    this.pos = pos ?? vec(x ?? 0, y ?? 0);\r\n    this.isEmitting = isEmitting ?? this.isEmitting;\r\n    this.minVel = minVel ?? this.minVel;\r\n    this.maxVel = maxVel ?? this.maxVel;\r\n    this.acceleration = acceleration ?? this.acceleration;\r\n    this.minAngle = minAngle ?? this.minAngle;\r\n    this.maxAngle = maxAngle ?? this.maxAngle;\r\n    this.emitRate = emitRate ?? this.emitRate;\r\n    this.particleLife = particleLife ?? this.particleLife;\r\n    this.opacity = opacity ?? this.opacity;\r\n    this.fadeFlag = fadeFlag ?? this.fadeFlag;\r\n    this.focus = focus ?? this.focus;\r\n    this.focusAccel = focusAccel ?? this.focusAccel;\r\n    this.startSize = startSize ?? this.startSize;\r\n    this.endSize = endSize ?? this.endSize;\r\n    this.minSize = minSize ?? this.minSize;\r\n    this.maxSize = maxSize ?? this.maxSize;\r\n    this.beginColor = beginColor ?? this.beginColor;\r\n    this.endColor = endColor ?? this.endColor;\r\n    this.particleSprite = particleSprite ?? this.particleSprite;\r\n    this.emitterType = emitterType ?? this.emitterType;\r\n    this.radius = radius ?? this.radius;\r\n    this.particleRotationalVelocity = particleRotationalVelocity ?? this.particleRotationalVelocity;\r\n    this.randomRotation = randomRotation ?? this.randomRotation;\r\n\r\n    this.body.collisionType = CollisionType.PreventCollision;\r\n\r\n    this.random = random ?? new Random();\r\n\r\n    // Remove offscreen culling from particle emitters\r\n    for (let i = 0; i < this.traits.length; i++) {\r\n      if (this.traits[i] instanceof Traits.OffscreenCulling) {\r\n        this.traits.splice(i, 1);\r\n      }\r\n    }\r\n  }\r\n\r\n  public removeParticle(particle: Particle) {\r\n    this.deadParticles.push(particle);\r\n  }\r\n\r\n  /**\r\n   * Causes the emitter to emit particles\r\n   * @param particleCount  Number of particles to emit right now\r\n   */\r\n  public emitParticles(particleCount: number) {\r\n    for (let i = 0; i < particleCount; i++) {\r\n      const p = this._createParticle();\r\n      this.particles.push(p);\r\n      if (this?.scene?.world) {\r\n        this.scene.world.add(p);\r\n      }\r\n    }\r\n  }\r\n\r\n  public clearParticles() {\r\n    this.particles.length = 0;\r\n  }\r\n\r\n  // Creates a new particle given the constraints of the emitter\r\n  private _createParticle(): Particle {\r\n    // todo implement emitter constraints;\r\n    let ranX = 0;\r\n    let ranY = 0;\r\n\r\n    const angle = randomInRange(this.minAngle, this.maxAngle, this.random);\r\n    const vel = randomInRange(this.minVel, this.maxVel, this.random);\r\n    const size = this.startSize || randomInRange(this.minSize, this.maxSize, this.random);\r\n    const dx = vel * Math.cos(angle);\r\n    const dy = vel * Math.sin(angle);\r\n\r\n    if (this.emitterType === EmitterType.Rectangle) {\r\n      ranX = randomInRange(0, this.width, this.random);\r\n      ranY = randomInRange(0, this.height, this.random);\r\n    } else if (this.emitterType === EmitterType.Circle) {\r\n      const radius = randomInRange(0, this.radius, this.random);\r\n      ranX = radius * Math.cos(angle);\r\n      ranY = radius * Math.sin(angle);\r\n    }\r\n\r\n    const p = new Particle(\r\n      this,\r\n      this.particleLife,\r\n      this.opacity,\r\n      this.beginColor,\r\n      this.endColor,\r\n      new Vector(ranX, ranY),\r\n      new Vector(dx, dy),\r\n      this.acceleration,\r\n      this.startSize,\r\n      this.endSize\r\n    );\r\n    p.fadeFlag = this.fadeFlag;\r\n    p.particleSize = size;\r\n    if (this.particleSprite) {\r\n      p.particleSprite = this.particleSprite;\r\n      p.graphics.opacity = this.opacity;\r\n      p.graphics.use(this._sprite);\r\n    }\r\n    p.particleRotationalVelocity = this.particleRotationalVelocity;\r\n    if (this.randomRotation) {\r\n      p.currentRotation = randomInRange(0, Math.PI * 2, this.random);\r\n    }\r\n    if (this.focus) {\r\n      p.focus = this.focus.add(new Vector(this.pos.x, this.pos.y));\r\n      p.focusAccel = this.focusAccel;\r\n    }\r\n    return p;\r\n  }\r\n\r\n  public update(engine: Engine, delta: number) {\r\n    super.update(engine, delta);\r\n\r\n    if (this.isEmitting) {\r\n      this._particlesToEmit += this.emitRate * (delta / 1000);\r\n      if (this._particlesToEmit > 1.0) {\r\n        this.emitParticles(Math.floor(this._particlesToEmit));\r\n        this._particlesToEmit = this._particlesToEmit - Math.floor(this._particlesToEmit);\r\n      }\r\n    }\r\n\r\n    // deferred removal\r\n    for (let i = 0; i < this.deadParticles.length; i++) {\r\n      Util.removeItemFromArray(this.deadParticles[i], this.particles);\r\n      if (this?.scene?.world) {\r\n        this.scene.world.remove(this.deadParticles[i], false);\r\n      }\r\n    }\r\n    this.deadParticles.length = 0;\r\n  }\r\n\r\n  /**\r\n   * @deprecated signature will change in v0.26.0\r\n   * @param ctx\r\n   */\r\n  public draw(ctx: CanvasRenderingContext2D) {\r\n    // todo is there a more efficient to draw\r\n    // possibly use a webgl offscreen canvas and shaders to do particles?\r\n    this.particles.forEach((p) => p.draw(ctx));\r\n  }\r\n\r\n  /**\r\n   * @deprecated signature will change in v0.26.0\r\n   * @param ctx\r\n   */\r\n  public debugDraw(ctx: CanvasRenderingContext2D) {\r\n    super.debugDraw(ctx);\r\n    ctx.fillStyle = Color.Black.toString();\r\n    ctx.fillText('Particles: ' + this.particles.length, this.pos.x, this.pos.y + 20);\r\n\r\n    if (this.focus) {\r\n      ctx.fillRect(this.focus.x + this.pos.x, this.focus.y + this.pos.y, 3, 3);\r\n      DrawUtil.line(ctx, Color.Yellow, this.focus.x + this.pos.x, this.focus.y + this.pos.y, this.center.x, this.center.y);\r\n      ctx.fillText('Focus', this.focus.x + this.pos.x, this.focus.y + this.pos.y);\r\n    }\r\n  }\r\n}\r\n","import { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\r\nimport { Scene } from '../Scene';\r\nimport { GraphicsComponent } from './GraphicsComponent';\r\nimport { vec } from '../Math/vector';\r\nimport { CoordPlane, TransformComponent } from '../EntityComponentSystem/Components/TransformComponent';\r\nimport { Entity } from '../EntityComponentSystem/Entity';\r\nimport { Camera } from '../Camera';\r\nimport { System, SystemType, TagComponent } from '../EntityComponentSystem';\r\nimport { Engine } from '../Engine';\r\nimport { EnterViewPortEvent, ExitViewPortEvent } from '../Events';\r\nimport { GraphicsGroup } from '.';\r\nimport { Particle } from '../Particles';\r\n\r\nexport class GraphicsSystem extends System<TransformComponent | GraphicsComponent> {\r\n  public readonly types = ['ex.transform', 'ex.graphics'] as const;\r\n  public readonly systemType = SystemType.Draw;\r\n  public priority = 0;\r\n  private _token = 0;\r\n  private _graphicsContext: ExcaliburGraphicsContext;\r\n  private _camera: Camera;\r\n  private _engine: Engine;\r\n\r\n  public initialize(scene: Scene): void {\r\n    this._graphicsContext = scene.engine.graphicsContext;\r\n    this._camera = scene.camera;\r\n    this._engine = scene.engine;\r\n  }\r\n\r\n  public sort(a: Entity, b: Entity) {\r\n    return a.get(TransformComponent).z - b.get(TransformComponent).z;\r\n  }\r\n\r\n  public update(entities: Entity[], delta: number): void {\r\n    this._token++;\r\n    let transform: TransformComponent;\r\n    let graphics: GraphicsComponent;\r\n\r\n    for (const entity of entities) {\r\n      transform = entity.get(TransformComponent);\r\n      graphics = entity.get(GraphicsComponent);\r\n\r\n      // Figure out if entities are offscreen\r\n      const entityOffscreen = this._isOffscreen(transform, graphics);\r\n      if (entityOffscreen && !entity.hasTag('offscreen')) {\r\n        entity.eventDispatcher.emit('exitviewport', new ExitViewPortEvent(entity));\r\n        entity.addComponent(new TagComponent('offscreen'));\r\n      }\r\n\r\n      if (!entityOffscreen && entity.hasTag('offscreen')) {\r\n        entity.eventDispatcher.emit('enterviewport', new EnterViewPortEvent(entity));\r\n        entity.removeComponent('offscreen');\r\n      }\r\n      // Skip entities that have graphics offscreen\r\n      if (entityOffscreen) {\r\n        continue;\r\n      }\r\n\r\n      // This optionally sets our camera based on the entity coord plan (world vs. screen)\r\n      this._pushCameraTransform(transform);\r\n\r\n      this._graphicsContext.save();\r\n\r\n      // Tick any graphics state (but only once) for animations and graphics groups\r\n      graphics.update(delta, this._token);\r\n\r\n      // Position the entity\r\n      this._applyTransform(entity);\r\n\r\n      // Optionally run the onPreDraw graphics lifecycle draw\r\n      if (graphics.onPreDraw) {\r\n        graphics.onPreDraw(this._graphicsContext, delta);\r\n      }\r\n\r\n      // TODO remove this hack on the particle redo\r\n      const particleOpacity = (entity instanceof Particle) ? entity.opacity : 1;\r\n      this._graphicsContext.opacity = graphics.opacity * particleOpacity;\r\n\r\n      // Draw the graphics component\r\n      this._drawGraphicsComponent(graphics);\r\n\r\n      // Optionally run the onPostDraw graphics lifecycle draw\r\n      if (graphics.onPostDraw) {\r\n        graphics.onPostDraw(this._graphicsContext, delta);\r\n      }\r\n\r\n      this._graphicsContext.restore();\r\n\r\n      // Reset the transform back to the original\r\n      this._popCameraTransform(transform);\r\n    }\r\n  }\r\n\r\n  private _isOffscreen(transform: TransformComponent, graphics: GraphicsComponent) {\r\n    if (transform.coordPlane === CoordPlane.World) {\r\n      const graphicsOffscreen = !this._camera.viewport.intersect(graphics.localBounds.transform(transform.getGlobalMatrix()));\r\n      return graphicsOffscreen;\r\n    } else {\r\n      // TODO screen coordinates\r\n      return false;\r\n    }\r\n  }\r\n\r\n  private _drawGraphicsComponent(graphicsComponent: GraphicsComponent) {\r\n    if (graphicsComponent.visible) {\r\n      // this should be moved to the graphics system\r\n      for (const layer of graphicsComponent.layers.get()) {\r\n        for (const { graphic, options } of layer.graphics) {\r\n          let anchor = graphicsComponent.anchor;\r\n          let offset = graphicsComponent.offset;\r\n          if (options?.anchor) {\r\n            anchor = options.anchor;\r\n          }\r\n          if (options?.offset) {\r\n            offset = options.offset;\r\n          }\r\n          // See https://github.com/excaliburjs/Excalibur/pull/619 for discussion on this formula\r\n          const offsetX = -graphic.width * anchor.x + offset.x;\r\n          const offsetY = -graphic.height * anchor.y + offset.y;\r\n\r\n          graphic?.draw(this._graphicsContext, offsetX + layer.offset.x, offsetY + layer.offset.y);\r\n\r\n          if (this._engine?.isDebug && this._engine.debug.graphics.showBounds) {\r\n            const offset = vec(offsetX + layer.offset.x, offsetY + layer.offset.y);\r\n            if (graphic instanceof GraphicsGroup) {\r\n              for (const g of graphic.members) {\r\n                g.graphic?.localBounds.translate(offset.add(g.pos)).draw(this._graphicsContext, this._engine.debug.graphics.boundsColor);\r\n              }\r\n            } else {\r\n              /* istanbul ignore next */\r\n              graphic?.localBounds.translate(offset).draw(this._graphicsContext, this._engine.debug.graphics.boundsColor);\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * This applies the current entity transform to the graphics context\r\n   * @param entity\r\n   */\r\n  private _applyTransform(entity: Entity): void {\r\n    const ancestors = entity.getAncestors();\r\n    for (const ancestor of ancestors) {\r\n      const transform = ancestor?.get(TransformComponent);\r\n      if (transform) {\r\n        this._graphicsContext.translate(transform.pos.x, transform.pos.y);\r\n        this._graphicsContext.scale(transform.scale.x, transform.scale.y);\r\n        this._graphicsContext.rotate(transform.rotation);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Applies the current camera transform if in world coordinates\r\n   * @param transform\r\n   */\r\n  private _pushCameraTransform(transform: TransformComponent) {\r\n    // Establish camera offset per entity\r\n    if (transform.coordPlane === CoordPlane.World) {\r\n      this._graphicsContext.save();\r\n      if (this._camera) {\r\n        this._camera.draw(this._graphicsContext);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Resets the current camera transform if in world coordinates\r\n   * @param transform\r\n   */\r\n  private _popCameraTransform(transform: TransformComponent) {\r\n    if (transform.coordPlane === CoordPlane.World) {\r\n      // Apply camera world offset\r\n      this._graphicsContext.restore();\r\n    }\r\n  }\r\n}\r\n","import { Engine } from '../Engine';\r\nimport { Actor } from '../Actor';\r\nimport { Entity, System, SystemType } from '../EntityComponentSystem';\r\nimport { CanvasDrawComponent } from './CanvasDrawComponent';\r\nimport { Scene } from '../Scene';\r\nimport { Camera } from '../Camera';\r\nimport { CoordPlane, TransformComponent } from '../EntityComponentSystem/Components/TransformComponent';\r\nimport { GraphicsDiagnostics } from '../Graphics/GraphicsDiagnostics';\r\n\r\n/**\r\n * Draws anything with a transform and a \"draw\" method\r\n * @deprecated Shim for canvas drawing, will be removed v0.26.0\r\n */\r\nexport class CanvasDrawingSystem extends System<TransformComponent | CanvasDrawComponent> {\r\n  public readonly types = ['ex.transform', 'ex.canvas'] as const;\r\n  public systemType = SystemType.Draw;\r\n  public priority = -1;\r\n\r\n  private _ctx: CanvasRenderingContext2D;\r\n  private _camera: Camera;\r\n  private _engine: Engine;\r\n\r\n  public initialize(scene: Scene): void {\r\n    this._ctx = scene.engine.ctx;\r\n    this._engine = scene.engine;\r\n    this._camera = scene.camera;\r\n  }\r\n\r\n  public sort(a: Entity, b: Entity) {\r\n    return a.get(TransformComponent).z - b.get(TransformComponent).z;\r\n  }\r\n\r\n  public update(entities: Entity[], delta: number) {\r\n    this._clearScreen();\r\n\r\n    let transform: TransformComponent;\r\n    let canvasdraw: CanvasDrawComponent;\r\n    const length = entities.length;\r\n    for (let i = 0; i < length; i++) {\r\n      const visible = (entities[i] as Actor)?.graphics?.visible ?? true;\r\n      const offscreen = (entities[i] as Actor).isOffScreen;\r\n      if (visible && !offscreen) {\r\n        transform = entities[i].get(TransformComponent);\r\n        canvasdraw = entities[i].get(CanvasDrawComponent);\r\n\r\n        this._ctx.save();\r\n        this._pushCameraTransform(transform);\r\n\r\n        this._ctx.save();\r\n        this._applyTransform(entities[i]);\r\n        canvasdraw.draw(this._ctx, delta);\r\n        this._ctx.restore();\r\n\r\n        this._popCameraTransform(transform);\r\n        this._ctx.restore();\r\n      }\r\n\r\n      if (this._engine.isDebug) {\r\n        this._ctx.save();\r\n        this._pushCameraTransform(transform);\r\n        this._ctx.strokeStyle = 'yellow';\r\n        (entities[i] as unknown as Actor).debugDraw(this._ctx);\r\n        this._popCameraTransform(transform);\r\n        this._ctx.restore();\r\n      }\r\n    }\r\n    if (this._engine.isDebug) {\r\n      this._ctx.save();\r\n      this._camera.draw(this._ctx);\r\n      this._camera.debugDraw(this._ctx);\r\n      this._ctx.restore();\r\n    }\r\n\r\n    this._engine.stats.currFrame.graphics.drawnImages = GraphicsDiagnostics.DrawnImagesCount;\r\n    this._engine.stats.currFrame.graphics.drawCalls = GraphicsDiagnostics.DrawCallCount;\r\n  }\r\n\r\n  private _applyTransform(entity: Entity) {\r\n    const ancestors = entity.getAncestors();\r\n    for (const ancestor of ancestors) {\r\n      const transform = ancestor?.get(TransformComponent);\r\n      if (transform) {\r\n        this._ctx.translate(transform.pos.x, transform.pos.y);\r\n        this._ctx.rotate(transform.rotation);\r\n        this._ctx.scale(transform.scale.x, transform.scale.y);\r\n      }\r\n    }\r\n  }\r\n\r\n  private _clearScreen(): void {\r\n    this._ctx.clearRect(0, 0, this._ctx.canvas.width, this._ctx.canvas.height);\r\n    this._ctx.fillStyle = this._engine.backgroundColor.toString();\r\n    this._ctx.fillRect(0, 0, this._ctx.canvas.width, this._ctx.canvas.height);\r\n  }\r\n\r\n  private _pushCameraTransform(transform: TransformComponent) {\r\n    if (transform.coordPlane === CoordPlane.World) {\r\n      // Apply camera transform to place entity in world space\r\n      this._ctx.save();\r\n      if (this._camera) {\r\n        this._camera.draw(this._ctx);\r\n      }\r\n    }\r\n  }\r\n\r\n  private _popCameraTransform(transform: TransformComponent) {\r\n    if (transform.coordPlane === CoordPlane.World) {\r\n      // Restore back to screen space from world space if we were drawing an entity there\r\n      this._ctx.restore();\r\n    }\r\n  }\r\n}\r\n","import { Engine } from '../Engine';\r\nimport { Scene } from '../Scene';\r\nimport { Camera } from '../Camera';\r\nimport { MotionComponent } from '../EntityComponentSystem/Components/MotionComponent';\r\nimport { ColliderComponent } from '../Collision/ColliderComponent';\r\nimport { CoordPlane, Entity, TransformComponent } from '../EntityComponentSystem';\r\nimport { System, SystemType } from '../EntityComponentSystem/System';\r\nimport { ExcaliburGraphicsContext } from '../Graphics/Context/ExcaliburGraphicsContext';\r\nimport { vec, Vector } from '../Math/vector';\r\nimport { toDegrees } from '../Math/util';\r\nimport { BodyComponent, CollisionSystem, CompositeCollider, GraphicsComponent, Particle } from '..';\r\nimport { DebugGraphicsComponent } from '../Graphics/DebugGraphicsComponent';\r\n\r\nexport class DebugSystem extends System<TransformComponent> {\r\n  public readonly types = ['ex.transform'] as const;\r\n  public readonly systemType = SystemType.Draw;\r\n  public priority = 999; // lowest priority\r\n  private _graphicsContext: ExcaliburGraphicsContext;\r\n  private _collisionSystem: CollisionSystem;\r\n  private _camera: Camera;\r\n  private _engine: Engine;\r\n\r\n  public initialize(scene: Scene): void {\r\n    this._graphicsContext = scene.engine.graphicsContext;\r\n    this._camera = scene.camera;\r\n    this._engine = scene.engine;\r\n    this._collisionSystem = scene.world.systemManager.get(CollisionSystem);\r\n  }\r\n\r\n  update(entities: Entity[], _delta: number): void {\r\n    if (!this._engine.isDebug) {\r\n      return;\r\n    }\r\n\r\n    const filterSettings = this._engine.debug.filter;\r\n\r\n    let id: number;\r\n    let name: string;\r\n    const entitySettings = this._engine.debug.entity;\r\n\r\n    let tx: TransformComponent;\r\n    const txSettings = this._engine.debug.transform;\r\n\r\n    let motion: MotionComponent;\r\n    const motionSettings = this._engine.debug.motion;\r\n\r\n    let colliderComp: ColliderComponent;\r\n    const colliderSettings = this._engine.debug.collider;\r\n\r\n    const physicsSettings = this._engine.debug.physics;\r\n\r\n    let graphics: GraphicsComponent;\r\n    const graphicsSettings = this._engine.debug.graphics;\r\n\r\n    let debugDraw: DebugGraphicsComponent;\r\n\r\n    let body: BodyComponent;\r\n    const bodySettings = this._engine.debug.body;\r\n\r\n    const cameraSettings = this._engine.debug.camera;\r\n    for (const entity of entities) {\r\n      if (entity.hasTag('offscreen')) {\r\n        // skip offscreen entities\r\n        continue;\r\n      }\r\n      if (entity instanceof Particle) {\r\n        // Particles crush the renderer :(\r\n        continue;\r\n      }\r\n      if (filterSettings.useFilter) {\r\n        const allIds = filterSettings.ids.length === 0;\r\n        const idMatch = allIds || filterSettings.ids.includes(entity.id);\r\n        if (!idMatch) {\r\n          continue;\r\n        }\r\n        const allNames = filterSettings.nameQuery === '';\r\n        const nameMatch = allNames || entity.name.includes(filterSettings.nameQuery);\r\n        if (!nameMatch) {\r\n          continue;\r\n        }\r\n      }\r\n\r\n      let cursor = Vector.Zero;\r\n      const lineHeight = vec(0, 16);\r\n      id = entity.id;\r\n      name = entity.name;\r\n      tx = entity.get(TransformComponent);\r\n\r\n      // This optionally sets our camera based on the entity coord plan (world vs. screen)\r\n      this._pushCameraTransform(tx);\r\n\r\n      this._graphicsContext.save();\r\n\r\n      this._applyTransform(entity);\r\n      if (tx) {\r\n        if (txSettings.showAll || txSettings.showPosition) {\r\n          this._graphicsContext.debug.drawPoint(Vector.Zero, { size: 4, color: txSettings.positionColor });\r\n        }\r\n        if (txSettings.showAll || txSettings.showPositionLabel) {\r\n          this._graphicsContext.debug.drawText(`pos${tx.pos.toString(2)}`, cursor);\r\n          cursor = cursor.add(lineHeight);\r\n        }\r\n\r\n        if (entitySettings.showAll || entitySettings.showId) {\r\n          this._graphicsContext.debug.drawText(`id(${id}) ${tx.parent ? 'child of id(' + tx.parent?.owner?.id + ')' : ''}`, cursor);\r\n          cursor = cursor.add(lineHeight);\r\n        }\r\n\r\n        if (entitySettings.showAll || entitySettings.showName) {\r\n          this._graphicsContext.debug.drawText(`name(${name})`, cursor);\r\n          cursor = cursor.add(lineHeight);\r\n        }\r\n\r\n        if (txSettings.showAll || txSettings.showRotation) {\r\n          this._graphicsContext.drawLine(\r\n            Vector.Zero,\r\n            Vector.fromAngle(tx.rotation).scale(50).add(Vector.Zero),\r\n            txSettings.rotationColor,\r\n            2\r\n          );\r\n          this._graphicsContext.debug.drawText(`rot deg(${toDegrees(tx.rotation).toFixed(2)})`, cursor);\r\n          cursor = cursor.add(lineHeight);\r\n        }\r\n\r\n        if (txSettings.showAll || txSettings.showScale) {\r\n          this._graphicsContext.drawLine(Vector.Zero, tx.scale.add(Vector.Zero), txSettings.scaleColor, 2);\r\n        }\r\n      }\r\n\r\n      graphics = entity.get(GraphicsComponent);\r\n      if (graphics) {\r\n        if (graphicsSettings.showAll || graphicsSettings.showBounds) {\r\n          const bounds = graphics.localBounds;\r\n          bounds.draw(this._graphicsContext, graphicsSettings.boundsColor);\r\n        }\r\n      }\r\n\r\n      debugDraw = entity.get(DebugGraphicsComponent);\r\n      if (debugDraw) {\r\n        debugDraw.draw(this._graphicsContext);\r\n      }\r\n\r\n      body = entity.get(BodyComponent);\r\n      if (body) {\r\n        if (bodySettings.showAll || bodySettings.showCollisionGroup) {\r\n          this._graphicsContext.debug.drawText(`collision group(${body.group.name})`, cursor);\r\n          cursor = cursor.add(lineHeight);\r\n        }\r\n\r\n        if (bodySettings.showAll || bodySettings.showCollisionType) {\r\n          this._graphicsContext.debug.drawText(`collision type(${body.collisionType})`, cursor);\r\n          cursor = cursor.add(lineHeight);\r\n        }\r\n\r\n        if (bodySettings.showAll || bodySettings.showMass) {\r\n          this._graphicsContext.debug.drawText(`mass(${body.mass})`, cursor);\r\n          cursor = cursor.add(lineHeight);\r\n        }\r\n\r\n        if (bodySettings.showAll || bodySettings.showMotion) {\r\n          this._graphicsContext.debug.drawText(`motion(${body.sleepMotion})`, cursor);\r\n          cursor = cursor.add(lineHeight);\r\n        }\r\n\r\n        if (bodySettings.showAll || bodySettings.showSleeping) {\r\n          this._graphicsContext.debug.drawText(`sleeping(${body.canSleep ? body.sleeping: 'cant sleep'})`, cursor);\r\n          cursor = cursor.add(lineHeight);\r\n        }\r\n      }\r\n\r\n      this._graphicsContext.restore();\r\n\r\n      motion = entity.get(MotionComponent);\r\n      if (motion) {\r\n        if (motionSettings.showAll || motionSettings.showVelocity) {\r\n          this._graphicsContext.debug.drawText(`vel${motion.vel.toString(2)}`, cursor.add(tx.globalPos));\r\n          this._graphicsContext.drawLine(tx.globalPos, tx.globalPos.add(motion.vel), motionSettings.velocityColor, 2);\r\n          cursor = cursor.add(lineHeight);\r\n        }\r\n\r\n        if (motionSettings.showAll || motionSettings.showAcceleration) {\r\n          this._graphicsContext.drawLine(tx.globalPos, tx.globalPos.add(motion.acc), motionSettings.accelerationColor, 2);\r\n        }\r\n      }\r\n\r\n      // Colliders live in world space already so after the restore()\r\n      colliderComp = entity.get(ColliderComponent);\r\n      if (colliderComp) {\r\n        const collider = colliderComp.get();\r\n        if ((colliderSettings.showAll || colliderSettings.showGeometry) && collider) {\r\n          collider.debug(this._graphicsContext, colliderSettings.geometryColor);\r\n        }\r\n        if (colliderSettings.showAll || colliderSettings.showBounds) {\r\n          if (collider instanceof CompositeCollider) {\r\n            const colliders = collider.getColliders();\r\n            for (const collider of colliders) {\r\n              const bounds = collider.bounds;\r\n              const pos = vec(bounds.left, bounds.top);\r\n              this._graphicsContext.debug.drawRect(pos.x, pos.y, bounds.width, bounds.height, { color: colliderSettings.boundsColor });\r\n              if (colliderSettings.showAll || colliderSettings.showOwner) {\r\n                this._graphicsContext.debug.drawText(`owner id(${collider.owner.id})`, pos);\r\n              }\r\n            }\r\n            colliderComp.bounds.draw(this._graphicsContext, colliderSettings.boundsColor);\r\n          } else if (collider) {\r\n            const bounds = colliderComp.bounds;\r\n            const pos = vec(bounds.left, bounds.top);\r\n            this._graphicsContext.debug.drawRect(pos.x, pos.y, bounds.width, bounds.height, { color: colliderSettings.boundsColor });\r\n            if (colliderSettings.showAll || colliderSettings.showOwner) {\r\n              this._graphicsContext.debug.drawText(`owner id(${colliderComp.owner.id})`, pos);\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      this._popCameraTransform(tx);\r\n    }\r\n\r\n    this._graphicsContext.save();\r\n    this._camera.draw(this._graphicsContext);\r\n    if (physicsSettings.showAll || physicsSettings.showBroadphaseSpacePartitionDebug) {\r\n      this._collisionSystem.debug(this._graphicsContext);\r\n    }\r\n    if (physicsSettings.showAll || physicsSettings.showCollisionContacts || physicsSettings.showCollisionNormals) {\r\n      for (const [_, contact] of this._engine.debug.stats.currFrame.physics.contacts) {\r\n        if (physicsSettings.showAll || physicsSettings.showCollisionContacts) {\r\n          for (const point of contact.points) {\r\n            this._graphicsContext.debug.drawPoint(point, { size: 5, color: physicsSettings.collisionContactColor });\r\n          }\r\n        }\r\n\r\n        if (physicsSettings.showAll || physicsSettings.showCollisionNormals) {\r\n          for (const point of contact.points) {\r\n            this._graphicsContext.debug.drawLine(point, contact.normal.scale(30).add(point), {\r\n              color: physicsSettings.collisionNormalColor\r\n            });\r\n          }\r\n        }\r\n      }\r\n    }\r\n    this._graphicsContext.restore();\r\n\r\n    if (cameraSettings) {\r\n      this._graphicsContext.save();\r\n      this._camera.draw(this._graphicsContext);\r\n      if (cameraSettings.showAll || cameraSettings.showFocus) {\r\n        this._graphicsContext.drawCircle(this._camera.pos, 4, cameraSettings.focusColor);\r\n      }\r\n      if (cameraSettings.showAll || cameraSettings.showZoom) {\r\n        this._graphicsContext.debug.drawText(`zoom(${this._camera.zoom})`, this._camera.pos);\r\n      }\r\n      this._graphicsContext.restore();\r\n    }\r\n\r\n    this._graphicsContext.flush();\r\n  }\r\n\r\n  /**\r\n   * This applies the current entity transform to the graphics context\r\n   * @param entity\r\n   */\r\n  private _applyTransform(entity: Entity): void {\r\n    const ancestors = entity.getAncestors();\r\n    for (const ancestor of ancestors) {\r\n      const transform = ancestor?.get(TransformComponent);\r\n      if (transform) {\r\n        this._graphicsContext.translate(transform.pos.x, transform.pos.y);\r\n        this._graphicsContext.scale(transform.scale.x, transform.scale.y);\r\n        this._graphicsContext.rotate(transform.rotation);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Applies the current camera transform if in world coordinates\r\n   * @param transform\r\n   */\r\n  private _pushCameraTransform(transform: TransformComponent) {\r\n    // Establish camera offset per entity\r\n    if (transform.coordPlane === CoordPlane.World) {\r\n      this._graphicsContext.save();\r\n      if (this._camera) {\r\n        this._camera.draw(this._graphicsContext);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Resets the current camera transform if in world coordinates\r\n   * @param transform\r\n   */\r\n  private _popCameraTransform(transform: TransformComponent) {\r\n    if (transform.coordPlane === CoordPlane.World) {\r\n      // Apply camera world offset\r\n      this._graphicsContext.restore();\r\n    }\r\n  }\r\n}\r\n","import { ColliderComponent } from '../Collision/ColliderComponent';\r\nimport { Engine } from '../Engine';\r\nimport { System, TransformComponent, SystemType, Entity, CoordPlane } from '../EntityComponentSystem';\r\nimport { GraphicsComponent } from '../Graphics/GraphicsComponent';\r\nimport { Scene } from '../Scene';\r\nimport { PointerComponent } from './PointerComponent';\r\nimport { PointerEventReceiver } from './PointerEventReceiver';\r\nimport { PointerEvent } from './PointerEvent';\r\n\r\n/**\r\n * The PointerSystem is responsible for dispatching pointer events to entities\r\n * that need them.\r\n *\r\n * The PointerSystem can be optionally configured by the [[PointerComponent]], by default Entities use\r\n * the [[Collider]]'s shape for pointer events.\r\n */\r\nexport class PointerSystem extends System<TransformComponent | PointerComponent> {\r\n  public readonly types = ['ex.transform', 'ex.pointer'] as const;\r\n  public readonly systemType = SystemType.Update;\r\n  public priority = -1;\r\n\r\n  private _engine: Engine;\r\n  private _receiver: PointerEventReceiver;\r\n\r\n  /**\r\n   * Optionally override component configuration for all entities\r\n   */\r\n  public overrideUseColliderShape = false;\r\n  /**\r\n   * Optionally override component configuration for all entities\r\n   */\r\n  public overrideUseGraphicsBounds = false;\r\n\r\n  public lastFrameEntityToPointers = new Map<number, number[]>();\r\n  public currentFrameEntityToPointers = new Map<number, number[]>();\r\n\r\n  public initialize(scene: Scene): void {\r\n    this._engine = scene.engine;\r\n    this._receiver = this._engine.input.pointers;\r\n  }\r\n\r\n  public sort(a: Entity, b: Entity) {\r\n    // Sort from high to low, because things on 'top' receive the pointer events first\r\n    return b.get(TransformComponent).z - a.get(TransformComponent).z;\r\n  }\r\n\r\n  public entityCurrentlyUnderPointer(entity: Entity, pointerId: number) {\r\n    return this.currentFrameEntityToPointers.has(entity.id) &&\r\n           this.currentFrameEntityToPointers.get(entity.id).includes(pointerId);\r\n  }\r\n\r\n  public entityWasUnderPointer(entity: Entity, pointerId: number) {\r\n    return this.lastFrameEntityToPointers.has(entity.id) &&\r\n           this.lastFrameEntityToPointers.get(entity.id).includes(pointerId);\r\n  }\r\n\r\n  public entered(entity: Entity, pointerId: number) {\r\n    return this.entityCurrentlyUnderPointer(entity, pointerId) &&\r\n           !this.lastFrameEntityToPointers.has(entity.id);\r\n  }\r\n\r\n  public left(entity: Entity, pointerId: number) {\r\n    return !this.currentFrameEntityToPointers.has(entity.id) &&\r\n            this.entityWasUnderPointer(entity, pointerId);\r\n  }\r\n\r\n  public addPointerToEntity(entity: Entity, pointerId: number) {\r\n    if (!this.currentFrameEntityToPointers.has(entity.id)) {\r\n      this.currentFrameEntityToPointers.set(entity.id, [pointerId]);\r\n      return;\r\n    }\r\n    const pointers = this.currentFrameEntityToPointers.get(entity.id);\r\n    this.currentFrameEntityToPointers.set(entity.id, pointers.concat(pointerId));\r\n  }\r\n\r\n  public update(entities: Entity[]): void {\r\n    // Locate all the pointer/entity mappings\r\n    this._processPointerToEntity(entities);\r\n\r\n    // Dispatch pointer events on entities\r\n    this._dispatchEvents(entities);\r\n\r\n    // Clear last frame's events\r\n    this._receiver.update();\r\n    this.lastFrameEntityToPointers.clear();\r\n    this.lastFrameEntityToPointers = new Map<number, number[]>(this.currentFrameEntityToPointers);\r\n    this.currentFrameEntityToPointers.clear();\r\n    this._receiver.clear();\r\n  }\r\n\r\n  private _processPointerToEntity(entities: Entity[]) {\r\n    let transform: TransformComponent;\r\n    let collider: ColliderComponent;\r\n    let graphics: GraphicsComponent;\r\n    let pointer: PointerComponent;\r\n\r\n    // TODO probably a spatial partition optimization here to quickly query bounds for pointer\r\n    // doesn't seem to cause issues tho for perf\r\n\r\n    // Pre-process find entities under pointers\r\n    for (const entity of entities) {\r\n      transform = entity.get(TransformComponent);\r\n      pointer = entity.get(PointerComponent) ?? new PointerComponent;\r\n      // Check collider contains pointer\r\n      collider = entity.get(ColliderComponent);\r\n      if (collider && (pointer.useColliderShape || this.overrideUseColliderShape)) {\r\n        const geom = collider.get();\r\n        if (geom) {\r\n          for (const [pointerId, pos] of this._receiver.currentFramePointerCoords.entries()) {\r\n            if (geom.contains(transform.coordPlane === CoordPlane.World ? pos.worldPos : pos.screenPos)) {\r\n              this.addPointerToEntity(entity, pointerId);\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      // Check graphics contains pointer\r\n      graphics = entity.get(GraphicsComponent);\r\n      if (graphics && (pointer.useGraphicsBounds || this.overrideUseGraphicsBounds)) {\r\n        const graphicBounds = graphics.localBounds.transform(transform.getGlobalMatrix());\r\n        for (const [pointerId, pos] of this._receiver.currentFramePointerCoords.entries()) {\r\n          if (graphicBounds.contains(transform.coordPlane === CoordPlane.World ? pos.worldPos : pos.screenPos)) {\r\n            this.addPointerToEntity(entity, pointerId);\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  private _processDownAndEmit(entity: Entity): Map<number, PointerEvent> {\r\n    const lastDownPerPointer = new Map<number, PointerEvent>();\r\n    // Loop through down and dispatch to entities\r\n    for (const event of this._receiver.currentFrameDown) {\r\n      if (event.active && entity.active && this.entityCurrentlyUnderPointer(entity, event.pointerId)) {\r\n        entity.events.emit('pointerdown', event as any);\r\n        if (this._receiver.isDragStart(event.pointerId)) {\r\n          entity.events.emit('pointerdragstart', event as any);\r\n        }\r\n      }\r\n      lastDownPerPointer.set(event.pointerId, event);\r\n    }\r\n    return lastDownPerPointer;\r\n  }\r\n\r\n  private _processUpAndEmit(entity: Entity): Map<number, PointerEvent> {\r\n    const lastUpPerPointer = new Map<number, PointerEvent>();\r\n    // Loop through up and dispatch to entities\r\n    for (const event of this._receiver.currentFrameUp) {\r\n      if (event.active && entity.active && this.entityCurrentlyUnderPointer(entity, event.pointerId)) {\r\n        entity.events.emit('pointerup', event as any);\r\n        if (this._receiver.isDragEnd(event.pointerId)) {\r\n          entity.events.emit('pointerdragend', event as any);\r\n        }\r\n      }\r\n      lastUpPerPointer.set(event.pointerId, event);\r\n    }\r\n    return lastUpPerPointer;\r\n  }\r\n\r\n  private _processMoveAndEmit(entity: Entity): Map<number, PointerEvent> {\r\n    const lastMovePerPointer = new Map<number, PointerEvent>();\r\n    // Loop through move and dispatch to entities\r\n    for (const event of this._receiver.currentFrameMove) {\r\n      if (event.active && entity.active && this.entityCurrentlyUnderPointer(entity, event.pointerId)) {\r\n        // move\r\n        entity.events.emit('pointermove', event as any);\r\n\r\n        if (this._receiver.isDragging(event.pointerId)) {\r\n          entity.events.emit('pointerdragmove', event as any);\r\n        }\r\n      }\r\n      lastMovePerPointer.set(event.pointerId, event);\r\n    }\r\n    return lastMovePerPointer;\r\n  }\r\n\r\n  private _processEnterLeaveAndEmit(entity: Entity, lastUpDownMoveEvents: PointerEvent[]) {\r\n    // up, down, and move are considered for enter and leave\r\n    for (const event of lastUpDownMoveEvents) {\r\n      // enter\r\n      if (event.active && entity.active && this.entered(entity, event.pointerId)) {\r\n        entity.events.emit('pointerenter', event as any);\r\n        if (this._receiver.isDragging(event.pointerId)) {\r\n          entity.events.emit('pointerdragenter', event as any);\r\n        }\r\n        break;\r\n      }\r\n      if (event.active && entity.active &&\r\n          // leave can happen on move\r\n          (this.left(entity, event.pointerId) ||\r\n          // or leave can happen on pointer up\r\n          (this.entityCurrentlyUnderPointer(entity, event.pointerId) && event.type === 'up'))) {\r\n        entity.events.emit('pointerleave', event as any);\r\n        if (this._receiver.isDragging(event.pointerId)) {\r\n          entity.events.emit('pointerdragleave', event as any);\r\n        }\r\n        break;\r\n      }\r\n    }\r\n  }\r\n\r\n  private _processCancelAndEmit(entity: Entity) {\r\n    // cancel\r\n    for (const event of this._receiver.currentFrameCancel) {\r\n      if (event.active && entity.active && this.entityCurrentlyUnderPointer(entity, event.pointerId)){\r\n        entity.events.emit('pointercancel', event as any);\r\n      }\r\n    }\r\n  }\r\n\r\n  private _processWheelAndEmit(entity: Entity) {\r\n    // wheel\r\n    for (const event of this._receiver.currentFrameWheel) {\r\n      // Currently the wheel only fires under the primary pointer '0'\r\n      if (event.active && entity.active && this.entityCurrentlyUnderPointer(entity, 0)) {\r\n        entity.events.emit('pointerwheel', event as any);\r\n      }\r\n    }\r\n  }\r\n\r\n  private _dispatchEvents(entities: Entity[]) {\r\n    const lastFrameEntities = new Set(this.lastFrameEntityToPointers.keys());\r\n    const currentFrameEntities = new Set(this.currentFrameEntityToPointers.keys());\r\n    // Filter preserves z order\r\n    const entitiesWithEvents = entities.filter(e => lastFrameEntities.has(e.id) || currentFrameEntities.has(e.id));\r\n    let lastMovePerPointer: Map<number, PointerEvent>;\r\n    let lastUpPerPointer: Map<number, PointerEvent>;\r\n    let lastDownPerPointer: Map<number, PointerEvent>;\r\n    // Dispatch events in entity z order\r\n    for (const entity of entitiesWithEvents) {\r\n      lastDownPerPointer = this._processDownAndEmit(entity);\r\n\r\n      lastUpPerPointer = this._processUpAndEmit(entity);\r\n\r\n      lastMovePerPointer = this._processMoveAndEmit(entity);\r\n\r\n      const lastUpDownMoveEvents = [\r\n        ...lastMovePerPointer.values(),\r\n        ...lastDownPerPointer.values(),\r\n        ...lastUpPerPointer.values()\r\n      ];\r\n      this._processEnterLeaveAndEmit(entity, lastUpDownMoveEvents);\r\n\r\n      this._processCancelAndEmit(entity);\r\n\r\n      this._processWheelAndEmit(entity);\r\n    }\r\n  }\r\n}","import { Entity } from '../EntityComponentSystem';\r\nimport { System, SystemType } from '../EntityComponentSystem/System';\r\nimport { ActionsComponent } from './ActionsComponent';\r\n\r\n\r\nexport class ActionsSystem extends System<ActionsComponent> {\r\n  public readonly types = ['ex.actions'] as const;\r\n  systemType = SystemType.Update;\r\n  priority = -1;\r\n\r\n  update(entities: Entity[], delta: number): void {\r\n    let actions: ActionsComponent;\r\n    for (const entity of entities) {\r\n      actions = entity.get(ActionsComponent);\r\n      actions.update(delta);\r\n    }\r\n  }\r\n}","import { ScreenElement } from './ScreenElement';\r\nimport {\r\n  InitializeEvent,\r\n  ActivateEvent,\r\n  DeactivateEvent,\r\n  PreUpdateEvent,\r\n  PostUpdateEvent,\r\n  PreDrawEvent,\r\n  PostDrawEvent,\r\n  PreDebugDrawEvent,\r\n  PostDebugDrawEvent,\r\n  GameEvent\r\n} from './Events';\r\nimport { Logger } from './Util/Log';\r\nimport { Timer } from './Timer';\r\nimport { Engine } from './Engine';\r\nimport { TileMap } from './TileMap';\r\nimport { Camera } from './Camera';\r\nimport { Actor } from './Actor';\r\nimport { Class } from './Class';\r\nimport { CanInitialize, CanActivate, CanDeactivate, CanUpdate, CanDraw } from './Interfaces/LifecycleEvents';\r\nimport * as Util from './Util/Util';\r\nimport * as Events from './Events';\r\nimport * as ActorUtils from './Util/Actors';\r\nimport { Trigger } from './Trigger';\r\nimport { SystemType } from './EntityComponentSystem/System';\r\nimport { obsolete } from './Util/Decorators';\r\nimport { World } from './EntityComponentSystem/World';\r\nimport { MotionSystem } from './Collision/MotionSystem';\r\nimport { CollisionSystem } from './Collision/CollisionSystem';\r\nimport { Entity } from './EntityComponentSystem/Entity';\r\nimport { GraphicsSystem } from './Graphics/GraphicsSystem';\r\nimport { CanvasDrawingSystem } from './Drawing/CanvasDrawingSystem';\r\nimport { Flags, Legacy } from './Flags';\r\nimport { DebugSystem } from './Debug/DebugSystem';\r\nimport { PointerSystem } from './Input/PointerSystem';\r\nimport { ActionsSystem } from './Actions/ActionsSystem';\r\n/**\r\n * [[Actor|Actors]] are composed together into groupings called Scenes in\r\n * Excalibur. The metaphor models the same idea behind real world\r\n * actors in a scene. Only actors in scenes will be updated and drawn.\r\n *\r\n * Typical usages of a scene include: levels, menus, loading screens, etc.\r\n */\r\nexport class Scene extends Class implements CanInitialize, CanActivate, CanDeactivate, CanUpdate, CanDraw {\r\n  private _logger: Logger = Logger.getInstance();\r\n  /**\r\n   * Gets or sets the current camera for the scene\r\n   */\r\n  public camera: Camera = new Camera();\r\n\r\n  /**\r\n   * The ECS world for the scene\r\n   */\r\n  public world = new World(this);\r\n\r\n  /**\r\n   * The actors in the current scene\r\n   */\r\n  public get actors(): Actor[] {\r\n    return this.world.entityManager.entities.filter((e) => {\r\n      return e instanceof Actor;\r\n    }) as Actor[];\r\n  }\r\n\r\n  /**\r\n   * The entities in the current scene\r\n   */\r\n  public get entities(): Entity[] {\r\n    return this.world.entityManager.entities;\r\n  }\r\n\r\n  /**\r\n   * The triggers in the current scene\r\n   */\r\n  public get triggers(): Trigger[] {\r\n    return this.world.entityManager.entities.filter((e) => {\r\n      return e instanceof Trigger;\r\n    }) as Trigger[];\r\n  }\r\n\r\n  /**\r\n   * The [[TileMap]]s in the scene, if any\r\n   */\r\n  public get tileMaps(): TileMap[] {\r\n    return this.world.entityManager.entities.filter((e) => {\r\n      return e instanceof TileMap;\r\n    }) as TileMap[];\r\n  }\r\n\r\n  /**\r\n   * Access to the Excalibur engine\r\n   */\r\n  public engine: Engine;\r\n\r\n  /**\r\n   * The [[ScreenElement]]s in a scene, if any; these are drawn last\r\n   * @deprecated Use [[Scene.actors]]\r\n   */\r\n  @obsolete({\r\n    message: 'Will be removed in excalibur v0.26.0',\r\n    alternateMethod: 'ScreenElements now are normal actors with a Transform Coordinate Plane of Screen'\r\n  })\r\n  public get screenElements(): ScreenElement[] {\r\n    return this.actors.filter((a) => a instanceof ScreenElement) as ScreenElement[];\r\n  }\r\n\r\n  private _isInitialized: boolean = false;\r\n  private _timers: Timer[] = [];\r\n  public get timers(): readonly Timer[] {\r\n    return this._timers;\r\n  }\r\n  private _cancelQueue: Timer[] = [];\r\n\r\n  constructor() {\r\n    super();\r\n    // Initialize systems\r\n    this.world.add(new ActionsSystem());\r\n    this.world.add(new MotionSystem());\r\n    this.world.add(new CollisionSystem());\r\n    this.world.add(new PointerSystem());\r\n    if (Flags.isEnabled(Legacy.LegacyDrawing)) {\r\n      this.world.add(new CanvasDrawingSystem());\r\n    } else {\r\n      this.world.add(new GraphicsSystem());\r\n    }\r\n    this.world.add(new DebugSystem());\r\n  }\r\n\r\n  public on(eventName: Events.initialize, handler: (event: InitializeEvent<Scene>) => void): void;\r\n  public on(eventName: Events.activate, handler: (event: ActivateEvent) => void): void;\r\n  public on(eventName: Events.deactivate, handler: (event: DeactivateEvent) => void): void;\r\n  public on(eventName: Events.preupdate, handler: (event: PreUpdateEvent<Scene>) => void): void;\r\n  public on(eventName: Events.postupdate, handler: (event: PostUpdateEvent<Scene>) => void): void;\r\n  public on(eventName: Events.predraw, handler: (event: PreDrawEvent) => void): void;\r\n  public on(eventName: Events.postdraw, handler: (event: PostDrawEvent) => void): void;\r\n  public on(eventName: Events.predebugdraw, handler: (event: PreDebugDrawEvent) => void): void;\r\n  public on(eventName: Events.postdebugdraw, handler: (event: PostDebugDrawEvent) => void): void;\r\n  public on(eventName: string, handler: (event: GameEvent<any>) => void): void;\r\n  public on(eventName: string, handler: (event: any) => void): void {\r\n    super.on(eventName, handler);\r\n  }\r\n\r\n  public once(eventName: Events.initialize, handler: (event: InitializeEvent<Scene>) => void): void;\r\n  public once(eventName: Events.activate, handler: (event: ActivateEvent) => void): void;\r\n  public once(eventName: Events.deactivate, handler: (event: DeactivateEvent) => void): void;\r\n  public once(eventName: Events.preupdate, handler: (event: PreUpdateEvent<Scene>) => void): void;\r\n  public once(eventName: Events.postupdate, handler: (event: PostUpdateEvent<Scene>) => void): void;\r\n  public once(eventName: Events.predraw, handler: (event: PreDrawEvent) => void): void;\r\n  public once(eventName: Events.postdraw, handler: (event: PostDrawEvent) => void): void;\r\n  public once(eventName: Events.predebugdraw, handler: (event: PreDebugDrawEvent) => void): void;\r\n  public once(eventName: Events.postdebugdraw, handler: (event: PostDebugDrawEvent) => void): void;\r\n  public once(eventName: string, handler: (event: GameEvent<any>) => void): void;\r\n  public once(eventName: string, handler: (event: any) => void): void {\r\n    super.once(eventName, handler);\r\n  }\r\n\r\n  public off(eventName: Events.initialize, handler?: (event: InitializeEvent<Scene>) => void): void;\r\n  public off(eventName: Events.activate, handler?: (event: ActivateEvent) => void): void;\r\n  public off(eventName: Events.deactivate, handler?: (event: DeactivateEvent) => void): void;\r\n  public off(eventName: Events.preupdate, handler?: (event: PreUpdateEvent<Scene>) => void): void;\r\n  public off(eventName: Events.postupdate, handler?: (event: PostUpdateEvent<Scene>) => void): void;\r\n  public off(eventName: Events.predraw, handler?: (event: PreDrawEvent) => void): void;\r\n  public off(eventName: Events.postdraw, handler?: (event: PostDrawEvent) => void): void;\r\n  public off(eventName: Events.predebugdraw, handler?: (event: PreDebugDrawEvent) => void): void;\r\n  public off(eventName: Events.postdebugdraw, handler?: (event: PostDebugDrawEvent) => void): void;\r\n  public off(eventName: string, handler?: (event: GameEvent<any>) => void): void;\r\n  public off(eventName: string, handler?: (event: any) => void): void {\r\n    super.off(eventName, handler);\r\n  }\r\n\r\n  /**\r\n   * This is called before the first update of the [[Scene]]. Initializes scene members like the camera. This method is meant to be\r\n   * overridden. This is where initialization of child actors should take place.\r\n   */\r\n  public onInitialize(_engine: Engine): void {\r\n    // will be overridden\r\n  }\r\n\r\n  /**\r\n   * This is called when the scene is made active and started. It is meant to be overridden,\r\n   * this is where you should setup any DOM UI or event handlers needed for the scene.\r\n   */\r\n  public onActivate(_oldScene: Scene, _newScene: Scene): void {\r\n    // will be overridden\r\n  }\r\n\r\n  /**\r\n   * This is called when the scene is made transitioned away from and stopped. It is meant to be overridden,\r\n   * this is where you should cleanup any DOM UI or event handlers needed for the scene.\r\n   */\r\n  public onDeactivate(_oldScene: Scene, _newScene: Scene): void {\r\n    // will be overridden\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPreUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\r\n   *\r\n   * `onPreUpdate` is called directly before a scene is updated.\r\n   */\r\n  public onPreUpdate(_engine: Engine, _delta: number): void {\r\n    // will be overridden\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPostUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\r\n   *\r\n   * `onPostUpdate` is called directly after a scene is updated.\r\n   */\r\n  public onPostUpdate(_engine: Engine, _delta: number): void {\r\n    // will be overridden\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPreDraw lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\r\n   *\r\n   * `onPreDraw` is called directly before a scene is drawn.\r\n   *\r\n   * @deprecated Signature will change in v0.26.0\r\n   */\r\n  public onPreDraw(_ctx: CanvasRenderingContext2D, _delta: number): void {\r\n    // will be overridden\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPostDraw lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\r\n   *\r\n   * `onPostDraw` is called directly after a scene is drawn.\r\n   *\r\n   * @deprecated Signature will change in v0.26.0\r\n   */\r\n  public onPostDraw(_ctx: CanvasRenderingContext2D, _delta: number): void {\r\n    // will be overridden\r\n  }\r\n\r\n  /**\r\n   * Initializes actors in the scene\r\n   */\r\n  private _initializeChildren(): void {\r\n    for (const child of this.entities) {\r\n      child._initialize(this.engine);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Gets whether or not the [[Scene]] has been initialized\r\n   */\r\n  public get isInitialized(): boolean {\r\n    return this._isInitialized;\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Initializes the scene before the first update, meant to be called by engine not by users of\r\n   * Excalibur\r\n   * @internal\r\n   */\r\n  public _initialize(engine: Engine) {\r\n    if (!this.isInitialized) {\r\n      this.engine = engine;\r\n      // Initialize camera first\r\n      this.camera._initialize(engine);\r\n\r\n      this.world.systemManager.initialize();\r\n\r\n      // This order is important! we want to be sure any custom init that add actors\r\n      // fire before the actor init\r\n      this.onInitialize.call(this, engine);\r\n      this._initializeChildren();\r\n\r\n      this._logger.debug('Scene.onInitialize', this, engine);\r\n      this.eventDispatcher.emit('initialize', new InitializeEvent(engine, this));\r\n      this._isInitialized = true;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Activates the scene with the base behavior, then calls the overridable `onActivate` implementation.\r\n   * @internal\r\n   */\r\n  public _activate(oldScene: Scene, newScene: Scene): void {\r\n    this._logger.debug('Scene.onActivate', this);\r\n    this.onActivate(oldScene, newScene);\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Deactivates the scene with the base behavior, then calls the overridable `onDeactivate` implementation.\r\n   * @internal\r\n   */\r\n  public _deactivate(oldScene: Scene, newScene: Scene): void {\r\n    this._logger.debug('Scene.onDeactivate', this);\r\n    this.onDeactivate(oldScene, newScene);\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _preupdate handler for [[onPreUpdate]] lifecycle event\r\n   * @internal\r\n   */\r\n  public _preupdate(_engine: Engine, delta: number): void {\r\n    this.emit('preupdate', new PreUpdateEvent(_engine, delta, this));\r\n    this.onPreUpdate(_engine, delta);\r\n  }\r\n\r\n  /**\r\n   *  It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _preupdate handler for [[onPostUpdate]] lifecycle event\r\n   * @internal\r\n   */\r\n  public _postupdate(_engine: Engine, delta: number): void {\r\n    this.emit('postupdate', new PostUpdateEvent(_engine, delta, this));\r\n    this.onPostUpdate(_engine, delta);\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _predraw handler for [[onPreDraw]] lifecycle event\r\n   *\r\n   * @deprecated Signature will change in v0.26.0\r\n   * @internal\r\n   */\r\n  public _predraw(_ctx: CanvasRenderingContext2D, _delta: number): void {\r\n    this.emit('predraw', new PreDrawEvent(_ctx, _delta, this));\r\n    this.onPreDraw(_ctx, _delta);\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _postdraw handler for [[onPostDraw]] lifecycle event\r\n   *\r\n   * @deprecated Signature will change in v0.26.0\r\n   * @internal\r\n   */\r\n  public _postdraw(_ctx: CanvasRenderingContext2D, _delta: number): void {\r\n    this.emit('postdraw', new PostDrawEvent(_ctx, _delta, this));\r\n    this.onPostDraw(_ctx, _delta);\r\n  }\r\n\r\n  /**\r\n   * Updates all the actors and timers in the scene. Called by the [[Engine]].\r\n   * @param engine  Reference to the current Engine\r\n   * @param delta   The number of milliseconds since the last update\r\n   */\r\n  public update(engine: Engine, delta: number) {\r\n    this._preupdate(engine, delta);\r\n\r\n    // TODO differed entity removal for timers\r\n    let i: number, len: number;\r\n    // Remove timers in the cancel queue before updating them\r\n    for (i = 0, len = this._cancelQueue.length; i < len; i++) {\r\n      this.removeTimer(this._cancelQueue[i]);\r\n    }\r\n    this._cancelQueue.length = 0;\r\n\r\n    // Cycle through timers updating timers\r\n    for (const timer of this._timers) {\r\n      timer.update(delta);\r\n    }\r\n\r\n    this.world.update(SystemType.Update, delta);\r\n\r\n    // Camera last keeps renders smooth that are based on entity/actor\r\n    if (this.camera) {\r\n      this.camera.update(engine, delta);\r\n    }\r\n\r\n    this._collectActorStats(engine);\r\n\r\n    this._postupdate(engine, delta);\r\n  }\r\n\r\n  /**\r\n   * Draws all the actors in the Scene. Called by the [[Engine]].\r\n   *\r\n   * @deprecated Signature will change in v0.26.0\r\n   * @param ctx    The current rendering context\r\n   * @param delta  The number of milliseconds since the last draw\r\n   */\r\n  public draw(ctx: CanvasRenderingContext2D, delta: number) {\r\n    this._predraw(ctx, delta);\r\n\r\n    this.world.update(SystemType.Draw, delta);\r\n\r\n    if (this.engine?.isDebug) {\r\n      this.debugDraw(ctx);\r\n    }\r\n    this._postdraw(ctx, delta);\r\n  }\r\n\r\n  /**\r\n   * Draws all the actors' debug information in the Scene. Called by the [[Engine]].\r\n   * @param ctx  The current rendering context\r\n   * @deprecated Signature will change in v0.26.0\r\n   */\r\n  /* istanbul ignore next */\r\n  public debugDraw(ctx: CanvasRenderingContext2D) {\r\n    this.emit('predebugdraw', new PreDebugDrawEvent(ctx, this));\r\n    // pass\r\n    this.emit('postdebugdraw', new PostDebugDrawEvent(ctx, this));\r\n  }\r\n\r\n  /**\r\n   * Checks whether an actor is contained in this scene or not\r\n   */\r\n  public contains(actor: Actor): boolean {\r\n    return this.actors.indexOf(actor) > -1;\r\n  }\r\n\r\n  /**\r\n   * Adds a [[Timer]] to the current [[Scene]].\r\n   * @param timer  The timer to add to the current [[Scene]].\r\n   */\r\n  public add(timer: Timer): void;\r\n\r\n  /**\r\n   * Adds a [[TileMap]] to the [[Scene]], once this is done the [[TileMap]] will be drawn and updated.\r\n   */\r\n  public add(tileMap: TileMap): void;\r\n\r\n  /**\r\n   * Adds a [[Trigger]] to the [[Scene]], once this is done the [[Trigger]] will listen for interactions with other actors.\r\n   * @param trigger\r\n   */\r\n  public add(trigger: Trigger): void;\r\n\r\n  /**\r\n   * Adds an actor to the scene, once this is done the [[Actor]] will be drawn and updated.\r\n   * @param actor  The actor to add to the current scene\r\n   */\r\n  public add(actor: Actor): void;\r\n\r\n  public add(entity: Entity): void;\r\n\r\n  /**\r\n   * Adds a [[ScreenElement]] to the scene.\r\n   * @param screenElement  The ScreenElement to add to the current scene\r\n   */\r\n  public add(screenElement: ScreenElement): void;\r\n  public add(entity: any): void {\r\n    this.emit('entityadded', { target: entity } as any);\r\n    this.world.add(entity);\r\n    entity.scene = this;\r\n    if (entity instanceof Timer) {\r\n      if (!Util.contains(this._timers, entity)) {\r\n        this.addTimer(entity);\r\n      }\r\n      return;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Removes a [[Timer]] from the current scene, it will no longer be updated.\r\n   * @param timer  The timer to remove to the current scene.\r\n   */\r\n  public remove(timer: Timer): void;\r\n\r\n  /**\r\n   * Removes a [[TileMap]] from the scene, it will no longer be drawn or updated.\r\n   * @param tileMap {TileMap}\r\n   */\r\n  public remove(tileMap: TileMap): void;\r\n\r\n  /**\r\n   * Removes an actor from the scene, it will no longer be drawn or updated.\r\n   * @param actor  The actor to remove from the current scene.\r\n   */\r\n  public remove(actor: Actor): void;\r\n\r\n  public remove(entity: Entity): void;\r\n\r\n  /**\r\n   * Removes a [[ScreenElement]] to the scene, it will no longer be drawn or updated\r\n   * @param screenElement  The ScreenElement to remove from the current scene\r\n   */\r\n  public remove(screenElement: ScreenElement): void;\r\n  public remove(entity: any): void {\r\n    if (entity instanceof Entity) {\r\n      this.emit('entityremoved', { target: entity } as any);\r\n      this.world.remove(entity);\r\n    }\r\n    if (entity instanceof Timer) {\r\n      this.removeTimer(entity);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Adds (any) actor to act as a piece of UI, meaning it is always positioned\r\n   * in screen coordinates. UI actors do not participate in collisions.\r\n   * @todo Should this be `ScreenElement` only?\r\n   * @deprecated Use [[Scene.add]]\r\n   */\r\n  @obsolete({ message: 'Will be removed in excalibur v0.26.0', alternateMethod: 'Use Scene.add' })\r\n  public addScreenElement(actor: Actor) {\r\n    this.add(actor);\r\n  }\r\n\r\n  /**\r\n   * Removes an actor as a piece of UI\r\n   * @deprecated Use [[Scene.remove]]\r\n   */\r\n  @obsolete({ message: 'Will be removed in excalibur v0.26.0', alternateMethod: 'Use Scene.remove' })\r\n  public removeScreenElement(actor: Actor) {\r\n    this.remove(actor);\r\n  }\r\n\r\n  /**\r\n   * Adds a [[TileMap]] to the scene, once this is done the TileMap will be drawn and updated.\r\n   * @deprecated Use [[Scene.add]]\r\n   */\r\n  @obsolete({ message: 'Will be removed in excalibur v0.26.0', alternateMethod: 'Use Scene.add' })\r\n  public addTileMap(tileMap: TileMap) {\r\n    this.world.add(tileMap);\r\n  }\r\n\r\n  /**\r\n   * Removes a [[TileMap]] from the scene, it will no longer be drawn or updated.\r\n   * @deprecated Use [[Scene.remove]]\r\n   */\r\n  @obsolete({ message: 'Will be removed in excalibur v0.26.0', alternateMethod: 'Use Scene.remove' })\r\n  public removeTileMap(tileMap: TileMap) {\r\n    this.world.remove(tileMap);\r\n  }\r\n\r\n  /**\r\n   * Adds a [[Timer]] to the scene\r\n   * @param timer  The timer to add\r\n   */\r\n  public addTimer(timer: Timer): Timer {\r\n    this._timers.push(timer);\r\n    timer.scene = this;\r\n    return timer;\r\n  }\r\n\r\n  /**\r\n   * Removes a [[Timer]] from the scene.\r\n   * @warning Can be dangerous, use [[cancelTimer]] instead\r\n   * @param timer  The timer to remove\r\n   */\r\n  public removeTimer(timer: Timer): Timer {\r\n    const i = this._timers.indexOf(timer);\r\n    if (i !== -1) {\r\n      this._timers.splice(i, 1);\r\n    }\r\n    return timer;\r\n  }\r\n\r\n  /**\r\n   * Cancels a [[Timer]], removing it from the scene nicely\r\n   * @param timer  The timer to cancel\r\n   */\r\n  public cancelTimer(timer: Timer): Timer {\r\n    this._cancelQueue.push(timer);\r\n    return timer;\r\n  }\r\n\r\n  /**\r\n   * Tests whether a [[Timer]] is active in the scene\r\n   */\r\n  public isTimerActive(timer: Timer): boolean {\r\n    return this._timers.indexOf(timer) > -1 && !timer.complete;\r\n  }\r\n\r\n  public isCurrentScene(): boolean {\r\n    if (this.engine) {\r\n      return this.engine.currentScene === this;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  private _collectActorStats(engine: Engine) {\r\n    const screenElements = this.actors.filter((a) => a instanceof ScreenElement) as ScreenElement[];\r\n    for (const _ui of screenElements) {\r\n      engine.stats.currFrame.actors.ui++;\r\n    }\r\n\r\n    for (const actor of this.actors) {\r\n      engine.stats.currFrame.actors.alive++;\r\n      for (const child of actor.children) {\r\n        if (ActorUtils.isScreenElement(child as Actor)) {\r\n          // TODO not true\r\n          engine.stats.currFrame.actors.ui++;\r\n        } else {\r\n          engine.stats.currFrame.actors.alive++;\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n","export default \"precision mediump float;\\r\\n// our texture\\r\\nuniform sampler2D u_image;\\r\\n// the texCoords passed in from the vertex shader.\\r\\nvarying vec2 v_texcoord;\\r\\n\\r\\n// color blind type\\r\\nuniform int u_type;\\r\\n\\r\\n// simulation?\\r\\nuniform bool u_simulate;\\r\\n\\r\\nvoid main() {\\r\\n  vec4 o =  texture2D(u_image, v_texcoord);\\r\\n  // RGB to LMS matrix conversion\\r\\n  float L = (17.8824 * o.r) + (43.5161 * o.g) + (4.11935 * o.b);\\r\\n  float M = (3.45565 * o.r) + (27.1554 * o.g) + (3.86714 * o.b);\\r\\n  float S = (0.0299566 * o.r) + (0.184309 * o.g) + (1.46709 * o.b);\\r\\n  // Simulate color blindness\\r\\n  float l;\\r\\n  float m;\\r\\n  float s;\\r\\n  //MODE CODE//\\r\\n  if (u_type == 0) {\\r\\n    // Protanope\\r\\n    l = 0.0 * L + 2.02344 * M + -2.52581 * S;\\r\\n    m = 0.0 * L + 1.0 * M + 0.0 * S;\\r\\n    s = 0.0 * L + 0.0 * M + 1.0 * S;;\\r\\n  } else if (u_type == 1) {\\r\\n    // Deuteranope\\r\\n    l = 1.0 * L + 0.0 * M + 0.0 * S;\\r\\n    m = 0.494207 * L + 0.0 * M + 1.24827 * S;\\r\\n    s = 0.0 * L + 0.0 * M + 1.0 * S;\\r\\n  } else if (u_type == 2) {\\r\\n    // Tritanope\\r\\n    l = 1.0 * L + 0.0 * M + 0.0 * S;\\r\\n    m = 0.0 * L + 1.0 * M + 0.0 * S;\\r\\n    s = -0.395913 * L + 0.801109 * M + 0.0 * S;\\r\\n  }\\r\\n\\r\\n  // LMS to RGB matrix conversion\\r\\n  vec4 error; // simulate the colors\\r\\n  error.r = (0.0809444479 * l) + (-0.130504409 * m) + (0.116721066 * s);\\r\\n  error.g = (-0.0102485335 * l) + (0.0540193266 * m) + (-0.113614708 * s);\\r\\n  error.b = (-0.000365296938 * l) + (-0.00412161469 * m) + (0.693511405 * s);\\r\\n  error.a = 1.0;\\r\\n  vec4 diff = o - error;\\r\\n  vec4 correction; // correct the colors\\r\\n  correction.r = 0.0;\\r\\n  correction.g =  (diff.r * 0.7) + (diff.g * 1.0);\\r\\n  correction.b =  (diff.r * 0.7) + (diff.b * 1.0);\\r\\n  correction = o + correction;\\r\\n  correction.a = o.a;\\r\\n  //SIMULATE//\\r\\n\\r\\n  // sim \\r\\n  if (u_simulate) {\\r\\n    gl_FragColor = error.rgba;\\r\\n  } else {\\r\\n    gl_FragColor = correction.rgba;\\r\\n  }\\r\\n}\";","import { Shader } from '../Context/shader';\r\nimport { VertexBuffer } from '../Context/vertex-buffer';\r\nimport { VertexLayout } from '../Context/vertex-layout';\r\n\r\n/**\r\n * Helper that defines a whole screen renderer, just provide a fragment source!\r\n *\r\n * Currently supports 1 varying\r\n * - vec2 a_texcoord between 0-1 which corresponds to screen position\r\n */\r\nexport class ScreenShader {\r\n  private _shader: Shader;\r\n  private _buffer: VertexBuffer;\r\n  private _layout: VertexLayout;\r\n  constructor(fragmentSource: string) {\r\n    this._shader = new Shader({\r\n      vertexSource: `\r\n      attribute vec2 a_position;\r\n      attribute vec2 a_texcoord;\r\n      varying vec2 v_texcoord;\r\n\r\n      void main() {\r\n        gl_Position = vec4(a_position, 0.0, 1.0);\r\n        // Pass the texcoord to the fragment shader.\r\n        v_texcoord = a_texcoord;\r\n      }`,\r\n      fragmentSource: fragmentSource\r\n    });\r\n    this._shader.compile();\r\n    // Setup memory layout\r\n    this._buffer = new VertexBuffer({\r\n      type: 'static',\r\n      // clip space quad + uv since we don't need a camera\r\n      data: new Float32Array([\r\n        -1, -1,          0, 0,\r\n        -1, 1,           0, 1,\r\n        1, -1,           1, 0,\r\n\r\n        1, -1,            1, 0,\r\n        -1, 1,           0, 1,\r\n        1, 1,            1, 1\r\n      ])\r\n    });\r\n    this._layout = new VertexLayout({\r\n      shader: this._shader,\r\n      vertexBuffer: this._buffer,\r\n      attributes: [\r\n        ['a_position', 2],\r\n        ['a_texcoord', 2]\r\n      ]\r\n    });\r\n    this._buffer.upload();\r\n  }\r\n\r\n  public getShader() {\r\n    return this._shader;\r\n  }\r\n  public getLayout() {\r\n    return this._layout;\r\n  }\r\n}","import colorBlindCorrectSource from './color-blind-fragment.glsl';\r\nimport { PostProcessor } from './PostProcessor';\r\nimport { ColorBlindnessMode } from './ColorBlindnessMode';\r\nimport { Shader } from '../Context/shader';\r\nimport { VertexLayout } from '../Context/vertex-layout';\r\nimport { ScreenShader } from './ScreenShader';\r\n\r\nexport class ColorBlindnessPostProcessor implements PostProcessor {\r\n  private _shader: ScreenShader;\r\n  private _simulate = false;\r\n  constructor(private _colorBlindnessMode: ColorBlindnessMode, simulate = false) {\r\n    this._simulate = simulate;\r\n  }\r\n\r\n  initialize(_gl: WebGLRenderingContext): void {\r\n    this._shader = new ScreenShader(colorBlindCorrectSource);\r\n    this.simulate = this._simulate;\r\n    this.colorBlindnessMode = this._colorBlindnessMode;\r\n  }\r\n\r\n  getShader(): Shader {\r\n    return this._shader.getShader();\r\n  }\r\n\r\n  getLayout(): VertexLayout {\r\n    return this._shader.getLayout();\r\n  }\r\n\r\n  set colorBlindnessMode(colorBlindMode: ColorBlindnessMode) {\r\n    this._colorBlindnessMode = colorBlindMode;\r\n    if (this._shader) {\r\n      const shader = this._shader.getShader();\r\n      shader.use();\r\n      if (this._colorBlindnessMode === ColorBlindnessMode.Protanope) {\r\n        shader.setUniformInt('u_type', 0);\r\n      } else if (this._colorBlindnessMode === ColorBlindnessMode.Deuteranope) {\r\n        shader.setUniformInt('u_type', 1);\r\n      } else if (this._colorBlindnessMode === ColorBlindnessMode.Tritanope) {\r\n        shader.setUniformInt('u_type', 2);\r\n      }\r\n    }\r\n  }\r\n\r\n  get colorBlindnessMode(): ColorBlindnessMode {\r\n    return this._colorBlindnessMode;\r\n  }\r\n\r\n  set simulate(value: boolean) {\r\n    this._simulate = value;\r\n    if (this._shader) {\r\n\r\n      const shader = this._shader.getShader();\r\n      shader.use();\r\n      shader.setUniformBoolean('u_simulate', value);\r\n    }\r\n  }\r\n\r\n  get simulate(): boolean {\r\n    return this._simulate;\r\n  }\r\n}\r\n","import { ColorBlindnessMode } from '../Graphics/PostProcessor/ColorBlindnessMode';\r\nimport { ColorBlindnessPostProcessor } from '../Graphics/PostProcessor/ColorBlindnessPostProcessor';\r\nimport { Engine } from '../Engine';\r\nimport { ExcaliburGraphicsContextWebGL } from '..';\r\n\r\nexport interface DebugFlags {\r\n  colorBlindMode: ColorBlindFlags;\r\n}\r\n\r\nexport class ColorBlindFlags {\r\n  private _engine: Engine;\r\n  private _colorBlindPostProcessor: ColorBlindnessPostProcessor;\r\n\r\n  constructor(engine: Engine) {\r\n    this._engine = engine;\r\n    this._colorBlindPostProcessor = new ColorBlindnessPostProcessor(ColorBlindnessMode.Protanope);\r\n  }\r\n\r\n  /**\r\n   * Correct colors for a specified color blindness\r\n   * @param colorBlindness\r\n   */\r\n  public correct(colorBlindness: ColorBlindnessMode) {\r\n    if (this._engine.graphicsContext instanceof ExcaliburGraphicsContextWebGL) {\r\n      this.clear();\r\n      this._colorBlindPostProcessor.colorBlindnessMode = colorBlindness;\r\n      this._colorBlindPostProcessor.simulate = false;\r\n      this._engine.graphicsContext.addPostProcessor(this._colorBlindPostProcessor);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Simulate colors for a specified color blindness\r\n   * @param colorBlindness\r\n   */\r\n  public simulate(colorBlindness: ColorBlindnessMode) {\r\n    if (this._engine.graphicsContext instanceof ExcaliburGraphicsContextWebGL) {\r\n      this.clear();\r\n      this._colorBlindPostProcessor.colorBlindnessMode = colorBlindness;\r\n      this._colorBlindPostProcessor.simulate = true;\r\n      this._engine.graphicsContext.addPostProcessor(this._colorBlindPostProcessor);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Remove color blindness post processor\r\n   */\r\n  public clear() {\r\n    this._engine.graphicsContext.removePostProcessor(this._colorBlindPostProcessor);\r\n  }\r\n}\r\n","import { DebugFlags, ColorBlindFlags } from './DebugFlags';\r\nimport { Engine } from '../Engine';\r\nimport { Color } from '../Color';\r\nimport { CollisionContact } from '../Collision/Detection/CollisionContact';\r\nimport { StandardClock, TestClock } from '..';\r\n\r\n/**\r\n * Debug stats containing current and previous frame statistics\r\n */\r\nexport interface DebugStats {\r\n  currFrame: FrameStats;\r\n  prevFrame: FrameStats;\r\n}\r\n\r\n/**\r\n * Represents a frame's individual statistics\r\n */\r\nexport interface FrameStatistics {\r\n  /**\r\n   * The number of the frame\r\n   */\r\n  id: number;\r\n\r\n  /**\r\n   * Gets the frame's delta (time since last frame scaled by [[Engine.timescale]]) (in ms)\r\n   */\r\n  delta: number;\r\n\r\n  /**\r\n   * Gets the frame's frames-per-second (FPS)\r\n   */\r\n  fps: number;\r\n\r\n  /**\r\n   * Duration statistics (in ms)\r\n   */\r\n  duration: FrameDurationStats;\r\n\r\n  /**\r\n   * Actor statistics\r\n   */\r\n  actors: FrameActorStats;\r\n\r\n  /**\r\n   * Physics statistics\r\n   */\r\n  physics: PhysicsStatistics;\r\n\r\n  /**\r\n   * Graphics statistics\r\n   */\r\n  graphics: GraphicsStatistics;\r\n}\r\n\r\n/**\r\n * Represents actor stats for a frame\r\n */\r\nexport interface FrameActorStats {\r\n  /**\r\n   * Gets the frame's number of actors (alive)\r\n   */\r\n  alive: number;\r\n\r\n  /**\r\n   * Gets the frame's number of actors (killed)\r\n   */\r\n  killed: number;\r\n\r\n  /**\r\n   * Gets the frame's number of remaining actors (alive - killed)\r\n   */\r\n  remaining: number;\r\n\r\n  /**\r\n   * Gets the frame's number of UI actors\r\n   */\r\n  ui: number;\r\n\r\n  /**\r\n   * Gets the frame's number of total actors (remaining + UI)\r\n   */\r\n  total: number;\r\n}\r\n\r\n/**\r\n * Represents duration stats for a frame\r\n */\r\nexport interface FrameDurationStats {\r\n  /**\r\n   * Gets the frame's total time to run the update function (in ms)\r\n   */\r\n  update: number;\r\n\r\n  /**\r\n   * Gets the frame's total time to run the draw function (in ms)\r\n   */\r\n  draw: number;\r\n\r\n  /**\r\n   * Gets the frame's total render duration (update + draw duration) (in ms)\r\n   */\r\n  total: number;\r\n}\r\n\r\n/**\r\n * Represents physics stats for the current frame\r\n */\r\nexport interface PhysicsStatistics {\r\n  /**\r\n   * Gets the number of broadphase collision pairs which\r\n   */\r\n  pairs: number;\r\n\r\n  /**\r\n   * Gets the number of actual collisions\r\n   */\r\n  collisions: number;\r\n\r\n  /**\r\n   * Copy of the current frame contacts (only updated if debug is toggled on)\r\n   */\r\n  contacts: Map<string, CollisionContact>;\r\n\r\n  /**\r\n   * Gets the number of fast moving bodies using raycast continuous collisions in the scene\r\n   */\r\n  fastBodies: number;\r\n\r\n  /**\r\n   * Gets the number of bodies that had a fast body collision resolution\r\n   */\r\n  fastBodyCollisions: number;\r\n\r\n  /**\r\n   * Gets the time it took to calculate the broadphase pairs\r\n   */\r\n  broadphase: number;\r\n\r\n  /**\r\n   * Gets the time it took to calculate the narrowphase\r\n   */\r\n  narrowphase: number;\r\n}\r\n\r\nexport interface GraphicsStatistics {\r\n  drawCalls: number;\r\n  drawnImages: number;\r\n}\r\n\r\n/**\r\n * Debug statistics and flags for Excalibur. If polling these values, it would be\r\n * best to do so on the `postupdate` event for [[Engine]], after all values have been\r\n * updated during a frame.\r\n */\r\nexport class Debug implements DebugFlags {\r\n  private _engine: Engine;\r\n\r\n  constructor(engine: Engine) {\r\n    this._engine = engine;\r\n\r\n    this.colorBlindMode = new ColorBlindFlags(this._engine);\r\n  }\r\n\r\n  /**\r\n   * Switch the current excalibur clock with the [[TestClock]] and return\r\n   * it in the same running state.\r\n   *\r\n   * This is useful when you need to debug frame by frame.\r\n   */\r\n  public useTestClock(): TestClock {\r\n    const clock = this._engine.clock;\r\n    const wasRunning = clock.isRunning();\r\n    clock.stop();\r\n\r\n    const testClock = clock.toTestClock();\r\n    if (wasRunning) {\r\n      testClock.start();\r\n    }\r\n    this._engine.clock = testClock;\r\n    return testClock;\r\n  }\r\n\r\n  /**\r\n   * Switch the current excalibur clock with the [[StandardClock]] and\r\n   * return it in the same running state.\r\n   *\r\n   * This is useful when you need to switch back to normal mode after\r\n   * debugging.\r\n   */\r\n  public useStandardClock(): StandardClock {\r\n    const currentClock = this._engine.clock;\r\n    const wasRunning = currentClock.isRunning();\r\n    currentClock.stop();\r\n\r\n    const standardClock = currentClock.toStandardClock();\r\n    if (wasRunning) {\r\n      standardClock.start();\r\n    }\r\n    this._engine.clock = standardClock;\r\n    return standardClock;\r\n  }\r\n\r\n  /**\r\n   * Performance statistics\r\n   */\r\n  public stats: DebugStats = {\r\n    /**\r\n     * Current frame statistics. Engine reuses this instance, use [[FrameStats.clone]] to copy frame stats.\r\n     * Best accessed on [[postframe]] event. See [[FrameStats]]\r\n     */\r\n    currFrame: new FrameStats(),\r\n\r\n    /**\r\n     * Previous frame statistics. Engine reuses this instance, use [[FrameStats.clone]] to copy frame stats.\r\n     * Best accessed on [[preframe]] event. Best inspected on engine event `preframe`. See [[FrameStats]]\r\n     */\r\n    prevFrame: new FrameStats()\r\n  };\r\n\r\n  /**\r\n   * Correct or simulate color blindness using [[ColorBlindnessPostProcessor]].\r\n   * @warning Will reduce FPS.\r\n   */\r\n  public colorBlindMode: ColorBlindFlags;\r\n\r\n  /**\r\n   * Filter debug context to named entities or entity ids\r\n   */\r\n  public filter: { useFilter: boolean; nameQuery: string; ids: number[] } = {\r\n    /**\r\n     * Toggle filter on or off (default off) must be on for DebugDraw to use filters\r\n     */\r\n    useFilter: false,\r\n    /**\r\n     * Query for entities by name, if the entity name contains `nameQuery` it will be included\r\n     */\r\n    nameQuery: '',\r\n    /**\r\n     * Query for Entity ids, if the id matches it will be included\r\n     */\r\n    ids: []\r\n  };\r\n\r\n  /**\r\n   * Entity debug settings\r\n   */\r\n  public entity = {\r\n    showAll: false,\r\n    showId: true,\r\n    showName: false\r\n  };\r\n\r\n  /**\r\n   * Transform component debug settings\r\n   */\r\n  public transform = {\r\n    showAll: false,\r\n\r\n    showPosition: false,\r\n    showPositionLabel: false,\r\n    positionColor: Color.Yellow,\r\n\r\n    showScale: false,\r\n    scaleColor: Color.Green,\r\n\r\n    showRotation: false,\r\n    rotationColor: Color.Blue\r\n  };\r\n\r\n  /**\r\n   * Graphics component debug settings\r\n   */\r\n  public graphics = {\r\n    showAll: false,\r\n\r\n    showBounds: true,\r\n    boundsColor: Color.Yellow\r\n  };\r\n\r\n  /**\r\n   * Collider component debug settings\r\n   */\r\n  public collider = {\r\n    showAll: false,\r\n\r\n    showBounds: true,\r\n    boundsColor: Color.Blue,\r\n\r\n    showOwner: false,\r\n\r\n    showGeometry: true,\r\n    geometryColor: Color.Green\r\n  };\r\n\r\n  /**\r\n   * Physics simulation debug settings\r\n   */\r\n  public physics = {\r\n    showAll: false,\r\n\r\n    showBroadphaseSpacePartitionDebug: false,\r\n\r\n    showCollisionNormals: false,\r\n    collisionNormalColor: Color.Cyan,\r\n\r\n    showCollisionContacts: true,\r\n    collisionContactColor: Color.Red\r\n  };\r\n\r\n  /**\r\n   * Motion component debug settings\r\n   */\r\n  public motion = {\r\n    showAll: false,\r\n\r\n    showVelocity: false,\r\n    velocityColor: Color.Yellow,\r\n\r\n    showAcceleration: false,\r\n    accelerationColor: Color.Red\r\n  };\r\n\r\n  /**\r\n   * Body component debug settings\r\n   */\r\n  public body = {\r\n    showAll: false,\r\n\r\n    showCollisionGroup: false,\r\n    showCollisionType: false,\r\n    showSleeping: false,\r\n    showMotion: false,\r\n    showMass: false\r\n  };\r\n\r\n  /**\r\n   * Camera debug settings\r\n   */\r\n  public camera = {\r\n    showAll: false,\r\n\r\n    showFocus: false,\r\n    focusColor: Color.Red,\r\n\r\n    showZoom: false\r\n  };\r\n}\r\n\r\n/**\r\n * Implementation of a frame's stats. Meant to have values copied via [[FrameStats.reset]], avoid\r\n * creating instances of this every frame.\r\n */\r\nexport class FrameStats implements FrameStatistics {\r\n  private _id: number = 0;\r\n  private _delta: number = 0;\r\n  private _fps: number = 0;\r\n  private _actorStats: FrameActorStats = {\r\n    alive: 0,\r\n    killed: 0,\r\n    ui: 0,\r\n    get remaining() {\r\n      return this.alive - this.killed;\r\n    },\r\n    get total() {\r\n      return this.remaining + this.ui;\r\n    }\r\n  };\r\n  private _durationStats: FrameDurationStats = {\r\n    update: 0,\r\n    draw: 0,\r\n    get total() {\r\n      return this.update + this.draw;\r\n    }\r\n  };\r\n\r\n  private _physicsStats: PhysicsStats = new PhysicsStats();\r\n\r\n  private _graphicsStats: GraphicsStatistics = {\r\n    drawCalls: 0,\r\n    drawnImages: 0\r\n  };\r\n\r\n  /**\r\n   * Zero out values or clone other IFrameStat stats. Allows instance reuse.\r\n   *\r\n   * @param [otherStats] Optional stats to clone\r\n   */\r\n  public reset(otherStats?: FrameStatistics) {\r\n    if (otherStats) {\r\n      this.id = otherStats.id;\r\n      this.delta = otherStats.delta;\r\n      this.fps = otherStats.fps;\r\n      this.actors.alive = otherStats.actors.alive;\r\n      this.actors.killed = otherStats.actors.killed;\r\n      this.actors.ui = otherStats.actors.ui;\r\n      this.duration.update = otherStats.duration.update;\r\n      this.duration.draw = otherStats.duration.draw;\r\n      this._physicsStats.reset(otherStats.physics);\r\n      this.graphics.drawCalls = otherStats.graphics.drawCalls;\r\n      this.graphics.drawnImages = otherStats.graphics.drawnImages;\r\n    } else {\r\n      this.id = this.delta = this.fps = 0;\r\n      this.actors.alive = this.actors.killed = this.actors.ui = 0;\r\n      this.duration.update = this.duration.draw = 0;\r\n      this._physicsStats.reset();\r\n      this.graphics.drawnImages = this.graphics.drawCalls = 0;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Provides a clone of this instance.\r\n   */\r\n  public clone(): FrameStats {\r\n    const fs = new FrameStats();\r\n\r\n    fs.reset(this);\r\n\r\n    return fs;\r\n  }\r\n\r\n  /**\r\n   * Gets the frame's id\r\n   */\r\n  public get id() {\r\n    return this._id;\r\n  }\r\n\r\n  /**\r\n   * Sets the frame's id\r\n   */\r\n  public set id(value: number) {\r\n    this._id = value;\r\n  }\r\n\r\n  /**\r\n   * Gets the frame's delta (time since last frame)\r\n   */\r\n  public get delta() {\r\n    return this._delta;\r\n  }\r\n\r\n  /**\r\n   * Sets the frame's delta (time since last frame). Internal use only.\r\n   * @internal\r\n   */\r\n  public set delta(value: number) {\r\n    this._delta = value;\r\n  }\r\n\r\n  /**\r\n   * Gets the frame's frames-per-second (FPS)\r\n   */\r\n  public get fps() {\r\n    return this._fps;\r\n  }\r\n\r\n  /**\r\n   * Sets the frame's frames-per-second (FPS). Internal use only.\r\n   * @internal\r\n   */\r\n  public set fps(value: number) {\r\n    this._fps = value;\r\n  }\r\n\r\n  /**\r\n   * Gets the frame's actor statistics\r\n   */\r\n  public get actors() {\r\n    return this._actorStats;\r\n  }\r\n\r\n  /**\r\n   * Gets the frame's duration statistics\r\n   */\r\n  public get duration() {\r\n    return this._durationStats;\r\n  }\r\n\r\n  /**\r\n   * Gets the frame's physics statistics\r\n   */\r\n  public get physics() {\r\n    return this._physicsStats;\r\n  }\r\n\r\n  /**\r\n   * Gets the frame's graphics statistics\r\n   */\r\n  public get graphics() {\r\n    return this._graphicsStats;\r\n  }\r\n}\r\n\r\nexport class PhysicsStats implements PhysicsStatistics {\r\n  private _pairs: number = 0;\r\n  private _collisions: number = 0;\r\n  private _contacts: Map<string, CollisionContact> = new Map();\r\n  private _fastBodies: number = 0;\r\n  private _fastBodyCollisions: number = 0;\r\n  private _broadphase: number = 0;\r\n  private _narrowphase: number = 0;\r\n\r\n  /**\r\n   * Zero out values or clone other IPhysicsStats stats. Allows instance reuse.\r\n   *\r\n   * @param [otherStats] Optional stats to clone\r\n   */\r\n  public reset(otherStats?: PhysicsStatistics) {\r\n    if (otherStats) {\r\n      this.pairs = otherStats.pairs;\r\n      this.collisions = otherStats.collisions;\r\n      this.contacts = otherStats.contacts;\r\n      this.fastBodies = otherStats.fastBodies;\r\n      this.fastBodyCollisions = otherStats.fastBodyCollisions;\r\n      this.broadphase = otherStats.broadphase;\r\n      this.narrowphase = otherStats.narrowphase;\r\n    } else {\r\n      this.pairs = this.collisions = this.fastBodies = 0;\r\n      this.fastBodyCollisions = this.broadphase = this.narrowphase = 0;\r\n      this.contacts.clear();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Provides a clone of this instance.\r\n   */\r\n  public clone(): PhysicsStatistics {\r\n    const ps = new PhysicsStats();\r\n\r\n    ps.reset(this);\r\n\r\n    return ps;\r\n  }\r\n\r\n  public get pairs(): number {\r\n    return this._pairs;\r\n  }\r\n\r\n  public set pairs(value: number) {\r\n    this._pairs = value;\r\n  }\r\n\r\n  public get collisions(): number {\r\n    return this._collisions;\r\n  }\r\n\r\n  public set collisions(value: number) {\r\n    this._collisions = value;\r\n  }\r\n\r\n  public get contacts(): Map<string, CollisionContact> {\r\n    return this._contacts;\r\n  }\r\n\r\n  public set contacts(contacts: Map<string, CollisionContact>) {\r\n    this._contacts = contacts;\r\n  }\r\n\r\n  public get fastBodies(): number {\r\n    return this._fastBodies;\r\n  }\r\n\r\n  public set fastBodies(value: number) {\r\n    this._fastBodies = value;\r\n  }\r\n\r\n  public get fastBodyCollisions(): number {\r\n    return this._fastBodyCollisions;\r\n  }\r\n\r\n  public set fastBodyCollisions(value: number) {\r\n    this._fastBodyCollisions = value;\r\n  }\r\n\r\n  public get broadphase(): number {\r\n    return this._broadphase;\r\n  }\r\n\r\n  public set broadphase(value: number) {\r\n    this._broadphase = value;\r\n  }\r\n\r\n  public get narrowphase(): number {\r\n    return this._narrowphase;\r\n  }\r\n\r\n  public set narrowphase(value: number) {\r\n    this._narrowphase = value;\r\n  }\r\n}\r\n","/**\r\n * Determines the scope of handling mouse/touch events.\r\n */\r\n\r\nexport enum PointerScope {\r\n  /**\r\n   * Handle events on the `canvas` element only. Events originating outside the\r\n   * `canvas` will not be handled.\r\n   */\r\n  Canvas = 'Canvas',\r\n\r\n  /**\r\n   * Handles events on the entire document. All events will be handled by Excalibur.\r\n   */\r\n  Document = 'Document'\r\n}\r\n","import { Logger } from '../Util/Log';\r\nimport { Class } from '../Class';\r\nimport * as Events from '../Events';\r\n\r\n/**\r\n * Enum representing physical input key codes\r\n */\r\nexport enum Keys {\r\n  // NUMPAD\r\n  Num0 = 'Numpad0',\r\n  Num1 = 'Numpad1',\r\n  Num2 = 'Numpad2',\r\n  Num3 = 'Numpad3',\r\n  Num4 = 'Numpad4',\r\n  Num5 = 'Numpad5',\r\n  Num6 = 'Numpad6',\r\n  Num7 = 'Numpad7',\r\n  Num8 = 'Numpad8',\r\n  Num9 = 'Numpad9',\r\n  NumAdd = 'NumpadAdd',\r\n  NumSubtract = 'NumpadSubtract',\r\n  NumMultiply = 'NumpadMultiply',\r\n  NumDivide = 'NumpadDivide',\r\n  // NumComma = 'NumpadComma', // not x-browser\r\n  NumDecimal = 'NumpadDecimal',\r\n  Numpad0 = 'Numpad0',\r\n  Numpad1 = 'Numpad1',\r\n  Numpad2 = 'Numpad2',\r\n  Numpad3 = 'Numpad3',\r\n  Numpad4 = 'Numpad4',\r\n  Numpad5 = 'Numpad5',\r\n  Numpad6 = 'Numpad6',\r\n  Numpad7 = 'Numpad7',\r\n  Numpad8 = 'Numpad8',\r\n  Numpad9 = 'Numpad9',\r\n  NumpadAdd = 'NumpadAdd',\r\n  NumpadSubtract = 'NumpadSubtract',\r\n  NumpadMultiply = 'NumpadMultiply',\r\n  NumpadDivide = 'NumpadDivide',\r\n  // NumpadComma = 'NumpadComma', // not x-browser\r\n  NumpadDecimal = 'NumpadDecimal',\r\n\r\n  // MODIFIERS\r\n  NumLock = 'NumLock',\r\n  ShiftLeft = 'ShiftLeft',\r\n  ShiftRight = 'ShiftRight',\r\n  AltLeft = 'AltLeft',\r\n  AltRight = 'AltRight',\r\n\r\n  // NUMBERS\r\n  Key0 = 'Digit0',\r\n  Key1 = 'Digit1',\r\n  Key2 = 'Digit2',\r\n  Key3 = 'Digit3',\r\n  Key4 = 'Digit4',\r\n  Key5 = 'Digit5',\r\n  Key6 = 'Digit6',\r\n  Key7 = 'Digit7',\r\n  Key8 = 'Digit8',\r\n  Key9 = 'Digit9',\r\n  Digit0 = 'Digit0',\r\n  Digit1 = 'Digit1',\r\n  Digit2 = 'Digit2',\r\n  Digit3 = 'Digit3',\r\n  Digit4 = 'Digit4',\r\n  Digit5 = 'Digit5',\r\n  Digit6 = 'Digit6',\r\n  Digit7 = 'Digit7',\r\n  Digit8 = 'Digit8',\r\n  Digit9 = 'Digit9',\r\n\r\n  // LETTERS\r\n  A = 'KeyA',\r\n  B = 'KeyB',\r\n  C = 'KeyC',\r\n  D = 'KeyD',\r\n  E = 'KeyE',\r\n  F = 'KeyF',\r\n  G = 'KeyG',\r\n  H = 'KeyH',\r\n  I = 'KeyI',\r\n  J = 'KeyJ',\r\n  K = 'KeyK',\r\n  L = 'KeyL',\r\n  M = 'KeyM',\r\n  N = 'KeyN',\r\n  O = 'KeyO',\r\n  P = 'KeyP',\r\n  Q = 'KeyQ',\r\n  R = 'KeyR',\r\n  S = 'KeyS',\r\n  T = 'KeyT',\r\n  U = 'KeyU',\r\n  V = 'KeyV',\r\n  W = 'KeyW',\r\n  X = 'KeyX',\r\n  Y = 'KeyY',\r\n  Z = 'KeyZ',\r\n  KeyA = 'KeyA',\r\n  KeyB = 'KeyB',\r\n  KeyC = 'KeyC',\r\n  KeyD = 'KeyD',\r\n  KeyE = 'KeyE',\r\n  KeyF = 'KeyF',\r\n  KeyG = 'KeyG',\r\n  KeyH = 'KeyH',\r\n  KeyI = 'KeyI',\r\n  KeyJ = 'KeyJ',\r\n  KeyK = 'KeyK',\r\n  KeyL = 'KeyL',\r\n  KeyM = 'KeyM',\r\n  KeyN = 'KeyN',\r\n  KeyO = 'KeyO',\r\n  KeyP = 'KeyP',\r\n  KeyQ = 'KeyQ',\r\n  KeyR = 'KeyR',\r\n  KeyS = 'KeyS',\r\n  KeyT = 'KeyT',\r\n  KeyU = 'KeyU',\r\n  KeyV = 'KeyV',\r\n  KeyW = 'KeyW',\r\n  KeyX = 'KeyX',\r\n  KeyY = 'KeyY',\r\n  KeyZ = 'KeyZ',\r\n\r\n  // SYMBOLS\r\n  Semicolon = 'Semicolon',\r\n  Quote = 'Quote',\r\n  Comma = 'Comma',\r\n  Minus = 'Minus',\r\n  Period = 'Period',\r\n  Slash = 'Slash',\r\n  Equal = 'Equal',\r\n  BracketLeft = 'BracketLeft',\r\n  Backslash = 'Backslash',\r\n  BracketRight = 'BracketRight',\r\n  Backquote = 'Backquote',\r\n\r\n  // DIRECTIONS\r\n  Up = 'ArrowUp',\r\n  Down = 'ArrowDown',\r\n  Left = 'ArrowLeft',\r\n  Right = 'ArrowRight',\r\n  ArrowUp = 'ArrowUp',\r\n  ArrowDown = 'ArrowDown',\r\n  ArrowLeft = 'ArrowLeft',\r\n  ArrowRight = 'ArrowRight',\r\n\r\n  // OTHER\r\n  Space = 'Space',\r\n  Esc = 'Escape',\r\n  Escape = 'Escape'\r\n}\r\n\r\n/**\r\n * Event thrown on a game object for a key event\r\n */\r\nexport class KeyEvent extends Events.GameEvent<any> {\r\n  /**\r\n   * @param key  The key responsible for throwing the event\r\n   * @param value The key's typed value the browser detected\r\n   * @param originalEvent The original keyboard event that Excalibur handled\r\n   */\r\n  constructor(public key: Keys, public value?: string, public originalEvent?: KeyboardEvent) {\r\n    super();\r\n  }\r\n}\r\n\r\n/**\r\n * Provides keyboard support for Excalibur.\r\n */\r\nexport class Keyboard extends Class {\r\n  private _keys: Keys[] = [];\r\n  private _keysUp: Keys[] = [];\r\n  private _keysDown: Keys[] = [];\r\n\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  public on(eventName: Events.press, handler: (event: KeyEvent) => void): void;\r\n  public on(eventName: Events.release, handler: (event: KeyEvent) => void): void;\r\n  public on(eventName: Events.hold, handler: (event: KeyEvent) => void): void;\r\n  public on(eventName: string, handler: (event: Events.GameEvent<any>) => void): void;\r\n  public on(eventName: string, handler: (event: any) => void): void {\r\n    super.on(eventName, handler);\r\n  }\r\n\r\n  /**\r\n   * Initialize Keyboard event listeners\r\n   */\r\n  init(global?: GlobalEventHandlers): void {\r\n    if (!global) {\r\n      try {\r\n        // Try and listen to events on top window frame if within an iframe.\r\n        //\r\n        // See https://github.com/excaliburjs/Excalibur/issues/1294\r\n        //\r\n        // Attempt to add an event listener, which triggers a DOMException on\r\n        // cross-origin iframes\r\n        const noop = () => {\r\n          return;\r\n        };\r\n        window.top.addEventListener('blur', noop);\r\n        window.top.removeEventListener('blur', noop);\r\n\r\n        // this will be the same as window if not embedded within an iframe\r\n        global = window.top;\r\n      } catch {\r\n        // fallback to current frame\r\n        global = window;\r\n\r\n        Logger.getInstance().warn(\r\n          'Failed to bind to keyboard events to top frame. ' +\r\n            'If you are trying to embed Excalibur in a cross-origin iframe, keyboard events will not fire.'\r\n        );\r\n      }\r\n    }\r\n\r\n    global.addEventListener('blur', () => {\r\n      this._keys.length = 0; // empties array efficiently\r\n    });\r\n\r\n    // key up is on window because canvas cannot have focus\r\n    global.addEventListener('keyup', (ev: KeyboardEvent) => {\r\n      const code = ev.code as Keys;\r\n      const key = this._keys.indexOf(code);\r\n      this._keys.splice(key, 1);\r\n      this._keysUp.push(code);\r\n      const keyEvent = new KeyEvent(code, ev.key, ev);\r\n\r\n      // alias the old api, we may want to deprecate this in the future\r\n      this.eventDispatcher.emit('up', keyEvent);\r\n      this.eventDispatcher.emit('release', keyEvent);\r\n    });\r\n\r\n    // key down is on window because canvas cannot have focus\r\n    global.addEventListener('keydown', (ev: KeyboardEvent) => {\r\n      const code = ev.code as Keys;\r\n      if (this._keys.indexOf(code) === -1) {\r\n        this._keys.push(code);\r\n        this._keysDown.push(code);\r\n        const keyEvent = new KeyEvent(code, ev.key, ev);\r\n        this.eventDispatcher.emit('down', keyEvent);\r\n        this.eventDispatcher.emit('press', keyEvent);\r\n      }\r\n    });\r\n  }\r\n\r\n  public update() {\r\n    // Reset keysDown and keysUp after update is complete\r\n    this._keysDown.length = 0;\r\n    this._keysUp.length = 0;\r\n\r\n    // Emit synthetic \"hold\" event\r\n    for (let i = 0; i < this._keys.length; i++) {\r\n      this.eventDispatcher.emit('hold', new KeyEvent(this._keys[i]));\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Gets list of keys being pressed down\r\n   */\r\n  public getKeys(): Keys[] {\r\n    return this._keys;\r\n  }\r\n\r\n  /**\r\n   * Tests if a certain key was just pressed this frame. This is cleared at the end of the update frame.\r\n   * @param key Test whether a key was just pressed\r\n   */\r\n  public wasPressed(key: Keys): boolean {\r\n    return this._keysDown.indexOf(key) > -1;\r\n  }\r\n\r\n  /**\r\n   * Tests if a certain key is held down. This is persisted between frames.\r\n   * @param key  Test whether a key is held down\r\n   */\r\n  public isHeld(key: Keys): boolean {\r\n    return this._keys.indexOf(key) > -1;\r\n  }\r\n\r\n  /**\r\n   * Tests if a certain key was just released this frame. This is cleared at the end of the update frame.\r\n   * @param key  Test whether a key was just released\r\n   */\r\n  public wasReleased(key: Keys): boolean {\r\n    return this._keysUp.indexOf(key) > -1;\r\n  }\r\n}\r\n","import { Class } from './../Class';\r\nimport { GameEvent, GamepadConnectEvent, GamepadDisconnectEvent, GamepadButtonEvent, GamepadAxisEvent } from '../Events';\r\nimport * as Events from '../Events';\r\n\r\n/**\r\n * Excalibur leverages the HTML5 Gamepad API [where it is supported](http://caniuse.com/#feat=gamepad)\r\n * to provide controller support for your games.\r\n */\r\nexport class Gamepads extends Class {\r\n  /**\r\n   * Whether or not to poll for Gamepad input (default: `false`)\r\n   */\r\n  public enabled = false;\r\n\r\n  /**\r\n   * Whether or not Gamepad API is supported\r\n   */\r\n  public supported = !!(<any>navigator).getGamepads;\r\n\r\n  /**\r\n   * The minimum value an axis has to move before considering it a change\r\n   */\r\n  public static MinAxisMoveThreshold = 0.05;\r\n\r\n  private _gamePadTimeStamps = [0, 0, 0, 0];\r\n  private _oldPads: Gamepad[] = [];\r\n  private _pads: Gamepad[] = [];\r\n  private _initSuccess: boolean = false;\r\n  private _navigator: NavigatorGamepads = <any>navigator;\r\n  private _minimumConfiguration: GamepadConfiguration = null;\r\n\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  public init() {\r\n    if (!this.supported) {\r\n      return;\r\n    }\r\n    if (this._initSuccess) {\r\n      return;\r\n    }\r\n\r\n    // In Chrome, this will return 4 undefined items until a button is pressed\r\n    // In FF, this will not return any items until a button is pressed\r\n    this._oldPads = this._clonePads(this._navigator.getGamepads());\r\n    if (this._oldPads.length && this._oldPads[0]) {\r\n      this._initSuccess = true;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Sets the minimum gamepad configuration, for example {axis: 4, buttons: 4} means\r\n   * this game requires at minimum 4 axis inputs and 4 buttons, this is not restrictive\r\n   * all other controllers with more axis or buttons are valid as well. If no minimum\r\n   * configuration is set all pads are valid.\r\n   */\r\n  public setMinimumGamepadConfiguration(config: GamepadConfiguration): void {\r\n    this._enableAndUpdate(); // if config is used, implicitly enable\r\n    this._minimumConfiguration = config;\r\n  }\r\n\r\n  /**\r\n   * When implicitly enabled, set the enabled flag and run an update so information is updated\r\n   */\r\n  private _enableAndUpdate() {\r\n    if (!this.enabled) {\r\n      this.enabled = true;\r\n      this.update();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Checks a navigator gamepad against the minimum configuration if present.\r\n   */\r\n  private _isGamepadValid(pad: NavigatorGamepad): boolean {\r\n    if (!this._minimumConfiguration) {\r\n      return true;\r\n    }\r\n    if (!pad) {\r\n      return false;\r\n    }\r\n    const axesLength = pad.axes.filter((value) => {\r\n      return typeof value !== undefined;\r\n    }).length;\r\n\r\n    const buttonLength = pad.buttons.filter((value) => {\r\n      return typeof value !== undefined;\r\n    }).length;\r\n    return axesLength >= this._minimumConfiguration.axis && buttonLength >= this._minimumConfiguration.buttons && pad.connected;\r\n  }\r\n\r\n  public on(eventName: Events.connect, handler: (event: GamepadConnectEvent) => void): void;\r\n  public on(eventName: Events.disconnect, handler: (event: GamepadDisconnectEvent) => void): void;\r\n  public on(eventName: Events.button, handler: (event: GamepadButtonEvent) => void): void;\r\n  public on(eventName: Events.axis, handler: (event: GamepadAxisEvent) => void): void;\r\n  public on(eventName: string, handler: (event: GameEvent<any>) => void): void;\r\n  public on(eventName: string, handler: (event: any) => void): void {\r\n    this._enableAndUpdate(); // implicitly enable\r\n    super.on(eventName, handler);\r\n  }\r\n\r\n  public off(eventName: string, handler?: (event: GameEvent<any>) => void) {\r\n    this._enableAndUpdate(); // implicitly enable\r\n    super.off(eventName, handler);\r\n  }\r\n\r\n  /**\r\n   * Updates Gamepad state and publishes Gamepad events\r\n   */\r\n  public update() {\r\n    if (!this.enabled || !this.supported) {\r\n      return;\r\n    }\r\n    this.init();\r\n\r\n    const gamepads = this._navigator.getGamepads();\r\n\r\n    for (let i = 0; i < gamepads.length; i++) {\r\n      if (!gamepads[i]) {\r\n        const gamepad = this.at(i);\r\n        // If was connected, but now isn't emit the disconnect event\r\n        if (gamepad.connected) {\r\n          this.eventDispatcher.emit('disconnect', new GamepadDisconnectEvent(i, gamepad));\r\n        }\r\n        // Reset connection status\r\n        gamepad.connected = false;\r\n        continue;\r\n      } else {\r\n        if (!this.at(i).connected && this._isGamepadValid(gamepads[i])) {\r\n          this.eventDispatcher.emit('connect', new GamepadConnectEvent(i, this.at(i)));\r\n        }\r\n        // Set connection status\r\n        this.at(i).connected = true;\r\n      }\r\n\r\n      // Only supported in Chrome\r\n      if (gamepads[i].timestamp && gamepads[i].timestamp === this._gamePadTimeStamps[i]) {\r\n        continue;\r\n      }\r\n\r\n      this._gamePadTimeStamps[i] = gamepads[i].timestamp;\r\n\r\n      // Add reference to navigator gamepad\r\n      this.at(i).navigatorGamepad = gamepads[i];\r\n\r\n      // Buttons\r\n      let b: string, bi: number, a: string, ai: number, value: number;\r\n\r\n      for (b in Buttons) {\r\n        bi = <any>Buttons[b];\r\n        if (typeof bi === 'number') {\r\n          if (gamepads[i].buttons[bi]) {\r\n            value = gamepads[i].buttons[bi].value;\r\n            if (value !== this._oldPads[i].getButton(bi)) {\r\n              if (gamepads[i].buttons[bi].pressed) {\r\n                this.at(i).updateButton(bi, value);\r\n                this.at(i).eventDispatcher.emit('button', new GamepadButtonEvent(bi, value, this.at(i)));\r\n              } else {\r\n                this.at(i).updateButton(bi, 0);\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      // Axes\r\n      for (a in Axes) {\r\n        ai = <any>Axes[a];\r\n        if (typeof ai === 'number') {\r\n          value = gamepads[i].axes[ai];\r\n          if (value !== this._oldPads[i].getAxes(ai)) {\r\n            this.at(i).updateAxes(ai, value);\r\n            this.at(i).eventDispatcher.emit('axis', new GamepadAxisEvent(ai, value, this.at(i)));\r\n          }\r\n        }\r\n      }\r\n\r\n      this._oldPads[i] = this._clonePad(gamepads[i]);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Safely retrieves a Gamepad at a specific index and creates one if it doesn't yet exist\r\n   */\r\n  public at(index: number): Gamepad {\r\n    this._enableAndUpdate(); // implicitly enable gamepads when at() is called\r\n    if (index >= this._pads.length) {\r\n      // Ensure there is a pad to retrieve\r\n      for (let i = this._pads.length - 1, max = index; i < max; i++) {\r\n        this._pads.push(new Gamepad());\r\n        this._oldPads.push(new Gamepad());\r\n      }\r\n    }\r\n\r\n    return this._pads[index];\r\n  }\r\n\r\n  /**\r\n   * Returns a list of all valid gamepads that meet the minimum configuration requirement.\r\n   */\r\n  public getValidGamepads(): Gamepad[] {\r\n    this._enableAndUpdate();\r\n    const result: Gamepad[] = [];\r\n    for (let i = 0; i < this._pads.length; i++) {\r\n      if (this._isGamepadValid(this.at(i).navigatorGamepad) && this.at(i).connected) {\r\n        result.push(this.at(i));\r\n      }\r\n    }\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Gets the number of connected gamepads\r\n   */\r\n  public count() {\r\n    return this._pads.filter((p) => p.connected).length;\r\n  }\r\n\r\n  private _clonePads(pads: NavigatorGamepad[]): Gamepad[] {\r\n    const arr = [];\r\n    for (let i = 0, len = pads.length; i < len; i++) {\r\n      arr.push(this._clonePad(pads[i]));\r\n    }\r\n    return arr;\r\n  }\r\n\r\n  /**\r\n   * Fastest way to clone a known object is to do it yourself\r\n   */\r\n  private _clonePad(pad: NavigatorGamepad): Gamepad {\r\n    let i, len;\r\n    const clonedPad = new Gamepad();\r\n\r\n    if (!pad) {\r\n      return clonedPad;\r\n    }\r\n\r\n    for (i = 0, len = pad.buttons.length; i < len; i++) {\r\n      if (pad.buttons[i]) {\r\n        clonedPad.updateButton(i, pad.buttons[i].value);\r\n      }\r\n    }\r\n    for (i = 0, len = pad.axes.length; i < len; i++) {\r\n      clonedPad.updateAxes(i, pad.axes[i]);\r\n    }\r\n\r\n    return clonedPad;\r\n  }\r\n}\r\n\r\n/**\r\n * Gamepad holds state information for a connected controller. See [[Gamepads]]\r\n * for more information on handling controller input.\r\n */\r\nexport class Gamepad extends Class {\r\n  public connected = false;\r\n  public navigatorGamepad: NavigatorGamepad;\r\n  private _buttons: number[] = new Array(16);\r\n  private _axes: number[] = new Array(4);\r\n\r\n  constructor() {\r\n    super();\r\n\r\n    for (let i = 0; i < this._buttons.length; i++) {\r\n      this._buttons[i] = 0;\r\n    }\r\n    for (let i = 0; i < this._axes.length; i++) {\r\n      this._axes[i] = 0;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Whether or not the given button is pressed\r\n   * @param button     The button to query\r\n   * @param threshold  The threshold over which the button is considered to be pressed\r\n   */\r\n  public isButtonPressed(button: Buttons, threshold: number = 1) {\r\n    return this._buttons[button] >= threshold;\r\n  }\r\n\r\n  /**\r\n   * Gets the given button value between 0 and 1\r\n   */\r\n  public getButton(button: Buttons) {\r\n    return this._buttons[button];\r\n  }\r\n\r\n  /**\r\n   * Gets the given axis value between -1 and 1. Values below\r\n   * [[MinAxisMoveThreshold]] are considered 0.\r\n   */\r\n  public getAxes(axes: Axes) {\r\n    const value = this._axes[axes];\r\n\r\n    if (Math.abs(value) < Gamepads.MinAxisMoveThreshold) {\r\n      return 0;\r\n    } else {\r\n      return value;\r\n    }\r\n  }\r\n\r\n  public updateButton(buttonIndex: number, value: number) {\r\n    this._buttons[buttonIndex] = value;\r\n  }\r\n\r\n  public updateAxes(axesIndex: number, value: number) {\r\n    this._axes[axesIndex] = value;\r\n  }\r\n}\r\n\r\n/**\r\n * Gamepad Buttons enumeration\r\n */\r\nexport enum Buttons {\r\n  /**\r\n   * Face 1 button (e.g. A)\r\n   */\r\n  Face1 = 0,\r\n  /**\r\n   * Face 2 button (e.g. B)\r\n   */\r\n  Face2 = 1,\r\n  /**\r\n   * Face 3 button (e.g. X)\r\n   */\r\n  Face3 = 2,\r\n  /**\r\n   * Face 4 button (e.g. Y)\r\n   */\r\n  Face4 = 3,\r\n  /**\r\n   * Left bumper button\r\n   */\r\n  LeftBumper = 4,\r\n  /**\r\n   * Right bumper button\r\n   */\r\n  RightBumper = 5,\r\n  /**\r\n   * Left trigger button\r\n   */\r\n  LeftTrigger = 6,\r\n  /**\r\n   * Right trigger button\r\n   */\r\n  RightTrigger = 7,\r\n  /**\r\n   * Select button\r\n   */\r\n  Select = 8,\r\n  /**\r\n   * Start button\r\n   */\r\n  Start = 9,\r\n  /**\r\n   * Left analog stick press (e.g. L3)\r\n   */\r\n  LeftStick = 10,\r\n  /**\r\n   * Right analog stick press (e.g. R3)\r\n   */\r\n  RightStick = 11,\r\n  /**\r\n   * D-pad up\r\n   */\r\n  DpadUp = 12,\r\n  /**\r\n   * D-pad down\r\n   */\r\n  DpadDown = 13,\r\n  /**\r\n   * D-pad left\r\n   */\r\n  DpadLeft = 14,\r\n  /**\r\n   * D-pad right\r\n   */\r\n  DpadRight = 15\r\n}\r\n\r\n/**\r\n * Gamepad Axes enumeration\r\n */\r\nexport enum Axes {\r\n  /**\r\n   * Left analogue stick X direction\r\n   */\r\n  LeftStickX = 0,\r\n  /**\r\n   * Left analogue stick Y direction\r\n   */\r\n  LeftStickY = 1,\r\n  /**\r\n   * Right analogue stick X direction\r\n   */\r\n  RightStickX = 2,\r\n  /**\r\n   * Right analogue stick Y direction\r\n   */\r\n  RightStickY = 3\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport interface NavigatorGamepads {\r\n  getGamepads(): NavigatorGamepad[];\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport interface NavigatorGamepad {\r\n  axes: number[];\r\n  buttons: NavigatorGamepadButton[];\r\n  connected: boolean;\r\n  id: string;\r\n  index: number;\r\n  mapping: string;\r\n  timestamp: number;\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport interface NavigatorGamepadButton {\r\n  pressed: boolean;\r\n  value: number;\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport interface NavigatorGamepadEvent {\r\n  gamepad: NavigatorGamepad;\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport interface GamepadConfiguration {\r\n  axis: number;\r\n  buttons: number;\r\n}\r\n","export interface NativeEventable {\r\n  addEventListener(name: string, handler: (...any: any[]) => any): any;\r\n  removeEventListener(name: string, handler: (...any: any[]) => any): any;\r\n}\r\n\r\nexport class BrowserComponent<T extends NativeEventable> {\r\n  private _paused = false;\r\n  private _nativeHandlers: { [key: string]: (handler: any) => void } = {};\r\n\r\n  on(eventName: string, handler: (evt: any) => void): void {\r\n    if (this._nativeHandlers[eventName]) {\r\n      this.off(eventName, this._nativeHandlers[eventName]);\r\n    }\r\n    this._nativeHandlers[eventName] = this._decorate(handler);\r\n    this.nativeComponent.addEventListener(eventName, this._nativeHandlers[eventName]);\r\n  }\r\n  off(eventName: string, handler?: (event: any) => void): void {\r\n    if (!handler) {\r\n      handler = this._nativeHandlers[eventName];\r\n    }\r\n    this.nativeComponent.removeEventListener(eventName, handler);\r\n    this._nativeHandlers[eventName] = null;\r\n  }\r\n\r\n  private _decorate(handler: (evt: any) => void): (evt: any) => void {\r\n    return (evt: any) => {\r\n      if (!this._paused) {\r\n        handler(evt);\r\n      }\r\n    };\r\n  }\r\n\r\n  public pause() {\r\n    this._paused = true;\r\n  }\r\n\r\n  public resume() {\r\n    this._paused = false;\r\n  }\r\n\r\n  public clear() {\r\n    for (const event in this._nativeHandlers) {\r\n      this.off(event);\r\n    }\r\n  }\r\n\r\n  constructor(public nativeComponent: T) {}\r\n}\r\n\r\nexport class BrowserEvents {\r\n  private _windowComponent: BrowserComponent<Window>;\r\n  private _documentComponent: BrowserComponent<Document>;\r\n  constructor(private _windowGlobal: Window, private _documentGlobal: Document) {\r\n    this._windowComponent = new BrowserComponent(this._windowGlobal);\r\n    this._documentComponent = new BrowserComponent(this._documentGlobal);\r\n  }\r\n\r\n  public get window(): BrowserComponent<Window> {\r\n    return this._windowComponent;\r\n  }\r\n\r\n  public get document(): BrowserComponent<Document> {\r\n    return this._documentComponent;\r\n  }\r\n\r\n  public pause() {\r\n    this.window.pause();\r\n    this.document.pause();\r\n  }\r\n\r\n  public resume() {\r\n    this.window.resume();\r\n    this.document.resume();\r\n  }\r\n\r\n  public clear() {\r\n    this.window.clear();\r\n    this.document.clear();\r\n  }\r\n}\r\n","import {\r\n  ExcaliburGraphicsContext,\r\n  LineGraphicsOptions,\r\n  PointGraphicsOptions,\r\n  ExcaliburGraphicsContextOptions,\r\n  DebugDraw,\r\n  HTMLImageSource\r\n} from './ExcaliburGraphicsContext';\r\nimport { Vector } from '../../Math/vector';\r\nimport { Color } from '../../Color';\r\nimport { StateStack } from './state-stack';\r\nimport { GraphicsDiagnostics } from '../GraphicsDiagnostics';\r\nimport { DebugText } from './debug-text';\r\nimport { Matrix } from '../../Math/matrix';\r\nimport { ScreenDimension } from '../../Screen';\r\nimport { PostProcessor } from '../PostProcessor/PostProcessor';\r\n\r\nclass ExcaliburGraphicsContext2DCanvasDebug implements DebugDraw {\r\n  private _debugText = new DebugText();\r\n  constructor(private _ex: ExcaliburGraphicsContext2DCanvas) {}\r\n  /**\r\n   * Draw a debug rectangle to the context\r\n   * @param x\r\n   * @param y\r\n   * @param width\r\n   * @param height\r\n   */\r\n  drawRect(x: number, y: number, width: number, height: number): void {\r\n    this._ex.__ctx.save();\r\n    this._ex.__ctx.strokeStyle = 'red';\r\n    this._ex.__ctx.strokeRect(\r\n      this._ex.snapToPixel ? ~~x : x,\r\n      this._ex.snapToPixel ? ~~y : y,\r\n      this._ex.snapToPixel ? ~~width : width,\r\n      this._ex.snapToPixel ? ~~height : height\r\n    );\r\n    this._ex.__ctx.restore();\r\n  }\r\n\r\n  drawLine(start: Vector, end: Vector, lineOptions: LineGraphicsOptions = { color: Color.Black }): void {\r\n    this._ex.__ctx.save();\r\n    this._ex.__ctx.beginPath();\r\n    this._ex.__ctx.strokeStyle = lineOptions.color.toString();\r\n    this._ex.__ctx.moveTo(this._ex.snapToPixel ? ~~start.x : start.x, this._ex.snapToPixel ? ~~start.y : start.y);\r\n    this._ex.__ctx.lineTo(this._ex.snapToPixel ? ~~end.x : end.x, this._ex.snapToPixel ? ~~end.y : end.y);\r\n    this._ex.__ctx.lineWidth = 2;\r\n    this._ex.__ctx.stroke();\r\n    this._ex.__ctx.closePath();\r\n    this._ex.__ctx.restore();\r\n  }\r\n\r\n  drawPoint(point: Vector, pointOptions: PointGraphicsOptions = { color: Color.Black, size: 5 }): void {\r\n    this._ex.__ctx.save();\r\n    this._ex.__ctx.beginPath();\r\n    this._ex.__ctx.fillStyle = pointOptions.color.toString();\r\n    this._ex.__ctx.arc(\r\n      this._ex.snapToPixel ? ~~point.x : point.x,\r\n      this._ex.snapToPixel ? ~~point.y : point.y,\r\n      pointOptions.size,\r\n      0,\r\n      Math.PI * 2\r\n    );\r\n    this._ex.__ctx.fill();\r\n    this._ex.__ctx.closePath();\r\n    this._ex.__ctx.restore();\r\n  }\r\n\r\n  drawText(text: string, pos: Vector) {\r\n    this._debugText.write(this._ex, text, pos);\r\n  }\r\n}\r\n\r\nexport class ExcaliburGraphicsContext2DCanvas implements ExcaliburGraphicsContext {\r\n  /**\r\n   * Meant for internal use only. Access the internal context at your own risk and no guarantees this will exist in the future.\r\n   * @internal\r\n   */\r\n  public __ctx: CanvasRenderingContext2D;\r\n  public get width() {\r\n    return this.__ctx.canvas.width;\r\n  }\r\n\r\n  public get height() {\r\n    return this.__ctx.canvas.height;\r\n  }\r\n\r\n  public backgroundColor: Color = Color.ExcaliburBlue;\r\n\r\n  private _state = new StateStack();\r\n\r\n  public get opacity(): number {\r\n    return this._state.current.opacity;\r\n  }\r\n\r\n  public set opacity(value: number) {\r\n    this._state.current.opacity = value;\r\n  }\r\n\r\n  public snapToPixel: boolean = true;\r\n\r\n  public get smoothing(): boolean {\r\n    return this.__ctx.imageSmoothingEnabled;\r\n  }\r\n\r\n  public set smoothing(value: boolean) {\r\n    this.__ctx.imageSmoothingEnabled = value;\r\n  }\r\n\r\n  constructor(options: ExcaliburGraphicsContextOptions) {\r\n    const { canvasElement, enableTransparency, snapToPixel, smoothing, backgroundColor } = options;\r\n    this.__ctx = canvasElement.getContext('2d', {\r\n      alpha: enableTransparency ?? true\r\n    });\r\n    this.backgroundColor = backgroundColor ?? this.backgroundColor;\r\n    this.snapToPixel = snapToPixel ?? this.snapToPixel;\r\n    this.smoothing = smoothing ?? this.smoothing;\r\n  }\r\n\r\n  public resetTransform(): void {\r\n    this.__ctx.resetTransform();\r\n  }\r\n\r\n  public updateViewport(_resolution: ScreenDimension): void {\r\n    // pass\r\n  }\r\n\r\n  /**\r\n   * Draw an image to the Excalibur Graphics context at an x and y coordinate using the images width and height\r\n   */\r\n  drawImage(image: HTMLImageSource, x: number, y: number): void;\r\n  /**\r\n   *\r\n   * Draw an image to the Excalibur Graphics context at an x and y coordinate with a specific width and height\r\n   */\r\n  drawImage(image: HTMLImageSource, x: number, y: number, width: number, height: number): void;\r\n  /**\r\n   *\r\n   * Draw an image to the Excalibur Graphics context specifying the source image coordinates (sx, sy, swidth, sheight)\r\n   * and to a specific destination on the context (dx, dy, dwidth, dheight)\r\n   */\r\n  drawImage(\r\n    image: HTMLImageSource,\r\n    sx: number,\r\n    sy: number,\r\n    swidth?: number,\r\n    sheight?: number,\r\n    dx?: number,\r\n    dy?: number,\r\n    dwidth?: number,\r\n    dheight?: number\r\n  ): void;\r\n\r\n  drawImage(\r\n    image: HTMLImageSource,\r\n    sx: number,\r\n    sy: number,\r\n    swidth?: number,\r\n    sheight?: number,\r\n    dx?: number,\r\n    dy?: number,\r\n    dwidth?: number,\r\n    dheight?: number\r\n  ): void {\r\n    if (swidth === 0 || sheight === 0) {\r\n      return; // zero dimension dest exit early\r\n    } else if (dwidth === 0 || dheight === 0) {\r\n      return; // zero dimension dest exit early\r\n    } else if (image.width === 0 || image.height === 0) {\r\n      return; // zero dimension source exit early\r\n    }\r\n\r\n    this.__ctx.globalAlpha = this.opacity;\r\n    const args = [image, sx, sy, swidth, sheight, dx, dy, dwidth, dheight]\r\n      .filter((a) => a !== undefined)\r\n      .map((a) => (typeof a === 'number' && this.snapToPixel ? ~~a : a));\r\n    this.__ctx.drawImage.apply(this.__ctx, args);\r\n    GraphicsDiagnostics.DrawCallCount++;\r\n    GraphicsDiagnostics.DrawnImagesCount = 1;\r\n  }\r\n\r\n  public drawLine(start: Vector, end: Vector, color: Color, thickness = 1) {\r\n    this.__ctx.save();\r\n    this.__ctx.beginPath();\r\n    this.__ctx.strokeStyle = color.toString();\r\n    this.__ctx.moveTo(this.snapToPixel ? ~~start.x : start.x, this.snapToPixel ? ~~start.y : start.y);\r\n    this.__ctx.lineTo(this.snapToPixel ? ~~end.x : end.x, this.snapToPixel ? ~~end.y : end.y);\r\n    this.__ctx.lineWidth = thickness;\r\n    this.__ctx.stroke();\r\n    this.__ctx.closePath();\r\n    this.__ctx.restore();\r\n  }\r\n\r\n  public drawRectangle(pos: Vector, width: number, height: number, color: Color) {\r\n    this.__ctx.save();\r\n    this.__ctx.fillStyle = color.toString();\r\n    this.__ctx.fillRect(\r\n      this.snapToPixel ? ~~pos.x : pos.x,\r\n      this.snapToPixel ? ~~pos.y : pos.y,\r\n      this.snapToPixel ? ~~width : width,\r\n      this.snapToPixel ? ~~height : height\r\n    );\r\n    this.__ctx.restore();\r\n  }\r\n\r\n  public drawCircle(pos: Vector, radius: number, color: Color, stroke?: Color, thickness?: number) {\r\n    this.__ctx.save();\r\n    this.__ctx.beginPath();\r\n    if (stroke) {\r\n      this.__ctx.strokeStyle = stroke.toString();\r\n    }\r\n    if (thickness) {\r\n      this.__ctx.lineWidth = thickness;\r\n    }\r\n    this.__ctx.fillStyle = color.toString();\r\n    this.__ctx.arc(this.snapToPixel ? ~~pos.x : pos.x, this.snapToPixel ? ~~pos.y : pos.y, radius, 0, Math.PI * 2);\r\n    this.__ctx.fill();\r\n    if (stroke) {\r\n      this.__ctx.stroke();\r\n    }\r\n    this.__ctx.closePath();\r\n    this.__ctx.restore();\r\n  }\r\n\r\n  debug = new ExcaliburGraphicsContext2DCanvasDebug(this);\r\n\r\n  /**\r\n   * Save the current state of the canvas to the stack (transforms and opacity)\r\n   */\r\n  save(): void {\r\n    this.__ctx.save();\r\n  }\r\n\r\n  /**\r\n   * Restore the state of the canvas from the stack\r\n   */\r\n  restore(): void {\r\n    this.__ctx.restore();\r\n  }\r\n\r\n  /**\r\n   * Translate the origin of the context by an x and y\r\n   * @param x\r\n   * @param y\r\n   */\r\n  translate(x: number, y: number): void {\r\n    this.__ctx.translate(this.snapToPixel ? ~~x : x, this.snapToPixel ? ~~y : y);\r\n  }\r\n\r\n  /**\r\n   * Rotate the context about the current origin\r\n   */\r\n  rotate(angle: number): void {\r\n    this.__ctx.rotate(angle);\r\n  }\r\n\r\n  /**\r\n   * Scale the context by an x and y factor\r\n   * @param x\r\n   * @param y\r\n   */\r\n  scale(x: number, y: number): void {\r\n    this.__ctx.scale(x, y);\r\n  }\r\n\r\n  public getTransform(): Matrix {\r\n    throw new Error('Not implemented');\r\n  }\r\n\r\n  public multiply(_m: Matrix): void {\r\n    this.__ctx.setTransform(this.__ctx.getTransform().multiply(_m.toDOMMatrix()));\r\n  }\r\n\r\n  public addPostProcessor(_postprocessor: PostProcessor) {\r\n    throw Error('Not implemented');\r\n  }\r\n\r\n  public removePostProcessor(_postprocessor: PostProcessor) {\r\n    throw Error('Not implemented');\r\n  }\r\n\r\n  public clearPostProcessors() {\r\n    throw Error('Not implemented');\r\n  }\r\n\r\n  public beginDrawLifecycle() {\r\n    // pass\r\n  }\r\n\r\n  public endDrawLifecycle() {\r\n    // pass\r\n  }\r\n\r\n  clear(): void {\r\n    // Clear frame\r\n    this.__ctx.clearRect(0, 0, this.width, this.height);\r\n    this.__ctx.fillStyle = this.backgroundColor.toString();\r\n    this.__ctx.fillRect(0, 0, this.width, this.height);\r\n    GraphicsDiagnostics.clear();\r\n  }\r\n\r\n  /**\r\n   * Flushes the batched draw calls to the screen\r\n   */\r\n  flush(): void {\r\n    // pass\r\n  }\r\n}\r\n","import { Engine } from '../Engine';\r\nimport { Vector } from './vector';\r\n\r\nexport class GlobalCoordinates {\r\n  public static fromPagePosition(x: number, y: number, engine: Engine): GlobalCoordinates;\r\n  public static fromPagePosition(pos: Vector, engine: Engine): GlobalCoordinates;\r\n  public static fromPagePosition(xOrPos: number | Vector, yOrEngine: number | Engine, engineOrUndefined?: Engine): GlobalCoordinates {\r\n    let pageX: number;\r\n    let pageY: number;\r\n    let pagePos: Vector;\r\n    let engine: Engine;\r\n\r\n    if (arguments.length === 3) {\r\n      pageX = <number>xOrPos;\r\n      pageY = <number>yOrEngine;\r\n      pagePos = new Vector(pageX, pageY);\r\n      engine = engineOrUndefined;\r\n    } else {\r\n      pagePos = <Vector>xOrPos;\r\n      pageX = pagePos.x;\r\n      pageY = pagePos.y;\r\n      engine = <Engine>yOrEngine;\r\n    }\r\n\r\n    const screenPos = engine.screen.pageToScreenCoordinates(pagePos);\r\n    const worldPos = engine.screen.screenToWorldCoordinates(screenPos);\r\n\r\n    return new GlobalCoordinates(worldPos, pagePos, screenPos);\r\n  }\r\n\r\n  constructor(public worldPos: Vector, public pagePos: Vector, public screenPos: Vector) {}\r\n}\r\n","import { GlobalCoordinates } from '../Math/global-coordinates';\r\nimport { Vector } from '../Math/vector';\r\nimport { PointerButton } from './PointerButton';\r\nimport { PointerType } from './PointerType';\r\n\r\nexport class PointerEvent {\r\n  public active = true;\r\n  public cancel() {\r\n    this.active = false;\r\n  }\r\n\r\n  get pagePos(): Vector {\r\n    return this.coordinates.pagePos;\r\n  }\r\n\r\n  get screenPos(): Vector {\r\n    return this.coordinates.screenPos;\r\n  }\r\n\r\n  get worldPos(): Vector {\r\n    return this.coordinates.worldPos;\r\n  }\r\n\r\n  constructor(\r\n    public type: 'down' | 'up' | 'move' | 'cancel',\r\n    public pointerId: number,\r\n    public button: PointerButton,\r\n    public pointerType: PointerType,\r\n    public coordinates: GlobalCoordinates,\r\n    public nativeEvent: Event) { };\r\n}\r\n","import { WheelDeltaMode } from './WheelDeltaMode';\r\n\r\n\r\nexport class WheelEvent {\r\n  public active = true;\r\n  public cancel() {\r\n    this.active = false;\r\n  }\r\n  constructor(\r\n    public x: number,\r\n    public y: number,\r\n    public pageX: number,\r\n    public pageY: number,\r\n    public screenX: number,\r\n    public screenY: number,\r\n    public index: number,\r\n    public deltaX: number,\r\n    public deltaY: number,\r\n    public deltaZ: number,\r\n    public deltaMode: WheelDeltaMode,\r\n    public ev: Event\r\n  ) { }\r\n}\r\n","import { Class } from '../Class';\r\nimport { Vector } from '../Math/vector';\r\nimport { WheelEvent } from './WheelEvent';\r\nimport { PointerEvent } from './PointerEvent';\r\n\r\nexport class PointerAbstraction extends Class {\r\n\r\n  /**\r\n   * The last position on the document this pointer was at. Can be `null` if pointer was never active.\r\n   */\r\n  public lastPagePos: Vector = Vector.Zero;\r\n\r\n  /**\r\n   * The last position on the screen this pointer was at. Can be `null` if pointer was never active.\r\n   */\r\n  public lastScreenPos: Vector = Vector.Zero;\r\n\r\n  /**\r\n   * The last position in the game world coordinates this pointer was at. Can be `null` if pointer was never active.\r\n   */\r\n  public lastWorldPos: Vector = Vector.Zero;\r\n\r\n  constructor() {\r\n    super();\r\n    this.on('move', this._onPointerMove);\r\n    this.on('down', this._onPointerDown);\r\n  }\r\n\r\n  on(event: 'move', handler: (event: PointerEvent) => void): void;\r\n  on(event: 'down', handler: (event: PointerEvent) => void): void;\r\n  on(event: 'up', handler: (event: PointerEvent) => void): void;\r\n  on(event: 'wheel', handler: (event: WheelEvent) => void): void;\r\n  on(event: string, handler: (event: any) => void): void {\r\n    super.on(event, handler);\r\n  }\r\n\r\n  once(event: 'move', handler: (event: PointerEvent) => void): void;\r\n  once(event: 'down', handler: (event: PointerEvent) => void): void;\r\n  once(event: 'up', handler: (event: PointerEvent) => void): void;\r\n  once(event: 'wheel', handler: (event: WheelEvent) => void): void;\r\n  once(event: string, handler: (event: any) => void): void {\r\n    super.once(event, handler);\r\n  }\r\n\r\n  off(event: 'move', handler?: (event: PointerEvent) => void): void;\r\n  off(event: 'down', handler?: (event: PointerEvent) => void): void;\r\n  off(event: 'up', handler?: (event: PointerEvent) => void): void;\r\n  off(event: 'wheel', handler?: (event: WheelEvent) => void): void;\r\n  off(event: string, handler?: (event: any) => void): void {\r\n    super.off(event, handler);\r\n  }\r\n\r\n  private _onPointerMove = (ev: PointerEvent): void => {\r\n    this.lastPagePos = new Vector(ev.pagePos.x, ev.pagePos.y);\r\n    this.lastScreenPos = new Vector(ev.screenPos.x, ev.screenPos.y);\r\n    this.lastWorldPos = new Vector(ev.worldPos.x, ev.worldPos.y);\r\n  };\r\n\r\n  private _onPointerDown = (ev: PointerEvent): void => {\r\n    this.lastPagePos = new Vector(ev.pagePos.x, ev.pagePos.y);\r\n    this.lastScreenPos = new Vector(ev.screenPos.x, ev.screenPos.y);\r\n    this.lastWorldPos = new Vector(ev.worldPos.x, ev.worldPos.y);\r\n  };\r\n}\r\n","\r\nexport enum WheelDeltaMode {\r\n  Pixel = 'Pixel',\r\n  Line = 'Line',\r\n  Page = 'Page'\r\n}\r\n","/**\r\n * Native browser button enumeration\r\n */\r\nexport enum NativePointerButton {\r\n  NoButton = -1,\r\n  Left = 0,\r\n  Middle = 1,\r\n  Right = 2,\r\n  Unknown = 3\r\n}\r\n","/**\r\n * The mouse button being pressed.\r\n */\r\nexport enum PointerButton {\r\n  Left = 'Left',\r\n  Middle = 'Middle',\r\n  Right = 'Right',\r\n  Unknown = 'Unknown',\r\n  NoButton = 'NoButton'\r\n}\r\n","/**\r\n * The type of pointer for a [[PointerEvent]].\r\n */\r\nexport enum PointerType {\r\n  Touch = 'Touch',\r\n  Mouse = 'Mouse',\r\n  Pen = 'Pen',\r\n  Unknown = 'Unknown'\r\n}\r\n","import { Class } from '../Class';\r\nimport { Engine, ScrollPreventionMode } from '../Engine';\r\nimport { GlobalCoordinates } from '../Math/global-coordinates';\r\nimport { vec, Vector } from '../Math/vector';\r\nimport { PointerEvent } from './PointerEvent';\r\nimport { WheelEvent } from './WheelEvent';\r\nimport { PointerAbstraction } from './PointerAbstraction';\r\n\r\nimport { WheelDeltaMode } from './WheelDeltaMode';\r\nimport { PointerSystem } from './PointerSystem';\r\nimport { NativePointerButton } from './NativePointerButton';\r\nimport { PointerButton } from './PointerButton';\r\nimport { Util } from '..';\r\nimport { PointerType } from './PointerType';\r\n\r\n\r\nexport type NativePointerEvent = globalThis.PointerEvent;\r\nexport type NativeMouseEvent = globalThis.MouseEvent;\r\nexport type NativeTouchEvent = globalThis.TouchEvent;\r\nexport type NativeWheelEvent = globalThis.WheelEvent;\r\n\r\n/**\r\n * Is this event a native touch event?\r\n */\r\nfunction isTouchEvent(value: any): value is NativeTouchEvent {\r\n  // Guard for Safari <= 13.1\r\n  return globalThis.TouchEvent && value instanceof globalThis.TouchEvent;\r\n}\r\n\r\n/**\r\n * Is this event a native pointer event\r\n */\r\nfunction isPointerEvent(value: any): value is NativePointerEvent {\r\n  // Guard for Safari <= 13.1\r\n  return globalThis.PointerEvent && value instanceof globalThis.PointerEvent;\r\n}\r\n\r\n/**\r\n * The PointerEventProcessor is responsible for collecting all the events from the canvas and transforming them into GlobalCoordinates\r\n */\r\nexport class PointerEventReceiver extends Class {\r\n  public primary: PointerAbstraction = new PointerAbstraction();\r\n\r\n  private _activeNativePointerIdsToNormalized = new Map<number, number>();\r\n  public lastFramePointerCoords = new Map<number, GlobalCoordinates>();\r\n  public currentFramePointerCoords = new Map<number, GlobalCoordinates>();\r\n\r\n  public currentFramePointerDown = new Map<number, boolean>();\r\n  public lastFramePointerDown = new Map<number, boolean>();\r\n\r\n  public currentFrameDown: PointerEvent[] = [];\r\n  public currentFrameUp: PointerEvent[] = [];\r\n  public currentFrameMove: PointerEvent[] = [];\r\n  public currentFrameCancel: PointerEvent[] = [];\r\n  public currentFrameWheel: WheelEvent[] = [];\r\n\r\n  constructor(public readonly target: GlobalEventHandlers & EventTarget, public engine: Engine) {\r\n    super();\r\n  }\r\n\r\n  private _pointers: PointerAbstraction[] = [this.primary];\r\n  /**\r\n   * Locates a specific pointer by id, creates it if it doesn't exist\r\n   * @param index\r\n   */\r\n  public at(index: number): PointerAbstraction {\r\n    if (index >= this._pointers.length) {\r\n      // Ensure there is a pointer to retrieve\r\n      for (let i = this._pointers.length - 1, max = index; i < max; i++) {\r\n        this._pointers.push(new PointerAbstraction());\r\n      }\r\n    }\r\n    return this._pointers[index];\r\n  }\r\n\r\n  /**\r\n   * The number of pointers currently being tracked by excalibur\r\n   */\r\n  public count(): number {\r\n    return this._pointers.length;\r\n  }\r\n\r\n  /**\r\n   * Is the specified pointer id down this frame\r\n   * @param pointerId\r\n   */\r\n  public isDown(pointerId: number) {\r\n    return this.currentFramePointerDown.get(pointerId) ?? false;\r\n  }\r\n\r\n  /**\r\n   * Was the specified pointer id down last frame\r\n   * @param pointerId\r\n   */\r\n  public wasDown(pointerId: number) {\r\n    return this.lastFramePointerDown.get(pointerId) ?? false;\r\n  }\r\n\r\n  /**\r\n   * Whether the Pointer is currently dragging.\r\n   */\r\n  public isDragging(pointerId: number): boolean {\r\n    return this.isDown(pointerId);\r\n  }\r\n\r\n  /**\r\n   * Whether the Pointer just started dragging.\r\n   */\r\n  public isDragStart(pointerId: number): boolean {\r\n    return this.isDown(pointerId) && !this.wasDown(pointerId);\r\n  }\r\n\r\n  /**\r\n   * Whether the Pointer just ended dragging.\r\n   */\r\n  public isDragEnd(pointerId: number): boolean {\r\n    return !this.isDown(pointerId) && this.wasDown(pointerId);\r\n  }\r\n\r\n  on(event: 'move', handler: (event: PointerEvent) => void): void;\r\n  on(event: 'down', handler: (event: PointerEvent) => void): void;\r\n  on(event: 'up', handler: (event: PointerEvent) => void): void;\r\n  on(event: 'wheel', handler: (event: WheelEvent) => void): void;\r\n  on(event: string, handler: (event: any) => void): void {\r\n    super.on(event, handler);\r\n  }\r\n\r\n  once(event: 'move', handler: (event: PointerEvent) => void): void;\r\n  once(event: 'down', handler: (event: PointerEvent) => void): void;\r\n  once(event: 'up', handler: (event: PointerEvent) => void): void;\r\n  once(event: 'wheel', handler: (event: WheelEvent) => void): void;\r\n  once(event: string, handler: (event: any) => void): void {\r\n    super.once(event, handler);\r\n  }\r\n\r\n  off(event: 'move', handler?: (event: PointerEvent) => void): void;\r\n  off(event: 'down', handler?: (event: PointerEvent) => void): void;\r\n  off(event: 'up', handler?: (event: PointerEvent) => void): void;\r\n  off(event: 'wheel', handler?: (event: WheelEvent) => void): void;\r\n  off(event: string, handler?: (event: any) => void): void {\r\n    super.off(event, handler);\r\n  }\r\n\r\n  /**\r\n   * Called internally by excalibur\r\n   *\r\n   * Updates the current frame pointer info and emits raw pointer events\r\n   *\r\n   * This does not emit events to entities, see PointerSystem\r\n   */\r\n  public update() {\r\n    this.lastFramePointerDown = new Map(this.currentFramePointerDown);\r\n    this.lastFramePointerCoords = new Map(this.currentFramePointerCoords);\r\n\r\n    for (const event of this.currentFrameDown) {\r\n      this.emit('down', event);\r\n      const pointer = this.at(event.pointerId);\r\n      pointer.emit('down', event);\r\n      this.primary.emit('pointerdown', event);\r\n    }\r\n\r\n    for (const event of this.currentFrameUp) {\r\n      this.emit('up', event);\r\n      const pointer = this.at(event.pointerId);\r\n      pointer.emit('up', event);\r\n    }\r\n\r\n    for (const event of this.currentFrameMove) {\r\n      this.emit('move', event);\r\n      const pointer = this.at(event.pointerId);\r\n      pointer.emit('move', event);\r\n    }\r\n\r\n    for (const event of this.currentFrameCancel) {\r\n      this.emit('cancel', event);\r\n      const pointer = this.at(event.pointerId);\r\n      pointer.emit('cancel', event);\r\n    }\r\n\r\n    for (const event of this.currentFrameWheel) {\r\n      this.emit('wheel', event);\r\n      this.primary.emit('pointerwheel', event);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clears the current frame event and pointer data\r\n   */\r\n  public clear() {\r\n    for (const event of this.currentFrameUp) {\r\n      this.currentFramePointerCoords.delete(event.pointerId);\r\n      const ids = this._activeNativePointerIdsToNormalized.entries();\r\n      for (const [native, normalized] of ids) {\r\n        if (normalized === event.pointerId) {\r\n          this._activeNativePointerIdsToNormalized.delete(native);\r\n        }\r\n      }\r\n    }\r\n    this.currentFrameDown.length = 0;\r\n    this.currentFrameUp.length = 0;\r\n    this.currentFrameMove.length = 0;\r\n    this.currentFrameCancel.length = 0;\r\n    this.currentFrameWheel.length = 0;\r\n  }\r\n\r\n  private _boundHandle = this._handle.bind(this);\r\n  private _boundWheel = this._handleWheel.bind(this);\r\n  /**\r\n   * Initializes the pointer event receiver so that it can start listening to native\r\n   * browser events.\r\n   */\r\n  public init() {\r\n    // Disabling the touch action avoids browser/platform gestures from firing on the canvas\r\n    // It is important on mobile to have touch action 'none'\r\n    // https://stackoverflow.com/questions/48124372/pointermove-event-not-working-with-touch-why-not\r\n    if (this.target === this.engine.canvas) {\r\n      this.engine.canvas.style.touchAction = 'none';\r\n    } else {\r\n      document.body.style.touchAction = 'none';\r\n    }\r\n    // Preferred pointer events\r\n    if (window.PointerEvent) {\r\n      this.target.addEventListener('pointerdown', this._boundHandle);\r\n      this.target.addEventListener('pointerup', this._boundHandle);\r\n      this.target.addEventListener('pointermove', this._boundHandle);\r\n      this.target.addEventListener('pointercancel', this._boundHandle);\r\n    } else {\r\n      // Touch Events\r\n      this.target.addEventListener('touchstart', this._boundHandle);\r\n      this.target.addEventListener('touchend', this._boundHandle);\r\n      this.target.addEventListener('touchmove', this._boundHandle);\r\n      this.target.addEventListener('touchcancel', this._boundHandle);\r\n\r\n      // Mouse Events\r\n      this.target.addEventListener('mousedown', this._boundHandle);\r\n      this.target.addEventListener('mouseup', this._boundHandle);\r\n      this.target.addEventListener('mousemove', this._boundHandle);\r\n    }\r\n\r\n    // MDN MouseWheelEvent\r\n    const wheelOptions = {\r\n      passive: !(\r\n        this.engine.pageScrollPreventionMode === ScrollPreventionMode.All ||\r\n        this.engine.pageScrollPreventionMode === ScrollPreventionMode.Canvas\r\n      )\r\n    };\r\n    if ('onwheel' in document.createElement('div')) {\r\n      // Modern Browsers\r\n      this.target.addEventListener('wheel', this._boundWheel, wheelOptions);\r\n    } else if (document.onmousewheel !== undefined) {\r\n      // Webkit and IE\r\n      this.target.addEventListener('mousewheel', this._boundWheel, wheelOptions);\r\n    } else {\r\n      // Remaining browser and older Firefox\r\n      this.target.addEventListener('MozMousePixelScroll', this._boundWheel, wheelOptions);\r\n    }\r\n  }\r\n\r\n  public detach() {\r\n    // Preferred pointer events\r\n    if (window.PointerEvent) {\r\n      this.target.removeEventListener('pointerdown', this._boundHandle);\r\n      this.target.removeEventListener('pointerup', this._boundHandle);\r\n      this.target.removeEventListener('pointermove', this._boundHandle);\r\n      this.target.removeEventListener('pointercancel', this._boundHandle);\r\n    } else {\r\n      // Touch Events\r\n      this.target.removeEventListener('touchstart', this._boundHandle);\r\n      this.target.removeEventListener('touchend', this._boundHandle);\r\n      this.target.removeEventListener('touchmove', this._boundHandle);\r\n      this.target.removeEventListener('touchcancel', this._boundHandle);\r\n\r\n      // Mouse Events\r\n      this.target.removeEventListener('mousedown', this._boundHandle);\r\n      this.target.removeEventListener('mouseup', this._boundHandle);\r\n      this.target.removeEventListener('mousemove', this._boundHandle);\r\n    }\r\n\r\n    if ('onwheel' in document.createElement('div')) {\r\n      // Modern Browsers\r\n      this.target.removeEventListener('wheel', this._boundWheel);\r\n    } else if (document.onmousewheel !== undefined) {\r\n      // Webkit and IE\r\n      this.target.addEventListener('mousewheel', this._boundWheel);\r\n    } else {\r\n      // Remaining browser and older Firefox\r\n      this.target.addEventListener('MozMousePixelScroll', this._boundWheel);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Take native pointer id and map it to index in active pointers\r\n   * @param nativePointerId\r\n   */\r\n  private _normalizePointerId(nativePointerId: number) {\r\n    // Add to the the native pointer set id\r\n    this._activeNativePointerIdsToNormalized.set(nativePointerId, -1);\r\n\r\n    // Native pointer ids in ascending order\r\n    const currentPointerIds = Array.from(this._activeNativePointerIdsToNormalized.keys()).sort((a, b) => a - b);\r\n\r\n    // The index into sorted ids will be the new id, will always have an id\r\n    const id = currentPointerIds.findIndex(p => p === nativePointerId);\r\n\r\n    // Save the mapping so we can reverse it later\r\n    this._activeNativePointerIdsToNormalized.set(nativePointerId, id);\r\n\r\n    // ignore pointer because game isn't watching\r\n    return id;\r\n  }\r\n\r\n  /**\r\n   * Responsible for handling and parsing pointer events\r\n   */\r\n  private _handle(ev: NativeTouchEvent | NativePointerEvent | NativeMouseEvent) {\r\n    ev.preventDefault();\r\n    const eventCoords = new Map<number, GlobalCoordinates>();\r\n    let button: PointerButton;\r\n    let pointerType: PointerType;\r\n    if (isTouchEvent(ev)) {\r\n      button = PointerButton.Unknown;\r\n      pointerType = PointerType.Touch;\r\n      // https://developer.mozilla.org/en-US/docs/Web/API/TouchEvent\r\n      for (let i = 0; i < ev.changedTouches.length; i++) {\r\n        const touch = ev.changedTouches[i];\r\n        const coordinates = GlobalCoordinates.fromPagePosition(touch.pageX, touch.pageY, this.engine);\r\n        const nativePointerId = i + 1;\r\n        const pointerId = this._normalizePointerId(nativePointerId);\r\n        this.currentFramePointerCoords.set(pointerId, coordinates);\r\n        eventCoords.set(pointerId, coordinates);\r\n      }\r\n    } else {\r\n      button = this._nativeButtonToPointerButton(ev.button);\r\n      pointerType = PointerType.Mouse;\r\n      const coordinates = GlobalCoordinates.fromPagePosition(ev.pageX, ev.pageY, this.engine);\r\n      let nativePointerId = 1;\r\n      if (isPointerEvent(ev)) {\r\n        nativePointerId = ev.pointerId;\r\n        pointerType = this._stringToPointerType(ev.pointerType);\r\n      }\r\n      const pointerId = this._normalizePointerId(nativePointerId);\r\n      this.currentFramePointerCoords.set(pointerId, coordinates);\r\n      eventCoords.set(pointerId, coordinates);\r\n    }\r\n\r\n    for (const [pointerId, coord] of eventCoords.entries()) {\r\n      switch (ev.type) {\r\n        case 'mousedown':\r\n        case 'pointerdown':\r\n        case 'touchstart':\r\n          this.currentFrameDown.push(new PointerEvent('down', pointerId, button, pointerType, coord, ev));\r\n          this.currentFramePointerDown.set(pointerId, true);\r\n          break;\r\n        case 'mouseup':\r\n        case 'pointerup':\r\n        case 'touchend':\r\n          this.currentFrameUp.push(new PointerEvent('up', pointerId, button, pointerType, coord, ev));\r\n          this.currentFramePointerDown.set(pointerId, false);\r\n          break;\r\n        case 'mousemove':\r\n        case 'pointermove':\r\n        case 'touchmove':\r\n          this.currentFrameMove.push(new PointerEvent('move', pointerId, button, pointerType, coord, ev));\r\n          break;\r\n        case 'touchcancel':\r\n        case 'pointercancel':\r\n          this.currentFrameCancel.push(new PointerEvent('cancel', pointerId, button, pointerType, coord, ev));\r\n          break;\r\n      }\r\n    }\r\n  }\r\n\r\n  private _handleWheel(ev: NativeWheelEvent) {\r\n    // Should we prevent page scroll because of this event\r\n    if (\r\n      this.engine.pageScrollPreventionMode === ScrollPreventionMode.All ||\r\n      (this.engine.pageScrollPreventionMode === ScrollPreventionMode.Canvas && ev.target === this.engine.canvas)\r\n    ) {\r\n      ev.preventDefault();\r\n    }\r\n    const screen = this.engine.screen.pageToScreenCoordinates(vec(ev.pageX, ev.pageY));\r\n    const world = this.engine.screen.screenToWorldCoordinates(screen);\r\n\r\n    /**\r\n     * A constant used to normalize wheel events across different browsers\r\n     *\r\n     * This normalization factor is pulled from\r\n     * https://developer.mozilla.org/en-US/docs/Web/Events/wheel#Listening_to_this_event_across_browser\r\n     */\r\n    const ScrollWheelNormalizationFactor = -1 / 40;\r\n\r\n    const deltaX = ev.deltaX || ev.wheelDeltaX * ScrollWheelNormalizationFactor || 0;\r\n    const deltaY =\r\n        ev.deltaY || ev.wheelDeltaY * ScrollWheelNormalizationFactor || ev.wheelDelta * ScrollWheelNormalizationFactor || ev.detail || 0;\r\n    const deltaZ = ev.deltaZ || 0;\r\n    let deltaMode = WheelDeltaMode.Pixel;\r\n\r\n    if (ev.deltaMode) {\r\n      if (ev.deltaMode === 1) {\r\n        deltaMode = WheelDeltaMode.Line;\r\n      } else if (ev.deltaMode === 2) {\r\n        deltaMode = WheelDeltaMode.Page;\r\n      }\r\n    }\r\n\r\n    const we = new WheelEvent(world.x, world.y, ev.pageX, ev.pageY, screen.x, screen.y, 0, deltaX, deltaY, deltaZ, deltaMode, ev);\r\n    this.currentFrameWheel.push(we);\r\n  }\r\n\r\n  /**\r\n   * Triggers an excalibur pointer event in a world space pos\r\n   *\r\n   * Useful for testing pointers in excalibur\r\n   * @param type\r\n   * @param pos\r\n   */\r\n  public triggerEvent(type: 'down' | 'up' | 'move' | 'cancel', pos: Vector) {\r\n    const page = this.engine.screen.worldToPageCoordinates(pos);\r\n    // Send an event to the event receiver\r\n    if (window.PointerEvent) {\r\n      this._handle(new window.PointerEvent('pointer' + type, {\r\n        pointerId: 0,\r\n        clientX: page.x,\r\n        clientY: page.y\r\n      }));\r\n    } else {\r\n      // Safari hack\r\n      this._handle(new window.MouseEvent('mouse' + type, {\r\n        clientX: page.x,\r\n        clientY: page.y\r\n      }));\r\n    }\r\n\r\n    // Force update pointer system\r\n    const pointerSystem = this.engine.currentScene.world.systemManager.get(PointerSystem);\r\n    const transformEntities = this.engine.currentScene.world.queryManager.createQuery(pointerSystem.types);\r\n    pointerSystem.update(transformEntities.getEntities());\r\n  }\r\n\r\n  private _nativeButtonToPointerButton(s: NativePointerButton): PointerButton {\r\n    switch (s) {\r\n      case NativePointerButton.NoButton:\r\n        return PointerButton.NoButton;\r\n      case NativePointerButton.Left:\r\n        return PointerButton.Left;\r\n      case NativePointerButton.Middle:\r\n        return PointerButton.Middle;\r\n      case NativePointerButton.Right:\r\n        return PointerButton.Right;\r\n      case NativePointerButton.Unknown:\r\n        return PointerButton.Unknown;\r\n      default:\r\n        return Util.fail(s);\r\n    }\r\n  }\r\n\r\n  private _stringToPointerType(s: string) {\r\n    switch (s) {\r\n      case 'touch':\r\n        return PointerType.Touch;\r\n      case 'mouse':\r\n        return PointerType.Mouse;\r\n      case 'pen':\r\n        return PointerType.Pen;\r\n      default:\r\n        return PointerType.Unknown;\r\n    }\r\n  }\r\n}","export interface FpsSamplerOptions {\r\n  /**\r\n   * Specify the sampling period in milliseconds (default 100)\r\n   */\r\n  samplePeriod?: number;\r\n  /**\r\n   * Specify the initial FPS\r\n   */\r\n  initialFps: number;\r\n\r\n  /**\r\n   * Specify the function used to return the current time (in milliseconds)\r\n   */\r\n  nowFn: () => number;\r\n}\r\n\r\nexport class FpsSampler {\r\n  private _fps: number;\r\n  private _samplePeriod: number = 100;\r\n  private _currentFrameTime: number = 0;\r\n  private _frames: number = 0;\r\n  private _previousSampleTime: number = 0;\r\n  private _beginFrameTime: number = 0;\r\n  private _nowFn: () => number;\r\n\r\n  constructor(options: FpsSamplerOptions) {\r\n    this._fps = options.initialFps;\r\n    this._samplePeriod = options.samplePeriod ?? this._samplePeriod;\r\n    this._currentFrameTime = 1000/options.initialFps;\r\n    this._nowFn = options.nowFn;\r\n    this._previousSampleTime = this._nowFn();\r\n  }\r\n\r\n  /**\r\n   * Start of code block to sample FPS for\r\n   */\r\n  start() {\r\n    this._beginFrameTime = this._nowFn();\r\n  }\r\n\r\n  /**\r\n   * End of code block to sample FPS for\r\n   */\r\n  end() {\r\n    this._frames++;\r\n    const time = this._nowFn();\r\n\r\n    this._currentFrameTime = time - this._beginFrameTime;\r\n\r\n    if (time >= this._previousSampleTime + this._samplePeriod) {\r\n      this._fps = (this._frames * 1000) / (time - this._previousSampleTime);\r\n      this._previousSampleTime = time;\r\n      this._frames = 0;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Return the currently sampled fps over the last sample period, by default every 100ms\r\n   */\r\n  get fps() {\r\n    return this._fps;\r\n  }\r\n\r\n  /**\r\n   * Return the instantaneous fps, this can be less useful because it will fluctuate given the current frames time\r\n   */\r\n  get instant() {\r\n    return 1000 / this._currentFrameTime;\r\n  }\r\n}","import { Logger } from '..';\r\nimport { FpsSampler } from './Fps';\r\n\r\nexport interface ClockOptions {\r\n  /**\r\n   * Define the function you'd like the clock to tick when it is started\r\n   */\r\n  tick: (elapsedMs: number) => any;\r\n  /**\r\n   * Optionally define the fatal exception handler, used if an error is thrown in tick\r\n   */\r\n  onFatalException?: (e: unknown) => any;\r\n  /**\r\n   * Optionally limit the maximum FPS of the clock\r\n   */\r\n  maxFps?: number;\r\n}\r\n\r\n\r\n/**\r\n * Abstract Clock is the base type of all Clocks\r\n *\r\n * It has a few opinions\r\n * 1. It manages the calculation of what \"elapsed\" time means and thus maximum fps\r\n * 2. The default timing api is implemented in now()\r\n *\r\n * To implement your own clock, extend Clock and override start/stop to start and stop the clock, then call update() with whatever\r\n * method is unique to your clock implementation.\r\n */\r\nexport abstract class Clock {\r\n  protected tick: (elapsedMs: number) => any;\r\n  private _onFatalException: (e: unknown) => any = () => { /* default nothing */ };\r\n  private _maxFps: number = Infinity;\r\n  private _lastTime: number = 0;\r\n  public fpsSampler: FpsSampler;\r\n  private _options: ClockOptions;\r\n  private _elapsed: number = 1;\r\n  private _scheduledCbs: [cb: () => any, scheduledTime: number][] = [];\r\n  private _totalElapsed: number = 0;\r\n  constructor(options: ClockOptions) {\r\n    this._options = options;\r\n    this.tick = options.tick;\r\n    this._lastTime = this.now() ?? 0;\r\n    this._maxFps = options.maxFps ?? this._maxFps;\r\n    this._onFatalException = options.onFatalException ?? this._onFatalException;\r\n    this.fpsSampler = new FpsSampler({\r\n      initialFps: 60,\r\n      nowFn: () => this.now()\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Get the elapsed time for the last completed frame\r\n   */\r\n  public elapsed(): number {\r\n    return this._elapsed;\r\n  }\r\n\r\n  /**\r\n   * Get the current time in milliseconds\r\n   */\r\n  public now(): number {\r\n    return performance.now();\r\n  }\r\n\r\n  public toTestClock() {\r\n    const testClock = new TestClock({\r\n      ...this._options,\r\n      defaultUpdateMs: 16.6\r\n    });\r\n    return testClock;\r\n  }\r\n\r\n  public toStandardClock() {\r\n    const clock = new StandardClock({\r\n      ...this._options\r\n    });\r\n    return clock;\r\n  }\r\n\r\n  public setFatalExceptionHandler(handler: (e: unknown) => any) {\r\n    this._onFatalException = handler;\r\n  }\r\n\r\n  /**\r\n   * Schedule a callback to fire given a timeout in milliseconds using the excalibur [[Clock]]\r\n   *\r\n   * This is useful to use over the built in browser `setTimeout` because callbacks will be tied to the\r\n   * excalibur update clock, instead of browser time, this means that callbacks wont fire if the game is\r\n   * stopped or paused.\r\n   *\r\n   * @param cb callback to fire\r\n   * @param timeoutMs Optionally specify a timeout in milliseconds from now, default is 0ms which means the next possible tick\r\n   */\r\n  public schedule(cb: () => any, timeoutMs: number = 0) {\r\n    const scheduledTime = this.now() + timeoutMs;\r\n    this._scheduledCbs.push([cb, scheduledTime]);\r\n  }\r\n\r\n  private _runScheduledCbs() {\r\n    // walk backwards to delete items as we loop\r\n    for (let i = this._scheduledCbs.length - 1; i > -1; i--) {\r\n      if (this._scheduledCbs[i][1] <= this._totalElapsed) {\r\n        this._scheduledCbs[i][0]();\r\n        this._scheduledCbs.splice(i, 1);\r\n      }\r\n    }\r\n  }\r\n\r\n  protected update(overrideUpdateMs?: number): void {\r\n    try {\r\n      this.fpsSampler.start();\r\n      // Get the time to calculate time-elapsed\r\n      const now = this.now();\r\n      let elapsed = now - this._lastTime || 1; // first frame\r\n\r\n      // Constrain fps\r\n      const fpsInterval = (1000 / this._maxFps);\r\n\r\n      // only run frame if enough time has elapsed\r\n      if (elapsed >= fpsInterval) {\r\n        let leftover = 0;\r\n        if (fpsInterval !== 0) {\r\n          leftover = (elapsed % fpsInterval);\r\n          elapsed = elapsed - leftover; // shift elapsed to be \"in phase\" with the current loop fps\r\n        }\r\n\r\n        // Resolves issue #138 if the game has been paused, or blurred for\r\n        // more than a 200 milliseconds, reset elapsed time to 1. This improves reliability\r\n        // and provides more expected behavior when the engine comes back\r\n        // into focus\r\n        if (elapsed > 200) {\r\n          elapsed = 1;\r\n        }\r\n\r\n        // tick the mainloop and run scheduled callbacks\r\n        this._elapsed = overrideUpdateMs || elapsed;\r\n        this._totalElapsed += this._elapsed;\r\n        this._runScheduledCbs();\r\n        this.tick(overrideUpdateMs || elapsed);\r\n\r\n        if (fpsInterval !== 0) {\r\n          this._lastTime = now - leftover;\r\n        } else {\r\n          this._lastTime = now;\r\n        }\r\n        this.fpsSampler.end();\r\n      }\r\n    } catch (e) {\r\n      this._onFatalException(e);\r\n      this.stop();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns if the clock is currently running\r\n   */\r\n  public abstract isRunning(): boolean;\r\n\r\n  /**\r\n   * Start the clock, it will then periodically call the tick(elapsedMilliseconds) since the last tick\r\n   */\r\n  public abstract start(): void;\r\n\r\n  /**\r\n   * Stop the clock, tick() is no longer called\r\n   */\r\n  public abstract stop(): void;\r\n}\r\n\r\n\r\n/**\r\n * The [[StandardClock]] implements the requestAnimationFrame browser api to run the tick()\r\n */\r\nexport class StandardClock extends Clock {\r\n\r\n  private _running = false;\r\n  private _requestId: number;\r\n  constructor(options: ClockOptions) {\r\n    super(options);\r\n  }\r\n\r\n  public isRunning(): boolean {\r\n    return this._running;\r\n  }\r\n\r\n  public start(): void {\r\n    if (this._running) {\r\n      return;\r\n    }\r\n    this._running = true;\r\n    const mainloop = () => {\r\n      // stop the loop\r\n      if (!this._running) {\r\n        return;\r\n      }\r\n      try {\r\n        // request next loop\r\n        this._requestId = window.requestAnimationFrame(mainloop);\r\n        this.update();\r\n      } catch (e) {\r\n        window.cancelAnimationFrame(this._requestId);\r\n        throw e;\r\n      }\r\n    };\r\n\r\n    // begin the first frame\r\n    mainloop();\r\n  }\r\n\r\n  public stop(): void {\r\n    this._running = false;\r\n  }\r\n}\r\n\r\nexport interface TestClockOptions {\r\n  /**\r\n   * Specify the update milliseconds to use for each manual step()\r\n   */\r\n  defaultUpdateMs: number;\r\n}\r\n\r\n/**\r\n * The TestClock is meant for debugging interactions in excalibur that require precise timing to replicate or test\r\n */\r\nexport class TestClock extends Clock {\r\n  private _logger = Logger.getInstance();\r\n  private _updateMs: number;\r\n  private _running: boolean = false;\r\n  private _currentTime = 0;\r\n  constructor(options: ClockOptions & TestClockOptions) {\r\n    super({\r\n      ...options\r\n    });\r\n    this._updateMs = options.defaultUpdateMs;\r\n  }\r\n\r\n  /**\r\n   * Get the current time in milliseconds\r\n   */\r\n  public override now() {\r\n    return this._currentTime ?? 0;\r\n  }\r\n\r\n  public isRunning(): boolean {\r\n    return this._running;\r\n  }\r\n  public start(): void {\r\n    this._running = true;\r\n  }\r\n  public stop(): void {\r\n    this._running = false;\r\n  }\r\n\r\n  /**\r\n   * Manually step the clock forward 1 tick, optionally specify an elapsed time in milliseconds\r\n   * @param overrideUpdateMs\r\n   */\r\n  step(overrideUpdateMs?: number): void {\r\n    const time = overrideUpdateMs ?? this._updateMs;\r\n\r\n    if (this._running) {\r\n      // to be comparable to RAF this needs to be a full blown Task\r\n      // For example, images cannot decode synchronously in a single step\r\n      this.update(time);\r\n      this._currentTime += time;\r\n    } else {\r\n      this._logger.warn('The clock is not running, no step will be performed');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Run a number of steps that tick the clock, optionally specify an elapsed time in milliseconds\r\n   * @param numberOfSteps\r\n   * @param overrideUpdateMs\r\n   */\r\n  run(numberOfSteps: number, overrideUpdateMs?: number): void {\r\n    for (let i = 0; i < numberOfSteps; i++) {\r\n      this.step(overrideUpdateMs ?? this._updateMs);\r\n    }\r\n  }\r\n}","import { EX_VERSION } from './';\r\nimport { Flags, Legacy } from './Flags';\r\nimport { polyfill } from './Polyfill';\r\npolyfill();\r\nimport { CanUpdate, CanDraw, CanInitialize } from './Interfaces/LifecycleEvents';\r\nimport { Loadable } from './Interfaces/Loadable';\r\nimport { Vector } from './Math/vector';\r\nimport { Screen, DisplayMode, AbsolutePosition, ScreenDimension, Resolution } from './Screen';\r\nimport { ScreenElement } from './ScreenElement';\r\nimport { Actor } from './Actor';\r\nimport { Timer } from './Timer';\r\nimport { TileMap } from './TileMap';\r\nimport { Animation } from './Drawing/Animation';\r\nimport { Loader } from './Loader';\r\nimport { Detector } from './Util/Detector';\r\nimport {\r\n  VisibleEvent,\r\n  HiddenEvent,\r\n  GameStartEvent,\r\n  GameStopEvent,\r\n  PreUpdateEvent,\r\n  PostUpdateEvent,\r\n  PreFrameEvent,\r\n  PostFrameEvent,\r\n  GameEvent,\r\n  DeactivateEvent,\r\n  ActivateEvent,\r\n  PreDrawEvent,\r\n  PostDrawEvent,\r\n  InitializeEvent\r\n} from './Events';\r\nimport { Logger, LogLevel } from './Util/Log';\r\nimport { Color } from './Color';\r\nimport { Scene } from './Scene';\r\nimport { Entity } from './EntityComponentSystem/Entity';\r\nimport { Debug, DebugStats } from './Debug/Debug';\r\nimport { Class } from './Class';\r\nimport * as Input from './Input/Index';\r\nimport * as Events from './Events';\r\nimport { BrowserEvents } from './Util/Browser';\r\nimport { obsolete } from './Util/Decorators';\r\nimport { ExcaliburGraphicsContext, ExcaliburGraphicsContext2DCanvas, ExcaliburGraphicsContextWebGL, TextureLoader } from './Graphics';\r\nimport { PointerEventReceiver } from './Input/PointerEventReceiver';\r\nimport { FpsSampler } from './Util/Fps';\r\nimport { Clock, StandardClock } from './Util/Clock';\r\nimport { ImageFiltering } from './Graphics/Filtering';\r\nimport { GraphicsDiagnostics } from './Graphics/GraphicsDiagnostics';\r\n\r\n/**\r\n * Enum representing the different mousewheel event bubble prevention\r\n */\r\nexport enum ScrollPreventionMode {\r\n  /**\r\n   * Do not prevent any page scrolling\r\n   */\r\n  None,\r\n  /**\r\n   * Prevent page scroll if mouse is over the game canvas\r\n   */\r\n  Canvas,\r\n  /**\r\n   * Prevent all page scrolling via mouse wheel\r\n   */\r\n  All\r\n}\r\n\r\n/**\r\n * Defines the available options to configure the Excalibur engine at constructor time.\r\n */\r\nexport interface EngineOptions {\r\n  /**\r\n   * Optionally configure the width of the viewport in css pixels\r\n   */\r\n  width?: number;\r\n\r\n  /**\r\n   * Optionally configure the height of the viewport in css pixels\r\n   */\r\n  height?: number;\r\n\r\n  /**\r\n   * Optionally configure the width & height of the viewport in css pixels.\r\n   * Use `viewport` instead of [[EngineOptions.width]] and [[EngineOptions.height]], or vice versa.\r\n   */\r\n  viewport?: ScreenDimension;\r\n\r\n  /**\r\n   * Optionally specify the size the logical pixel resolution, if not specified it will be width x height.\r\n   * See [[Resolution]] for common presets.\r\n   */\r\n  resolution?: ScreenDimension;\r\n\r\n  /**\r\n   * Optionally specify antialiasing (smoothing), by default true (smooth pixels)\r\n   *\r\n   *  * `true` - useful for high resolution art work you would like smoothed, this also hints excalibur to load images\r\n   * with [[ImageFiltering.Blended]]\r\n   *\r\n   *  * `false` - useful for pixel art style art work you would like sharp, this also hints excalibur to load images\r\n   * with [[ImageFiltering.Pixel]]\r\n   */\r\n  antialiasing?: boolean;\r\n\r\n  /**\r\n   * Optionally configure the native canvas transparent backdrop\r\n   */\r\n  enableCanvasTransparency?: boolean;\r\n\r\n  /**\r\n   * Optionally specify the target canvas DOM element to render the game in\r\n   */\r\n  canvasElementId?: string;\r\n\r\n  /**\r\n   * Optionally specify the target canvas DOM element directly\r\n   */\r\n  canvasElement?: HTMLCanvasElement;\r\n\r\n  /**\r\n   * Optionally snap drawings to nearest pixel\r\n   */\r\n  snapToPixel?: boolean;\r\n\r\n  /**\r\n   * The [[DisplayMode]] of the game, by default [[DisplayMode.FitScreen]] with aspect ratio 4:3 (800x600).\r\n   * Depending on this value, [[width]] and [[height]] may be ignored.\r\n   */\r\n  displayMode?: DisplayMode;\r\n\r\n  /**\r\n   * Configures the pointer scope. Pointers scoped to the 'Canvas' can only fire events within the canvas viewport; whereas, 'Document'\r\n   * (default) scoped will fire anywhere on the page.\r\n   */\r\n  pointerScope?: Input.PointerScope;\r\n\r\n  /**\r\n   * Suppress boot up console message, which contains the \"powered by Excalibur message\"\r\n   */\r\n  suppressConsoleBootMessage?: boolean;\r\n\r\n  /**\r\n   * Suppress minimum browser feature detection, it is not recommended users of excalibur switch this off. This feature ensures that\r\n   * the currently running browser meets the minimum requirements for running excalibur. This can be useful if running on non-standard\r\n   * browsers or if there is a bug in excalibur preventing execution.\r\n   */\r\n  suppressMinimumBrowserFeatureDetection?: boolean;\r\n\r\n  /**\r\n   * Suppress HiDPI auto detection and scaling, it is not recommended users of excalibur switch off this feature. This feature detects\r\n   * and scales the drawing canvas appropriately to accommodate HiDPI screens.\r\n   */\r\n  suppressHiDPIScaling?: boolean;\r\n\r\n  /**\r\n   * Suppress play button, it is not recommended users of excalibur switch this feature. Some browsers require a user gesture (like a click)\r\n   * for certain browser features to work like web audio.\r\n   */\r\n  suppressPlayButton?: boolean;\r\n\r\n  /**\r\n   * Specify how the game window is to be positioned when the [[DisplayMode.Position]] is chosen. This option MUST be specified\r\n   * if the DisplayMode is set as [[DisplayMode.Position]]. The position can be either a string or an [[AbsolutePosition]].\r\n   * String must be in the format of css style background-position. The vertical position must precede the horizontal position in strings.\r\n   *\r\n   * Valid String examples: \"top left\", \"top\", \"bottom\", \"middle\", \"middle center\", \"bottom right\"\r\n   * Valid [[AbsolutePosition]] examples: `{top: 5, right: 10%}`, `{bottom: 49em, left: 10px}`, `{left: 10, bottom: 40}`\r\n   */\r\n  position?: string | AbsolutePosition;\r\n\r\n  /**\r\n   * Scroll prevention method.\r\n   */\r\n  scrollPreventionMode?: ScrollPreventionMode;\r\n\r\n  /**\r\n   * Optionally set the background color\r\n   */\r\n  backgroundColor?: Color;\r\n\r\n  /**\r\n   * Optionally set the maximum fps if not set Excalibur will go as fast as the device allows.\r\n   *\r\n   * You may want to constrain max fps if your game cannot maintain fps consistently, it can look and feel better to have a 30fps game than\r\n   * one that bounces between 30fps and 60fps\r\n   */\r\n  maxFps?: number;\r\n}\r\n\r\n/**\r\n * The Excalibur Engine\r\n *\r\n * The [[Engine]] is the main driver for a game. It is responsible for\r\n * starting/stopping the game, maintaining state, transmitting events,\r\n * loading resources, and managing the scene.\r\n */\r\nexport class Engine extends Class implements CanInitialize, CanUpdate, CanDraw {\r\n  /**\r\n   * Excalibur browser events abstraction used for wiring to native browser events safely\r\n   */\r\n  public browser: BrowserEvents;\r\n\r\n  /**\r\n   * Screen abstraction\r\n   */\r\n  public screen: Screen;\r\n\r\n  /**\r\n   * Direct access to the engine's canvas element\r\n   */\r\n  public canvas: HTMLCanvasElement;\r\n\r\n  /**\r\n   * Direct access to the engine's 2D rendering context\r\n   * @deprecated Will be removed in v0.26.0, use Engine.graphicsContext\r\n   */\r\n  public ctx: CanvasRenderingContext2D;\r\n\r\n  /**\r\n   * Direct access to the ExcaliburGraphicsContext used for drawing things to the screen\r\n   */\r\n  public graphicsContext: ExcaliburGraphicsContext;\r\n\r\n  /**\r\n   * Direct access to the canvas element ID, if an ID exists\r\n   */\r\n  public canvasElementId: string;\r\n\r\n  /**\r\n   * Optionally set the maximum fps if not set Excalibur will go as fast as the device allows.\r\n   *\r\n   * You may want to constrain max fps if your game cannot maintain fps consistently, it can look and feel better to have a 30fps game than\r\n   * one that bounces between 30fps and 60fps\r\n   */\r\n  public maxFps: number = Number.POSITIVE_INFINITY;\r\n\r\n  /**\r\n   * Direct access to the excalibur clock\r\n   */\r\n  public clock: Clock;\r\n\r\n  /**\r\n   * The width of the game canvas in pixels (physical width component of the\r\n   * resolution of the canvas element)\r\n   */\r\n  public get canvasWidth(): number {\r\n    return this.screen.canvasWidth;\r\n  }\r\n\r\n  /**\r\n   * Returns half width of the game canvas in pixels (half physical width component)\r\n   */\r\n  public get halfCanvasWidth(): number {\r\n    return this.screen.halfCanvasWidth;\r\n  }\r\n\r\n  /**\r\n   * The height of the game canvas in pixels, (physical height component of\r\n   * the resolution of the canvas element)\r\n   */\r\n  public get canvasHeight(): number {\r\n    return this.screen.canvasHeight;\r\n  }\r\n\r\n  /**\r\n   * Returns half height of the game canvas in pixels (half physical height component)\r\n   */\r\n  public get halfCanvasHeight(): number {\r\n    return this.screen.halfCanvasHeight;\r\n  }\r\n\r\n  /**\r\n   * Returns the width of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\r\n   */\r\n  public get drawWidth(): number {\r\n    return this.screen.drawWidth;\r\n  }\r\n\r\n  /**\r\n   * Returns half the width of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\r\n   */\r\n  public get halfDrawWidth(): number {\r\n    return this.screen.halfDrawWidth;\r\n  }\r\n\r\n  /**\r\n   * Returns the height of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\r\n   */\r\n  public get drawHeight(): number {\r\n    return this.screen.drawHeight;\r\n  }\r\n\r\n  /**\r\n   * Returns half the height of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\r\n   */\r\n  public get halfDrawHeight(): number {\r\n    return this.screen.halfDrawHeight;\r\n  }\r\n\r\n  /**\r\n   * Returns whether excalibur detects the current screen to be HiDPI\r\n   */\r\n  public get isHiDpi(): boolean {\r\n    return this.screen.isHiDpi;\r\n  }\r\n\r\n  /**\r\n   * Access engine input like pointer, keyboard, or gamepad\r\n   */\r\n  public input: Input.EngineInput;\r\n\r\n  private _hasStarted: boolean = false;\r\n\r\n  /**\r\n   * Access Excalibur debugging functionality.\r\n   *\r\n   * Useful when you want to debug different aspects of built in engine features like\r\n   *   * Transform\r\n   *   * Graphics\r\n   *   * Colliders\r\n   */\r\n  public debug: Debug;\r\n\r\n  /**\r\n   * Access [[stats]] that holds frame statistics.\r\n   */\r\n  public get stats(): DebugStats {\r\n    return this.debug.stats;\r\n  }\r\n\r\n  /**\r\n   * The current [[Scene]] being drawn and updated on screen\r\n   */\r\n  public currentScene: Scene;\r\n\r\n  /**\r\n   * The default [[Scene]] of the game, use [[Engine.goToScene]] to transition to different scenes.\r\n   */\r\n  public readonly rootScene: Scene;\r\n\r\n  /**\r\n   * Contains all the scenes currently registered with Excalibur\r\n   */\r\n  public readonly scenes: { [key: string]: Scene } = {};\r\n\r\n  /**\r\n   * @hidden\r\n   * @deprecated will be removed in v0.26.0\r\n   */\r\n  private _animations: AnimationNode[] = [];\r\n\r\n  /**\r\n   * Indicates whether the engine is set to fullscreen or not\r\n   */\r\n  public get isFullscreen(): boolean {\r\n    return this.screen.isFullScreen;\r\n  }\r\n\r\n  /**\r\n   * Indicates the current [[DisplayMode]] of the engine.\r\n   */\r\n  public get displayMode(): DisplayMode {\r\n    return this.screen.displayMode;\r\n  }\r\n\r\n  private _suppressPlayButton: boolean = false;\r\n  /**\r\n   * Returns the calculated pixel ration for use in rendering\r\n   */\r\n  public get pixelRatio(): number {\r\n    return this.screen.pixelRatio;\r\n  }\r\n\r\n  /**\r\n   * Indicates the current position of the engine. Valid only when DisplayMode is DisplayMode.Position\r\n   * @deprecated will be removed in v0.26.0\r\n   */\r\n  public position: string | AbsolutePosition;\r\n\r\n  /**\r\n   * Indicates whether audio should be paused when the game is no longer visible.\r\n   */\r\n  public pauseAudioWhenHidden: boolean = true;\r\n\r\n  /**\r\n   * Indicates whether the engine should draw with debug information\r\n   */\r\n  private _isDebug: boolean = false;\r\n  public get isDebug(): boolean {\r\n    return this._isDebug;\r\n  }\r\n\r\n  /**\r\n   * No longer used\r\n   * @deprecated will be removed in v0.26.0\r\n   */\r\n  public debugColor: Color = new Color(255, 255, 255);\r\n\r\n  /**\r\n   * Sets the background color for the engine.\r\n   */\r\n  public backgroundColor: Color;\r\n\r\n  /**\r\n   * Sets the Transparency for the engine.\r\n   */\r\n  public enableCanvasTransparency: boolean = true;\r\n\r\n  /**\r\n   * Hints the graphics context to truncate fractional world space coordinates\r\n   */\r\n  public get snapToPixel(): boolean {\r\n    return this.graphicsContext.snapToPixel;\r\n  };\r\n\r\n  public set snapToPixel(shouldSnapToPixel: boolean) {\r\n    this.graphicsContext.snapToPixel = shouldSnapToPixel;\r\n  };\r\n\r\n  /**\r\n   * The action to take when a fatal exception is thrown\r\n   */\r\n  public onFatalException = (e: any) => {\r\n    Logger.getInstance().fatal(e);\r\n  };\r\n\r\n  /**\r\n   * The mouse wheel scroll prevention mode\r\n   */\r\n  public pageScrollPreventionMode: ScrollPreventionMode;\r\n\r\n  private _logger: Logger;\r\n\r\n  // this is a reference to the current requestAnimationFrame return value\r\n  private _requestId: number;\r\n\r\n  // this determines whether excalibur is compatible with your browser\r\n  private _compatible: boolean;\r\n\r\n  private _timescale: number = 1.0;\r\n\r\n  // loading\r\n  private _loader: Loader;\r\n\r\n  private _isInitialized: boolean = false;\r\n\r\n  private _deferredGoTo: string = null;\r\n\r\n  public on(eventName: Events.initialize, handler: (event: Events.InitializeEvent<Engine>) => void): void;\r\n  public on(eventName: Events.visible, handler: (event: VisibleEvent) => void): void;\r\n  public on(eventName: Events.hidden, handler: (event: HiddenEvent) => void): void;\r\n  public on(eventName: Events.start, handler: (event: GameStartEvent) => void): void;\r\n  public on(eventName: Events.stop, handler: (event: GameStopEvent) => void): void;\r\n  public on(eventName: Events.preupdate, handler: (event: PreUpdateEvent<Engine>) => void): void;\r\n  public on(eventName: Events.postupdate, handler: (event: PostUpdateEvent<Engine>) => void): void;\r\n  public on(eventName: Events.preframe, handler: (event: PreFrameEvent) => void): void;\r\n  public on(eventName: Events.postframe, handler: (event: PostFrameEvent) => void): void;\r\n  public on(eventName: Events.predraw, handler: (event: PreDrawEvent) => void): void;\r\n  public on(eventName: Events.postdraw, handler: (event: PostDrawEvent) => void): void;\r\n  public on(eventName: string, handler: (event: GameEvent<any>) => void): void;\r\n  public on(eventName: string, handler: (event: any) => void): void {\r\n    super.on(eventName, handler);\r\n  }\r\n\r\n  public once(eventName: Events.initialize, handler: (event: Events.InitializeEvent<Engine>) => void): void;\r\n  public once(eventName: Events.visible, handler: (event: VisibleEvent) => void): void;\r\n  public once(eventName: Events.hidden, handler: (event: HiddenEvent) => void): void;\r\n  public once(eventName: Events.start, handler: (event: GameStartEvent) => void): void;\r\n  public once(eventName: Events.stop, handler: (event: GameStopEvent) => void): void;\r\n  public once(eventName: Events.preupdate, handler: (event: PreUpdateEvent<Engine>) => void): void;\r\n  public once(eventName: Events.postupdate, handler: (event: PostUpdateEvent<Engine>) => void): void;\r\n  public once(eventName: Events.preframe, handler: (event: PreFrameEvent) => void): void;\r\n  public once(eventName: Events.postframe, handler: (event: PostFrameEvent) => void): void;\r\n  public once(eventName: Events.predraw, handler: (event: PreDrawEvent) => void): void;\r\n  public once(eventName: Events.postdraw, handler: (event: PostDrawEvent) => void): void;\r\n  public once(eventName: string, handler: (event: GameEvent<any>) => void): void;\r\n  public once(eventName: string, handler: (event: any) => void): void {\r\n    super.once(eventName, handler);\r\n  }\r\n\r\n  public off(eventName: Events.initialize, handler?: (event: Events.InitializeEvent<Engine>) => void): void;\r\n  public off(eventName: Events.visible, handler?: (event: VisibleEvent) => void): void;\r\n  public off(eventName: Events.hidden, handler?: (event: HiddenEvent) => void): void;\r\n  public off(eventName: Events.start, handler?: (event: GameStartEvent) => void): void;\r\n  public off(eventName: Events.stop, handler?: (event: GameStopEvent) => void): void;\r\n  public off(eventName: Events.preupdate, handler?: (event: PreUpdateEvent<Engine>) => void): void;\r\n  public off(eventName: Events.postupdate, handler?: (event: PostUpdateEvent<Engine>) => void): void;\r\n  public off(eventName: Events.preframe, handler?: (event: PreFrameEvent) => void): void;\r\n  public off(eventName: Events.postframe, handler?: (event: PostFrameEvent) => void): void;\r\n  public off(eventName: Events.predraw, handler?: (event: PreDrawEvent) => void): void;\r\n  public off(eventName: Events.postdraw, handler?: (event: PostDrawEvent) => void): void;\r\n  public off(eventName: string, handler?: (event: GameEvent<any>) => void): void;\r\n  public off(eventName: string, handler?: (event: any) => void): void {\r\n    super.off(eventName, handler);\r\n  }\r\n\r\n  /**\r\n   * Default [[EngineOptions]]\r\n   */\r\n  private static _DEFAULT_ENGINE_OPTIONS: EngineOptions = {\r\n    width: 0,\r\n    height: 0,\r\n    enableCanvasTransparency: true,\r\n    canvasElementId: '',\r\n    canvasElement: undefined,\r\n    snapToPixel: false,\r\n    pointerScope: Input.PointerScope.Canvas,\r\n    suppressConsoleBootMessage: null,\r\n    suppressMinimumBrowserFeatureDetection: null,\r\n    suppressHiDPIScaling: null,\r\n    suppressPlayButton: null,\r\n    scrollPreventionMode: ScrollPreventionMode.Canvas,\r\n    backgroundColor: Color.fromHex('#2185d0') // Excalibur blue\r\n  };\r\n\r\n  /**\r\n   * Creates a new game using the given [[EngineOptions]]. By default, if no options are provided,\r\n   * the game will be rendered full screen (taking up all available browser window space).\r\n   * You can customize the game rendering through [[EngineOptions]].\r\n   *\r\n   * Example:\r\n   *\r\n   * ```js\r\n   * var game = new ex.Engine({\r\n   *   width: 0, // the width of the canvas\r\n   *   height: 0, // the height of the canvas\r\n   *   enableCanvasTransparency: true, // the transparencySection of the canvas\r\n   *   canvasElementId: '', // the DOM canvas element ID, if you are providing your own\r\n   *   displayMode: ex.DisplayMode.FullScreen, // the display mode\r\n   *   pointerScope: ex.Input.PointerScope.Document, // the scope of capturing pointer (mouse/touch) events\r\n   *   backgroundColor: ex.Color.fromHex('#2185d0') // background color of the engine\r\n   * });\r\n   *\r\n   * // call game.start, which is a Promise\r\n   * game.start().then(function () {\r\n   *   // ready, set, go!\r\n   * });\r\n   * ```\r\n   */\r\n  constructor(options?: EngineOptions) {\r\n    super();\r\n\r\n    options = { ...Engine._DEFAULT_ENGINE_OPTIONS, ...options };\r\n\r\n    Flags.freeze();\r\n\r\n    // Initialize browser events facade\r\n    this.browser = new BrowserEvents(window, document);\r\n\r\n    // Check compatibility\r\n    const detector = new Detector();\r\n    if (!options.suppressMinimumBrowserFeatureDetection && !(this._compatible = detector.test())) {\r\n      const message = document.createElement('div');\r\n      message.innerText = 'Sorry, your browser does not support all the features needed for Excalibur';\r\n      document.body.appendChild(message);\r\n\r\n      detector.failedTests.forEach(function (test) {\r\n        const testMessage = document.createElement('div');\r\n        testMessage.innerText = 'Browser feature missing ' + test;\r\n        document.body.appendChild(testMessage);\r\n      });\r\n\r\n      if (options.canvasElementId) {\r\n        const canvas = document.getElementById(options.canvasElementId);\r\n        if (canvas) {\r\n          canvas.parentElement.removeChild(canvas);\r\n        }\r\n      }\r\n\r\n      return;\r\n    } else {\r\n      this._compatible = true;\r\n    }\r\n\r\n    // Use native console API for color fun\r\n    // eslint-disable-next-line no-console\r\n    if (console.log && !options.suppressConsoleBootMessage) {\r\n      // eslint-disable-next-line no-console\r\n      console.log(\r\n        `%cPowered by Excalibur.js (v${EX_VERSION})`,\r\n        'background: #176BAA; color: white; border-radius: 5px; padding: 15px; font-size: 1.5em; line-height: 80px;'\r\n      );\r\n      // eslint-disable-next-line no-console\r\n      console.log('\\n\\\r\n      /| ________________\\n\\\r\nO|===|* >________________>\\n\\\r\n      \\\\|');\r\n      // eslint-disable-next-line no-console\r\n      console.log('Visit', 'http://excaliburjs.com', 'for more information');\r\n    }\r\n\r\n    // Suppress play button\r\n    if (options.suppressPlayButton) {\r\n      this._suppressPlayButton = true;\r\n    }\r\n\r\n    this._logger = Logger.getInstance();\r\n\r\n    // If debug is enabled, let's log browser features to the console.\r\n    if (this._logger.defaultLevel === LogLevel.Debug) {\r\n      detector.logBrowserFeatures();\r\n    }\r\n\r\n    this._logger.debug('Building engine...');\r\n\r\n    this.canvasElementId = options.canvasElementId;\r\n\r\n    if (options.canvasElementId) {\r\n      this._logger.debug('Using Canvas element specified: ' + options.canvasElementId);\r\n      this.canvas = <HTMLCanvasElement>document.getElementById(options.canvasElementId);\r\n    } else if (options.canvasElement) {\r\n      this._logger.debug('Using Canvas element specified:', options.canvasElement);\r\n      this.canvas = options.canvasElement;\r\n    } else {\r\n      this._logger.debug('Using generated canvas element');\r\n      this.canvas = <HTMLCanvasElement>document.createElement('canvas');\r\n    }\r\n\r\n    let displayMode = options.displayMode ?? DisplayMode.Fixed;\r\n    if ((options.width && options.height) || options.viewport) {\r\n      if (options.displayMode === undefined) {\r\n        displayMode = DisplayMode.Fixed;\r\n      }\r\n      this._logger.debug('Engine viewport is size ' + options.width + ' x ' + options.height);\r\n    } else if (!options.displayMode) {\r\n      this._logger.debug('Engine viewport is fit');\r\n      displayMode = DisplayMode.FitScreen;\r\n    }\r\n\r\n    if (Flags.isEnabled(Legacy.Canvas)) {\r\n      const ex2dCtx = new ExcaliburGraphicsContext2DCanvas({\r\n        canvasElement: this.canvas,\r\n        enableTransparency: this.enableCanvasTransparency,\r\n        smoothing: options.antialiasing,\r\n        backgroundColor: options.backgroundColor,\r\n        snapToPixel: options.snapToPixel\r\n      });\r\n      this.graphicsContext = ex2dCtx;\r\n      this.ctx = ex2dCtx.__ctx;\r\n    } else {\r\n      const exWebglCtx = new ExcaliburGraphicsContextWebGL({\r\n        canvasElement: this.canvas,\r\n        enableTransparency: this.enableCanvasTransparency,\r\n        smoothing: options.antialiasing,\r\n        backgroundColor: options.backgroundColor,\r\n        snapToPixel: options.snapToPixel\r\n      });\r\n      this.graphicsContext = exWebglCtx;\r\n      this.ctx = exWebglCtx.__ctx;\r\n    }\r\n\r\n    this.screen = new Screen({\r\n      canvas: this.canvas,\r\n      context: this.graphicsContext,\r\n      antialiasing: options.antialiasing ?? true,\r\n      browser: this.browser,\r\n      viewport: options.viewport ?? (options.width && options.height ? { width: options.width, height: options.height } : Resolution.SVGA),\r\n      resolution: options.resolution,\r\n      displayMode,\r\n      position: options.position,\r\n      pixelRatio: options.suppressHiDPIScaling ? 1 : null\r\n    });\r\n\r\n    TextureLoader.filtering = options.antialiasing ? ImageFiltering.Blended : ImageFiltering.Pixel;\r\n\r\n    if (options.backgroundColor) {\r\n      this.backgroundColor = options.backgroundColor.clone();\r\n    }\r\n\r\n    this.maxFps = options.maxFps ?? this.maxFps;\r\n\r\n    this.clock = new StandardClock({\r\n      maxFps: this.maxFps,\r\n      tick: this._mainloop.bind(this),\r\n      onFatalException: (e) => this.onFatalException(e)\r\n    });\r\n\r\n    this.enableCanvasTransparency = options.enableCanvasTransparency;\r\n\r\n    this._loader = new Loader();\r\n    this._loader.wireEngine(this);\r\n    this.debug = new Debug(this);\r\n\r\n    this._initialize(options);\r\n\r\n    this.rootScene = this.currentScene = new Scene();\r\n\r\n    this.addScene('root', this.rootScene);\r\n    (window as any).___EXCALIBUR_DEVTOOL = this;\r\n  }\r\n\r\n  /**\r\n   * Returns a BoundingBox of the top left corner of the screen\r\n   * and the bottom right corner of the screen.\r\n   */\r\n  public getWorldBounds() {\r\n    return this.screen.getWorldBounds();\r\n  }\r\n\r\n  /**\r\n   * Gets the current engine timescale factor (default is 1.0 which is 1:1 time)\r\n   */\r\n  public get timescale() {\r\n    return this._timescale;\r\n  }\r\n\r\n  /**\r\n   * Sets the current engine timescale factor. Useful for creating slow-motion effects or fast-forward effects\r\n   * when using time-based movement.\r\n   */\r\n  public set timescale(value: number) {\r\n    if (value <= 0) {\r\n      Logger.getInstance().error('Cannot set engine.timescale to a value of 0 or less than 0.');\r\n      return;\r\n    }\r\n\r\n    this._timescale = value;\r\n  }\r\n\r\n  /**\r\n   * Plays a sprite animation on the screen at the specified `x` and `y`\r\n   * (in game coordinates, not screen pixels). These animations play\r\n   * independent of actors, and will be cleaned up internally as soon\r\n   * as they are complete. Note animations that loop will never be\r\n   * cleaned up.\r\n   *\r\n   * @param animation  Animation to play\r\n   * @param x          x game coordinate to play the animation\r\n   * @param y          y game coordinate to play the animation\r\n   * @deprecated\r\n   */\r\n  @obsolete({ message: 'Will be removed in excalibur v0.26.0', alternateMethod: 'Use Actor.graphics' })\r\n  public playAnimation(animation: Animation, x: number, y: number) {\r\n    this._animations.push(new AnimationNode(animation, x, y));\r\n  }\r\n\r\n  /**\r\n   * Adds a [[TileMap]] to the [[currentScene]], once this is done the TileMap\r\n   * will be drawn and updated.\r\n   */\r\n  public addTileMap(tileMap: TileMap) {\r\n    this.currentScene.addTileMap(tileMap);\r\n  }\r\n\r\n  /**\r\n   * Removes a [[TileMap]] from the [[currentScene]], it will no longer be drawn or updated.\r\n   */\r\n  public removeTileMap(tileMap: TileMap) {\r\n    this.currentScene.removeTileMap(tileMap);\r\n  }\r\n\r\n  /**\r\n   * Adds a [[Timer]] to the [[currentScene]].\r\n   * @param timer  The timer to add to the [[currentScene]].\r\n   */\r\n  public addTimer(timer: Timer): Timer {\r\n    return this.currentScene.addTimer(timer);\r\n  }\r\n\r\n  /**\r\n   * Removes a [[Timer]] from the [[currentScene]].\r\n   * @param timer  The timer to remove to the [[currentScene]].\r\n   */\r\n  public removeTimer(timer: Timer): Timer {\r\n    return this.currentScene.removeTimer(timer);\r\n  }\r\n\r\n  /**\r\n   * Adds a [[Scene]] to the engine, think of scenes in Excalibur as you\r\n   * would levels or menus.\r\n   *\r\n   * @param key  The name of the scene, must be unique\r\n   * @param scene The scene to add to the engine\r\n   */\r\n  public addScene(key: string, scene: Scene) {\r\n    if (this.scenes[key]) {\r\n      this._logger.warn('Scene', key, 'already exists overwriting');\r\n    }\r\n    this.scenes[key] = scene;\r\n  }\r\n\r\n  /**\r\n   * Removes a [[Scene]] instance from the engine\r\n   * @param scene  The scene to remove\r\n   */\r\n  public removeScene(scene: Scene): void;\r\n  /**\r\n   * Removes a scene from the engine by key\r\n   * @param key  The scene key to remove\r\n   */\r\n  public removeScene(key: string): void;\r\n  /**\r\n   * @internal\r\n   */\r\n  public removeScene(entity: any): void {\r\n    if (entity instanceof Scene) {\r\n      // remove scene\r\n      for (const key in this.scenes) {\r\n        if (this.scenes.hasOwnProperty(key)) {\r\n          if (this.scenes[key] === entity) {\r\n            delete this.scenes[key];\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    if (typeof entity === 'string') {\r\n      // remove scene\r\n      delete this.scenes[entity];\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Adds a [[Scene]] to the engine, think of scenes in Excalibur as you\r\n   * would levels or menus.\r\n   * @param sceneKey  The key of the scene, must be unique\r\n   * @param scene     The scene to add to the engine\r\n   */\r\n  public add(sceneKey: string, scene: Scene): void;\r\n  /**\r\n   * Adds a [[Timer]] to the [[currentScene]].\r\n   * @param timer  The timer to add to the [[currentScene]].\r\n   */\r\n  public add(timer: Timer): void;\r\n  /**\r\n   * Adds a [[TileMap]] to the [[currentScene]], once this is done the TileMap\r\n   * will be drawn and updated.\r\n   */\r\n  public add(tileMap: TileMap): void;\r\n  /**\r\n   * Adds an actor to the [[currentScene]] of the game. This is synonymous\r\n   * to calling `engine.currentScene.add(actor)`.\r\n   *\r\n   * Actors can only be drawn if they are a member of a scene, and only\r\n   * the [[currentScene]] may be drawn or updated.\r\n   *\r\n   * @param actor  The actor to add to the [[currentScene]]\r\n   */\r\n  public add(actor: Actor): void;\r\n\r\n  /**\r\n   * Adds a [[ScreenElement]] to the [[currentScene]] of the game,\r\n   * ScreenElements do not participate in collisions, instead the\r\n   * remain in the same place on the screen.\r\n   * @param screenElement  The ScreenElement to add to the [[currentScene]]\r\n   */\r\n  public add(screenElement: ScreenElement): void;\r\n  public add(entity: any): void {\r\n    if (arguments.length === 2) {\r\n      this.addScene(<string>arguments[0], <Scene>arguments[1]);\r\n      return;\r\n    }\r\n    if (this._deferredGoTo && this.scenes[this._deferredGoTo]) {\r\n      this.scenes[this._deferredGoTo].add(entity);\r\n    } else {\r\n      this.currentScene.add(entity);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Removes a scene instance from the engine\r\n   * @param scene  The scene to remove\r\n   */\r\n  public remove(scene: Scene): void;\r\n  /**\r\n   * Removes a scene from the engine by key\r\n   * @param sceneKey  The scene to remove\r\n   */\r\n  public remove(sceneKey: string): void;\r\n  /**\r\n   * Removes a [[Timer]] from the [[currentScene]].\r\n   * @param timer  The timer to remove to the [[currentScene]].\r\n   */\r\n  public remove(timer: Timer): void;\r\n  /**\r\n   * Removes a [[TileMap]] from the [[currentScene]], it will no longer be drawn or updated.\r\n   */\r\n  public remove(tileMap: TileMap): void;\r\n  /**\r\n   * Removes an actor from the [[currentScene]] of the game. This is synonymous\r\n   * to calling `engine.currentScene.removeChild(actor)`.\r\n   * Actors that are removed from a scene will no longer be drawn or updated.\r\n   *\r\n   * @param actor  The actor to remove from the [[currentScene]].\r\n   */\r\n  public remove(actor: Actor): void;\r\n  /**\r\n   * Removes a [[ScreenElement]] to the scene, it will no longer be drawn or updated\r\n   * @param screenElement  The ScreenElement to remove from the [[currentScene]]\r\n   */\r\n  public remove(screenElement: ScreenElement): void;\r\n  public remove(entity: any): void {\r\n    if (entity instanceof Entity) {\r\n      this.currentScene.remove(entity);\r\n    }\r\n\r\n    if (entity instanceof Scene) {\r\n      this.removeScene(entity);\r\n    }\r\n\r\n    if (typeof entity === 'string') {\r\n      this.removeScene(entity);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Changes the currently updating and drawing scene to a different,\r\n   * named scene. Calls the [[Scene]] lifecycle events.\r\n   * @param key  The key of the scene to transition to.\r\n   */\r\n  public goToScene(key: string): void {\r\n    // if not yet initialized defer goToScene\r\n    if (!this.isInitialized) {\r\n      this._deferredGoTo = key;\r\n      return;\r\n    }\r\n\r\n    if (this.scenes[key]) {\r\n      const oldScene = this.currentScene;\r\n      const newScene = this.scenes[key];\r\n\r\n      this._logger.debug('Going to scene:', key);\r\n\r\n      // only deactivate when initialized\r\n      if (this.currentScene.isInitialized) {\r\n        this.currentScene._deactivate.apply(this.currentScene, [oldScene, newScene]);\r\n        this.currentScene.eventDispatcher.emit('deactivate', new DeactivateEvent(newScene, this.currentScene));\r\n      }\r\n\r\n      // set current scene to new one\r\n      this.currentScene = newScene;\r\n      this.screen.setCurrentCamera(newScene.camera);\r\n\r\n      // initialize the current scene if has not been already\r\n      this.currentScene._initialize(this);\r\n\r\n      this.currentScene._activate.apply(this.currentScene, [oldScene, newScene]);\r\n      this.currentScene.eventDispatcher.emit('activate', new ActivateEvent(oldScene, this.currentScene));\r\n    } else {\r\n      this._logger.error('Scene', key, 'does not exist!');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Transforms the current x, y from screen coordinates to world coordinates\r\n   * @param point  Screen coordinate to convert\r\n   */\r\n  public screenToWorldCoordinates(point: Vector): Vector {\r\n    return this.screen.screenToWorldCoordinates(point);\r\n  }\r\n\r\n  /**\r\n   * Transforms a world coordinate, to a screen coordinate\r\n   * @param point  World coordinate to convert\r\n   */\r\n  public worldToScreenCoordinates(point: Vector): Vector {\r\n    return this.screen.worldToScreenCoordinates(point);\r\n  }\r\n\r\n  /**\r\n   * Initializes the internal canvas, rendering context, display mode, and native event listeners\r\n   */\r\n  private _initialize(options?: EngineOptions) {\r\n    this.pageScrollPreventionMode = options.scrollPreventionMode;\r\n\r\n    // initialize inputs\r\n    const pointerTarget = options && options.pointerScope === Input.PointerScope.Document ? document : this.canvas;\r\n    this.input = {\r\n      keyboard: new Input.Keyboard(),\r\n      pointers: new PointerEventReceiver(pointerTarget, this),\r\n      gamepads: new Input.Gamepads()\r\n    };\r\n    this.input.keyboard.init();\r\n    this.input.pointers.init();\r\n    this.input.gamepads.init();\r\n\r\n    // Issue #385 make use of the visibility api\r\n    // https://developer.mozilla.org/en-US/docs/Web/Guide/User_experience/Using_the_Page_Visibility_API\r\n\r\n    let hidden: keyof HTMLDocument, visibilityChange: string;\r\n    if (typeof document.hidden !== 'undefined') {\r\n      // Opera 12.10 and Firefox 18 and later support\r\n      hidden = 'hidden';\r\n      visibilityChange = 'visibilitychange';\r\n    } else if ('msHidden' in document) {\r\n      hidden = <keyof HTMLDocument>'msHidden';\r\n      visibilityChange = 'msvisibilitychange';\r\n    } else if ('webkitHidden' in document) {\r\n      hidden = <keyof HTMLDocument>'webkitHidden';\r\n      visibilityChange = 'webkitvisibilitychange';\r\n    }\r\n\r\n    this.browser.document.on(visibilityChange, () => {\r\n      if (document[hidden]) {\r\n        this.eventDispatcher.emit('hidden', new HiddenEvent(this));\r\n        this._logger.debug('Window hidden');\r\n      } else {\r\n        this.eventDispatcher.emit('visible', new VisibleEvent(this));\r\n        this._logger.debug('Window visible');\r\n      }\r\n    });\r\n\r\n    if (!this.canvasElementId && !options.canvasElement) {\r\n      document.body.appendChild(this.canvas);\r\n    }\r\n  }\r\n\r\n  public onInitialize(_engine: Engine) {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * If supported by the browser, this will set the antialiasing flag on the\r\n   * canvas. Set this to `false` if you want a 'jagged' pixel art look to your\r\n   * image resources.\r\n   * @param isSmooth  Set smoothing to true or false\r\n   */\r\n  public setAntialiasing(isSmooth: boolean) {\r\n    this.screen.antialiasing = isSmooth;\r\n  }\r\n\r\n  /**\r\n   * Return the current smoothing status of the canvas\r\n   */\r\n  public getAntialiasing(): boolean {\r\n    return this.screen.antialiasing;\r\n  }\r\n\r\n  /**\r\n   * Gets whether the actor is Initialized\r\n   */\r\n  public get isInitialized(): boolean {\r\n    return this._isInitialized;\r\n  }\r\n\r\n  private _overrideInitialize(engine: Engine) {\r\n    if (!this.isInitialized) {\r\n      this.onInitialize(engine);\r\n      super.emit('initialize', new InitializeEvent(engine, this));\r\n      this._isInitialized = true;\r\n      if (this._deferredGoTo) {\r\n        this.goToScene(this._deferredGoTo);\r\n      } else {\r\n        this.goToScene('root');\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Updates the entire state of the game\r\n   * @param delta  Number of milliseconds elapsed since the last update.\r\n   */\r\n  private _update(delta: number) {\r\n    if (!this.ready) {\r\n      // suspend updates until loading is finished\r\n      this._loader.update(this, delta);\r\n      // Update input listeners\r\n      this.input.keyboard.update();\r\n      this.input.gamepads.update();\r\n      return;\r\n    }\r\n\r\n\r\n    // Publish preupdate events\r\n    this._preupdate(delta);\r\n\r\n    // process engine level events\r\n    this.currentScene.update(this, delta);\r\n\r\n    // update animations\r\n    // TODO remove\r\n    this._animations = this._animations.filter(function (a) {\r\n      return !a.animation.isDone();\r\n    });\r\n\r\n    // Update input listeners\r\n    this.input.keyboard.update();\r\n    this.input.gamepads.update();\r\n\r\n    // Publish update event\r\n    this._postupdate(delta);\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  public _preupdate(delta: number) {\r\n    this.emit('preupdate', new PreUpdateEvent(this, delta, this));\r\n    this.onPreUpdate(this, delta);\r\n  }\r\n\r\n  public onPreUpdate(_engine: Engine, _delta: number) {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  public _postupdate(delta: number) {\r\n    this.emit('postupdate', new PostUpdateEvent(this, delta, this));\r\n    this.onPostUpdate(this, delta);\r\n  }\r\n\r\n  public onPostUpdate(_engine: Engine, _delta: number) {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * Draws the entire game\r\n   * @param delta  Number of milliseconds elapsed since the last draw.\r\n   */\r\n  private _draw(delta: number) {\r\n    const ctx = this.ctx;\r\n    this.graphicsContext.beginDrawLifecycle();\r\n    this.graphicsContext.clear();\r\n    this._predraw(ctx, delta);\r\n\r\n    // Drawing nothing else while loading\r\n    if (!this._isReady) {\r\n      this._loader.canvas.draw(this.graphicsContext, 0, 0);\r\n      this.graphicsContext.flush();\r\n      return;\r\n    }\r\n\r\n    // TODO move to graphics systems?\r\n    this.graphicsContext.backgroundColor = this.backgroundColor;\r\n\r\n    this.currentScene.draw(this.ctx, delta);\r\n\r\n    // todo needs to be a better way of doing this\r\n    let a = 0;\r\n    const len = this._animations.length;\r\n    for (a; a < len; a++) {\r\n      this._animations[a].animation.draw(ctx, this._animations[a].x, this._animations[a].y);\r\n    }\r\n\r\n    // Draw debug information\r\n    // TODO don't access ctx directly\r\n    if (this.isDebug) {\r\n      this.ctx.font = 'Consolas';\r\n      this.ctx.fillStyle = this.debugColor.toString();\r\n      const keys = this.input.keyboard.getKeys();\r\n      for (let j = 0; j < keys.length; j++) {\r\n        this.ctx.fillText(keys[j].toString() + ' : ' + (Input.Keys[keys[j]] ? Input.Keys[keys[j]] : 'Not Mapped'), 100, 10 * j + 10);\r\n      }\r\n\r\n      this.ctx.fillText('FPS:' + this.stats.currFrame.fps.toFixed(2).toString(), 10, 10);\r\n    }\r\n\r\n    this._postdraw(ctx, delta);\r\n\r\n    // Flush any pending drawings\r\n    this.graphicsContext.flush();\r\n    this.graphicsContext.endDrawLifecycle();\r\n\r\n    this._checkForScreenShots();\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  public _predraw(_ctx: CanvasRenderingContext2D, delta: number) {\r\n    this.emit('predraw', new PreDrawEvent(_ctx, delta, this));\r\n    this.onPreDraw(_ctx, delta);\r\n  }\r\n\r\n  public onPreDraw(_ctx: CanvasRenderingContext2D, _delta: number) {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  public _postdraw(_ctx: CanvasRenderingContext2D, delta: number) {\r\n    this.emit('postdraw', new PostDrawEvent(_ctx, delta, this));\r\n    this.onPostDraw(_ctx, delta);\r\n  }\r\n\r\n  public onPostDraw(_ctx: CanvasRenderingContext2D, _delta: number) {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * Enable or disable Excalibur debugging functionality.\r\n   * @param toggle a value that debug drawing will be changed to\r\n   */\r\n  public showDebug(toggle: boolean): void {\r\n    this._isDebug = toggle;\r\n  }\r\n\r\n  /**\r\n   * Toggle Excalibur debugging functionality.\r\n   */\r\n  public toggleDebug(): boolean {\r\n    this._isDebug = !this._isDebug;\r\n    return this._isDebug;\r\n  }\r\n\r\n  private _loadingComplete: boolean = false;\r\n\r\n  /**\r\n   * Returns true when loading is totally complete and the player has clicked start\r\n   */\r\n  public get loadingComplete() {\r\n    return this._loadingComplete;\r\n  }\r\n\r\n  private _isReady = false;\r\n  public get ready() {\r\n    return this._isReady;\r\n  }\r\n  private _isReadyResolve: () => any;\r\n  private _isReadyPromise = new Promise<void>(resolve => {\r\n    this._isReadyResolve = resolve;\r\n  });\r\n  public isReady(): Promise<void> {\r\n    return this._isReadyPromise;\r\n  }\r\n\r\n\r\n  /**\r\n   * Starts the internal game loop for Excalibur after loading\r\n   * any provided assets.\r\n   * @param loader  Optional [[Loader]] to use to load resources. The default loader is [[Loader]], override to provide your own\r\n   * custom loader.\r\n   *\r\n   * Note: start() only resolves AFTER the user has clicked the play button\r\n   */\r\n  public async start(loader?: Loader): Promise<void> {\r\n    if (!this._compatible) {\r\n      throw new Error('Excalibur is incompatible with your browser');\r\n    }\r\n\r\n    // Wire loader if we have it\r\n    if (loader) {\r\n      // Push the current user entered resolution/viewport\r\n      this.screen.pushResolutionAndViewport();\r\n\r\n      // Configure resolution for loader, it expects resolution === viewport\r\n      this.screen.resolution = this.screen.viewport;\r\n      this.screen.applyResolutionAndViewport();\r\n      this._loader = loader;\r\n      this._loader.suppressPlayButton = this._suppressPlayButton || this._loader.suppressPlayButton;\r\n      this._loader.wireEngine(this);\r\n    }\r\n\r\n    // Start the excalibur clock which drives the mainloop\r\n    // has started is a slight misnomer, it's really mainloop started\r\n    this._logger.debug('Starting game clock...');\r\n    this.browser.resume();\r\n    this.clock.start();\r\n    this._logger.debug('Game clock started');\r\n\r\n    if (loader) {\r\n      await this.load(this._loader);\r\n      this._loadingComplete = true;\r\n\r\n      // reset back to previous user resolution/viewport\r\n      this.screen.popResolutionAndViewport();\r\n      this.screen.applyResolutionAndViewport();\r\n    }\r\n\r\n    this._loadingComplete = true;\r\n\r\n    // Initialize before ready\r\n    this._overrideInitialize(this);\r\n\r\n    this._isReady = true;\r\n\r\n    this._isReadyResolve();\r\n    this.emit('start', new GameStartEvent(this));\r\n    return this._isReadyPromise;\r\n  }\r\n\r\n  private _mainloop(elapsed: number) {\r\n    this.emit('preframe', new PreFrameEvent(this, this.stats.prevFrame));\r\n    const delta = elapsed * this.timescale;\r\n\r\n    // reset frame stats (reuse existing instances)\r\n    const frameId = this.stats.prevFrame.id + 1;\r\n    this.stats.currFrame.reset();\r\n    this.stats.currFrame.id = frameId;\r\n    this.stats.currFrame.delta = delta;\r\n    this.stats.currFrame.fps = this.clock.fpsSampler.fps;\r\n    GraphicsDiagnostics.clear();\r\n\r\n    const beforeUpdate = this.clock.now();\r\n    this._update(delta);\r\n    const afterUpdate = this.clock.now();\r\n    this._draw(delta);\r\n    const afterDraw = this.clock.now();\r\n\r\n    this.stats.currFrame.duration.update = afterUpdate - beforeUpdate;\r\n    this.stats.currFrame.duration.draw = afterDraw - afterUpdate;\r\n    this.stats.currFrame.graphics.drawnImages = GraphicsDiagnostics.DrawnImagesCount;\r\n    this.stats.currFrame.graphics.drawCalls = GraphicsDiagnostics.DrawCallCount;\r\n\r\n    this.emit('postframe', new PostFrameEvent(this, this.stats.currFrame));\r\n    this.stats.prevFrame.reset(this.stats.currFrame);\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param game\r\n   * @param raf\r\n   * @param nowFn\r\n   * @deprecated Use [[Clock]] to run the mainloop, will be removed in v0.26.0\r\n   */\r\n  public static createMainLoop(game: Engine, raf: (func: Function) => number, nowFn: () => number) {\r\n    let lastTime = nowFn();\r\n    const fpsSampler = new FpsSampler({\r\n      nowFn,\r\n      initialFps: game.maxFps === Infinity ? 60 : game.maxFps\r\n    });\r\n    return function mainloop() {\r\n      if (!game._hasStarted) {\r\n        return;\r\n      }\r\n      try {\r\n        game._requestId = raf(mainloop);\r\n        fpsSampler.start();\r\n        game.emit('preframe', new PreFrameEvent(game, game.stats.prevFrame));\r\n\r\n        // Get the time to calculate time-elapsed\r\n        const now = nowFn();\r\n        let elapsed = now - lastTime || 1; // first frame\r\n\r\n        // Constrain fps\r\n        const fpsInterval = game.maxFps === Number.POSITIVE_INFINITY ? 0 : 1000 / game.maxFps;\r\n        if (elapsed <= fpsInterval) {\r\n          return; // too fast  skip this frame\r\n        }\r\n\r\n        // Resolves issue #138 if the game has been paused, or blurred for\r\n        // more than a 200 milliseconds, reset elapsed time to 1. This improves reliability\r\n        // and provides more expected behavior when the engine comes back\r\n        // into focus\r\n        if (elapsed > 200) {\r\n          elapsed = 1;\r\n        }\r\n        const delta = elapsed * game.timescale;\r\n\r\n        // reset frame stats (reuse existing instances)\r\n        const frameId = game.stats.prevFrame.id + 1;\r\n        game.stats.currFrame.reset();\r\n        game.stats.currFrame.id = frameId;\r\n        game.stats.currFrame.delta = delta;\r\n        game.stats.currFrame.fps = fpsSampler.fps;\r\n\r\n        const beforeUpdate = nowFn();\r\n        game._update(delta);\r\n        const afterUpdate = nowFn();\r\n        game._draw(delta);\r\n        const afterDraw = nowFn();\r\n\r\n        game.stats.currFrame.duration.update = afterUpdate - beforeUpdate;\r\n        game.stats.currFrame.duration.draw = afterDraw - afterUpdate;\r\n\r\n        // if fps interval is not a multiple\r\n        if (fpsInterval > 0) {\r\n          lastTime = now - (elapsed % fpsInterval);\r\n        } else {\r\n          lastTime = now;\r\n        }\r\n        game.emit('postframe', new PostFrameEvent(game, game.stats.currFrame));\r\n        fpsSampler.end();\r\n        game.stats.prevFrame.reset(game.stats.currFrame);\r\n      } catch (e) {\r\n        window.cancelAnimationFrame(game._requestId);\r\n        game.stop();\r\n        game.onFatalException(e);\r\n      }\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Stops Excalibur's main loop, useful for pausing the game.\r\n   */\r\n  public stop() {\r\n    if (this.clock.isRunning()) {\r\n      this.emit('stop', new GameStopEvent(this));\r\n      this.browser.pause();\r\n      this.clock.stop();\r\n      this._logger.debug('Game stopped');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns the Engine's Running status, Useful for checking whether engine is running or paused.\r\n   * @deprecated will be removed in v0.26.0, use isRunning()\r\n   */\r\n  public isPaused(): boolean {\r\n    return !this.clock.isRunning();\r\n  }\r\n\r\n  /**\r\n   * Returns the Engine's running status, Useful for checking whether engine is running or paused.\r\n   */\r\n  public isRunning() {\r\n    return this.clock.isRunning();\r\n  }\r\n\r\n\r\n  private _screenShotRequests: { preserveHiDPIResolution: boolean, resolve: (image: HTMLImageElement) => void }[] = [];\r\n  /**\r\n   * Takes a screen shot of the current viewport and returns it as an\r\n   * HTML Image Element.\r\n   * @param preserveHiDPIResolution in the case of HiDPI return the full scaled backing image, by default false\r\n   */\r\n  public screenshot(preserveHiDPIResolution = false): Promise<HTMLImageElement> {\r\n    const screenShotPromise = new Promise<HTMLImageElement>((resolve) => {\r\n      this._screenShotRequests.push({preserveHiDPIResolution, resolve});\r\n    });\r\n    return screenShotPromise;\r\n  }\r\n\r\n  private _checkForScreenShots() {\r\n    // We must grab the draw buffer before we yield to the browser\r\n    // the draw buffer is cleared after compositing\r\n    // the reason for the asynchrony is setting `preserveDrawingBuffer: true`\r\n    // forces the browser to copy buffers which can have a mass perf impact on mobile\r\n    for (const request of this._screenShotRequests) {\r\n      const finalWidth = request.preserveHiDPIResolution ? this.canvas.width : this.screen.resolution.width;\r\n      const finalHeight = request.preserveHiDPIResolution ? this.canvas.height : this.screen.resolution.height;\r\n      const screenshot = document.createElement('canvas');\r\n      screenshot.width = finalWidth;\r\n      screenshot.height = finalHeight;\r\n      const ctx = screenshot.getContext('2d');\r\n      ctx.drawImage(this.canvas, 0, 0, finalWidth, finalHeight);\r\n\r\n      const result = new Image();\r\n      const raw = screenshot.toDataURL('image/png');\r\n      result.src = raw;\r\n      request.resolve(result);\r\n    }\r\n    // Reset state\r\n    this._screenShotRequests.length = 0;\r\n  }\r\n\r\n  /**\r\n   * Another option available to you to load resources into the game.\r\n   * Immediately after calling this the game will pause and the loading screen\r\n   * will appear.\r\n   * @param loader  Some [[Loadable]] such as a [[Loader]] collection, [[Sound]], or [[Texture]].\r\n   */\r\n  public async load(loader: Loadable<any>): Promise<void> {\r\n    try {\r\n      await loader.load();\r\n    } catch {\r\n      await Promise.resolve();\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * @internal\r\n * @deprecated\r\n */\r\n@obsolete({ message: 'Will be removed in excalibur v0.26.0' })\r\nclass AnimationNode {\r\n  constructor(public animation: Animation, public x: number, public y: number) {}\r\n}\r\n","import { Color } from '../Color';\r\nimport * as Effects from './SpriteEffects';\r\n\r\nimport { Drawable, DrawOptions } from '../Interfaces/Drawable';\r\nimport { Vector } from '../Math/vector';\r\nimport { obsolete } from '../Util/Decorators';\r\n\r\n/**\r\n * Creates a closed polygon drawing given a list of [[Vector]]s.\r\n *\r\n * @deprecated Use [[Polygon]]\r\n * @warning Use sparingly as Polygons are performance intensive\r\n */\r\n@obsolete({\r\n  message: 'Polygon will be removed in v0.26.0',\r\n  alternateMethod: 'Use Graphics.Polygon'\r\n})\r\nexport class Polygon implements Drawable {\r\n  public flipVertical: boolean;\r\n  public flipHorizontal: boolean;\r\n  public drawWidth: number;\r\n  public drawHeight: number;\r\n\r\n  public width: number;\r\n  public height: number;\r\n\r\n  /**\r\n   * The color to use for the lines of the polygon\r\n   */\r\n  public lineColor: Color;\r\n  /**\r\n   * The color to use for the interior of the polygon\r\n   */\r\n  public fillColor: Color;\r\n  /**\r\n   * The width of the lines of the polygon\r\n   */\r\n  public lineWidth: number = 5;\r\n  /**\r\n   * Indicates whether the polygon is filled or not.\r\n   */\r\n  public filled: boolean = false;\r\n\r\n  private _points: Vector[] = [];\r\n  public anchor = Vector.Zero;\r\n  public offset = Vector.Zero;\r\n  public rotation: number = 0;\r\n  public scale = Vector.One;\r\n  public opacity: number = 1;\r\n\r\n  /**\r\n   * @param points  The vectors to use to build the polygon in order\r\n   */\r\n  constructor(points: Vector[]) {\r\n    this._points = points;\r\n\r\n    const minX = this._points.reduce((prev: number, curr: Vector) => {\r\n      return Math.min(prev, curr.x);\r\n    }, 0);\r\n    const maxX = this._points.reduce((prev: number, curr: Vector) => {\r\n      return Math.max(prev, curr.x);\r\n    }, 0);\r\n\r\n    this.drawWidth = maxX - minX;\r\n\r\n    const minY = this._points.reduce((prev: number, curr: Vector) => {\r\n      return Math.min(prev, curr.y);\r\n    }, 0);\r\n    const maxY = this._points.reduce((prev: number, curr: Vector) => {\r\n      return Math.max(prev, curr.y);\r\n    }, 0);\r\n\r\n    this.drawHeight = maxY - minY;\r\n\r\n    this.height = this.drawHeight;\r\n    this.width = this.drawWidth;\r\n  }\r\n\r\n  /**\r\n   * @notimplemented Effects are not supported on `Polygon`\r\n   */\r\n  public addEffect() {\r\n    // not supported on polygons\r\n  }\r\n  /**\r\n   * @notimplemented Effects are not supported on `Polygon`\r\n   */\r\n  public removeEffect(index: number): void;\r\n  /**\r\n   * @notimplemented Effects are not supported on `Polygon`\r\n   */\r\n  public removeEffect(effect: Effects.SpriteEffect): void;\r\n  /**\r\n   * @notimplemented Effects are not supported on `Polygon`\r\n   */\r\n  public removeEffect() {\r\n    // not supported on polygons\r\n  }\r\n\r\n  /**\r\n   * @notimplemented Effects are not supported on `Polygon`\r\n   */\r\n  public clearEffects() {\r\n    // not supported on polygons\r\n  }\r\n\r\n  public reset() {\r\n    //pass\r\n  }\r\n\r\n  /**\r\n   * Draws the sprite appropriately to the 2D rendering context, at an x and y coordinate.\r\n   * @param ctx  The 2D rendering context\r\n   * @param x    The x coordinate of where to draw\r\n   * @param y    The y coordinate of where to draw\r\n   */\r\n  public draw(ctx: CanvasRenderingContext2D, x: number, y: number): void;\r\n  /**\r\n   * Draws the sprite with custom options to override internals without mutating them.\r\n   * @param options\r\n   */\r\n  public draw(options: DrawOptions): void;\r\n  public draw(ctxOrOptions: CanvasRenderingContext2D | DrawOptions, x?: number, y?: number): void {\r\n    if (ctxOrOptions instanceof CanvasRenderingContext2D) {\r\n      this._drawWithOptions({ ctx: ctxOrOptions, x, y });\r\n    } else {\r\n      this._drawWithOptions(ctxOrOptions);\r\n    }\r\n  }\r\n\r\n  private _drawWithOptions(options: DrawOptions) {\r\n    const { ctx, x, y, rotation, drawWidth, drawHeight, anchor, offset, opacity, flipHorizontal, flipVertical } = {\r\n      ...options,\r\n      rotation: options.rotation ?? this.rotation,\r\n      drawWidth: options.drawWidth ?? this.drawWidth,\r\n      drawHeight: options.drawHeight ?? this.drawHeight,\r\n      flipHorizontal: options.flipHorizontal ?? this.flipHorizontal,\r\n      flipVertical: options.flipVertical ?? this.flipVertical,\r\n      anchor: options.anchor ?? this.anchor,\r\n      offset: options.offset ?? this.offset,\r\n      opacity: (options.opacity ?? 1) * (this.opacity ?? 1)\r\n    };\r\n\r\n    const xpoint = drawWidth * anchor.x + offset.x + x;\r\n    const ypoint = drawHeight * anchor.y + offset.y + y;\r\n\r\n    ctx.save();\r\n    ctx.translate(xpoint, ypoint);\r\n    ctx.scale(this.scale.x, this.scale.y);\r\n    ctx.rotate(rotation);\r\n    ctx.beginPath();\r\n    ctx.lineWidth = this.lineWidth;\r\n\r\n    // Iterate through the supplied points and construct a 'polygon'\r\n    const firstPoint = this._points[0];\r\n    ctx.moveTo(firstPoint.x, firstPoint.y);\r\n\r\n    let i = 0;\r\n    const len = this._points.length;\r\n\r\n    for (i; i < len; i++) {\r\n      ctx.lineTo(this._points[i].x, this._points[i].y);\r\n    }\r\n\r\n    ctx.lineTo(firstPoint.x, firstPoint.y);\r\n    ctx.closePath();\r\n\r\n    if (this.filled) {\r\n      ctx.fillStyle = this.fillColor.toString();\r\n      ctx.fill();\r\n    }\r\n\r\n    ctx.strokeStyle = this.lineColor.toString();\r\n\r\n    if (flipHorizontal) {\r\n      ctx.translate(drawWidth, 0);\r\n      ctx.scale(-1, 1);\r\n    }\r\n\r\n    if (flipVertical) {\r\n      ctx.translate(0, drawHeight);\r\n      ctx.scale(1, -1);\r\n    }\r\n\r\n    const oldAlpha = ctx.globalAlpha;\r\n    ctx.globalAlpha = opacity;\r\n    ctx.stroke();\r\n    ctx.globalAlpha = oldAlpha;\r\n\r\n    ctx.restore();\r\n  }\r\n}\r\n","import { GameEvent } from '../Events';\r\nimport { Sound } from '../Resources/Sound/Sound';\r\nimport { Actor } from '../Actor';\r\nimport { WebAudioInstance } from '../Resources/Sound/WebAudioInstance';\r\n\r\nexport class MediaEvent extends GameEvent<Sound> {\r\n  /**\r\n   * Media event cannot bubble\r\n   */\r\n  public set bubbles(_value: boolean) {\r\n    // stubbed\r\n  }\r\n  /**\r\n   * Media event cannot bubble\r\n   */\r\n  public get bubbles(): boolean {\r\n    return false;\r\n  }\r\n  /**\r\n   * Media event cannot bubble, so they have no path\r\n   */\r\n  protected get _path(): Actor[] {\r\n    return null;\r\n  }\r\n  /**\r\n   * Media event cannot bubble, so they have no path\r\n   */\r\n  protected set _path(_val: Actor[]) {\r\n    // stubbed\r\n  }\r\n\r\n  constructor(public target: Sound, protected _name: string = 'MediaEvent') {\r\n    super();\r\n  }\r\n\r\n  /**\r\n   * Prevents event from bubbling\r\n   */\r\n  public stopPropagation(): void {\r\n    /**\r\n     * Stub\r\n     */\r\n  }\r\n  /**\r\n   * Action, that calls when event happens\r\n   */\r\n  public action(): void {\r\n    /**\r\n     * Stub\r\n     */\r\n  }\r\n  /**\r\n   * Propagate event further through event path\r\n   */\r\n  public propagate(): void {\r\n    /**\r\n     * Stub\r\n     */\r\n  }\r\n\r\n  public layPath(_actor: Actor): void {\r\n    /**\r\n     * Stub\r\n     */\r\n  }\r\n}\r\n\r\nexport class NativeSoundEvent extends MediaEvent {\r\n  constructor(target: Sound, public track?: WebAudioInstance) {\r\n    super(target, 'NativeSoundEvent');\r\n  }\r\n}\r\n\r\nexport class NativeSoundProcessedEvent extends MediaEvent {\r\n  public data: string | AudioBuffer;\r\n\r\n  constructor(target: Sound, private _processedData: string | AudioBuffer) {\r\n    super(target, 'NativeSoundProcessedEvent');\r\n\r\n    this.data = this._processedData;\r\n  }\r\n}\r\n","import { Engine } from './Engine';\r\nimport { Color } from './Color';\r\nimport { vec, Vector } from './Math/vector';\r\nimport { Text } from './Graphics/Text';\r\nimport { BaseAlign, FontStyle, FontUnit, TextAlign } from './Graphics/FontCommon';\r\nimport { obsolete } from './Util/Decorators';\r\nimport { SpriteFont as LegacySpriteFont } from './Drawing/SpriteSheet';\r\nimport { ExcaliburGraphicsContext, GraphicsComponent, SpriteFont } from './Graphics';\r\nimport { Font } from './Graphics/Font';\r\nimport { Actor } from './Actor';\r\nimport { ActorArgs } from '.';\r\n\r\n/**\r\n * Option for creating a label\r\n */\r\nexport interface LabelOptions {\r\n  /**\r\n   * Specify the label text\r\n   */\r\n  text?: string;\r\n  /**\r\n   * Specify the color of the text (does not apply to SpriteFonts)\r\n   */\r\n  color?: Color;\r\n  x?: number;\r\n  y?: number;\r\n  pos?: Vector;\r\n  /**\r\n   * Optionally specify a sprite font, will take precedence over any other [[Font]]\r\n   */\r\n  spriteFont?: SpriteFont | LegacySpriteFont;\r\n  /**\r\n   * Specify a custom font\r\n   */\r\n  font?: Font\r\n}\r\n\r\n/**\r\n * Labels are the way to draw small amounts of text to the screen. They are\r\n * actors and inherit all of the benefits and capabilities.\r\n */\r\nexport class Label extends Actor {\r\n  private _font: Font = new Font();\r\n  private _text: Text = new Text({ text: '', font: this._font });\r\n\r\n  public get font(): Font {\r\n    return this._font;\r\n  }\r\n\r\n  public set font(newFont: Font) {\r\n    this._font = newFont;\r\n    this._text.font = newFont;\r\n  }\r\n\r\n  /**\r\n   * The text to draw.\r\n   */\r\n  public get text(): string {\r\n    return this._text.text;\r\n  }\r\n\r\n  public set text(text: string) {\r\n    this._text.text = text;\r\n  }\r\n\r\n  public override get color(): Color {\r\n    return this._text.color;\r\n  }\r\n\r\n  public override set color(color: Color) {\r\n    if (this._text) {\r\n      this._text.color = color;\r\n    }\r\n  }\r\n\r\n  public get opacity(): number {\r\n    return this._text.opacity;\r\n  }\r\n\r\n  public set opacity(opacity: number) {\r\n    this._text.opacity = opacity;\r\n  }\r\n\r\n  /**\r\n   * Sets or gets the bold property of the label's text, by default it's false\r\n   * @deprecated Use [[Font.bold|Label.font.bold]]\r\n   */\r\n  @obsolete({\r\n    message: 'Label.bold will be removed in v0.26.0',\r\n    alternateMethod: 'Use Label.font.bold'\r\n  })\r\n  public get bold(): boolean {\r\n    return this.font.bold;\r\n  }\r\n\r\n  public set bold(isBold: boolean) {\r\n    this.font.bold = isBold;\r\n  }\r\n\r\n  /**\r\n   * The CSS font family string (e.g. `sans-serif`, `Droid Sans Pro`). Web fonts\r\n   * are supported, same as in CSS.\r\n   * @deprecated Use [[Font.family|Label.font.family]]\r\n   */\r\n  @obsolete({\r\n    message: 'Label.fontFamily will be removed in v0.26.0',\r\n    alternateMethod: 'Use Label.font.family'\r\n  })\r\n  public get fontFamily(): string {\r\n    return this.font.family;\r\n  }\r\n\r\n  public set fontFamily(family: string) {\r\n    this.font.family = family;\r\n  }\r\n\r\n  /**\r\n   * The font size in the selected units, default is 10 (default units is pixel)\r\n   * @deprecated Use [[Font.size|Label.font.size]]\r\n   */\r\n  @obsolete({\r\n    message: 'Label.fontSize will be removed in v0.26.0',\r\n    alternateMethod: 'Use Label.font.size'\r\n  })\r\n  public get fontSize(): number {\r\n    return this.font.size;\r\n  }\r\n\r\n  public set fontSize(sizeInUnit: number) {\r\n    this.font.size = sizeInUnit;\r\n  }\r\n\r\n  /**\r\n   * The font style for this label, the default is [[FontStyle.Normal]]\r\n   * @deprecated Use [[Font.style|Label.font.style]]\r\n   */\r\n  @obsolete({\r\n    message: 'Label.fontStyle will be removed in v0.26.0',\r\n    alternateMethod: 'Use Label.font.style'\r\n  })\r\n  public get fontStyle(): FontStyle {\r\n    return this.font.style;\r\n  }\r\n\r\n  public set fontStyle(style: FontStyle) {\r\n    this.font.style = style;\r\n  }\r\n\r\n  /**\r\n   * The css units for a font size such as px, pt, em (SpriteFont only support px), by default is 'px';\r\n   * @deprecated Use [[Font.unit|Label.font.unit]]\r\n   */\r\n  @obsolete({\r\n    message: 'Label.fontUnit will be removed in v0.26.0',\r\n    alternateMethod: 'Use Label.font.unit'\r\n  })\r\n  public get fontUnit(): FontUnit {\r\n    return this.font.unit;\r\n  }\r\n\r\n  public set fontUnit(unit: FontUnit) {\r\n    this.font.unit = unit;\r\n  }\r\n\r\n  /**\r\n   * Gets or sets the horizontal text alignment property for the label.\r\n   * @deprecated Use [[Font.textAlign|Label.font.textAlign]]\r\n   */\r\n  @obsolete({\r\n    message: 'Label.textAlign will be removed in v0.26.0',\r\n    alternateMethod: 'Use Label.font.textAlign'\r\n  })\r\n  public get textAlign(): TextAlign {\r\n    return this.font.textAlign;\r\n  }\r\n\r\n  public set textAlign(align: TextAlign) {\r\n    this.font.textAlign = align;\r\n  }\r\n\r\n  /**\r\n   * Gets or sets the baseline alignment property for the label.\r\n   * @deprecated Use [[Font.baseAlign|Label.font.baseAlign]]\r\n   */\r\n  @obsolete({\r\n    message: 'Label.baseAlign will be removed in v0.26.0',\r\n    alternateMethod: 'Use Label.font.baseAlign'\r\n  })\r\n  public get baseAlign(): BaseAlign {\r\n    return this.font.baseAlign;\r\n  }\r\n\r\n  public set baseAlign(align: BaseAlign) {\r\n    this.font.baseAlign = align;\r\n  }\r\n\r\n  /**\r\n   * Gets or sets the maximum width (in pixels) that the label should occupy\r\n   * @deprecated The maxWidth constraint is gone\r\n   */\r\n  public maxWidth: number;\r\n\r\n  private _legacySpriteFont: LegacySpriteFont;\r\n  private _spriteFont: SpriteFont;\r\n  /**\r\n   * The [[LegacyDrawing.SpriteFont]] to use, if any. Overrides [[fontFamily]] if present.\r\n   * @deprecated Use [[SpriteFont]]\r\n   */\r\n  public get spriteFont(): LegacySpriteFont {\r\n    return this._legacySpriteFont;\r\n  }\r\n\r\n  public set spriteFont(sf: LegacySpriteFont | SpriteFont) {\r\n    if (sf) {\r\n      if (sf instanceof LegacySpriteFont) {\r\n        this._legacySpriteFont = sf;\r\n        this._spriteFont = SpriteFont.fromLegacySpriteFont(sf);\r\n        this._text.font = this._spriteFont;\r\n        return;\r\n      }\r\n      this._spriteFont = sf;\r\n      this._text.font = this._spriteFont;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Gets or sets the letter spacing on a Label. Only supported with Sprite Fonts.\r\n   * @deprecated Use [[SpriteFont.spacing]]\r\n   */\r\n  public letterSpacing: number = 0; //px\r\n\r\n  /**\r\n   * Whether or not the [[SpriteFont]] will be case-sensitive when matching characters.\r\n   * @deprecated Use Graphics.SpriteFont.caseInsensitive\r\n   */\r\n  public caseInsensitive: boolean = true;\r\n\r\n  private _graphicsContext: ExcaliburGraphicsContext;\r\n\r\n  /**\r\n   * Build a new label\r\n   * @param options\r\n   */\r\n  constructor(options?: LabelOptions & ActorArgs) {\r\n    super(options);\r\n    const {text, pos, x, y, spriteFont, font, color} = options;\r\n\r\n    this.pos = pos ?? (x && y ? vec(x, y) : this.pos);\r\n    this.text = text ?? this.text;\r\n    this.font = font ?? this.font;\r\n    this.spriteFont = spriteFont ?? this.spriteFont;\r\n    this._text.color = color ?? this.color;\r\n    const gfx = this.get(GraphicsComponent);\r\n    gfx.anchor = Vector.Zero;\r\n    gfx.use(this._text);\r\n  }\r\n\r\n  public _initialize(engine: Engine) {\r\n    super._initialize(engine);\r\n    this._graphicsContext = engine.graphicsContext;\r\n  }\r\n\r\n  /**\r\n   * Returns the width of the text in the label (in pixels);\r\n   */\r\n  public getTextWidth(): number {\r\n    return this._text.width;\r\n  }\r\n\r\n  /**\r\n   * Sets the text shadow for sprite fonts\r\n   * @param offsetX      The x offset in pixels to place the shadow\r\n   * @param offsetY      The y offset in pixels to place the shadow\r\n   * @param shadowColor  The color of the text shadow\r\n   * @deprecated Use [[Font.shadow|Label.font.shadow]]\r\n   */\r\n  @obsolete({\r\n    message: 'Label.setTextShadow will be removed in v0.26.0',\r\n    alternateMethod: 'Use Label.font.shadow'\r\n  })\r\n  public setTextShadow(offsetX: number, offsetY: number, shadowColor: Color) {\r\n    this.font.shadow = { offset: vec(offsetX, offsetY), blur: 2, color: shadowColor };\r\n  }\r\n\r\n  /**\r\n   * Toggles text shadows on or off, only applies when using sprite fonts\r\n   * @deprecated Use [[Font.shadow|Label.font.shadow]]\r\n   */\r\n  @obsolete({\r\n    message: 'Label.useTextShadow will be removed in v0.26.0',\r\n    alternateMethod: 'Use Label.font.shadow'\r\n  })\r\n  public useTextShadow(on: boolean) {\r\n    if (this.spriteFont) {\r\n      this.spriteFont.useTextShadow(on);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clears the current text shadow\r\n   * @deprecated Use [[Font.shadow|Label.font.shadow]]\r\n   */\r\n  @obsolete({\r\n    message: 'Label.clearTextShadow will be removed in v0.26.0',\r\n    alternateMethod: 'Use Label.font.shadow'\r\n  })\r\n  public clearTextShadow() {\r\n    this.font.shadow = null;\r\n  }\r\n\r\n  /**\r\n   * @deprecated signature will change in v0.26.0\r\n   * @param _ctx\r\n   * @param _delta\r\n   */\r\n  public draw(_ctx: CanvasRenderingContext2D, _delta: number) {\r\n    const exctx = this._graphicsContext;\r\n    this._text.draw(exctx, 0, 0);\r\n  }\r\n}\r\n","import { CollisionGroup } from './CollisionGroup';\r\n\r\n/**\r\n * Static class for managing collision groups in excalibur, there is a maximum of 32 collision groups possible in excalibur\r\n */\r\nexport class CollisionGroupManager {\r\n  // using bitmasking the maximum number of groups is 32, because that is the highest 32bit integer that JS can present.\r\n  private static _STARTING_BIT = 0b1 | 0;\r\n  private static _MAX_GROUPS = 32;\r\n  private static _CURRENT_GROUP = 1;\r\n  private static _CURRENT_BIT = CollisionGroupManager._STARTING_BIT;\r\n  private static _GROUPS: Map<string, CollisionGroup> = new Map<string, CollisionGroup>();\r\n\r\n  /**\r\n   * Create a new named collision group up to a max of 32.\r\n   * @param name Name for the collision group\r\n   * @param mask Optionally provide your own 32-bit mask, if none is provide the manager will generate one\r\n   */\r\n  public static create(name: string, mask?: number) {\r\n    if (this._CURRENT_GROUP > this._MAX_GROUPS) {\r\n      throw new Error(`Cannot have more than ${this._MAX_GROUPS} collision groups`);\r\n    }\r\n    if (this._GROUPS.get(name)) {\r\n      throw new Error(`Collision group ${name} already exists`);\r\n    }\r\n    const group = new CollisionGroup(name, this._CURRENT_BIT, mask !== undefined ? mask : ~this._CURRENT_BIT);\r\n    this._CURRENT_BIT = (this._CURRENT_BIT << 1) | 0;\r\n    this._CURRENT_GROUP++;\r\n    this._GROUPS.set(name, group);\r\n    return group;\r\n  }\r\n\r\n  /**\r\n   * Get all collision groups currently tracked by excalibur\r\n   */\r\n  public static get groups(): CollisionGroup[] {\r\n    return Array.from(this._GROUPS.values());\r\n  }\r\n\r\n  /**\r\n   * Get a collision group by it's name\r\n   * @param name\r\n   */\r\n  public static groupByName(name: string) {\r\n    return this._GROUPS.get(name);\r\n  }\r\n\r\n  /**\r\n   * Resets the managers internal group management state\r\n   */\r\n  public static reset() {\r\n    this._GROUPS = new Map<string, CollisionGroup>();\r\n    this._CURRENT_BIT = this._STARTING_BIT;\r\n    this._CURRENT_GROUP = 1;\r\n  }\r\n}\r\n","import { Audio } from './Audio';\r\n\r\nexport type ExResponseType = '' | 'arraybuffer' | 'blob' | 'document' | 'json' | 'text';\r\n\r\nexport interface ExResponseTypesLookup {\r\n  [name: string]: ExResponseType;\r\n}\r\n\r\nexport class ExResponse {\r\n  public static type: ExResponseTypesLookup = {\r\n    any: '',\r\n    blob: 'blob',\r\n    json: 'json',\r\n    text: 'text',\r\n    document: 'document',\r\n    arraybuffer: 'arraybuffer'\r\n  };\r\n}\r\n\r\n/**\r\n * Represents an audio implementation like [[WebAudioInstance]]\r\n */\r\nexport interface AudioImplementation {\r\n  /**\r\n   * XHR response type\r\n   */\r\n  responseType: ExResponseType;\r\n\r\n  /**\r\n   * Processes raw data and transforms into sound data\r\n   */\r\n  processData(data: Blob | ArrayBuffer): Promise<string | AudioBuffer>;\r\n\r\n  /**\r\n   * Factory method that returns an instance of a played audio track\r\n   */\r\n  createInstance(data: string | AudioBuffer): Audio;\r\n}\r\n","import { Engine } from './../Engine';\r\nimport * as Events from './../Events';\r\nimport { Scene } from '../Scene';\r\n\r\n// eslint-disable-next-line @typescript-eslint/naming-convention\r\nexport interface _initialize {\r\n  _initialize(engine: Engine): void;\r\n}\r\n\r\n/**\r\n * Type guard checking for internal initialize method\r\n * @internal\r\n * @param a\r\n */\r\nexport function has_initialize(a: any): a is _initialize {\r\n  return !!a._initialize;\r\n}\r\n\r\nexport interface OnInitialize {\r\n  onInitialize(engine: Engine): void;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function hasOnInitialize(a: any): a is OnInitialize {\r\n  return !!a.onInitialize;\r\n}\r\n\r\n// eslint-disable-next-line @typescript-eslint/naming-convention\r\nexport interface _preupdate {\r\n  _preupdate(engine: Engine, delta: number): void;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function has_preupdate(a: any): a is _preupdate {\r\n  return !!a._preupdate;\r\n}\r\n\r\nexport interface OnPreUpdate {\r\n  onPreUpdate(engine: Engine, delta: number): void;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function hasOnPreUpdate(a: any): a is OnPreUpdate {\r\n  return !!a.onPreUpdate;\r\n}\r\n\r\n// eslint-disable-next-line @typescript-eslint/naming-convention\r\nexport interface _postupdate {\r\n  _postupdate(engine: Engine, delta: number): void;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function has_postupdate(a: any): a is _postupdate {\r\n  return !!a.onPostUpdate;\r\n}\r\n\r\nexport interface OnPostUpdate {\r\n  onPostUpdate(engine: Engine, delta: number): void;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function hasOnPostUpdate(a: any): a is OnPostUpdate {\r\n  return !!a.onPostUpdate;\r\n}\r\n\r\nexport interface CanInitialize {\r\n  /**\r\n   * Overridable implementation\r\n   */\r\n  onInitialize(_engine: Engine): void;\r\n\r\n  /**\r\n   * Event signatures\r\n   */\r\n  on(eventName: Events.initialize, handler: (event: Events.InitializeEvent<any>) => void): void;\r\n  once(eventName: Events.initialize, handler: (event: Events.InitializeEvent<any>) => void): void;\r\n  off(eventName: Events.initialize, handler?: (event: Events.InitializeEvent<any>) => void): void;\r\n}\r\n\r\nexport interface CanActivate {\r\n  /**\r\n   * Overridable implementation\r\n   */\r\n  onActivate(oldScene: Scene, newScene: Scene): void;\r\n\r\n  /**\r\n   * Event signatures\r\n   */\r\n  on(eventName: Events.activate, handler: (event: Events.ActivateEvent) => void): void;\r\n  once(eventName: Events.activate, handler: (event: Events.ActivateEvent) => void): void;\r\n  off(eventName: Events.activate, handler?: (event: Events.ActivateEvent) => void): void;\r\n}\r\n\r\nexport interface CanDeactivate {\r\n  /**\r\n   * Overridable implementation\r\n   */\r\n  onDeactivate(oldScene: Scene, newScene: Scene): void;\r\n\r\n  /**\r\n   * Event signature\r\n   */\r\n  on(eventName: Events.deactivate, handler: (event: Events.DeactivateEvent) => void): void;\r\n  once(eventName: Events.deactivate, handler: (event: Events.DeactivateEvent) => void): void;\r\n  off(eventName: Events.deactivate, handler?: (event: Events.DeactivateEvent) => void): void;\r\n}\r\n\r\nexport interface CanUpdate {\r\n  /**\r\n   * Overridable implementation\r\n   */\r\n  onPreUpdate(_engine: Engine, _delta: number): void;\r\n\r\n  /**\r\n   * Event signature\r\n   */\r\n  on(eventName: Events.preupdate, handler: (event: Events.PreUpdateEvent<any>) => void): void;\r\n  once(eventName: Events.preupdate, handler: (event: Events.PreUpdateEvent<any>) => void): void;\r\n  off(eventName: Events.preupdate, handler?: (event: Events.PreUpdateEvent<any>) => void): void;\r\n\r\n  /**\r\n   * Overridable implementation\r\n   */\r\n  onPostUpdate(_engine: Engine, _delta: number): void;\r\n\r\n  /**\r\n   * Event signatures\r\n   */\r\n  on(eventName: Events.postupdate, handler: (event: Events.PostUpdateEvent<any>) => void): void;\r\n  once(eventName: Events.postupdate, handler: (event: Events.PostUpdateEvent<any>) => void): void;\r\n  off(eventName: Events.postupdate, handler?: (event: Events.PostUpdateEvent<any>) => void): void;\r\n}\r\n\r\nexport interface OnPreDraw {\r\n  /**\r\n   * Overridable implementation\r\n   */\r\n  onPreDraw(_ctx: CanvasRenderingContext2D, _delta: number): void;\r\n\r\n  /**\r\n   * Event signatures\r\n   */\r\n  on(eventName: Events.predraw, handler: (event: Events.PreDrawEvent) => void): void;\r\n  once(eventName: Events.predraw, handler: (event: Events.PreDrawEvent) => void): void;\r\n  off(eventName: Events.predraw, handler?: (event: Events.PreDrawEvent) => void): void;\r\n}\r\n\r\nexport interface OnPostDraw {\r\n  /**\r\n   * Overridable implementation\r\n   */\r\n  onPostDraw(_ctx: CanvasRenderingContext2D, _delta: number): void;\r\n\r\n  /**\r\n   * Event signatures\r\n   */\r\n  on(eventName: Events.postdraw, handler: (event: Events.PostDrawEvent) => void): void;\r\n  once(eventName: Events.postdraw, handler: (event: Events.PostDrawEvent) => void): void;\r\n  off(eventName: Events.postdraw, handler?: (event: Events.PostDrawEvent) => void): void;\r\n}\r\n\r\nexport interface CanDraw extends OnPreDraw, OnPostDraw {\r\n  on(eventName: Events.predraw, handler: (event: Events.PreDrawEvent) => void): void;\r\n  on(eventName: Events.postdraw, handler: (event: Events.PostDrawEvent) => void): void;\r\n\r\n  once(eventName: Events.predraw, handler: (event: Events.PreDrawEvent) => void): void;\r\n  once(eventName: Events.postdraw, handler: (event: Events.PostDrawEvent) => void): void;\r\n\r\n  off(eventName: Events.predraw, handler?: (event: Events.PreDrawEvent) => void): void;\r\n  off(eventName: Events.postdraw, handler?: (event: Events.PostDrawEvent) => void): void;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function hasPreDraw(a: any): a is OnPreDraw {\r\n  return !!a.onPreDraw;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function hasPostDraw(a: any): a is OnPostDraw {\r\n  return !!a.onPostDraw;\r\n}\r\n\r\nexport interface CanBeKilled {\r\n  /**\r\n   * Overridable implementation\r\n   */\r\n  onPreKill(_scene: Scene): void;\r\n\r\n  /**\r\n   * Event signatures\r\n   */\r\n  on(eventName: Events.prekill, handler: (event: Events.PreKillEvent) => void): void;\r\n  once(eventName: Events.prekill, handler: (event: Events.PreKillEvent) => void): void;\r\n  off(eventName: Events.prekill, handler: (event: Events.PreKillEvent) => void): void;\r\n\r\n  /**\r\n   * Overridable implementation\r\n   */\r\n  onPostKill(_scene: Scene): void;\r\n\r\n  /**\r\n   * Event signatures\r\n   */\r\n  on(eventName: Events.postkill, handler: (event: Events.PostKillEvent) => void): void;\r\n  once(eventName: Events.postkill, handler: (event: Events.PostKillEvent) => void): void;\r\n  off(eventName: Events.postkill, handler: (event: Events.PostKillEvent) => void): void;\r\n}\r\n","import { Audio } from '../../Interfaces/Audio';\r\nimport { clamp } from '../../Math/util';\r\nimport { AudioContextFactory } from './AudioContext';\r\n\r\n/**\r\n * Internal class representing a Web Audio AudioBufferSourceNode instance\r\n * @see https://developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API\r\n */\r\nexport class WebAudioInstance implements Audio {\r\n  private _volume = 1;\r\n  private _duration: number | undefined = undefined;\r\n\r\n  private _playingPromise: Promise<boolean>;\r\n  private _playingResolve: (value: boolean) => void;\r\n\r\n  private _loop = false;\r\n  public set loop(value: boolean) {\r\n    this._loop = value;\r\n\r\n    if (this._instance) {\r\n      this._instance.loop = value;\r\n      this._wireUpOnEnded();\r\n    }\r\n  }\r\n  public get loop(): boolean {\r\n    return this._loop;\r\n  }\r\n\r\n  public set volume(value: number) {\r\n    value = clamp(value, 0, 1.0);\r\n\r\n    this._volume = value;\r\n\r\n    if (this._isPlaying && this._volumeNode.gain.setTargetAtTime) {\r\n      // https://developer.mozilla.org/en-US/docs/Web/API/AudioParam/setTargetAtTime\r\n      // After each .1 seconds timestep, the target value will ~63.2% closer to the target value.\r\n      // This exponential ramp provides a more pleasant transition in gain\r\n      this._volumeNode.gain.setTargetAtTime(value, this._audioContext.currentTime, 0.1);\r\n    } else {\r\n      this._volumeNode.gain.value = value;\r\n    }\r\n  }\r\n  public get volume(): number {\r\n    return this._volume;\r\n  }\r\n\r\n  public set duration(value: number | undefined) {\r\n    this._duration = value;\r\n  }\r\n\r\n  /**\r\n   * Duration of the sound, in seconds.\r\n   */\r\n  public get duration() {\r\n    return this._duration;\r\n  }\r\n\r\n  private get _playbackRate(): number {\r\n    return this._instance ? 1 / (this._instance.playbackRate.value || 1.0) : null;\r\n  }\r\n\r\n  private _isPlaying = false;\r\n  private _isPaused = false;\r\n  private _instance: AudioBufferSourceNode;\r\n  private _audioContext: AudioContext = AudioContextFactory.create();\r\n  private _volumeNode = this._audioContext.createGain();\r\n  private _startTime: number;\r\n\r\n  /**\r\n   * Current playback offset (in seconds)\r\n   */\r\n  private _currentOffset = 0;\r\n\r\n  constructor(private _src: AudioBuffer) {\r\n    this._createNewBufferSource();\r\n  }\r\n\r\n  public isPlaying() {\r\n    return this._isPlaying;\r\n  }\r\n\r\n  // eslint-disable-next-line @typescript-eslint/no-empty-function\r\n  public play(playStarted: () => any = () => {}) {\r\n    if (this._isPaused) {\r\n      this._resumePlayBack();\r\n      playStarted();\r\n    }\r\n\r\n    if (!this._isPlaying) {\r\n      this._startPlayBack();\r\n      playStarted();\r\n    }\r\n\r\n    return this._playingPromise;\r\n  }\r\n\r\n  public pause() {\r\n    if (!this._isPlaying) {\r\n      return;\r\n    }\r\n\r\n    this._isPaused = true;\r\n    this._isPlaying = false;\r\n\r\n    this._instance.stop(0);\r\n    // Playback rate will be a scale factor of how fast/slow the audio is being played\r\n    // default is 1.0\r\n    // we need to invert it to get the time scale\r\n\r\n    this._setPauseOffset();\r\n  }\r\n\r\n  public stop() {\r\n    if (!this._isPlaying) {\r\n      return;\r\n    }\r\n\r\n    this._isPlaying = false;\r\n    this._isPaused = false;\r\n\r\n    this._currentOffset = 0;\r\n    this._instance.stop(0);\r\n\r\n    // handler will not be wired up if we were looping\r\n    if (!this._instance.onended) {\r\n      this._handleOnEnded();\r\n    }\r\n  }\r\n\r\n  private _startPlayBack() {\r\n    this._isPlaying = true;\r\n    this._isPaused = false;\r\n    this._playingPromise = new Promise<boolean>((resolve) => {\r\n      this._playingResolve = resolve;\r\n    });\r\n\r\n    if (!this._instance) {\r\n      this._createNewBufferSource();\r\n    }\r\n\r\n    this._rememberStartTime();\r\n\r\n    this._volumeNode.connect(this._audioContext.destination);\r\n    this._instance.start(0, 0);\r\n    this._currentOffset = 0;\r\n\r\n    this._wireUpOnEnded();\r\n  }\r\n\r\n  private _resumePlayBack() {\r\n    if (!this._isPaused) {\r\n      return;\r\n    }\r\n\r\n    this._isPaused = false;\r\n    this._isPlaying = true;\r\n\r\n    // a buffer source can only be started once\r\n    // so we need to dispose of the previous instance before\r\n    // \"resuming\" the next one\r\n    this._instance.onended = null; // dispose of any previous event handler\r\n    this._createNewBufferSource();\r\n\r\n    const duration = this._playbackRate * this._src.duration;\r\n    const restartTime = this._currentOffset % duration;\r\n\r\n    this._rememberStartTime(restartTime * -1000);\r\n    this._instance.start(0, restartTime);\r\n    this._wireUpOnEnded();\r\n  }\r\n\r\n  private _wireUpOnEnded() {\r\n    if (!this.loop) {\r\n      this._instance.onended = () => this._handleOnEnded();\r\n    }\r\n  }\r\n\r\n  private _handleOnEnded() {\r\n    // pausing calls stop(0) which triggers onended event\r\n    // so we don't \"resolve\" yet (when we resume we'll try again)\r\n    if (!this._isPaused) {\r\n      this._isPlaying = false;\r\n      this._playingResolve(true);\r\n    }\r\n  }\r\n\r\n  private _rememberStartTime(amend?: number) {\r\n    this._startTime = new Date().getTime() + (amend | 0);\r\n  }\r\n\r\n  private _setPauseOffset() {\r\n    this._currentOffset = ((new Date().getTime() - this._startTime) * this._playbackRate) / 1000; // in seconds\r\n  }\r\n\r\n  private _createNewBufferSource() {\r\n    this._instance = this._audioContext.createBufferSource();\r\n    this._instance.buffer = this._src;\r\n    this._instance.loop = this.loop;\r\n    this._instance.playbackRate.setValueAtTime(1.0, 0);\r\n\r\n    this._instance.connect(this._volumeNode);\r\n  }\r\n}\r\n","import { Logger } from './Log';\r\n\r\n/**\r\n * Whether or not the browser can play this file as HTML5 Audio\r\n */\r\nexport function canPlayFile(file: string): boolean {\r\n  try {\r\n    const a = new Audio();\r\n    const filetype = /.*\\.([A-Za-z0-9]+)$/;\r\n    const type = file.match(filetype)[1];\r\n    if (a.canPlayType('audio/' + type)) {\r\n      return true;\r\n    } else {\r\n      return false;\r\n    }\r\n  } catch (e) {\r\n    Logger.getInstance().warn('Cannot determine audio support, assuming no support for the Audio Tag', e);\r\n    return false;\r\n  }\r\n}\r\n","import { ExResponse } from '../../Interfaces/AudioImplementation';\r\nimport { Audio } from '../../Interfaces/Audio';\r\nimport { Engine } from '../../Engine';\r\nimport { Resource } from '../Resource';\r\nimport { WebAudioInstance } from './WebAudioInstance';\r\nimport { AudioContextFactory } from './AudioContext';\r\nimport { NativeSoundEvent, NativeSoundProcessedEvent } from '../../Events/MediaEvents';\r\nimport { canPlayFile } from '../../Util/Sound';\r\nimport { Loadable } from '../../Interfaces/Index';\r\nimport { Logger } from '../../Util/Log';\r\nimport { Class } from '../../Class';\r\n\r\n/**\r\n * The [[Sound]] object allows games built in Excalibur to load audio\r\n * components, from soundtracks to sound effects. [[Sound]] is an [[Loadable]]\r\n * which means it can be passed to a [[Loader]] to pre-load before a game or level.\r\n */\r\nexport class Sound extends Class implements Audio, Loadable<AudioBuffer> {\r\n  public logger: Logger = Logger.getInstance();\r\n  public data: AudioBuffer;\r\n  private _resource: Resource<ArrayBuffer>;\r\n  /**\r\n   * Indicates whether the clip should loop when complete\r\n   * @param value  Set the looping flag\r\n   */\r\n  public set loop(value: boolean) {\r\n    this._loop = value;\r\n\r\n    for (const track of this._tracks) {\r\n      track.loop = this._loop;\r\n    }\r\n\r\n    this.logger.debug('Set loop for all instances of sound', this.path, 'to', this._loop);\r\n  }\r\n  public get loop(): boolean {\r\n    return this._loop;\r\n  }\r\n\r\n  public set volume(value: number) {\r\n    this._volume = value;\r\n\r\n    for (const track of this._tracks) {\r\n      track.volume = this._volume;\r\n    }\r\n\r\n    this.emit('volumechange', new NativeSoundEvent(this));\r\n\r\n    this.logger.debug('Set loop for all instances of sound', this.path, 'to', this._volume);\r\n  }\r\n  public get volume(): number {\r\n    return this._volume;\r\n  }\r\n\r\n  public get duration(): number | undefined {\r\n    return this._duration;\r\n  }\r\n\r\n  /**\r\n   * Return array of Current AudioInstances playing or being paused\r\n   */\r\n  public get instances(): Audio[] {\r\n    return this._tracks;\r\n  }\r\n\r\n  public get path() {\r\n    return this._resource.path;\r\n  }\r\n\r\n  public set path(val: string) {\r\n    this._resource.path = val;\r\n  }\r\n\r\n  private _loop = false;\r\n  private _volume = 1;\r\n  private _duration: number | undefined = undefined;\r\n  private _isStopped = false;\r\n  private _isPaused = false;\r\n  private _tracks: Audio[] = [];\r\n  private _engine: Engine;\r\n  private _wasPlayingOnHidden: boolean = false;\r\n  private _audioContext = AudioContextFactory.create();\r\n\r\n  /**\r\n   * @param paths A list of audio sources (clip.wav, clip.mp3, clip.ogg) for this audio clip. This is done for browser compatibility.\r\n   */\r\n  constructor(...paths: string[]) {\r\n    super();\r\n    this._resource = new Resource('', ExResponse.type.arraybuffer);\r\n    /**\r\n     * Chrome : MP3, WAV, Ogg\r\n     * Firefox : WAV, Ogg,\r\n     * IE : MP3, WAV coming soon\r\n     * Safari MP3, WAV, Ogg\r\n     */\r\n    for (const path of paths) {\r\n      if (canPlayFile(path)) {\r\n        this.path = path;\r\n        break;\r\n      }\r\n    }\r\n\r\n    if (!this.path) {\r\n      this.logger.warn('This browser does not support any of the audio files specified:', paths.join(', '));\r\n      this.logger.warn('Attempting to use', paths[0]);\r\n      this.path = paths[0]; // select the first specified\r\n    }\r\n  }\r\n\r\n  public isLoaded() {\r\n    return !!this.data;\r\n  }\r\n\r\n  public async load(): Promise<AudioBuffer> {\r\n    if (this.data) {\r\n      return this.data;\r\n    }\r\n    const arraybuffer = await this._resource.load();\r\n    const audiobuffer = await this.decodeAudio(arraybuffer.slice(0));\r\n    this._duration = typeof audiobuffer === 'object' ? audiobuffer.duration : undefined;\r\n    this.emit('processed', new NativeSoundProcessedEvent(this, audiobuffer));\r\n    return this.data = audiobuffer;\r\n  }\r\n\r\n  public async decodeAudio(data: ArrayBuffer): Promise<AudioBuffer> {\r\n    try {\r\n      return await this._audioContext.decodeAudioData(data.slice(0));\r\n    } catch (e) {\r\n      this.logger.error(\r\n        'Unable to decode ' +\r\n          ' this browser may not fully support this format, or the file may be corrupt, ' +\r\n          'if this is an mp3 try removing id3 tags and album art from the file.'\r\n      );\r\n      return await Promise.reject();\r\n    }\r\n  }\r\n\r\n  public wireEngine(engine: Engine) {\r\n    if (engine) {\r\n      this._engine = engine;\r\n\r\n      this._engine.on('hidden', () => {\r\n        if (engine.pauseAudioWhenHidden && this.isPlaying()) {\r\n          this._wasPlayingOnHidden = true;\r\n          this.pause();\r\n        }\r\n      });\r\n\r\n      this._engine.on('visible', () => {\r\n        if (engine.pauseAudioWhenHidden && this._wasPlayingOnHidden) {\r\n          this.play();\r\n          this._wasPlayingOnHidden = false;\r\n        }\r\n      });\r\n\r\n      this._engine.on('start', () => {\r\n        this._isStopped = false;\r\n      });\r\n\r\n      this._engine.on('stop', () => {\r\n        this.stop();\r\n        this._isStopped = true;\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns how many instances of the sound are currently playing\r\n   */\r\n  public instanceCount(): number {\r\n    return this._tracks.length;\r\n  }\r\n\r\n  /**\r\n   * Whether or not the sound is playing right now\r\n   */\r\n  public isPlaying(): boolean {\r\n    return this._tracks.some((t) => t.isPlaying());\r\n  }\r\n\r\n  /**\r\n   * Play the sound, returns a promise that resolves when the sound is done playing\r\n   * An optional volume argument can be passed in to play the sound. Max volume is 1.0\r\n   */\r\n  public play(volume?: number): Promise<boolean> {\r\n    if (!this.isLoaded()) {\r\n      this.logger.warn('Cannot start playing. Resource', this.path, 'is not loaded yet');\r\n\r\n      return Promise.resolve(true);\r\n    }\r\n\r\n    if (this._isStopped) {\r\n      this.logger.warn('Cannot start playing. Engine is in a stopped state.');\r\n      return Promise.resolve(false);\r\n    }\r\n\r\n    this.volume = volume || this.volume;\r\n\r\n    if (this._isPaused) {\r\n      return this._resumePlayback();\r\n    } else {\r\n      return this._startPlayback();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Stop the sound, and do not rewind\r\n   */\r\n  public pause() {\r\n    if (!this.isPlaying()) {\r\n      return;\r\n    }\r\n\r\n    for (const track of this._tracks) {\r\n      track.pause();\r\n    }\r\n\r\n    this._isPaused = true;\r\n\r\n    this.emit('pause', new NativeSoundEvent(this));\r\n\r\n    this.logger.debug('Paused all instances of sound', this.path);\r\n  }\r\n\r\n  /**\r\n   * Stop the sound if it is currently playing and rewind the track. If the sound is not playing, rewinds the track.\r\n   */\r\n  public stop() {\r\n    for (const track of this._tracks) {\r\n      track.stop();\r\n    }\r\n\r\n    this.emit('stop', new NativeSoundEvent(this));\r\n\r\n    this._isPaused = false;\r\n    this._tracks.length = 0;\r\n    this.logger.debug('Stopped all instances of sound', this.path);\r\n  }\r\n\r\n\r\n\r\n  /**\r\n   * Get Id of provided AudioInstance in current trackList\r\n   * @param track [[Audio]] which Id is to be given\r\n   */\r\n  public getTrackId(track: Audio): number {\r\n    return this._tracks.indexOf(track);\r\n  }\r\n\r\n  private async _resumePlayback(): Promise<boolean> {\r\n    if (this._isPaused) {\r\n      const resumed: Promise<boolean>[] = [];\r\n      // ensure we resume *current* tracks (if paused)\r\n      for (const track of this._tracks) {\r\n        resumed.push(track.play());\r\n      }\r\n\r\n      this._isPaused = false;\r\n\r\n      this.emit('resume', new NativeSoundEvent(this));\r\n\r\n      this.logger.debug('Resuming paused instances for sound', this.path, this._tracks);\r\n      // resolve when resumed tracks are done\r\n      await Promise.all(resumed);\r\n    }\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Starts playback, returns a promise that resolves when playback is complete\r\n   */\r\n  private async _startPlayback(): Promise<boolean> {\r\n    const track = await this._getTrackInstance(this.data);\r\n\r\n    const complete = await track.play(() => {\r\n      this.emit('playbackstart', new NativeSoundEvent(this, track));\r\n      this.logger.debug('Playing new instance for sound', this.path);\r\n    });\r\n\r\n    // when done, remove track\r\n    this.emit('playbackend', new NativeSoundEvent(this, track));\r\n    this._tracks.splice(this.getTrackId(track), 1);\r\n\r\n    return complete;\r\n  }\r\n\r\n  private _getTrackInstance(data: AudioBuffer): WebAudioInstance {\r\n    const newTrack = new WebAudioInstance(data);\r\n\r\n    newTrack.loop = this.loop;\r\n    newTrack.volume = this.volume;\r\n    newTrack.duration = this.duration;\r\n\r\n    this._tracks.push(newTrack);\r\n\r\n    return newTrack;\r\n  }\r\n}\r\n","import { Resource } from './Resource';\r\nimport { Sprite } from '../Graphics/Sprite';\r\nimport { Color } from '../Color';\r\nimport { SpriteSheet } from '../Graphics/SpriteSheet';\r\nimport { Animation } from '../Graphics/Animation';\r\nimport { Engine } from '../Engine';\r\nimport { Loadable } from '../Interfaces/Index';\r\nimport { ImageSource } from '../Graphics/ImageSource';\r\nimport { LegacyDrawing } from '..';\r\nimport { range } from '../Math/util';\r\n/**\r\n * The [[Texture]] object allows games built in Excalibur to load image resources.\r\n * [[Texture]] is an [[Loadable]] which means it can be passed to a [[Loader]]\r\n * to pre-load before starting a level or game.\r\n */\r\nexport class Gif implements Loadable<ImageSource[]> {\r\n  private _resource: Resource<ArrayBuffer>;\r\n\r\n  /**\r\n   * The width of the texture in pixels\r\n   */\r\n  public width: number;\r\n\r\n  /**\r\n   * The height of the texture in pixels\r\n   */\r\n  public height: number;\r\n\r\n\r\n  private _stream: Stream = null;\r\n  private _gif: ParseGif = null;\r\n  private _textures: ImageSource[] = [];\r\n  private _animation: Animation = null;\r\n  private _transparentColor: Color = null;\r\n\r\n  public data: ImageSource[];\r\n\r\n  /**\r\n   * @param path       Path to the image resource\r\n   * @param color      Optionally set the color to treat as transparent the gif, by default [[Color.Magenta]]\r\n   * @param bustCache  Optionally load texture with cache busting\r\n   */\r\n  constructor(public path: string, public color: Color = Color.Magenta, public bustCache = true) {\r\n    this._resource = new Resource(path, 'arraybuffer', bustCache);\r\n    this._transparentColor = color;\r\n  }\r\n\r\n  /**\r\n   * Begins loading the texture and returns a promise to be resolved on completion\r\n   */\r\n  public async load(): Promise<ImageSource[]> {\r\n    const arraybuffer = await this._resource.load();\r\n    this._stream = new Stream(arraybuffer);\r\n    this._gif = new ParseGif(this._stream, this._transparentColor);\r\n    const images = this._gif.images.map(i => new ImageSource(i.src, false));\r\n\r\n    // Load all textures\r\n    await Promise.all(images.map(t => t.load()));\r\n    return this.data = this._textures = images;\r\n  }\r\n\r\n  public isLoaded() {\r\n    return !!this.data;\r\n  }\r\n\r\n  /**\r\n   * Return a frame of the gif as a legacy sprite by index\r\n   * @deprecated\r\n   */\r\n  public toLegacySprite(id: number = 0): LegacyDrawing.Sprite {\r\n    return Sprite.toLegacySprite(this.toSprite(id));\r\n  }\r\n\r\n  /**\r\n   * Return the gif as a legacy spritesheet\r\n   * @deprecated\r\n   */\r\n  public toLegacySpriteSheet(): LegacyDrawing.SpriteSheet {\r\n    return SpriteSheet.toLegacySpriteSheet(this.toSpriteSheet());\r\n  }\r\n\r\n  /**\r\n   * Return the gif as a legacy animation\r\n   * @deprecated\r\n   * @param engine\r\n   * @param speed\r\n   */\r\n  public toLegacyAnimation(engine: Engine, speed: number): LegacyDrawing.Animation {\r\n    return Animation.toLegacyAnimation(engine, this.toAnimation(speed));\r\n  }\r\n\r\n  /**\r\n   * Return a frame of the gif as a sprite by id\r\n   * @param id\r\n   */\r\n  public toSprite(id: number = 0): Sprite {\r\n    const sprite = this._textures[id].toSprite();\r\n    return sprite;\r\n  }\r\n\r\n  /**\r\n   * Return the gif as a spritesheet\r\n   */\r\n  public toSpriteSheet(): SpriteSheet {\r\n    const sprites: Sprite[] = this._textures.map((image) => {\r\n      return image.toSprite();\r\n    });\r\n    return new SpriteSheet({ sprites });\r\n  }\r\n\r\n  /**\r\n   * Transform the GIF into an animation with duration per frame\r\n   */\r\n  public toAnimation(durationPerFrameMs: number): Animation {\r\n    const spriteSheet: SpriteSheet = this.toSpriteSheet();\r\n    const length = spriteSheet.sprites.length;\r\n    this._animation = Animation.fromSpriteSheet(spriteSheet, range(0, length), durationPerFrameMs);\r\n    return this._animation;\r\n  }\r\n\r\n  public get readCheckBytes(): number[] {\r\n    return this._gif.checkBytes;\r\n  }\r\n}\r\n\r\nexport interface GifFrame {\r\n  sentinel: number;\r\n  type: string;\r\n  leftPos: number;\r\n  topPos: number;\r\n  width: number;\r\n  height: number;\r\n  lctFlag: boolean;\r\n  interlaced: boolean;\r\n  sorted: boolean;\r\n  reserved: boolean[];\r\n  lctSize: number;\r\n  lzwMinCodeSize: number;\r\n  pixels: number[];\r\n}\r\n\r\nconst bitsToNum = (ba: any) => {\r\n  return ba.reduce(function (s: number, n: number) {\r\n    return s * 2 + n;\r\n  }, 0);\r\n};\r\n\r\nconst byteToBitArr = (bite: any) => {\r\n  const a = [];\r\n  for (let i = 7; i >= 0; i--) {\r\n    a.push(!!(bite & (1 << i)));\r\n  }\r\n  return a;\r\n};\r\n\r\nexport class Stream {\r\n  data: any = null;\r\n  len: number = 0;\r\n  position: number = 0;\r\n\r\n  constructor(dataArray: ArrayBuffer) {\r\n    this.data = new Uint8Array(dataArray);\r\n    this.len = this.data.byteLength;\r\n    if (this.len === 0) {\r\n      throw new Error('No data loaded from file');\r\n    }\r\n  }\r\n\r\n  public readByte = () => {\r\n    if (this.position >= this.data.byteLength) {\r\n      throw new Error('Attempted to read past end of stream.');\r\n    }\r\n    return this.data[this.position++];\r\n  };\r\n\r\n  public readBytes = (n: number) => {\r\n    const bytes = [];\r\n    for (let i = 0; i < n; i++) {\r\n      bytes.push(this.readByte());\r\n    }\r\n    return bytes;\r\n  };\r\n\r\n  public read = (n: number) => {\r\n    let s = '';\r\n    for (let i = 0; i < n; i++) {\r\n      s += String.fromCharCode(this.readByte());\r\n    }\r\n    return s;\r\n  };\r\n\r\n  public readUnsigned = () => {\r\n    // Little-endian.\r\n    const a = this.readBytes(2);\r\n    return (a[1] << 8) + a[0];\r\n  };\r\n}\r\n\r\nconst lzwDecode = function (minCodeSize: number, data: any) {\r\n  // TODO: Now that the GIF parser is a bit different, maybe this should get an array of bytes instead of a String?\r\n  let pos = 0; // Maybe this streaming thing should be merged with the Stream?\r\n\r\n  const readCode = function (size: number) {\r\n    let code = 0;\r\n    for (let i = 0; i < size; i++) {\r\n      if (data.charCodeAt(pos >> 3) & (1 << (pos & 7))) {\r\n        code |= 1 << i;\r\n      }\r\n      pos++;\r\n    }\r\n    return code;\r\n  };\r\n\r\n  const output: any[] = [];\r\n\r\n  const clearCode = 1 << minCodeSize;\r\n  const eoiCode = clearCode + 1;\r\n\r\n  let codeSize = minCodeSize + 1;\r\n\r\n  let dict: any[] = [];\r\n\r\n  const clear = function () {\r\n    dict = [];\r\n    codeSize = minCodeSize + 1;\r\n    for (let i = 0; i < clearCode; i++) {\r\n      dict[i] = [i];\r\n    }\r\n    dict[clearCode] = [];\r\n    dict[eoiCode] = null;\r\n  };\r\n\r\n  let code;\r\n  let last;\r\n\r\n  while (true) {\r\n    last = code;\r\n    code = readCode(codeSize);\r\n    if (code === clearCode) {\r\n      clear();\r\n      continue;\r\n    }\r\n    if (code === eoiCode) {\r\n      break;\r\n    }\r\n\r\n    if (code < dict.length) {\r\n      if (last !== clearCode) {\r\n        dict.push(dict[last].concat(dict[code][0]));\r\n      }\r\n    } else {\r\n      if (code !== dict.length) {\r\n        throw new Error('Invalid LZW code.');\r\n      }\r\n      dict.push(dict[last].concat(dict[last][0]));\r\n    }\r\n    output.push.apply(output, dict[code]);\r\n\r\n    if (dict.length === 1 << codeSize && codeSize < 12) {\r\n      // If we're at the last code and codeSize is 12, the next code will be a clearCode, and it'll be 12 bits long.\r\n      codeSize++;\r\n    }\r\n  }\r\n\r\n  // I don't know if this is technically an error, but some GIFs do it.\r\n  //if (Math.ceil(pos / 8) !== data.length) throw new Error('Extraneous LZW bytes.');\r\n  return output;\r\n};\r\n\r\n// The actual parsing; returns an object with properties.\r\nexport class ParseGif {\r\n  private _st: Stream = null;\r\n  private _handler: any = {};\r\n  private _transparentColor: Color = null;\r\n  public frames: GifFrame[] = [];\r\n  public images: HTMLImageElement[] = [];\r\n  public globalColorTable: any[] = [];\r\n  public checkBytes: number[] = [];\r\n\r\n  constructor(stream: Stream, color: Color = Color.Magenta) {\r\n    this._st = stream;\r\n    this._handler = {};\r\n    this._transparentColor = color;\r\n    this.parseHeader();\r\n    this.parseBlock();\r\n  }\r\n\r\n  // LZW (GIF-specific)\r\n  parseColorTable = (entries: any) => {\r\n    // Each entry is 3 bytes, for RGB.\r\n    const ct = [];\r\n    for (let i = 0; i < entries; i++) {\r\n      const rgb: number[] = this._st.readBytes(3);\r\n      const rgba =\r\n        '#' +\r\n        rgb\r\n          .map((x: any) => {\r\n            const hex = x.toString(16);\r\n            return hex.length === 1 ? '0' + hex : hex;\r\n          })\r\n          .join('');\r\n      ct.push(rgba);\r\n    }\r\n    return ct;\r\n  };\r\n\r\n  readSubBlocks = () => {\r\n    let size, data;\r\n    data = '';\r\n    do {\r\n      size = this._st.readByte();\r\n      data += this._st.read(size);\r\n    } while (size !== 0);\r\n    return data;\r\n  };\r\n\r\n  parseHeader = () => {\r\n    const hdr: any = {\r\n      sig: null,\r\n      ver: null,\r\n      width: null,\r\n      height: null,\r\n      colorRes: null,\r\n      globalColorTableSize: null,\r\n      gctFlag: null,\r\n      sorted: null,\r\n      globalColorTable: [],\r\n      bgColor: null,\r\n      pixelAspectRatio: null // if not 0, aspectRatio = (pixelAspectRatio + 15) / 64\r\n    };\r\n\r\n    hdr.sig = this._st.read(3);\r\n    hdr.ver = this._st.read(3);\r\n    if (hdr.sig !== 'GIF') {\r\n      throw new Error('Not a GIF file.'); // XXX: This should probably be handled more nicely.\r\n    }\r\n\r\n    hdr.width = this._st.readUnsigned();\r\n    hdr.height = this._st.readUnsigned();\r\n\r\n    const bits = byteToBitArr(this._st.readByte());\r\n    hdr.gctFlag = bits.shift();\r\n    hdr.colorRes = bitsToNum(bits.splice(0, 3));\r\n    hdr.sorted = bits.shift();\r\n    hdr.globalColorTableSize = bitsToNum(bits.splice(0, 3));\r\n\r\n    hdr.bgColor = this._st.readByte();\r\n    hdr.pixelAspectRatio = this._st.readByte(); // if not 0, aspectRatio = (pixelAspectRatio + 15) / 64\r\n\r\n    if (hdr.gctFlag) {\r\n      hdr.globalColorTable = this.parseColorTable(1 << (hdr.globalColorTableSize + 1));\r\n      this.globalColorTable = hdr.globalColorTable;\r\n    }\r\n    if (this._handler.hdr && this._handler.hdr(hdr)) {\r\n      this.checkBytes.push(this._handler.hdr);\r\n    }\r\n  };\r\n\r\n  parseExt = (block: any) => {\r\n    const parseGCExt = (block: any) => {\r\n      this.checkBytes.push(this._st.readByte()); // Always 4\r\n\r\n      const bits = byteToBitArr(this._st.readByte());\r\n      block.reserved = bits.splice(0, 3); // Reserved; should be 000.\r\n      block.disposalMethod = bitsToNum(bits.splice(0, 3));\r\n      block.userInput = bits.shift();\r\n      block.transparencyGiven = bits.shift();\r\n\r\n      block.delayTime = this._st.readUnsigned();\r\n\r\n      block.transparencyIndex = this._st.readByte();\r\n\r\n      block.terminator = this._st.readByte();\r\n\r\n      if (this._handler.gce && this._handler.gce(block)) {\r\n        this.checkBytes.push(this._handler.gce);\r\n      }\r\n    };\r\n\r\n    const parseComExt = (block: any) => {\r\n      block.comment = this.readSubBlocks();\r\n      if (this._handler.com && this._handler.com(block)) {\r\n        this.checkBytes.push(this._handler.com);\r\n      }\r\n    };\r\n\r\n    const parsePTExt = (block: any) => {\r\n      this.checkBytes.push(this._st.readByte()); // Always 12\r\n      block.ptHeader = this._st.readBytes(12);\r\n      block.ptData = this.readSubBlocks();\r\n      if (this._handler.pte && this._handler.pte(block)) {\r\n        this.checkBytes.push(this._handler.pte);\r\n      }\r\n    };\r\n\r\n    const parseAppExt = (block: any) => {\r\n      const parseNetscapeExt = (block: any) => {\r\n        this.checkBytes.push(this._st.readByte()); // Always 3\r\n        block.unknown = this._st.readByte(); // Q: Always 1? What is this?\r\n        block.iterations = this._st.readUnsigned();\r\n        block.terminator = this._st.readByte();\r\n        if (this._handler.app && this._handler.app.NETSCAPE && this._handler.app.NETSCAPE(block)) {\r\n          this.checkBytes.push(this._handler.app);\r\n        }\r\n      };\r\n\r\n      const parseUnknownAppExt = (block: any) => {\r\n        block.appData = this.readSubBlocks();\r\n        // FIXME: This won't work if a handler wants to match on any identifier.\r\n        if (this._handler.app && this._handler.app[block.identifier] && this._handler.app[block.identifier](block)) {\r\n          this.checkBytes.push(this._handler.app[block.identifier]);\r\n        }\r\n      };\r\n\r\n      this.checkBytes.push(this._st.readByte()); // Always 11\r\n      block.identifier = this._st.read(8);\r\n      block.authCode = this._st.read(3);\r\n      switch (block.identifier) {\r\n        case 'NETSCAPE':\r\n          parseNetscapeExt(block);\r\n          break;\r\n        default:\r\n          parseUnknownAppExt(block);\r\n          break;\r\n      }\r\n    };\r\n\r\n    const parseUnknownExt = (block: any) => {\r\n      block.data = this.readSubBlocks();\r\n      if (this._handler.unknown && this._handler.unknown(block)) {\r\n        this.checkBytes.push(this._handler.unknown);\r\n      }\r\n    };\r\n\r\n    block.label = this._st.readByte();\r\n    switch (block.label) {\r\n      case 0xf9:\r\n        block.extType = 'gce';\r\n        parseGCExt(block);\r\n        break;\r\n      case 0xfe:\r\n        block.extType = 'com';\r\n        parseComExt(block);\r\n        break;\r\n      case 0x01:\r\n        block.extType = 'pte';\r\n        parsePTExt(block);\r\n        break;\r\n      case 0xff:\r\n        block.extType = 'app';\r\n        parseAppExt(block);\r\n        break;\r\n      default:\r\n        block.extType = 'unknown';\r\n        parseUnknownExt(block);\r\n        break;\r\n    }\r\n  };\r\n\r\n  parseImg = (img: any) => {\r\n    const deinterlace = (pixels: any, width: any) => {\r\n      // Of course this defeats the purpose of interlacing. And it's *probably*\r\n      // the least efficient way it's ever been implemented. But nevertheless...\r\n\r\n      const newPixels = new Array(pixels.length);\r\n      const rows = pixels.length / width;\r\n      const cpRow = (toRow: any, fromRow: any) => {\r\n        const fromPixels = pixels.slice(fromRow * width, (fromRow + 1) * width);\r\n        newPixels.splice.apply(newPixels, [toRow * width, width].concat(fromPixels));\r\n      };\r\n\r\n      const offsets = [0, 4, 2, 1];\r\n      const steps = [8, 8, 4, 2];\r\n\r\n      let fromRow = 0;\r\n      for (let pass = 0; pass < 4; pass++) {\r\n        for (let toRow = offsets[pass]; toRow < rows; toRow += steps[pass]) {\r\n          cpRow(toRow, fromRow);\r\n          fromRow++;\r\n        }\r\n      }\r\n\r\n      return newPixels;\r\n    };\r\n\r\n    img.leftPos = this._st.readUnsigned();\r\n    img.topPos = this._st.readUnsigned();\r\n    img.width = this._st.readUnsigned();\r\n    img.height = this._st.readUnsigned();\r\n\r\n    const bits = byteToBitArr(this._st.readByte());\r\n    img.lctFlag = bits.shift();\r\n    img.interlaced = bits.shift();\r\n    img.sorted = bits.shift();\r\n    img.reserved = bits.splice(0, 2);\r\n    img.lctSize = bitsToNum(bits.splice(0, 3));\r\n\r\n    if (img.lctFlag) {\r\n      img.lct = this.parseColorTable(1 << (img.lctSize + 1));\r\n    }\r\n\r\n    img.lzwMinCodeSize = this._st.readByte();\r\n\r\n    const lzwData = this.readSubBlocks();\r\n\r\n    img.pixels = lzwDecode(img.lzwMinCodeSize, lzwData);\r\n\r\n    if (img.interlaced) {\r\n      // Move\r\n      img.pixels = deinterlace(img.pixels, img.width);\r\n    }\r\n\r\n    this.frames.push(img);\r\n    this.arrayToImage(img);\r\n    if (this._handler.img && this._handler.img(img)) {\r\n      this.checkBytes.push(this._handler);\r\n    }\r\n  };\r\n\r\n  public parseBlock = () => {\r\n    const block = {\r\n      sentinel: this._st.readByte(),\r\n      type: ''\r\n    };\r\n    const blockChar = String.fromCharCode(block.sentinel);\r\n    switch (blockChar) {\r\n      case '!':\r\n        block.type = 'ext';\r\n        this.parseExt(block);\r\n        break;\r\n      case ',':\r\n        block.type = 'img';\r\n        this.parseImg(block);\r\n        break;\r\n      case ';':\r\n        block.type = 'eof';\r\n        if (this._handler.eof && this._handler.eof(block)) {\r\n          this.checkBytes.push(this._handler.eof);\r\n        }\r\n        break;\r\n      default:\r\n        throw new Error('Unknown block: 0x' + block.sentinel.toString(16));\r\n    }\r\n\r\n    if (block.type !== 'eof') {\r\n      this.parseBlock();\r\n    }\r\n  };\r\n\r\n  arrayToImage = (frame: GifFrame) => {\r\n    let count = 0;\r\n    const c = document.createElement('canvas');\r\n    c.id = count.toString();\r\n    c.width = frame.width;\r\n    c.height = frame.height;\r\n    count++;\r\n    const context = c.getContext('2d');\r\n    const pixSize = 1;\r\n    let y = 0;\r\n    let x = 0;\r\n    for (let i = 0; i < frame.pixels.length; i++) {\r\n      if (x % frame.width === 0) {\r\n        y++;\r\n        x = 0;\r\n      }\r\n      if (this.globalColorTable[frame.pixels[i]] === this._transparentColor.toHex()) {\r\n        context.fillStyle = `rgba(0, 0, 0, 0)`;\r\n      } else {\r\n        context.fillStyle = this.globalColorTable[frame.pixels[i]];\r\n      }\r\n\r\n      context.fillRect(x, y, pixSize, pixSize);\r\n      x++;\r\n    }\r\n    const img = new Image();\r\n    img.src = c.toDataURL();\r\n    this.images.push(img);\r\n  };\r\n}\r\n","import { ImageFiltering } from '.';\r\nimport { Vector, vec } from '../Math/vector';\r\nimport { Raster, RasterOptions } from './Raster';\r\n\r\nexport interface PolygonOptions {\r\n  points: Vector[];\r\n}\r\n\r\n/**\r\n * A polygon [[Graphic]] for drawing arbitrary polygons to the [[ExcaliburGraphicsContext]]\r\n *\r\n * Polygons default to [[ImageFiltering.Blended]]\r\n */\r\nexport class Polygon extends Raster {\r\n  private _points: Vector[];\r\n  public get points(): Vector[] {\r\n    return this._points;\r\n  }\r\n  public set points(points: Vector[]) {\r\n    this._points = points;\r\n    const min = this.minPoint;\r\n    this.width = this._points.reduce((max, p) => Math.max(p.x, max), 0) - min.x;\r\n    this.height = this._points.reduce((max, p) => Math.max(p.y, max), 0) - min.y;\r\n    this.flagDirty();\r\n  }\r\n\r\n  public get minPoint() {\r\n    const minX = this._points.reduce((min, p) => Math.min(p.x, min), Infinity);\r\n    const minY = this._points.reduce((min, p) => Math.min(p.y, min), Infinity);\r\n    return vec(minX, minY);\r\n  }\r\n\r\n  constructor(options: RasterOptions & PolygonOptions) {\r\n    super(options);\r\n    this.points = options.points;\r\n    this.filtering = ImageFiltering.Blended;\r\n    this.rasterize();\r\n  }\r\n\r\n  public clone(): Polygon {\r\n    return new Polygon({\r\n      points: this.points.map((p) => p.clone()),\r\n      ...this.cloneGraphicOptions(),\r\n      ...this.cloneRasterOptions()\r\n    });\r\n  }\r\n\r\n  execute(ctx: CanvasRenderingContext2D): void {\r\n    if (this.points && this.points.length) {\r\n      ctx.beginPath();\r\n      // Iterate through the supplied points and construct a 'polygon'\r\n      const min = this.minPoint.negate();\r\n      const firstPoint = this.points[0].add(min);\r\n      ctx.moveTo(firstPoint.x, firstPoint.y);\r\n      this.points.forEach((point) => {\r\n        ctx.lineTo(point.x + min.x, point.y + min.y);\r\n      });\r\n      ctx.lineTo(firstPoint.x, firstPoint.y);\r\n      ctx.closePath();\r\n      if (this.color) {\r\n        ctx.fill();\r\n      }\r\n      if (this.strokeColor) {\r\n        ctx.stroke();\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { obsolete } from './Decorators';\r\n\r\n/**\r\n * A sorted list implementation. NOTE: this implementation is not self-balancing\r\n * @deprecated WIll be removed in v0.26.0 Use built in JS array.sort\r\n */\r\n@obsolete({message: 'Will be removed in excalibur v0.26.0', alternateMethod: 'Use built in JS array.sort'})\r\nexport class SortedList<T> {\r\n  private _getComparable: (item: T) => number;\r\n  private _root: BinaryTreeNode<T>;\r\n\r\n  constructor(getComparable: (item: T) => number) {\r\n    this._getComparable = getComparable;\r\n  }\r\n\r\n  public find(element: T): boolean {\r\n    return this._find(this._root, element);\r\n  }\r\n\r\n  private _find(node: BinaryTreeNode<T>, element: any): boolean {\r\n    if (node == null) {\r\n      return false;\r\n    } else if (this._getComparable(element) === node.getKey()) {\r\n      if (node.getData().indexOf(element) > -1) {\r\n        return true;\r\n      } else {\r\n        return false;\r\n      }\r\n    } else if (this._getComparable(element) < node.getKey()) {\r\n      return this._find(node.getLeft(), element);\r\n    } else {\r\n      return this._find(node.getRight(), element);\r\n    }\r\n  }\r\n\r\n  // returns the array of elements at a specific key value\r\n  public get(key: number): any[] {\r\n    return this._get(this._root, key);\r\n  }\r\n\r\n  private _get(node: BinaryTreeNode<T>, key: number): any[] {\r\n    if (node == null) {\r\n      return [];\r\n    } else if (key === node.getKey()) {\r\n      return node.getData();\r\n    } else if (key < node.getKey()) {\r\n      return this._get(node.getLeft(), key);\r\n    } else {\r\n      return this._get(node.getRight(), key);\r\n    }\r\n  }\r\n\r\n  public add(element: T): boolean {\r\n    if (this._root == null) {\r\n      this._root = new BinaryTreeNode(this._getComparable(element), [element], null, null);\r\n      return true;\r\n    } else {\r\n      return this._insert(this._root, element);\r\n    }\r\n  }\r\n\r\n  private _insert(node: BinaryTreeNode<T>, element: T): boolean {\r\n    if (node != null) {\r\n      if (this._getComparable(element) === node.getKey()) {\r\n        if (node.getData().indexOf(element) > -1) {\r\n          return false; // the element we're trying to insert already exists\r\n        } else {\r\n          node.getData().push(element);\r\n          return true;\r\n        }\r\n      } else if (this._getComparable(element) < node.getKey()) {\r\n        if (node.getLeft() == null) {\r\n          node.setLeft(new BinaryTreeNode(this._getComparable(element), [element], null, null));\r\n          return true;\r\n        } else {\r\n          return this._insert(node.getLeft(), element);\r\n        }\r\n      } else {\r\n        if (node.getRight() == null) {\r\n          node.setRight(new BinaryTreeNode(this._getComparable(element), [element], null, null));\r\n          return true;\r\n        } else {\r\n          return this._insert(node.getRight(), element);\r\n        }\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  public removeByComparable(element: T): void {\r\n    this._root = this._remove(this._root, element);\r\n  }\r\n\r\n  private _remove(node: BinaryTreeNode<T>, element: T): BinaryTreeNode<T> {\r\n    if (node == null) {\r\n      return null;\r\n    } else if (this._getComparable(element) === node.getKey()) {\r\n      const elementIndex = node.getData().indexOf(element);\r\n      // if the node contains the element, remove the element\r\n      if (elementIndex > -1) {\r\n        node.getData().splice(elementIndex, 1);\r\n        // if we have removed the last element at this node, remove the node\r\n        if (node.getData().length === 0) {\r\n          // if the node is a leaf\r\n          if (node.getLeft() == null && node.getRight() == null) {\r\n            return null;\r\n          } else if (node.getLeft() == null) {\r\n            return node.getRight();\r\n          } else if (node.getRight() == null) {\r\n            return node.getLeft();\r\n          }\r\n          // if node has 2 children\r\n          const temp = this._findMinNode(node.getRight());\r\n          node.setKey(temp.getKey());\r\n          node.setData(temp.getData());\r\n          node.setRight(this._cleanup(node.getRight(), temp)); //\"cleanup nodes\" (move them up recursively)\r\n          return node;\r\n        } else {\r\n          // this prevents the node from being removed since it still contains elements\r\n          return node;\r\n        }\r\n      }\r\n    } else if (this._getComparable(element) < node.getKey()) {\r\n      node.setLeft(this._remove(node.getLeft(), element));\r\n      return node;\r\n    } else {\r\n      node.setRight(this._remove(node.getRight(), element));\r\n      return node;\r\n    }\r\n    return null;\r\n  }\r\n\r\n  // called once we have successfully removed the element we wanted, recursively corrects the part of the tree below the removed node\r\n  private _cleanup(node: BinaryTreeNode<T>, element: BinaryTreeNode<T>): BinaryTreeNode<T> {\r\n    const comparable = element.getKey();\r\n    if (node == null) {\r\n      return null;\r\n    } else if (comparable === node.getKey()) {\r\n      // if the node is a leaf\r\n      if (node.getLeft() == null && node.getRight() == null) {\r\n        return null;\r\n      } else if (node.getLeft() == null) {\r\n        return node.getRight();\r\n      } else if (node.getRight() == null) {\r\n        return node.getLeft();\r\n      }\r\n      // if node has 2 children\r\n      const temp = this._findMinNode(node.getRight());\r\n      node.setKey(temp.getKey());\r\n      node.setData(temp.getData());\r\n\r\n      node.setRight(this._cleanup(node.getRight(), temp));\r\n      return node;\r\n    } else if (element.getKey() < node.getKey()) {\r\n      node.setLeft(this._cleanup(node.getLeft(), element));\r\n      return node;\r\n    } else {\r\n      node.setRight(this._cleanup(node.getRight(), element));\r\n      return node;\r\n    }\r\n  }\r\n\r\n  private _findMinNode(node: BinaryTreeNode<T>): BinaryTreeNode<T> {\r\n    let current = node;\r\n    while (current.getLeft() != null) {\r\n      current = current.getLeft();\r\n    }\r\n    return current;\r\n  }\r\n\r\n  public list(): Array<T> {\r\n    const results = new Array<T>();\r\n    this._list(this._root, results);\r\n    return results;\r\n  }\r\n\r\n  private _list(treeNode: BinaryTreeNode<T>, results: Array<T>): void {\r\n    if (treeNode != null) {\r\n      this._list(treeNode.getLeft(), results);\r\n      treeNode.getData().forEach((element) => {\r\n        results.push(element);\r\n      });\r\n      this._list(treeNode.getRight(), results);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * A tree node part of [[SortedList]]\r\n * @deprecated Will be removed in v0.26.0\r\n */\r\n@obsolete({message: 'Will be removed in excalibur v0.26.0'})\r\nexport class BinaryTreeNode<T> {\r\n  private _key: number;\r\n  private _data: Array<T>;\r\n  private _left: BinaryTreeNode<T>;\r\n  private _right: BinaryTreeNode<T>;\r\n\r\n  constructor(key: number, data: Array<T>, left: BinaryTreeNode<T>, right: BinaryTreeNode<T>) {\r\n    this._key = key;\r\n    this._data = data;\r\n    this._left = left;\r\n    this._right = right;\r\n  }\r\n\r\n  public getKey(): number {\r\n    return this._key;\r\n  }\r\n\r\n  public setKey(key: number) {\r\n    this._key = key;\r\n  }\r\n\r\n  public getData(): T[] {\r\n    return this._data;\r\n  }\r\n\r\n  public setData(data: T[]) {\r\n    this._data = data;\r\n  }\r\n\r\n  public getLeft(): BinaryTreeNode<T> {\r\n    return this._left;\r\n  }\r\n\r\n  public setLeft(left: BinaryTreeNode<T>) {\r\n    this._left = left;\r\n  }\r\n\r\n  public getRight(): BinaryTreeNode<T> {\r\n    return this._right;\r\n  }\r\n\r\n  public setRight(right: BinaryTreeNode<T>) {\r\n    this._right = right;\r\n  }\r\n}\r\n\r\n/**\r\n * Mock element for testing\r\n *\r\n * @internal\r\n * @deprecated Will be removed in v0.26.0\r\n */\r\nexport class MockedElement {\r\n  private _key: number = 0;\r\n\r\n  constructor(key: number) {\r\n    this._key = key;\r\n  }\r\n\r\n  public getTheKey() {\r\n    return this._key;\r\n  }\r\n\r\n  public setKey(key: number) {\r\n    this._key = key;\r\n  }\r\n}\r\n","import { Logger } from '..';\r\nexport class Pool<Type> {\r\n  public totalAllocations = 0;\r\n  public index = 0;\r\n  public objects: Type[] = [];\r\n  private _logger = Logger.getInstance();\r\n\r\n  constructor(\r\n    public builder: (...args: any[]) => Type,\r\n    public recycler: (instance: Type, ...args: any[]) => Type,\r\n    public maxObjects: number = 100\r\n  ) {}\r\n\r\n  /**\r\n   * Use many instances out of the in the context and return all to the pool.\r\n   *\r\n   * By returning values out of the context they will be un-hooked from the pool and are free to be passed to consumers\r\n   * @param context\r\n   */\r\n  using(context: (pool: Pool<Type>) => Type[] | void) {\r\n    const result = context(this);\r\n    if (result) {\r\n      return this.done(...result);\r\n    }\r\n    return this.done();\r\n  }\r\n\r\n  /**\r\n   * Use a single instance out of th pool and immediately return it to the pool\r\n   * @param context\r\n   */\r\n  borrow(context: (object: Type) => void) {\r\n    const object = this.get();\r\n    context(object);\r\n    this.index--;\r\n  }\r\n\r\n  /**\r\n   * Retrieve a value from the pool, will allocate a new instance if necessary or recycle from the pool\r\n   * @param args\r\n   */\r\n  get(...args: any[]): Type {\r\n    if (this.index === this.maxObjects) {\r\n      this._logger.warn('Max pooled objects reached, possible memory leak? Doubling');\r\n      this.maxObjects = this.maxObjects * 2;\r\n    }\r\n\r\n    if (this.objects[this.index]) {\r\n      // Pool has an available object already constructed\r\n      return this.recycler(this.objects[this.index++], ...args);\r\n    } else {\r\n      // New allocation\r\n      this.totalAllocations++;\r\n      const object = (this.objects[this.index++] = this.builder(...args));\r\n      return object;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Signals we are done with the pool objects for now, Reclaims all objects in the pool.\r\n   *\r\n   * If a list of pooled objects is passed to done they are un-hooked from the pool and are free\r\n   * to be passed to consumers\r\n   * @param objects A list of object to separate from the pool\r\n   */\r\n  done(...objects: Type[]): Type[];\r\n  done(): void;\r\n  done(...objects: Type[]): Type[] | void {\r\n    // All objects in pool now considered \"free\"\r\n    this.index = 0;\r\n    for (const object of objects) {\r\n      const poolIndex = this.objects.indexOf(object);\r\n      // Build a new object to take the pool place\r\n      this.objects[poolIndex] = (this as any).builder(); // TODO problematic 0-arg only support\r\n      this.totalAllocations++;\r\n    }\r\n    return objects;\r\n  }\r\n}\r\n","// Promises/A+ Spec http://promises-aplus.github.io/promises-spec/\r\n\r\nimport { obsolete } from './Util/Decorators';\r\n\r\n/**\r\n * Valid states for a promise to be in\r\n * @deprecated Will be removed in v0.26.0\r\n */\r\nexport enum PromiseState {\r\n  Resolved,\r\n  Rejected,\r\n  Pending\r\n}\r\n\r\n/**\r\n * @deprecated Will be removed in v0.26.0\r\n */\r\nexport interface PromiseLike<T> {\r\n  then(successCallback?: (value?: T) => any, rejectCallback?: (value?: T) => any): PromiseLike<T>;\r\n  error(rejectCallback?: (value?: any) => any): PromiseLike<T>;\r\n\r\n  //Cannot define static methods on interfaces\r\n  //wrap<T>(value?: T): IPromise<T>;\r\n\r\n  resolve(value?: T): PromiseLike<T>;\r\n  reject(value?: any): PromiseLike<T>;\r\n\r\n  state(): PromiseState;\r\n}\r\n\r\n/**\r\n * Promises are used to do asynchronous work and they are useful for\r\n * creating a chain of actions. In Excalibur they are used for loading,\r\n * sounds, animation, actions, and more.\r\n * @deprecated Will be removed in v0.26.0\r\n */\r\n@obsolete({\r\n  message: 'ex.Promises are being replaced by native browser promises in v0.26.0',\r\n  alternateMethod: 'Use browser native promises'\r\n})\r\nexport class Promise<T> implements PromiseLike<T> {\r\n  private _state: PromiseState = PromiseState.Pending;\r\n  private _value: T;\r\n  private _successCallbacks: { (value?: T): any }[] = [];\r\n  private _rejectCallback: (value?: any) => any = () => {\r\n    return;\r\n  };\r\n  private _errorCallback: (value?: any) => any;\r\n\r\n  /**\r\n   * Create and resolve a Promise with an optional value\r\n   * @param value  An optional value to wrap in a resolved promise\r\n   * @deprecated Use browser native promises\r\n   */\r\n  public static resolve<T>(value?: T): Promise<T> {\r\n    const promise = new Promise<T>().resolve(value);\r\n\r\n    return promise;\r\n  }\r\n\r\n  /**\r\n   * Create and reject a Promise with an optional value\r\n   * @param value  An optional value to wrap in a rejected promise\r\n   * @deprecated Use browser native promises\r\n   */\r\n  public static reject<T>(value?: T): Promise<T> {\r\n    const promise = new Promise<T>().reject(value);\r\n\r\n    return promise;\r\n  }\r\n\r\n  /**\r\n   * Returns a new promise that resolves when all the promises passed to it resolve, or rejects\r\n   * when at least 1 promise rejects.\r\n   * @deprecated Use browser native promises\r\n   */\r\n  public static join<T>(promises: Promise<T>[]): Promise<T>;\r\n\r\n  /**\r\n   * Returns a new promise that resolves when all the promises passed to it resolve, or rejects\r\n   * when at least 1 promise rejects.\r\n   * @deprecated Use browser native promises\r\n   */\r\n  public static join<T>(...promises: Promise<T>[]): Promise<T>;\r\n\r\n  public static join<T>() {\r\n    let promises: Promise<T>[] = [];\r\n\r\n    if (arguments.length > 0 && !Array.isArray(arguments[0])) {\r\n      for (let _i = 0; _i < arguments.length; _i++) {\r\n        promises[_i - 0] = arguments[_i];\r\n      }\r\n    } else if (arguments.length === 1 && Array.isArray(arguments[0])) {\r\n      promises = arguments[0];\r\n    }\r\n\r\n    const joinedPromise = new Promise<T>();\r\n    if (!promises || !promises.length) {\r\n      return joinedPromise.resolve();\r\n    }\r\n\r\n    const total = promises.length;\r\n    let successes = 0;\r\n    let rejects = 0;\r\n    const errors: any = [];\r\n\r\n    promises.forEach((p) => {\r\n      p.then(\r\n        () => {\r\n          successes += 1;\r\n          if (successes === total) {\r\n            joinedPromise.resolve();\r\n          } else if (successes + rejects + errors.length === total) {\r\n            joinedPromise.reject(errors);\r\n          }\r\n        },\r\n        () => {\r\n          rejects += 1;\r\n          if (successes + rejects + errors.length === total) {\r\n            joinedPromise.reject(errors);\r\n          }\r\n        }\r\n      ).error((e) => {\r\n        errors.push(e);\r\n        if (errors.length + successes + rejects === total) {\r\n          joinedPromise.reject(errors);\r\n        }\r\n      });\r\n    });\r\n\r\n    return joinedPromise;\r\n  }\r\n\r\n  /**\r\n   * Chain success and reject callbacks after the promise is resolved\r\n   * @param successCallback  Call on resolution of promise\r\n   * @param rejectCallback   Call on rejection of promise\r\n   * @deprecated Use browser native promises\r\n   */\r\n  public then(successCallback?: (value?: T) => any, rejectCallback?: (value?: any) => any) {\r\n    if (successCallback) {\r\n      this._successCallbacks.push(successCallback);\r\n\r\n      // If the promise is already resolved call immediately\r\n      if (this.state() === PromiseState.Resolved) {\r\n        try {\r\n          successCallback.call(this, this._value);\r\n        } catch (e) {\r\n          this._handleError(e);\r\n        }\r\n      }\r\n    }\r\n    if (rejectCallback) {\r\n      this._rejectCallback = rejectCallback;\r\n\r\n      // If the promise is already rejected call immediately\r\n      if (this.state() === PromiseState.Rejected) {\r\n        try {\r\n          rejectCallback.call(this, this._value);\r\n        } catch (e) {\r\n          this._handleError(e);\r\n        }\r\n      }\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Add an error callback to the promise\r\n   * @param errorCallback  Call if there was an error in a callback\r\n   * @deprecated Use browser native promises\r\n   */\r\n  public error(errorCallback?: (value?: any) => any) {\r\n    if (errorCallback) {\r\n      this._errorCallback = errorCallback;\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Resolve the promise and pass an option value to the success callbacks\r\n   * @param value  Value to pass to the success callbacks\r\n   * @deprecated Use browser native promises\r\n   */\r\n  public resolve(value?: T): Promise<T> {\r\n    if (this._state === PromiseState.Pending) {\r\n      this._value = value;\r\n      try {\r\n        this._state = PromiseState.Resolved;\r\n        this._successCallbacks.forEach((cb) => {\r\n          cb.call(this, this._value);\r\n        });\r\n      } catch (e) {\r\n        this._handleError(e);\r\n      }\r\n    } else {\r\n      throw new Error('Cannot resolve a promise that is not in a pending state!');\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Reject the promise and pass an option value to the reject callbacks\r\n   * @param value  Value to pass to the reject callbacks\r\n   * @deprecated Use browser native promises\r\n   */\r\n  public reject(value?: any) {\r\n    if (this._state === PromiseState.Pending) {\r\n      this._value = value;\r\n      try {\r\n        this._state = PromiseState.Rejected;\r\n        this._rejectCallback.call(this, this._value);\r\n      } catch (e) {\r\n        this._handleError(e);\r\n      }\r\n    } else {\r\n      throw new Error('Cannot reject a promise that is not in a pending state!');\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Inspect the current state of a promise\r\n   * @deprecated Use browser native promises\r\n   */\r\n  public state(): PromiseState {\r\n    return this._state;\r\n  }\r\n\r\n  private _handleError(e: any) {\r\n    if (this._errorCallback) {\r\n      this._errorCallback.call(this, e);\r\n    } else {\r\n      // rethrow error\r\n      throw e;\r\n    }\r\n  }\r\n}\r\n","/**\r\n * The current Excalibur version string\r\n * @description `process.env.__EX_VERSION` gets replaced by Webpack on build\r\n */\r\nexport const EX_VERSION = process.env.__EX_VERSION;\r\nimport { polyfill } from './Polyfill';\r\npolyfill();\r\n\r\n// This file is used as the bundle entry point and exports everything\r\n// that will be exposed as the `ex` global variable.\r\nexport * from './Flags';\r\nexport * from './Id';\r\nexport * from './Engine';\r\nexport * from './Screen';\r\nexport { Actor, ActorArgs } from './Actor';\r\nexport * from './Math/Index';\r\nexport * from './Camera';\r\nexport * from './Class';\r\nexport * from './Configurable';\r\nexport * from './Debug/index';\r\nexport * from './EventDispatcher';\r\nexport * from './Events/MediaEvents';\r\nexport * from './Events';\r\nexport * from './Label';\r\nexport { FontStyle, FontUnit, TextAlign, BaseAlign } from './Graphics/FontCommon';\r\nexport * from './Loader';\r\nexport { Particle, ParticleEmitter, ParticleArgs, ParticleEmitterArgs, EmitterType } from './Particles';\r\nexport * from './Collision/Physics';\r\nexport * from './Scene';\r\nexport { TileMap, Cell, TileMapArgs, CellArgs } from './TileMap';\r\nexport * from './Timer';\r\nexport * from './Trigger';\r\nexport * from './ScreenElement';\r\n\r\nexport * from './Actions/Index';\r\nexport * from './Collision/Index';\r\n\r\n// ex.LegacyDrawing namespace\r\nimport * as legacyDrawing from './Drawing/Index';\r\nexport { legacyDrawing as LegacyDrawing };\r\nexport * from './Interfaces/Index';\r\nexport * from './Resources/Index';\r\n\r\nexport * from './EntityComponentSystem/index';\r\n\r\nexport * from './Color';\r\n\r\nexport * from './Graphics/index';\r\n\r\n// ex.Events namespace\r\nimport * as events from './Events';\r\nexport { events as Events };\r\n\r\n// ex.Input namespace\r\nimport * as input from './Input/Index';\r\nexport { input as Input };\r\nexport { PointerComponent } from './Input/Index';\r\nexport { PointerSystem } from './Input/PointerSystem';\r\n\r\n// ex.Traits namespace\r\nimport * as traits from './Traits/Index';\r\nexport { traits as Traits };\r\n\r\n// ex.Util namespaces\r\nimport * as util from './Util/Index';\r\nexport { util as Util };\r\n\r\nexport * from './Util/Browser';\r\nexport * from './Util/Decorators';\r\nexport * from './Util/Detector';\r\nexport * from './Util/CullingBox';\r\nexport * from './Util/EasingFunctions';\r\nexport * from './Util/Observable';\r\nexport * from './Util/Log';\r\nexport * from './Util/SortedList';\r\nexport * from './Util/Pool';\r\nexport * from './Util/Fps';\r\nexport * from './Util/Clock';\r\nexport * from './Util/WebAudio';\r\n\r\n// ex.Deprecated\r\nexport * from './Promises';\r\n// import * as deprecated from './Deprecated';\r\n// export { deprecated as Deprecated };\r\n// export * from './Deprecated';\r\n","import { Actor, CollisionType, Color, Engine, vec } from \"excalibur\";\n// game.js\n\n// start-snippet{create-engine}\n// Create an instance of the engine.\n// I'm specifying that the game be 800 pixels wide by 600 pixels tall.\n// If no dimensions are specified the game will fit to the screen.\nconst game = new Engine({\n  width: 800,\n  height: 600,\n});\n// end-snippet{create-engine}\n\n// start-snippet{create-paddle}\n// Create an actor with x position of 150px,\n// y position of 40px from the bottom of the screen,\n// width of 200px, height and a height of 20px\nconst paddle = new Actor({\n  x: 150,\n  y: game.drawHeight - 40,\n  width: 200,\n  height: 20,\n  // Let's give it some color with one of the predefined\n  // color constants\n  color: Color.Chartreuse,\n});\n\n// Make sure the paddle can partipate in collisions, by default excalibur actors do not collide with each other\n// CollisionType.Fixed is like an object with infinite mass, and cannot be moved, but does participate in collision.\npaddle.body.collisionType = CollisionType.Fixed;\n\n// `game.add` is the same as calling\n// `game.currentScene.add`\ngame.add(paddle);\n// end-snippet{create-paddle}\n\n// start-snippet{mouse-move}\n// Add a mouse move listener\ngame.input.pointers.primary.on(\"move\", (evt) => {\n  paddle.pos.x = evt.worldPos.x;\n});\n// end-snippet{mouse-move}\n\n// start-snippet{create-ball}\n// Create a ball at pos (100, 300) to start\nconst ball = new Actor({\n  x: 100,\n  y: 300,\n  // Use a circle collider with radius 10\n  radius: 10,\n  // Set the color\n  color: Color.Red,\n});\n\n// Start the serve after a second\nsetTimeout(() => {\n  // Set the velocity in pixels per second\n  ball.vel = vec(100, 100);\n}, 1000);\n\n// Set the collision Type to passive\n// This means \"tell me when I collide with an emitted event, but don't let excalibur do anything automatically\"\nball.body.collisionType = CollisionType.Passive;\n// Other possible collision types:\n// \"ex.CollisionType.PreventCollision - this means do not participate in any collision notification at all\"\n// \"ex.CollisionType.Active - this means participate and let excalibur resolve the positions/velocities of actors after collision\"\n// \"ex.CollisionType.Fixed - this means participate, but this object is unmovable\"\n\n// Add the ball to the current scene\ngame.add(ball);\n// end-snippet{create-ball}\n\n// start-snippet{screen-collision}\n// Wire up to the postupdate event\nball.on(\"postupdate\", () => {\n  // If the ball collides with the left side\n  // of the screen reverse the x velocity\n  if (ball.pos.x < ball.width / 2) {\n    ball.vel.x *= -1;\n  }\n\n  // If the ball collides with the right side\n  // of the screen reverse the x velocity\n  if (ball.pos.x + ball.width / 2 > game.drawWidth) {\n    ball.vel.x *= -1;\n  }\n\n  // If the ball collides with the top\n  // of the screen reverse the y velocity\n  if (ball.pos.y < ball.height / 2) {\n    ball.vel.y *= -1;\n  }\n});\n// end-snippet{screen-collision}\n\n// start-snippet{create-bricks}\n// Build Bricks\n\n// Padding between bricks\nconst padding = 20; // px\nconst xoffset = 65; // x-offset\nconst yoffset = 20; // y-offset\nconst columns = 5;\nconst rows = 3;\n\nconst brickColor = [Color.Violet, Color.Orange, Color.Yellow];\n\n// Individual brick width with padding factored in\nconst brickWidth = game.drawWidth / columns - padding - padding / columns; // px\nconst brickHeight = 30; // px\nconst bricks: Actor[] = [];\nfor (let j = 0; j < rows; j++) {\n  for (let i = 0; i < columns; i++) {\n    bricks.push(\n      new Actor({\n        x: xoffset + i * (brickWidth + padding) + padding,\n        y: yoffset + j * (brickHeight + padding) + padding,\n        width: brickWidth,\n        height: brickHeight,\n        color: brickColor[j % brickColor.length],\n      })\n    );\n  }\n}\n\nbricks.forEach(function (brick) {\n  // Make sure that bricks can participate in collisions\n  brick.body.collisionType = CollisionType.Active;\n\n  // Add the brick to the current scene to be drawn\n  game.add(brick);\n});\n// end-snippet{create-bricks}\n\n// start-snippet{ball-brick-collision}\n// On collision remove the brick, bounce the ball\nball.on(\"precollision\", function (ev) {\n  if (bricks.indexOf(ev.other) > -1) {\n    // kill removes an actor from the current scene\n    // therefore it will no longer be drawn or updated\n    ev.other.kill();\n  }\n\n  // reverse course after any collision\n  // intersections are the direction body A has to move to not be clipping body B\n  // `ev.intersection` is a vector `normalize()` will make the length of it 1\n  // `negate()` flips the direction of the vector\n  var intersection = ev.intersection.normalize();\n\n  // The largest component of intersection is our axis to flip\n  if (Math.abs(intersection.x) > Math.abs(intersection.y)) {\n    ball.vel.x *= -1;\n  } else {\n    ball.vel.y *= -1;\n  }\n});\n// end-snippet{ball-brick-collision}\n\n// start-snippet{lose-condition}\n// Loss condition\nball.on(\"exitviewport\", () => {\n  alert(\"You lose!\");\n});\n// end-snippet{lose-condition}\n\n// start-snippet{start-game}\n// Start the engine to begin the game.\ngame.start();\n// end-snippet{start-game}\n"],"names":["__webpack_require__","entryUnbind","module","exports","path","Object","keys","global","isCallable","tryToString","TypeError","argument","isObject","String","toIndexedObject","toAbsoluteIndex","lengthOfArrayLike","createMethod","IS_INCLUDES","$this","el","fromIndex","value","O","length","index","includes","indexOf","fails","METHOD_NAME","method","call","createProperty","Array","max","Math","start","end","k","fin","undefined","result","n","arraySlice","floor","mergeSort","array","comparefn","middle","insertionSort","merge","element","j","i","left","right","llength","rlength","lindex","rindex","uncurryThis","toString","stringSlice","slice","it","TO_STRING_TAG_SUPPORT","classofRaw","TO_STRING_TAG","wellKnownSymbol","CORRECT_ARGUMENTS","arguments","tag","key","error","tryGet","callee","hasOwn","ownKeys","getOwnPropertyDescriptorModule","definePropertyModule","target","source","exceptions","defineProperty","f","getOwnPropertyDescriptor","DESCRIPTORS","createPropertyDescriptor","object","bitmap","enumerable","configurable","writable","toPropertyKey","propertyKey","get","document","EXISTS","createElement","firefox","match","UA","test","getBuiltIn","version","userAgent","process","Deno","versions","v8","split","webkit","CONSTRUCTOR","METHOD","prototype","createNonEnumerableProperty","redefine","setGlobal","copyConstructorProperties","isForced","options","targetProperty","sourceProperty","descriptor","TARGET","GLOBAL","STATIC","stat","noTargetGet","forced","sham","exec","bind","hasOwnProperty","NATIVE_BIND","Function","apply","FunctionPrototype","getDescriptor","PROPER","name","CONFIGURABLE","fn","aFunction","namespace","aCallable","V","P","func","check","globalThis","window","self","g","this","toObject","a","classof","propertyIsEnumerable","store","functionToString","inspectSource","set","has","NATIVE_WEAK_MAP","shared","sharedKey","hiddenKeys","OBJECT_ALREADY_INITIALIZED","WeakMap","state","wmget","wmhas","wmset","metadata","facade","STATE","enforce","getterFor","TYPE","type","replacement","feature","detection","data","normalize","POLYFILL","NATIVE","string","replace","toLowerCase","isPrototypeOf","USE_SYMBOL_AS_UID","$Symbol","toLength","obj","V8_VERSION","getOwnPropertySymbols","symbol","Symbol","IE8_DOM_DEFINE","V8_PROTOTYPE_DEFINE_BUG","anObject","$defineProperty","$getOwnPropertyDescriptor","ENUMERABLE","WRITABLE","Attributes","current","propertyIsEnumerableModule","internalObjectKeys","concat","getOwnPropertyNames","push","names","enumBugKeys","$propertyIsEnumerable","NASHORN_BUG","input","pref","val","valueOf","getOwnPropertyNamesModule","getOwnPropertySymbolsModule","InternalStateModule","CONFIGURABLE_FUNCTION_NAME","getInternalState","enforceInternalState","TEMPLATE","unsafe","simple","join","uid","SHARED","IS_PURE","mode","copyright","license","toIntegerOrInfinity","min","integer","IndexedObject","requireObjectCoercible","ceil","number","isSymbol","getMethod","ordinaryToPrimitive","TO_PRIMITIVE","exoticToPrim","toPrimitive","id","postfix","random","NATIVE_SYMBOL","iterator","WellKnownSymbolsStore","symbolFor","createWellKnownSymbol","withoutSetter","description","$","internalSort","arrayMethodIsStrict","FF","IE_OR_EDGE","V8","WEBKIT","un$Sort","sort","FAILS_ON_UNDEFINED","FAILS_ON_NULL","STRICT_METHOD","STABLE_SORT","code","chr","fromCharCode","v","b","charAt","proto","itemsLength","items","arrayLength","x","y","getSortCompare","nativeKeys","___CSS_LOADER_EXPORT___","_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1___default","_node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0___default","sources","mappings","sourcesContent","sourceRoot","__WEBPACK_DEFAULT_EXPORT__","cssWithMappingToString","list","map","item","content","needLayer","modules","media","dedupe","supports","layer","alreadyImportedModules","_k","cssMapping","btoa","base64","unescape","encodeURIComponent","JSON","stringify","sourceMapping","sourceURLs","$2c23f148d58cd887$var$__webpack_module_cache__","$2c23f148d58cd887$var$__webpack_require__","moduleId","cachedModule","$2c23f148d58cd887$var$__webpack_modules__","getter","__esModule","d","definition","o","e","prop","r","toStringTag","Experiments1","Legacy1","Legacy","LogLevel","polyfill","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","callback","setInterval","cancelAnimationFrame","webkitCancelAnimationFrame","mozCancelAnimationFrame","AudioContext","webkitAudioContext","replaceMe","decodeAudioData","arrayBuffer","Promise","resolve","reject","mozAudioContext","msAudioContext","oAudioContext","devicePixelRatio","Flags","static","_FROZEN","_FLAGS","enable","WebGL","Canvas","LegacyDrawing","flagName","Error","createId","LogLevel1","Logger","constructor","_appenders","defaultLevel","Info","_INSTANCE","addAppender","ConsoleAppender","appender","level","args","len","log","_log","Debug","warn","Warn","fatal","Fatal","console","consoleArgs","unshift","width","height","_messages","_canvas","message","_ctx","clearRect","pos","opacity","fillStyle","toFixed","fillText","maxMessages","resetObsoleteCounter","obsoleteMessage","logMessage","suppressObsoleteMessages","isEnabled","getInstance","trace","showStackTrace","obsolete","alternateMethod","property","SyntaxError","DecoratedClass","super","Vector","_x","_y","Zero","One","Half","Up","Down","Left","Right","angle","cos","sin","vec","isNaN","Infinity","vec1","vec2","setTo","tolerance","abs","vector","sqrt","pow","distance","size","newLength","scale","add","sizeOrScale","scaleEqual","num","normal","perpendicular","atan2","anchor","sinAngle","cosAngle","fixed","decorators","desc","c","Reflect","decorate","Side1","Side","Color_decorate","Color","parseInt","parseFloat","hex","h","s","l","HSLColor","toRGBA","factor","temp","fromRGBA","desaturate","color","newR","newG","newB","newA","multiply","screen","color1","invert","color2","format","toHSLA","toHex","_componentToHex","Black","fromHex","White","Gray","LightGray","DarkGray","Yellow","Orange","Red","Vermilion","Vermillion","Magenta","Blue","Azure","Cyan","Viridian","Green","Chartreuse","Transparent","ExcaliburBlue","p","q","t","hue2rgb","getOpposite","side","Top","Bottom","None","fromDirection","direction","directions","directionEnum","Number","MAX_VALUE","maxIndex","dot","BoundingBox","leftOrOptions","top","bottom","intersection","points","minX","minY","maxX","maxY","hasZeroDimensions","center","translate","point","getPoints","rotate","fromPoints","shifted","transform","matrix","multv","getPerimeter","results","ray","farClipDistance","tmin","tmax","xinv","dir","yinv","tx1","tx2","ty1","ty2","rayCastTime","other","dimensions","intersect","totalBoundingBox","combine","equals","overlapX","overlapY","intersectWithSide","bb","getSideFromIntersection","debugDraw","ctx","strokeStyle","strokeRect","ex","debug","drawRect","seed","_lowerMask","_upperMask","_w","_n","_m","_a","_u","_s","_b","_t","_c","_l","_f","_mt","Date","now","mag01","BITMASK32","_index","_twist","nextInt","next","likelihood","numPicks","allowDuplicates","_pickSetWithDuplicates","_pickSetWithoutDuplicates","currentPick","tempArray","splice","pickOne","swap","randomIndex","TwoPI","PI","frac","sign","clamp","canonicalizeAngle","tmpAngle","toDegrees","radians","toRadians","degrees","from","to","randomInRange","Random","floating","randomIntInRange","round","Util_TwoPI","Util_clamp","Util_canonicalizeAngle","Util_toDegrees","Util_toRadians","Util_range","range","getPosition","oLeft","oTop","calcOffsetLeft","parent","offsetLeft","offsetParent","calcOffsetTop","offsetTop","addItemToArray","removeItemFromArray","getOppositeSide","getSideFromDirection","initialSize","Collection","DefaultSize","_internalArray","_endPointer","newSize","newArray","count","_resize","removed","removeElement","remove","delay1","milliseconds","clock","schedule","setTimeout","MatrixLocations","EventTypes","MatrixLocations1","Matrix","Float32Array","_scaleSignX","_scaleSignY","near","far","mat","toDOMMatrix","DOMMatrix","identity","sx","sy","angleRadians","dest","a11","a21","a31","a41","a12","a22","a32","a42","a13","a23","a33","a43","a14","a24","a34","a44","b11","b21","b31","b41","b12","b22","b32","b42","b13","b23","b33","b43","b14","b24","b34","b44","getScale","sine","cosine","currentScale","getRotation","getScaleY","getScaleX","xscale","yscale","setScaleX","setScaleY","setScale","getBasisDeterminant","getAffineInverse","inverseDet","m","tx","ty","isIdentity","TransformStack","_transforms","_currentTransform","save","clone","pop","_states","_currentState","_getDefaultState","_cloneState","restore","watch","change","__isProxy","Proxy","watchAny","Graphic","_d","_e","_ID","_transformStale","showDebug","_flipHorizontal","_flipVertical","_rotation","_scale","_origin","_width","_height","origin","flipHorizontal","flipVertical","rotation","isStale","localBounds","fromDimension","draw","_preDraw","_drawImage","_postDraw","reset","_rotate","_flip","scaleDirX","scaleDirY","nextHighestPowerOfTwo","ensurePowerOfTwo","isPowerOfTwo","gl","FLOAT","SHORT","UNSIGNED_SHORT","BYTE","UNSIGNED_BYTE","getAttributeComponentSize","LOW_FLOAT","HIGH_FLOAT","FLOAT_VEC2","FLOAT_VEC3","FLOAT_VEC4","context","TextureLoader","_GL","_MAX_TEXTURE_SIZE","getParameter","MAX_TEXTURE_SIZE","image","_TEXTURE_MAP","filtering","forceUpdate","tex","bindTexture","TEXTURE_2D","toPowerOfTwoImage","texImage2D","RGBA","createTexture","checkImageSizeSupportedAndLog","pixelStorei","UNPACK_PREMULTIPLY_ALPHA_WEBGL","texParameteri","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","filterMode","TEXTURE_MIN_FILTER","ImageFiltering1","Pixel","NEAREST","LINEAR","TEXTURE_MAG_FILTER","potCanvas","_POT_CANVAS","potCtx","_POT_CTX","imageSmoothingEnabled","drawImage","originalSrc","dataset","_LOGGER","Blended","getContext","Map","Raster","_g","_h","_dirty","_smoothing","_color","flagDirty","_lineWidth","_lineDash","_padding","strokeColor","smoothing","lineWidth","lineDash","padding","_bitmap","bitmapWidth","bitmapHeight","maybeCtx","cloneRasterOptions","dirty","_getTotalWidth","_originalWidth","_getTotalHeight","_originalHeight","_strokeColor","execute","load","setLineDash","getLineDash","rasterize","_options","cloneGraphicOptions","cache","EventTypes1","_bubbles","bubbles","GameEvent","delta","PreDebugDrawEvent","PostDebugDrawEvent","engine","prevStats","PostFrameEvent","stats","gamepad","button","axis","topic","handler","actor","contact","CollisionEndEvent","InitializeEvent","ActivateEvent","oldScene","DeactivateEvent","newScene","EventDispatcher","_handlers","_wiredEventDispatchers","event","eventName","emit","on","SubscribeEvent","off","eventHandlers","UnsubscribeEvent","once","ev","wire","eventDispatcher","responseType","bustCache","uri","logger","events","request","XMLHttpRequest","open","_cacheBust","addEventListener","status","response","statusText","send","imageData","firstPixel","pixel","avg","SpriteEffects_decorate","updatePixel","fromRGB","lighten","darken","saturate","_sprite","loaded","_loadedResolve","Resource","Sprite_Sprite","url","blob","_resource","URL","createObjectURL","Image","src","decode","naturalWidth","naturalHeight","Configurable","base","assign","props","filter","imageOrConfig","offset","drawAroundAnchor","effects","_spriteCanvas","_spriteCtx","_pixelData","_pixelsLoaded","_dirtyEffect","_opacity","Texture","texture","_initPixelsFromTexture","drawWidth","_loadPixels","isLoaded","_flushTexture","grayscale","addEffect","Grayscale","Invert","fill","Fill","Colorize","Lighten","Darken","Saturate","Desaturate","effect","_applyEffects","removeEffect","param","indexToRemove","getImageData","putImageData","xpoint","ypoint","drawHeight","ctxOrOptions","CanvasRenderingContext2D","_drawWithOptions","_j","anchorX","anchorY","oldAlpha","globalAlpha","SpriteImpl","Sprite_decorate","Sprite","sourceView","destSize","_updateSpriteDimensions","ready","then","newWidth","newHeight","nativeWidth","nativeHeight","sprite","ImageSource","fromLegacyTexture","_logger","_filtering","endsWith","_src","setAttribute","unload","engineOrConfig","sprites","speed","loop","currentFrame","Engine","config","_engine","_timeLeftInFrame","freezeFrame","colorize","clearEffects","_setAnchor","idempotencyToken","_idempotencyToken","elapsed","_updateValues","_setRotation","_setScale","frames","animOptions","currSprite","playAnimation","AnimationImpl","images","TextAlign","BaseAlign","Direction","Animation_decorate","FontUnit1","TextAlign1","BaseAlign1","FontStyle1","Direction1","imageOrConfigOrSprites","columns","rows","spWidth","spHeight","spacing","_sprites","_image","_columns","_rows","_spWidth","_spHeight","_spacing","loadFromImage","isWidthError","isHeightError","RangeError","getSpacingDimensions","row","col","margin","indices","Animation_Animation","beginIndex","endIndex","getAnimationForAll","spriteCoordinates","maxWidth","maxHeight","coord","anim","SpriteSheet_SpriteSheet","alphabet","caseInsensitive","_currentColor","_currentOpacity","_spriteRecord","_textShadowOn","_textShadowDirty","_textShadowColor","_textShadowSprites","_shadowOffsetX","_shadowOffsetY","getTextSprites","lookup","char","offsetX","offsetY","shadowColor","character","setTextShadow","text","_parseOptions","characterShadow","fontSize","letterSpacing","currX","textAlign","Start","End","Center","currY","baseAlign","Hanging","Ideographic","Alphabetic","Middle","charSprite","SpriteSheet_decorate","SpriteSheet","spriteIndex","legacySpriteSheet","oldSprite","fromLegacySprite","spriteSheet","toLegacySprite","grid","cols","spriteWidth","spriteHeight","originOffset","offsetDefaults","marginDefaults","_text","shadow","_alreadyWarnedAlphabet","_alreadyWarnedSpriteSheet","spriteFont","SpriteFont_SpriteFont","textToRender","toLocaleLowerCase","letterIndex","letter","letterSprite","lines","maxWidthLine","reduce","_getCharacterSprites","xCursor","yCursor","line","bounds","measureText","DebugText","fontSheet","_imageSource","_spriteSheet","fromImageSource","_spriteFont","write","render","_gl","_texture","use","activeTexture","TEXTURE0","_setupFramebuffer","_frameTexture","frameBuffer","_frameBuffer","frameTexture","attachmentPoint","COLOR_ATTACHMENT0","createFramebuffer","FRAMEBUFFER","disable","RenderSource","bindFramebuffer","viewport","ExcaliburWebGLContextAccessor","uniforms","attributes","_compiled","vertexSource","fragmentSource","compiled","program","_ACTIVE_SHADER_INSTANCE","Shader","compile","vertexShader","_compileShader","VERTEX_SHADER","fragmentShader","FRAGMENT_SHADER","_createProgram","getAttributes","attribute","getUniforms","uniform","uniformCount","getProgramParameter","ACTIVE_UNIFORMS","getActiveUniform","uniformLocation","getUniformLocation","glType","location","attributeCount","ACTIVE_ATTRIBUTES","getActiveAttrib","attributeLocation","getAttribLocation","getAttributePointerType","normalized","slotNumber","setUniform","setUniformBoolean","uniformType","isCurrentlyBound","createProgram","attachShader","LINK_STATUS","getProgramInfoLog","typeName","shader","createShader","shaderSource","getShaderParameter","COMPILE_STATUS","errorInfo","getShaderInfoLog","_processSourceForError","errorLineStart","search","errorLineEnd","_","error2","VertexBuffer","buffer","createBuffer","bufferData","ARRAY_BUFFER","bindBuffer","STATIC_DRAW","DYNAMIC_DRAW","VertexLayout","_layout","_attributes","_vertexTotalSizeBytes","vertexBuffer","_vertexBuffer","_shader","initialize","totalVertexSizeBytes","shaderAttributes","attrib","componentsPerVertex","vertAttribute","typeSize","getGlTypeSizeBytes","uploadBuffer","upload","vert","vertexAttribPointer","enableVertexAttribArray","DrawCallCount","DrawnImagesCount","priority","_maxLines","_vertexIndex","_lineCount","_context","setUniformMatrix","ortho","_isFull","flush","getTransform","finalStart","finalEnd","drawArrays","LINES","GraphicsDiagnostics","PointRenderer","_maxPoints","_pointCount","_buffer","finalPoint","POINTS","postprocessor","getLayout","TRIANGLES","numberOfQuads","useUint16","ELEMENT_ARRAY_BUFFER","totalVertices","getExtension","maxUint16","maxUint16Index","bufferGlType","Uint16Array","currentQuad","ImageRenderer","_maxImages","_maxTextures","_imageCount","_textures","MAX_TEXTURE_IMAGE_UNITS","transformedFrag","_transformFragmentSource","setUniformIntArray","_quads","QuadIndexBuffer","maxTextures","newSource","texturePickerBuilder","_addImageAsTexture","_getTextureIdForImage","swidth","sheight","dx","dy","dwidth","dheight","view","sw","sh","snapToPixel","topleft","topRight","bottomLeft","bottomRight","textureId","potWidth","potHeight","uvx0","uvy0","uvx1","uvy1","_maxRectangles","_rectangleCount","thickness","sub","halfThick","startTop","startBottom","endTop","endBottom","stroke","strokeThickness","topLeft","hasPendingDraws","drawElements","_maxCircles","_circleCount","radius","_webglCtx","_debugText","rectOptions","lineOptions","pointOptions","drawText","ExcaliburGraphicsContextWebGL","_renderers","_isDrawLifecycle","_postProcessTargets","_postprocessors","_transform","_state","StateStack","backgroundColor","ExcaliburGraphicsContextWebGLDebug","canvasElement","enableTransparency","premultipliedAlpha","register","__gl","_init","canvas","_ortho","dim","supported","clearColor","clear","COLOR_BUFFER_BIT","BLEND","blendEquation","FUNC_ADD","blendFunc","ONE","ONE_MINUS_SRC_ALPHA","blendEquationSeparate","blendFuncSeparate","RectangleRenderer","CircleRenderer","LineRenderer","_screenRenderer","ScreenPassPainter","_renderTarget","RenderTarget","__ctx","renderer","rendererName","_currentRenderer","endDrawLifecycle","_alreadyWarnedDrawLifecycle","_isCurrentRenderer","resolution","setResolution","drawLine","drawRectangle","drawCircle","multm","values","toRenderSource","renderWithPostProcessor","renderToScreen","DisplayMode","DisplayMode1","SVGA","Standard","Atari2600","GameBoy","GameBoyAdvance","NintendoDS","NES","SNES","Screen","_antialiasing","_resolutionStack","_viewportStack","_pixelRatioOverride","_isFullScreen","_isDisposed","_fullscreenChangeHandler","_pixelRatioChangeHandler","_listenForPixelRatio","_devicePixelRatio","_calculateDevicePixelRatio","applyResolutionAndViewport","_resizeHandler","_setResolutionAndViewportByDisplayMode","_alreadyWarned","_displayMode","displayMode","Fixed","antialiasing","browser","position","pixelRatio","_mediaQueryList","removeListener","_browser","nativeComponent","matchMedia","addListener","_resizeObserver","disconnect","removeEventListener","FillContainer","FitContainer","parentElement","body","_resolution","_viewport","aspectRatio","scaledWidth","camera","_camera","scaledHeight","graphicsContext","checkIfResolutionSupported","style","imageRendering","updateViewport","resetTransform","isSmooth","isFullScreen","requestFullscreen","exitFullscreen","newX","newY","innerWidth","innerHeight","screenHeight","screenWidth","screenMarginY","screenMarginX","inverse","pageToScreenCoordinates","screenToWorldCoordinates","halfCanvasWidth","halfCanvasHeight","zoom","halfDrawWidth","halfDrawHeight","overflow","aspect","adjustedWidth","adjustedHeight","clientWidth","clientHeight","Position","_initializeDisplayModePosition","_position","Window","ResizeObserver","observe","FillScreen","FitScreen","_computeFit","_computeFitContainer","display","specifiedPosition","marginTop","marginLeft","AudioContextFactory","WebAudio","_UNLOCKED","create","unlockTimeoutTimer","audioContext","resume","createBufferSource","ended","connect","destination","onended","playbackState","isLegacyWebAudioSource","currentTime","PLAYING_STATE","FINISHED_STATE","clearTimeout","Class","eventObject","line1","x1","y1","x2","y2","cap","beginPath","lineCap","moveTo","lineTo","closePath","point1","vector1","roundRect","br","defaultRadius","tl","tr","bl","quadraticCurveTo","circle1","arc","Loader_0","loadables","_resourceList","_playButtonShown","_resourceCount","_numLoaded","_progressCounts","_totalCounts","logo","logoWidth","logoHeight","loadingBarColor","suppressPlayButton","_playButtonStyles","Z","playButtonText","startButtonFactory","buttonElement","getElementById","textContent","_isLoadedPromise","_isLoadedResolve","addResources","_imageElement","playButtonRootElement","_playButtonRootElement","playButtonElement","_playButtonElement","_playButton","existingRoot","appendChild","_styleBlock","head","loadable","addResource","_a1","resizeHandler","_positionPlayButton","evt","click","playButtonClicked","startButtonHandler","stopPropagation","hidePlayButton","removeChild","_delta","showPlayButton","unlock","progress","buttonWidth","buttonHeight","playButtonPosition","canvasHeight","canvasWidth","fillRect","logoY","logoX","logoPosition","imageHeight","oldAntialias","getAntialiasing","setAntialiasing","loadingX","loadingY","loadingBarPosition","progressWidth","REPORTED_FEATURES","gamepadapi","Detector","_features","failedTests","_criticalTests","canvasSupport","elem","arrayBufferSupport","xhr","dataUrlSupport","toDataURL","objectUrlSupport","rgbaSupport","cssText","_warningTest","webAudioSupport","webglSupport","_loadBrowserFeatures","logBrowserFeatures","msg","getBrowserFeatures","arraybuffer","dataurl","objecturl","rgba","webaudio","navigator","getGamepads","failedCritical","warning","CollisionType1","CollisionResolutionStrategy","BroadphaseStrategy","CollisionResolutionStrategy1","BroadphaseStrategy1","Integrator1","Integrator","Physics","gravity","acc","collisionResolutionStrategy","Arcade","Realistic","dynamicTreeVelocityMultiplyer","dynamicTreeVelocityMultiplier","broadphaseStrategy","DynamicAABBTree","defaultMass","integrator","Euler","boundsPadding","positionIterations","velocityIterations","sleepEpsilon","disableMinimumSpeedForFastBody","_getX","getX","_getY","getY","_setX","setX","_setY","setY","owner","newComponent","TagComponent","Component","CoordPlane","CoordPlane1","VectorView","X","Y","createPosView","createScaleView","coordPlane","World","z","getGlobalMatrix","globalPos","globalScale","globalRotation","TransformComponent","_recalculate","setPosition","parentTransform","setRotation","globalScaleX","globalScaleY","vel","scaleFactor","angularVelocity","torque","inertia","CollisionGroup","category","mask","_category","_mask","_name","collisionGroups","combinedName","combinedCategory","All","observers","subscriptions","observer","notifyAll","forEach","notify","cb","colliderA","colliderB","Pair","calculatePairHash","bodyA","BodyComponent","bodyB","group","canCollide","collisionType","PreventCollision","active","collide","collider","idA","idB","Projection","projection","overlaps","DynamicTree","worldBounds","root","nodes","leaf","leafAABB","currentRoot","isLeaf","area","combinedArea","leftCombined","newArea","oldArea","leftCost","inheritanceCost","rightCost","rightCombined","cost","oldParent","newParent","TreeNode","currentNode","_balance","_remove","grandParent","sibling","node","_insert","contains","untrackCollider","multdx","multdy","balance","query","helper","rayCast","numerator","begin","cross","getSlope","divisor","u","getLength","time","getPoint","Set","_collisionPairCache","_colliders","track","CompositeCollider","colliders","getColliders","_dynamicCollisionTree","trackCollider","hash","_pairs","broadphase","targets","seconds","potentialColliders","_pairExists","pair","physics","pairs","checkForFastBodies","collider1","Active","updateDistance","minDimension","fastBodies","updateVec","oldPos","centerPoint","getFurthestPoint","furthestPoint","Ray","minCollider","surfaceEpsilon","minTranslate","rayCastQuery","hitPoint","isValid","shift","update","fastBodyCollisions","narrowphase","contacts","newContacts","collisions","updated","updateCollider","Collider","_collisionProcessor","DynamicTreeCollisionProcessor","_dynamicAABBTree","addCollider","unwire","untrack","worldPos","axes","furthestPoints","bestPoint","maxDistance","mass","totalInertia","getInertia","otherColliders","potentialCollider","getClosestLineBetween","maybeLine","minLine","minLength","minPoint","minDistance","projs","proj","project","newProjection","Line","slope","midpoint","sideVector","clipTime","signed","x0","y0","aMinusP","findPoint","intercept","currPoint","threshold","dxc","dyc","dx1","dy1","ClosestLine","p0","q0","w0","denom","sDenom","tDenom","tClosestParallel","sClosest","tClosest","ClosestLineJumpTable","PolygonPolygonClosestLine","polygonA","polygonB","otherWorldPos","otherDirection","thisDirection","negate","rayTowardsOther","rayTowardsThis","thisPoint","otherPoint","thisFace","getClosestFace","otherFace","face","getEdge","PolygonEdgeClosestLine","polygon","edge","edgeLine","asLine","circle","circlex","circley","circleA","circleB","circleWorlPos","edgeA","edgeB","edgeLineA","edgeLineB","_naturalRadius","CircleCollider","orig","toi","discriminant","toi1","toi2","positiveToi","mintoi","shape","CircleCircleClosestLine","PolygonCollider","PolygonCircleClosestLine","flip","EdgeCollider","CircleEdgeClosestLine","CollisionJumpTable","CollideCircleCircle","CollideCirclePolygon","CollideCircleEdge","getFurthestLocalPoint","dotProduct","scalars","newPos","mtv","tangent","localPoints","info","_canceled","sleeping","sleepMotion","wakeThreshold","setSleeping","isCanceled","polyA","polyB","bestSeparation","bestSide","bestAxis","bestSideIndex","bestOtherPoint","sides","getSides","localSides","getLocalSides","vertB","vertSeparation","distanceToPoint","separation","localSide","sideId","localPoint","polyDir","closestPointOnPoly","minOverlap","minAxis","minIndex","proj1","proj2","overlap","getOverlap","circleAPos","circleBPos","combinedRadius","mvt","local","CollisionContact","SeparatingAxis","findCirclePolygonSeparation","samedir","applyInverse","findSide","findLocalSide","cc","edgeWorld","asLocalLine","da","dda","db","ddb","den","pointOnEdge","dd","CollidePolygonEdge","pc","linePoly","CollidePolygonPolygon","separationA","findPolygonPolygonSeparation","separationB","incident","reference","refDir","clipRight","clip","clipLeft","below","xf","shapeA","txA","shapeB","txB","worldPoint","circlePoint","dist","average","_getBodyPos","_getTransformedBegin","_getTransformedEnd","EdgeEdgeClosestLine","CollideEdgeEdge","transformedBegin","transformedEnd","_boundsFromBeginEnd","edgeNormal","_transformedPoints","_axes","_sides","_localSides","winding","clockwiseWinding","reverse","_calculateTransformation","getTransformedPoints","currentSide","mostDirection","testRay","accum","pts","POSITIVE_INFINITY","faceIndex","denominator","iplusone","crossTerm","minContactTime","contactIndex","contactTime","scalar","effectiveOffset","firstPoint","Shape","Circle","Box","ColliderComponent","$colliderAdded","Observable","$colliderRemoved","_collider","flipped","onAdd","entity","precollision","PreCollisionEvent","postcollision","PostCollisionEvent","CollisionStartEvent","usePolygonCollider","poly","Polygon","useCircleCollider","Edge","DegreeOfFreedom","DegreeOfFreedom1","dependencies","MotionComponent","canSleep","bodiesCanSleepByDefault","_sleeping","bounciness","friction","useGravity","limitDegreeOfFreedom","oldVel","oldAcc","oldRotation","oldScale","inverseMass","updateMotion","currentMotion","bias","sleepBias","motion","xFactor","yFactor","rx","impulse","finalImpulse","addEqual","Rotation","distanceFromCenter","inverseInertia","applyAngularImpulse","CullingBox","_topLeft","_topRight","_bottomLeft","_bottomRight","drawingWidth","currentDrawing","drawingHeight","getGlobalPos","topLeftScreen","worldToScreenCoordinates","topRightScreen","bottomLeftScreen","bottomRightScreen","_xCoords","_yCoords","_xMin","_yMin","_xMax","_yMax","minWorld","maxWorld","_xMinWorld","_yMinWorld","_xMaxWorld","_yMaxWorld","boundingPoints","rect","cullingBox","isSpriteOffScreen","actorBoundsOffscreen","currentScene","isOffScreen","EnterViewPortEvent","removeComponent","ExitViewPortEvent","addComponent","isAddedComponent","isRemovedComponent","components","Entity","_componentsToRemove","_componentTypeToInstance","_tagsMemo","_typesMemo","componentAdded$","componentRemoved$","_parent","childrenRemoved$","_children","_isInitialized","component","_setName","kill","tags","hasTag","removeTag","force","types","_componentStringToInstance","AddedComponent","added","RemovedComponent","_rebuildMemos","children","addChild","getAncestors","childrenAdded$","curr","newEntity","child","templateEntity","getComponents","addTemplate","ctor","constuctorType","_notifyAddComponent","componentOrType","_removeComponentByType","onRemove","delete","_notifyRemoveComponent","isInitialized","onInitialize","_preupdate","PreUpdateEvent","onPreUpdate","_postupdate","PostUpdateEvent","onPostUpdate","_initialize","hasGraphicsTick","graphic","tick","_graphics","graphics","nameOrGraphic","gfx","getGraphic","copyGraphics","getNames","hide","show","order","currentKeys","_component","_layers","_layerMap","default","GraphicsLayer","_maybeAddLayer","_getLayer","graphicsLayerKeys","GraphicsComponent","visible","_bounds","onPreDraw","onPostDraw","layers","GraphicsLayers","graphicToSet","Rectangle","_radius","useColliderShape","useGraphicsBounds","RotationType","EasingFunctions","easing","duration","CreateReversibleEasingFunction","Linear","startValue","endValue","EaseInQuad","EaseOutQuad","EaseInOutQuad","EaseInCubic","EaseOutCubic","EaseInOutCubic","ActionQueue","_actions","_completedActions","_entity","action","clearActions","_currentAction","stop","getActions","hasNext","elapsedMs","isComplete","repeatBuilder","repeat","_stopped","_repeatBuilder","_repeatContext","ActionContext","_actionQueue","getQueue","_repeat","_originalRepeat","MoveBy","_started","_tx","_motion","_speed","_offset","_start","_end","_distance","_dir","destx","desty","RotationType1","rotationType","_rotationType","ShortestPath","_currentNonCannonAngle","distance1","distance2","_shortDistance","_longDistance","_shortestPathIsPositive","_direction","LongestPath","Clockwise","CounterClockwise","distanceTravelled","RotateBy","angleRadiansOffset","scaleX","scaleY","speedX","speedY","_endX","_endY","_speedX","_speedY","_startX","_startY","_distanceX","_distanceY","directionX","directionY","scaleOffsetX","scaleOffsetY","_startScale","_endScale","_directionX","_directionY","CallMethod","_hasBeenCalled","_method","easingFcn","_currentLerpTime","_lerpDuration","_lerpStart","_lerpEnd","_initialized","timeVisible","timeNotVisible","numBlinks","_totalTime","_elapsedTime","_timeVisible","_timeNotVisible","_duration","endOpacity","_multiplier","_endOpacity","delay","_delay","ActionsComponent","entityToFollow","followDistance","_followTx","_current","_followMotion","actorToFollowSpeed","_maximumDistance","actorToMeet","_speedWasSpecified","_meetTx","_meetMotion","_distanceBetween","actorToMeetSpeed","_queue","EaseTo","xOrPos","yOrSpeed","speedOrUndefined","MoveTo","moveBy","xOffsetOrVector","yOffsetOrSpeed","xOffset","yOffset","RotateTo","sizeXOrVector","sizeYOrSpeed","speedXOrUndefined","speedYOrUndefined","sizeX","sizeY","ScaleTo","sizeOffsetXOrVector","sizeOffsetYOrSpeed","sizeOffsetX","sizeOffsetY","ScaleBy","blink","Blink","Fade","Delay","Die","times","Repeat","repeatForever","RepeatForever","Follow","Meet","asPromise","toPromise","easeTo","rotateTo","rotateBy","scaleTo","scaleBy","fade","die","callMethod","follow","meet","_o","_p","_q","_r","quality","family","Normal","bold","unit","Px","LeftToRight","_textBounds","_textToBitmap","_bitmapUsage","Font","blur","_ex","_getTextBitmap","_applyFont","metrics","textHeight","actualBoundingBoxAscent","actualBoundingBoxDescent","lineAdjustedHeight","bottomBounds","actualBoundingBoxLeft","actualBoundingBoxRight","_setDimension","textBounds","fontString","_applyRasterProperties","textBaseline","shadowBlur","shadowOffsetX","shadowOffsetY","colorOverride","lineHeight","strokeText","textAndHash","_getRasterPropertiesHash","clearCache","checkAndClearCache","rasterWidth","rasterHeight","performance","entries","_textWidth","_textHeight","font","Text","_font","_calculateDimension","_anchor","_handleAnchorChange","scene","_draggable","_dragging","_pointerDragStartHandler","_pointerDragEndHandler","_pointerDragMoveHandler","pe","collisionGroup","Actor","defaults","PointerComponent","CanvasDrawComponent","Passive","traits","OffscreenCulling","thePos","theVel","theAcc","theAngle","isVisible","isDraggable","_pointerDragLeaveHandler","currentGraphic","_scene","PreKillEvent","onPreKill","PostKillEvent","onPostKill","_prekill","KillEvent","_postkill","isKilled","addDrawing","asSprite","getZIndex","newZ","newIndex","localCenter","getGlobalScale","getGlobalRotation","recurse","geom","containment","some","within","otherCollider","me","drawing","currFrame","trait","_predraw","_postdraw","PreDrawEvent","Actor_decorate","useBoxCollider","useWorld","coords","fcn","interval","repeats","numberOfRepeats","_totalTimeAlive","_running","_numberOfTicks","maxNumberOfRepeats","_complete","Timer","_MAX_ID","_callbacks","complete","newNumberOfRepeats","newInterval","pause","cancelTimer","xOrConfig","cellWidth","cellHeight","_token","_onScreenXStart","_onScreenXEnd","_onScreenYStart","_onScreenYEnd","_spriteSheets","_legacySpriteMap","_cols","isOffscreen","DebugGraphicsComponent","_composite","useCompositeCollider","currentCol","cd","Cell","registerSpriteSheet","fromLegacySpriteSheet","_updateColliders","clearColliders","tile","solid","prev","getCellByIndex","getCell","getCellByPoint","cell","getRows","getColumns","getWorldBounds","worldCoordsUpperLeft","worldCoordsLowerRight","xEnd","yEnd","graphicsIndex","graphicsLen","PostDrawEvent","grayish","TileMapImpl","_solid","addGraphic","removeGraphic","CellImpl","StrategyContainer","addStrategy","LockCameraToActorStrategy","LockCameraToActorAxisStrategy","cameraElasticity","cameraFriction","ElasticToActorStrategy","RadiusAroundActorStrategy","LimitCameraBoundsStrategy","box","target1","_cam","_eng","target2","cam","currentFocus","getFocus","Axis1","target3","focus","cameraVel","stretch","target4","target5","boundSizeChecked","focusX","focusY","Camera","_cameraStrategies","strategy","_z","dz","az","_posChanged","_pos","_cameraMoving","_isShaking","_shakeMagnitudeX","_shakeMagnitudeY","_shakeDuration","_elapsedShakeTime","_xShake","_yShake","_isZooming","_zoomStart","_zoomEnd","_currentZoomTime","_zoomDuration","_zoomEasing","_easing","_halfWidth","_halfHeight","_follow","ax","ay","easingFn","_lerpPromise","_lerpResolve","shake","magnitudeX","magnitudeY","_zoomPromise","_zoomResolve","cameraStrategy","_screen","currentRes","loadingComplete","res","peekResolution","updateTransform","runStrategies","newZoom","zoomEasing","lerpPoint","CreateVectorEasingFunction","moveEasing","_isDoneShaking","newCanvasWidth","newCanvasHeight","cameraPos","isScreenElement","ScreenElement_ScreenElement","opts","triggerDefaults","EnterTriggerEvent","_dispatchAction","ExitTriggerEvent","_target","wp","Violet","SystemType1","SystemType","RemovedEntity","isRemoveSystemEntity","_world","entities","_entityIndex","_entitiesToRemove","removeEntity","queryManager","addEntity","idOrEntity","deferred","unregister","actors","killed","processComponentRemovals","processComponentRemoval","localeCompare","_entities","T","_key","buildTypeKey","matches","AddedEntity","typesOrEntity","_queries","entityManager","queryType","contain","maybeExistingQuery","getQuery","Query","_addQuery","systems","find","systemType","addSystem","system","initialized","maybeRemoveQuery","s3","preupdate","s1","getEntities","Scene","s2","postupdate","removeSystem","QueryManager","EntityManager","systemManager","SystemManager","Update","updateEntities","updateSystems","findEntitiesForRemoval","processEntityRemovals","entityOrSystem","System","totalAcc","optionalBody","captureOldTransform","EulerIntegrator","integrate","preSolve","solveVelocity","solvePosition","postSolve","ArcadeSolver","CollisionSolver","opposite","velAdj","normalImpulse","tangentMass","aToContact","bToContact","aToContactNormal","bToContactNormal","normalMass","aToContactTangent","bToContactTangent","velA","idToContactConstraint","CollisionPreSolveEvent","matchAwake","finishedContactIds","contact1","contactPoints","pointIndex","squareDistance","ContactConstraintPoint","warmStart","contact2","getContactConstraints","tangentImpulse","CollisionPostSolveEvent","lastFrameContacts","applyImpulse","constraints","FindContactSeparation","maxCorrection","steeringForce","steeringFactor","slop","restitution","impulseDelta","getRelativeVelocity","maxFriction","newImpulse","point2","RealisticSolver","_processor","colliderComponent","subscribe","_trackCollider","_untrackCollider","enabled","colliderComp","_currentFrameContacts","getSolver","solve","runContactStartEnd","_lastFrameContacts","_realisticSolver","_arcadeSolver","ContactStartEvent","id1","c1","ContactEndEvent","AnimationDirection1","AnimationDirection","AnimationStrategy1","AnimationStrategy","EmitterType1","EmitterType","Animation","Loop","frameDuration","timeScale","_firstTick","_currentFrame","_done","_playing","_reversed","totalDuration","goToFrame","maybeFrame","frameIndices","durationPerFrameMs","invalidIndices","animation","legacySprites","Freeze","currentFrameIndex","isPlaying","Backward","Forward","canFinish","done","frameNumber","_nextFrame","PingPong","elapsedMilliseconds","members","_updateDimensions","GraphicsGroup","member","maybeAnimation","_isAnimationOrGroup","ParticleImpl","emitterOrConfig","life","beginColor","endColor","velocity","acceleration","startSize","endSize","particleRotationalVelocity","currentRotation","fadeFlag","_rRate","_gRate","_bRate","_aRate","emitter","particleSize","particleSprite","sizeRate","elapsedMultiplier","ParticleEmitter","tmpColor","drawPoint","removeParticle","accel","focusAccel","Particle","_particlesToEmit","numParticles","isEmitting","particles","deadParticles","minVel","maxVel","minAngle","maxAngle","emitRate","particleLife","minSize","maxSize","_og","emitterType","randomRotation","particle","particleCount","_createParticle","world","ranX","ranY","emitParticles","GraphicsSystem","Draw","_graphicsContext","entityOffscreen","_isOffscreen","_pushCameraTransform","_applyTransform","particleOpacity","_drawGraphicsComponent","_popCameraTransform","graphicsComponent","isDebug","showBounds","boundsColor","ancestors","ancestor","canvasdraw","_clearScreen","offscreen","drawnImages","drawCalls","_collisionSystem","CollisionSystem","graphicsSettings","bodySettings","cameraSettings","filterSettings","useFilter","ids","nameQuery","cursor","txSettings","showAll","showPosition","positionColor","showPositionLabel","entitySettings","showId","showName","showRotation","fromAngle","rotationColor","showScale","scaleColor","showCollisionGroup","showCollisionType","showMass","showMotion","showSleeping","motionSettings","showVelocity","velocityColor","showAcceleration","accelerationColor","colliderSettings","showGeometry","geometryColor","collider2","showOwner","physicsSettings","showBroadphaseSpacePartitionDebug","showCollisionContacts","showCollisionNormals","collisionContactColor","point3","collisionNormalColor","showFocus","focusColor","showZoom","overrideUseColliderShape","overrideUseGraphicsBounds","lastFrameEntityToPointers","currentFrameEntityToPointers","_receiver","pointers","pointerId","entityWasUnderPointer","entered","entityCurrentlyUnderPointer","_processPointerToEntity","_dispatchEvents","pointer","graphicBounds","currentFramePointerCoords","screenPos","addPointerToEntity","lastDownPerPointer","currentFrameDown","isDragStart","lastUpPerPointer","currentFrameUp","isDragEnd","_processMoveAndEmit","lastMovePerPointer","currentFrameMove","isDragging","lastUpDownMoveEvents","_processCancelAndEmit","currentFrameCancel","currentFrameWheel","lastFrameEntities","currentFrameEntities","entitiesWithEvents","_processDownAndEmit","_processUpAndEmit","_processEnterLeaveAndEmit","_processWheelAndEmit","actions","_timers","_cancelQueue","ActionsSystem","MotionSystem","PointerSystem","CanvasDrawingSystem","DebugSystem","triggers","Trigger_Trigger","tileMaps","TileMap","screenElements","timers","onActivate","_oldScene","_newScene","_initializeChildren","onDeactivate","removeTimer","timer","_collectActorStats","$2c23f148d58cd887$export$202e0172ed3c7be0","$2c23f148d58cd887$var$__webpack_exports__","Bhw","$ad2bcec7a0192558$var$game","$2c23f148d58cd887$export$2c3b404bf3a77a1f","$ad2bcec7a0192558$var$paddle","$2c23f148d58cd887$export$f73d3eb6fd876d80","$2c23f148d58cd887$export$892596cec99bc70e","$2c23f148d58cd887$export$ddb2ed749236e720","primary","$ad2bcec7a0192558$var$ball","$ad2bcec7a0192558$var$brickColor","$ad2bcec7a0192558$var$brickWidth","$ad2bcec7a0192558$var$padding","$ad2bcec7a0192558$var$bricks","brick","alert"],"version":3,"file":"index.acb62e86.js.map"}